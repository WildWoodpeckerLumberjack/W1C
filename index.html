<p>Билет 1<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Поступление товара отражается документом «Приходная накладная», продажа – «Расходная накладная». Помимо продажи товара, могут оказываться дополнительные услуги, например по доставке. И услуги и товары указываются в одной табличной части.<br>
 Учет товаров ведется в разрезе складов. Поступление и продажа осуществляется с указанием склада (в шапке документа).<br>
 При проведении документа «Расходная накладная» необходимо производить списание товара со склада. В том случае, когда товара не хватает, документ проводиться не должен.<br>
 Списание себестоимости товаров должно быть организовано по партиям, в зависимости от метода списания (FIFO или LIFO), принятого в учетной политике. Значение учетной политики меняется не чаще одного раза в год. При проведении документа необходимо использовать метод, актуальный на момент проведения. <br>
 Для расчета себестоимости при списании товара необходимо учитывать только момент поступления товара в компанию, вне зависимости от того, на какой склад он пришел. Предположим, для метода списания FIFO первое поступление портсигара произошло на склад «Основной» документом «Приходная накладная №1», а потом на склад «Транзитный» документом «Приходная накладная №2». В этом случае при продаже товара со склада «Транзитный» в первую очередь должна быть списана себестоимость портсигара по документу «Приходная накладная №1», так как она пришла раньше.<br>
 Необходимо построить отчет по остаткам товара на складах на указанную дату.<br>
 <br>
 Остатки товаров на 01.01.2010<br>
Склад<br>
Номенклатура<br>
Кол-во<br>
 Основной</p>

<br>
<p> <br>
Куртка замшевая<br>
2<br>
 <br>
Портсигар<br>
2<br>
 Транзитный</p>

<br>
<p> <br>
Куртка замшевая<br>
5<br>
 <br>
Кинокамера<br>
1<br>
 <br>
 <br>
Бухгалтерский учет <br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задачи следует учесть возможность наличия проводок, сформированных с помощью данного документа.<br>
 Компания занимается торговлей продуктами питания. Учет товаров ведется в разрезе сроков годности. Под сроком годности принимается календарная дата, до которой товар годен к употреблению. На один и тот же товар с разными сроками годности при его поступлении может указываться разная цена. Например, на товар со сроком годности 10 января 2010 цена может быть ниже, чем на товар со сроком годности 30 января 2010. Товар с одинаковым сроком годности может поступать разными документами и по разной цене. Возможна ситуация когда в одном документе один и тот же товар поступает с разными сроками годности (и по разной цене). Учет товаров в разрезе складов не ведется.<br>
 Документ «Приходная накладная» реализует следующую проводку:<br>
Дт «Товары» - Кт «Поставщики» на количество и сумму закупаемого товара.<br>
 Продажа товара регистрируется документом «Расходная накладная». При продаже срок годности не указывается. В первую очередь списывается товар с наименьшим календарным сроком годности. Себестоимость определяется как средняя по товару по всем срокам годности. Т.е. например если 1 пачка йогурта со сроком годности 10.01.2010 поступила по цене 90 рублей и еще 1 пачка того же йогурта, но со сроком годности 30.01.2010 поступила по цене 110 рублей, то при списании себестоимость одной пачки данного йогурта равна 100 рублей.<br>
 Документ «Расходная накладная» реализует следующие проводки:<br>
Дт «Прибыли и убытки» - Кт «Товары» на количество и сумму себестоимости<br>
Дт «Покупатели» - Кт «Прибыли и убытки» на сумму в продажных ценах.<br>
 При проведении документа анализируется наличие этого товара в организации. Если товара не достаточно документ не проводится.<br>
 Необходимо создать отчет, выдающий данные о количественном и суммовом остатке товаров.<br>
 Остатки товаров на 10.01.2010<br>
 Товар<br>
 Срок годности<br>
 Количество<br>
 Сумма<br>
 Йогурт<br>
 <br>
 550<br>
 110 000<br>
 <br>
 20.01.10<br>
 50<br>
 10 000<br>
 <br>
 05.02.10<br>
 500<br>
 100 000<br>
 Кефир<br>
 <br>
 20<br>
 400<br>
 <br>
 20.01.10<br>
 20<br>
 400<br>
 <br>
 Сумма для срока годности должна получаться расчетным образом как средняя цена по данному товару умноженная на количество с данным сроком. Средняя цена рассчитывается как общая сумма данного товара поделенная на общее количество данного товара.<br>
 <br>
Периодические расчеты <br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно только в одном подразделении компании, то есть совместительство не допускается.<br>
 Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам.<br>
 Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в днях. Дневная ставка рассчитывается как начальное значение оклада, деленное на количество рабочих дней в том же периоде, что и фактически отработанные дни. Первоначальное значение оклада может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.<br>
 Дополнительно, сотрудникам компании может быть начислена премия процентом от начисленного им за тот же период оклада. Процент премии зависит от стажа работы сотрудника на данном предприятии. Шкала значений процента премии вводится пользователем в режиме 1С:Предприятия. При решении задачи необходимо учитывать, что на момент начала ведения учета в информационной базе у сотрудника уже может быть стаж отличный от нуля. Например:<br>
 <br>
Трудовой стаж<br>
Процент премии<br>
 до 1 года<br>
5<br>
 От 1 года до 3 лет<br>
10<br>
 От 3 лет<br>
15<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 В форме документа "Начисление зарплаты" необходимо предусмотреть наличие кнопки "Рассчитать", при нажатии на которую, будет произведен предварительный расчет зарплаты. Результат расчета должен быть отражен в табличной части этой же формы.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 <br>
 Для анализа полученных сотрудниками предприятия премий в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 <br>
 Месяц: Июнь 2012 г.<br>
Сотрудник<br>
Трудовой стаж<br>
% премии<br>
Сумма премии<br>
 <br>
 <br>
 <br>
 <br>
 ИТОГО:<br>
 </p>

<br>
<p> Отчет должен быть построен только за определенный календарный месяц<br>
 <br>
Бизнес процессы<br>
 <br>
Сотрудник<br>
Подразделение<br>
Должность<br>
 Васина<br>
Бухгалтерия<br>
Кассир<br>
 Мишина<br>
Бухгалтерия<br>
Кассир<br>
 Мишина<br>
Бухгалтерия<br>
Бухгалтер<br>
 Кротов<br>
Бухгалтерия<br>
Бухгалтер<br>
 Иванов<br>
Бухгалтерия<br>
Гл. бухгалтер<br>
 Хабибулин<br>
Отдел продаж<br>
Начальник отдела<br>
 Крамер<br>
Отдел продаж<br>
Зам. Начальника отдела<br>
 Галкин<br>
Отдел продаж<br>
Менеджер<br>
 Палкин<br>
Отдел продаж<br>
Менеджер<br>
 Малкин<br>
Отдел продаж<br>
Менеджер<br>
 Залкинд<br>
Отдел продаж<br>
Кладовщик<br>
 Лоханкина<br>
Отдел продаж<br>
Кладовщик<br>
 Рахимов<br>
Отдел закупок<br>
Менеджер<br>
 Мансуров<br>
Отдел закупок<br>
Менеджер<br>
 Жупиков<br>
Отдел закупок<br>
Кладовщик<br>
 </p>

<p> <br>
 <br>
 <br>
 <br>
Билет 2<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Поступление товаров отражается документом «Приходная накладная», продажа - «Расходная накладная». Помимо продажи товара, могут оказываться дополнительные услуги, например по доставке. И услуги и товары указываются в одной табличной части.<br>
 Складской учет товаров не ведется.<br>
 В документе «Расходная накладная», в табличной части для каждого товара пользователь указывает партию, которую необходимо списать. В том случае, если товара по указанной партии не хватает, документ не проводится и выводится соответствующее сообщение о нехватке.<br>
 Необходимо построить отчет по анализу продаж товаров за период.<br>
 <br>
 Продажи с 01.01.2010 по 31.03.2010<br>
 <br>
Номенклатура<br>
Кол- во<br>
Себест-стъ<br>
Продажа<br>
Прибыль<br>
Интервал<br>
Срок<br>
 Куртка замшевая<br>
 3<br>
 300<br>
 620<br>
 320<br>
 10<br>
 20<br>
 Портсигар<br>
 3<br>
 30<br>
 50<br>
 20<br>
 Разовая<br>
 50<br>
 Доставка<br>
 1<br>
 <br>
 100<br>
 100<br>
 Разовая<br>
 <br>
 <br>
 Прибыль рассчитывается как:<br>
«Сумма продаж» - «Себестоимость»<br>
 Интервал - расчетный показатель средний интервал отгрузок (в днях). Он рассчитывается как:<br>
(«Дата первой отгрузки» - «Дата последней отгрузки») / «количество отгрузок»<br>
 В том случае, когда отгрузка была только одна, то в колонке Интервал выводится «разовая».<br>
 Срок - расчетный показатель срок последней отгрузки (в днях), определяющий, как давно прошла последняя отгрузка. Он рассчитывается как: <br>
«Конец периода отчета» - «Дата последнего документа отгрузки»<br>
 <br>
Бухгалтерский учет <br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задачи следует учесть возможность наличия проводок, сформированных с помощью данного документа.<br>
 Необходимо реализовать учет дополнительных затрат, связанных с рекламой продаваемого товара.<br>
 Факт передачи товара со склада (отгрузки) покупателю регистрируется документом «Расходная накладная». Данный документ формирует следующие проводки:<br>
Дт «Прибыли и убытки» - Кт «Товары» на сумму себестоимости.<br>
Себестоимость определяется как средняя для каждой номенклатурной позиции по всей компании.<br>
Дт «Покупатели» - Кт «Прибыли и убытки» на сумму в продажных ценах;<br>
 Кроме этого в документе «Расходная накладная» заполняется дополнительный реквизит «Проект», т.е. все продажи осуществляются в разрезе проектов (пустым данный реквизит быть не может). При проведении документа (расходная накладная) анализируется наличие этого товара на указанном в шапке документа складе. Если товара недостаточно документ не проводится.<br>
 Дополнительные затраты на продажу вводятся в систему с помощью документа «Затраты». В табличной части этого документа указывается проект, и сумма, затраченная на затраты в рамках данного проекта. Документы вводятся по мере поступления затрат в течение дня. Считается, что все затраты должны быть отнесены в счет продаж текущего дня. Контролировать наличие продаж по данному проекту при проведении документа «Затраты» не нужно. <br>
 При проведении документ «Затраты» формируют следующие проводки:<br>
Дт «Прибыли и убытки» - Кт «Общехозяйственные затраты» на сумму затрат<br>
 Необходимо построить отчет о продажах с учетом затрат.<br>
 <br>
 Продажи за период с 01.01.2010 по 31.01.2010<br>
Проект<br>
Товар<br>
Кол-во<br>
Себест-сть<br>
Сумма продажи<br>
Сумма затрат<br>
 проект №1</p><br>
<br>
<br>
<p>225<br>
 <br>
Карандаши<br>
100<br>
100<br>
300</p>

<p> <br>
Авторучки<br>
500<br>
5 000<br>
10 000</p>

<p> проект №2</p><br>
<br>
<br>
<p>60<br>
 <br>
Карандаши<br>
50<br>
60<br>
200</p>

<p> <br>
 <br>
Периодические расчеты <br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно только в одном подразделении компании, то есть совместительство не допускается.<br>
 Все сотрудники работают по графику работы, установленному отдельно для каждого подразделения.<br>
 Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в часах. Часовая ставка рассчитывается как начальное значение оклада, деленное на количество рабочих часов в том же периоде, что и фактически отработанные часы. В течение расчетного периода первоначальное значение оклада может быть неоднократно изменено. В информационной базе необходимо хранить историю его изменения. Расчет должен проводиться исходя из действующего на рассчитываемую дату начального значения оклада. Например, если начальное значение оклада изменилось 10 августа, то до 10 августа при расчете берется старое значение, а начиная с 10 августа – новое. <br>
 Дополнительно, сотрудникам компании может быть начислена премия процентом от начисленного им в том же расчетном периоде оклада. Процент премии в течение периода начисления не меняется и задается в документе «Начисление зарплаты». Период (премии) задается с точностью до дня в документе «Начисление зарплаты». Вместо премии, за любой отработанный день, сотруднику может быть выплачена произвольная сумма денег.<br>
 В конфигурации необходимо создать документ «Зарплата к выплате». Документ формируется по конкретному подразделению. Предусмотреть возможность автоматического заполнения документа по остаткам невыплаченных сумм.<br>
 Добавить отчет с шапкой "Расчетно-платежная ведомость № 1 за январь 2010 года по подразделению «Бухгалтерия»", с колонками Сотрудник, Вид расчета, Нач. сальдо, Начислено, Выплачено, Кон. сальдо. Итоги по вертикали.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 <br>
 <br>
Управляемые формы<br>
 С помощью регламентного задания необходимо по расписанию каждый день формировать задачи сотрудникам на создание отчет о проделанной работе. Задача должна порождаться для тех сотрудников, которые числятся в регистре сведений «Сведения о сотрудниках» на момент формирования задачи. По мере возникновения этих задач у пользователя должна автоматически открываться форма каждой невыполненной его задачи.</p>

<p>Затем в задании будет представлен скриншот внешнего вида формы задачи.<br>
На форме следующие поля:<br>
Номер: 000000001, Дата: 21.01.2014 20:25:38<br>
Наименование: Отчет о проделанной работ<br>
Исполнитель: Иванюхин<br>
Перечень работ (многострочное поле):<br>
1. Работал работу на работе<br>
2. Еще немного работал<br>
3. Посещал столовую</p>

<p> <br>
 На рабочем столе необходимо отобразить список невыполненных задач текущего пользователя. Кроме того, пользователь должен иметь возможность видеть полный список задач.<br>
 <br>
 <br>
 </p>

<p>Билет 3<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Поступление товаров отражается документом «Приходная накладная», продажа - «Расходная накладная». Помимо продажи товара, могут оказываться дополнительные услуги, например по доставке. И услуги и товары указываются в одной табличной части.<br>
 Складской учет товаров не ведется.<br>
 Списание себестоимости должно быть в зависимости от принятого на момент проведения документа значения учетной политики. Метод списания себестоимости либо по FIFO, либо по средней. Учетная политика может меняться каждый месяц, её изменение фиксируется соответствующим документом. Например:<br>
 01.01.2012 Учетная политика № 1 Списание по FIFO<br>
 05.01.2012 Прих. накладная № 1 Куртка 1 шт. 1800р. (стоимость закупки)<br>
 10.01.2012 Прих. накладная № 2 Куртка 1 шт. 1000р. (стоимость закупки)<br>
 15.01.2012 Прих Накладная № 3 Куртка 1 шт. 2000р. (стоимость закупки)<br>
 25.01.2012 Расх. накладная № 1 Куртка 1 шт. 1800р. (себестоимость)<br>
 01.02.2012 Учетная политика № 2 списание по средней <br>
 07.02.2012 Расх. накладная № 2 Куртка 1 шт. 1500р. (себестоимость)<br>
 Считается, что документы задним числом не вводятся, но старые документы могут неоперативно перепроводиться.<br>
 Необходимо построить отчет по движениям товаров за период.<br>
 <br>
 Движения товаров за период с 15.01.2012 по 25.01.2012<br>
 Номенклатура<br>
 Партия<br>
 Нач. ост.<br>
 Кол./ сум.<br>
 Приход<br>
 Кол./ сум<br>
 Расход<br>
 Кол. / сум<br>
 Кон. ост<br>
 Кол. / сум<br>
 Куртка <br>
 Замшевая<br>
 <br>
 2<br>
 2800<br>
 1<br>
 2 000<br>
 1<br>
 1 800<br>
 2<br>
 3 000<br>
 <br>
 ПН № 1 от 05.01.12<br>
 <br>
 1<br>
 1 800<br>
 <br>
 1<br>
 1 800<br>
 <br>
 <br>
 <br>
 ПН № 2 от 10.01.12<br>
 <br>
 1<br>
 1 000<br>
 <br>
 <br>
 1<br>
 1 000<br>
 <br>
 ПН № 3 от 15.01.12<br>
 <br>
 <br>
 1<br>
 2 000<br>
 <br>
 1<br>
 2 000<br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задач следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Требуется организовать возможность ведения взаиморасчетов (счет «Покупатели») в разрезе контрагентов и договоров в валюте взаиморасчетов. С каждым контрагентом может быть заключено любое количество договоров (у каждого может быть своя валюта взаиморасчетов). Все взаиморасчеты по договору ведутся только в валюте, указанной в этом договоре, и рублевом эквиваленте.<br>
 Задолженность покупателей возникает при проведении документа «Расходная накладная». В этом документе пользователем указывается сам покупатель («Контрагент») и договор. Все суммы в документе указываются в валюте выбранного договора.<br>
 Документ «Расходная накладная» формирует следующую проводку:<br>
Дт «Покупатели» - Кт «Прибыли и убытки»<br>
на сумму продажи в валюте взаиморасчетов и в рублях по курсу на дату документа<br>
 Оплата задолженности по отгрузке происходит документом «Приход денег», где указывается контрагент и сумма оплаты в рублях. Сумма должна автоматически распределяться на договоры в соответствии с максимальной рублевой задолженностью по договору (чем больше задолженность, тем скорее она должна быть оплачена). Следует считать, что авансов и переплат быть не может.<br>
 Документ «Приход денег» должен формировать следующие проводки:<br>
Дт «Касса» - Кт «Покупатели»<br>
на расчетную сумму оплаты в валюте взаиморасчетов и в рублях по курсу на дату документа.<br>
 Необходимо реализовать обработку документ «Корректировка задолженности», которая бы в соответствии с изменившимся курсом валюты взаиморасчетов корректировала рублевую задолженность покупателя. Т.е. предположим, что при курсе валюты «Валютная» в 10 рублей покупателем был получен товар на 10 единиц «Валютная» (получается, по курсу это 100 рублей). Курс вырос до 12 рублей за единицу валюты. В соответствии с этим рублевая сумма задолженности покупателя должная возрасти на 20 рублей.<br>
 Документ Обработка «Корректировка задолженности» должна формировать документ “Операция” со следующими проводками:<br>
 В случае увеличения рублевого долга покупателя:<br>
Дт «Покупатели» - Кт «Прибыли и убытки» на сумму разницы<br>
 В случае уменьшения рублевого долга покупателя:<br>
Дт «Прибыли и убытки» - Кт «Покупатели» на сумму разницы<br>
 Документ «Корректировка задолженности» «Операция» вводится как регламентный (один экземпляр корректирует все существующие задолженности).<br>
 Необходимо создать отчет о взаиморасчетах с покупателями по выбранной валюте за период с детализацией до документа.<br>
 <br>
 Взаиморасчеты за период с 01.01.2012 по 31.01.2012<br>
Валюта: USD<br>
Контрагент<br>
Договор<br>
Нач. ост.<br>
руб./вал.<br>
Документ<br>
Сумма<br>
руб./вал.<br>
Кон. Ост.<br>
руб./вал.<br>
 InqUnited<br>
Основной<br>
100 000<br>
3 500<br>
Расходная <br>
Накладная №5<br>
50 000<br>
1 700<br>
150 000<br>
5 200<br>
 <br>
Основной<br>
150 000<br>
5 200<br>
Приход денег № 12<br>
155 400<br>
5 200<br>
-5 400<br>
0<br>
 <br>
Основной<br>
-5 400<br>
0<br>
Корректировка долга № 8<br>
5 400<br>
0<br>
0<br>
0<br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, то есть совместительство допускается.<br>
 Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам.<br>
 Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в днях. Дневная ставка рассчитывается как начальное значение оклада, деленное на количество рабочих дней в том же периоде, что и фактически отработанные часы дни. Первоначальное значение оклада может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.<br>
 По мере необходимости любой сотрудник может быть отправлен в командировку.<br>
 В этом случае начисление по окладу не происходит. Часы, проведенные в командировке, определяются по шестидневному графику работы. Часовая ставка для расчета командировки определяется как сумма начислений по окладу за два предыдущих месяца, деленная на количество отработанных часов в двух предыдущих месяцах по основному месту работы. Следует учесть, что данные о командировке могут вводиться в систему задним числом.<br>
 По понедельникам, средам и пятницам по 2 часа времени уходит на вечерние часы. Часовая ставка за каждый вечерний час на 50% больше часовой ставки оклада.<br>
 Вечерние часы (командировка) рассчитываются также, как и для оклада (возможно не требуется).<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 <br>
 <br>
 Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 Подразделение<br>
 Сотрудник<br>
 Вид расчета<br>
 Период1<br>
 Период2<br>
 …<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Итого:<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Отчет может быть построен за любой расчетный период.<br>
 <br>
Управляемые формы<br>
 В справочнике «Контрагенты» необходимо создать управляемую основную форму элемента, в которой пользователь сможет увидеть все движения с участием этого контрагента по регистру бухгалтерии. Доступ к этой информации должен осуществляться из панели навигации.<br>
 В форме документа «Приходная накладная» необходимо предоставить пользователю возможность вводить произвольный текстовый комментарий. Текст комментария может содержать навигационную ссылку (не более одной) на документ оплаты. Переход по навигационной ссылке должен осуществляться при нажатии кнопки открытия, созданной у данного элемента управления формы. <br>
 При проведении документа «Расходная накладная» в случае нехватки товара должно появляться сообщение с указанием реального количества. Данное сообщение должно быть привязано к полю «Количество» соответствующей строки табличной части документа. В случае наличия дублей строк сообщение должно быть связано с первой строкой, содержащей проблемную номенклатуру.<br>
 </p><br>
<br>
<p>Комментарии при сдаче</p>

<p> http://chistov.spb.ru/forum/16-993-27237-16-1357927083<br>
 ОУ: Сделал как здесь http://www.ax-online.ru/Exams/AttPlatf/Task-1.5.aspx, в итоге получил -1 балл. Вывод: не стоит так делать. Я понадеялся на этот сайт, думал там круто решено, оказалось не совсем. Препод сказал, что так, конечно, можно делать, но лучше не нужно. Сказал (цитирую): идеальное решение этой задачи на двух регистрах, один с количеством, другой с суммой.<br>
 С другой стороны, есть комментарии, что так решать можно:<br>
 1. Самое интересное что полтора года назад П.Белоусов говорил что решать надо как в http://www.ax-online.ru/Exams/AttPlatf/Task-1.5.aspx (http://chistov.spb.ru/forum/16-993-27300-16-1358298418)<br>
 2. Человек решал этим же способом, получил “Отлично” (http://chistov.spb.ru/forum/16-993-142#27104)<br>
 БУ: В бух части билета необходимо обратить внимание на то, что документ Приход денег должен погашать именно валютные суммы, несмотря на то, что оплата всегда в рублях. Еще измерение валюта не надо создавать, она указывается в договоре.<br>
 <br>
 http://chistov.spb.ru/forum/16-993-28684-16-1366686967<br>
 УФ: в открытии комментария надо искать не e1cib, а e1cib/data/Документ, поскольку может быть ссылка не только на документ.<br>
 Спросила про блокировки, нужно ли ставить две блокировки БлокироватьДляИзменения и БлокировкаДанных. Оказывается, вопрос спорный, зависит от ситуации и в 5 минутах не рассказать. В задачах на экзамене Д. Гончаров ответил, что он бы не стал, поскольку вообще это может привести к взаимных блокировкам. А на экзамене за двойную блокировку не снижают.<br>
 <br>
 http://chistov.spb.ru/forum/16-993-172#30563<br>
 ОУ. Два метода - по средней и фифо. Отсебятину не добавлял, под два метода затачивал решение. Документ Изменение учетной политики, в случае, когда с фифо менялось на среднюю, списывал все остатки партий и тут же делал приход с незаполненной партией. В расходной вообще разделил проведение в условии Если ИначеЕсли КонецЕсли. В зависимости от текущего метода списания. Данные для списания получал одним запросом. Один регистр накопления, измерения: Номенклатура, Партия, ресуры: Количество, Стоимость. Отчет стандартная ведомость по таблице остатков и оборотов. Красивости не наводил, все ресурсы в отдельных колонках smile <br>
 БУ. Тут тоже вроде ничего не изобретал. Договоры как справочник, подчиненный справочнику Контрагенты. Валюта - реквизит договора. Признак учета Валютный для счета Покупатели и Касса, на счете Покупатели два субконто Контрагент и Договор. В регистре бухгалтерии измерение Валюта (небаланс, связь с ПУ), ресурсы Сумма и ВалСумма (небаланс, связь с ПУ). В документах все стандартно, в расходной просто движения с БлокироватьДляИзменения = Истина, в Приходе денег классическое списание партий по "старой" методике, только в качестве партий договора. Трудности с документом Корректировка задолженности, но я его для себя почти выучил, делал регламентным его, без реквизитов, т.е. отрабатывал для всех контрагентов и их договоров. <br>
 Отчет делал также по таблице Остатки и обороты. Без "красивостей", как в тексте билета. Столкнулся с интересным косяком, добавил признак учета и когда хотел связать его с измерением регистра бухгалтерии и ресурсом, то ПУ в окне выбора не появлялся! Пусто там было. Раньше почему то с таким не сталкивался. Сохранял конфу, конфу базы данных обновлял, бесполезно. Минут 10 был в шоке smile Потом пришла мысль перезапустить конфигуратор целиком. ПУ стал доступен для выбора. Вот такие чудеса smile <br>
 Расчетная часть. Тут вообще как по маслу, с нее и начал решать. Оклад и командировка, все по часам, все в одном ПВР, один РР, Отработано дней накапливал в ресурсе РР, измерения Подразделение (т.к. есть совместительство), Сотрудник, ресурс Сумма и ОтработаноДней, параметр График (связь с графиком). Командировка вытесняет Оклад, ПВР ОсновныеНачисления - с периодом действия, зависит по периоду действия от Осн начислений. РР с периодом действия, связь с графиком, с базовым периодом. В качестве базы для командировки поставил оклад и саму командировку. Сторно должны быть получены и учтены. В общем модуле делал расчет отдельно для оклада, записывал, потом делал отдельным запросом для командировки, записывал. Отчет классический в виде таблицы по периодам. На фразу в билете "В одном документе могу быть данные за разные расчетныепериоды" покосился и забыл. В качестве периода регистрации использовал дату документа smile <br>
 В силу моих особенностей не очень торопиться с мыслями, раздел на управляемые формы не успел сделать, кроме вывода сообщения в расходной, который сделал по ходу оперативной части. <br>
 Вот как то так. В сообщении о результатах экзамена написали "Оценка 3. Результат: Сдан. Не реализован раздел по управляемым формам". Получается, что все остальное проверяющих устроило smile Ну я и рад безмерно smile Все свои сомнительные умозаключения описывал в файле-пояснении к решению, рекомендую это делать всем. Например, я туда написал, что специально не делал красивости в отчетах, т.к. они и так выводят правильные данные smile ну и другие мысли туда понаписал, когда решал СПР и ОУ. <br>
 <br>
 http://chistov.spb.ru/forum/16-2670-30865-16-1378541670<br>
 ОУ: Во-первых, при сортировки по партиям указал дату документа, а нужно было использовать момент времени. <br>
 Во-вторых, сам метод решения был неправильным. Для экзамена пойдет, но для жизни - нет. Многое сделано неоптимально. Сомневался я над решением этой задачи, оказалось не зря. <br>
 Я делал способом описанным здесь на формуме. Для смены учетной политики я сделал месячный регистр сведений. Оказалось не совсем правильно, поскольку учетная политика меняется раз в месяц, но кто сказал, что она должна меняться именно первого числа в начале дня . Упрощение - раз. Далее - не факт, что именно в эту секунду не будет сделан приход или расход. В общем выход один - сделать так, чтобы учетная политика могла устанавливаться на определенный момент времени и меняться хоть сто раз в день. Условие, что учетная политика может меняться раз месяц - это ограничение пользователей. Дополнительных проверок не нужно делать. (Тоже самое касается и бухгалтерского учета, переплат и авансов нет, и проверять это не нужно в программе, это ограничение в самом вводе, контролировать не нужно.) <br>
 Краткое описание как я сделал - один регистр ОстаткиНоменклатуры - два измерения - Номенклатура, Партия - два ресурса - Количество, Сумма. <br>
 Я сделал так - приход в зависимости от метода списания - приход делается либо по пустой партии, либо в партию идет документ прихода. При списании я сделал два алгоритма - либо по среденей, либо по партиям. Получение метода, далее простое условие, если по средней, то один алгоритм и выборка, иначе - другой. Преподаватель сказал, что я сделал лишнюю работу, потерял время, так как можно было сделать одно партионное списание, но баллы не снял. <br>
 Нужно было делать так - списание чисто по партиям. Регистр учетная политика - подчинен регистратору документу СменаУчетной политики и определяется на каждый момент времени (а не даты). Далее основная идея - нет никаких пустых партий в регистре. При переходе на учетную политику по средней документ СменаУчетнойПолитики должен закрывать все партии, а делать приход на себя. То есть Партия - это документ оприходования или же документ смена учетной политики. Вот так. При проведении приходной накладной, она смотрит установленное значение метода списания, если по партиям- пишет в партию себя(ссылку), если же по средней - то из регистра получает, какой документ поставил эту учетную политику, и ставить его. Проведение - по партиям. Всё оказалось просто и легко, работает для любого момента времени, даже если документы были в одной секунде. Можно менять учетную политику много раз в любой интервал времени. <br>
 Всё остальное - более менее нормально и стандартно. <br>
 БУ: счет покупатели - Контрагенты, Договоры. Сумма - баланс, ВалСумма - небаланс, валютный учет. Валюта не является субконто, так как расчеты по одному договору только в этой валюте. Главное в курсах не запутаться. Приход денег без контроля авансов. Корректировка задолженности с проверкой, чтобы не писать пустые записи, если курс не изменился. <br>
 СПР: период регистрации в таблице. Один регистр с периодом действия и базой по периоду действия, виды начисления - командировки и оклад. График пятидневка, отдельный реквизит для хранения. Ресурсы - результат и отработано часов. Командировка вытесняет оклад. База для расчет командировки - оклад. <br>
 Есть одна сложность - получить в запросе для списка сотрудников на разные даты периода регистрации - оклад на первое число. Пришлось обращаться к записям регистра ОкладыСотрудников, искать сначала нужные мне периоды (меньше или равно началу менсяца периода регистрации, дальше брать максимум). Потом уже когда период известен, то по сотруднику, подразделению и периоду в регистре находить нужный мне оклад. Далее стандартно - при расчете, сделать запись результата оклада до расчета командировки. Так же не забыть про сторно записи. <br>
 Отчеты смотрелись только по внешнему виду, сами запросы не смотрелись. Шапки и заголовки не нужны. Однако важно наличие положения колонок - вертикально, горизонтально. Положение и заполнение группировок - отдельно и только в итогах. <br>
 Красоту делать не нужно. Внешний вид документов по умолнчанию. Пересчета табличных частей нет (сумма, цена, количество). Последовательностей нет. В документе операция сделал только установку дату для всех проводок, при отмене проведения делал отмену активности записей. Претензий не было.<br>
 Принимал Белоусов. Было неудобно, торопился всё время. Сняли баллы за решение задач по управляемым формам, не успел всё доделать. По управляемым формам три задачки, я сделал только одну, вторую не до конца, третью не успел. Не хватило чуть-чуть, слишком много времени потратил на отладку ошибок, ввод данных, первоначальный разгон. Снял баллы за решение оперативной задачи. Смотрел код проведения всех документов, запросы, блокировки, запись, проблема копеек. </p>

<p> <br>
Билет 4<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Поступление товаров отражается документом «Приходная накладная», продажа - «Расходная накладная». Помимо продажи товара, могут оказываться дополнительные услуги, например по доставке. И услуги и товары указываются в одной табличной части.<br>
 Учет товаров ведется в разрезе складов. Каждый из складов имеет свой приоритет, который может меняться не чаще чем 1 раз в месяц.<br>
 При проведении расходной накладной необходимо в первую очередь контролировать хватает ли товара вообще. Если нет - выдавать соответствующее предупреждение с указанием количества нехватки и не позволять проводить документ.<br>
 Списание себестоимости товаров должно быть организовано по складам, в зависимости от текущего значения их приоритета и выбранного в документе склада. В первую очередь товар списывается со склада, указанного в шапке документа, далее со склада с минимальным приоритетом, потом со следующего склада с большим приоритетом и т.д. пока не спишется все необходимое количество.<br>
 Себестоимость товаров рассчитывается как средняя по складу.<br>
 Поступление товара происходит на один выбранный пользователем в документе «Приходная накладная» склад.<br>
 Необходимо построить отчет по движениям товаров за период по количеству и сумме.<br>
 Движения товаров с 01.01.2010 по 31.03.2010<br>
 <br>
 Склад<br>
 Товар<br>
 Нач. ост.<br>
 Приход<br>
 Расход<br>
 Кон. ост.<br>
 Оптовый<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Куртка замшевая<br>
 2<br>
 32<br>
 4<br>
 100<br>
 5<br>
 110<br>
 1<br>
 22<br>
 <br>
 Портсигар<br>
 1<br>
 10<br>
 2<br>
 23<br>
 <br>
 3<br>
 33<br>
 Розница<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Куртка замшевая<br>
 1<br>
 21,6<br>
 2<br>
 48,4<br>
 3<br>
 60<br>
 <br>
 Транзитный<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Куртка замшевая<br>
 3<br>
 79,2<br>
 <br>
 <br>
 1<br>
 26,4<br>
 2<br>
 52,8<br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задач следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Необходимо реализовать возможность ведения учета товаров в разрезе организаций, мест хранения и партий товаров. Подразумевается, что для каждой организации баланс будет формировать отдельно (каждая организация – это отдельное юридическое лицо). Склады у организаций «общие» (привязки склада к конкретной организации нет, но товар может принадлежать только одной организации). Под партией товара понимается документ, регистрирующий его поступление.<br>
 Документ «Приходная накладная» реализует следующую проводку:<br>
Дт «Товары» - Km «Поставщики» на количество и сумму закупаемого товара.<br>
 В системе необходимо реализовать документ, который осуществлял бы перемещение товара между собственными организациями (с возможным изменением склада компании). Фактически подобное перемещение будет регистрировать сразу две операции: продажа товара поставщиком покупателю и покупка покупателем товара у поставщика. Регистрация этих операций будет осуществляться документом «КупляПродажа». В шапке документа (при его заполнении) указывается организация-покупатель, организация-поставщик, склад организации-покупателя и склад организации-поставщика.<br>
 Документ «КупляПродажа» реализует следующие проводки:<br>
 По организации-поставщику:<br>
Дт «Прибыли и убытки» - Km «Товары» на количество сумму себестоимости. <br>
 Себестоимость товара рассчитывается для каждой организации в разрезе партий и складов по каждой номенклатурной позиции.<br>
Дт «Покупатели» - Km «Прибыли и убытки» на сумму в продажных ценах;<br>
 По организации-покупателю: <br>
Дт «Товары» - Km «Поставщики» на сумму закупаемого товара.<br>
 Необходимо сформировать отчет позволяющий получать информацию о суммах продаж перемещаемого между организациями товара.<br>
 Продажи собственным организациям за период с 01.01.2010 по 31.01.2010<br>
 Получатель \ Отправитель<br>
 Организация 1<br>
 Организация 2<br>
 Организация 3<br>
 Организация 1<br>
 X<br>
 100 000<br>
 <br>
 Организация 2<br>
 500 000<br>
 X<br>
 250 000<br>
 Организация 3<br>
 <br>
 <br>
 X<br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, т.е. совместительство допускается. Сотрудники каждого подразделения работают в три смены по графику «Сутки через двое».<br>
 Сотрудники предприятия получают оплату по часовому тарифу. Сумма начисления по тарифу определяется как тарифная ставка, умноженная на количество фактически отработанных часов. В течение расчетного периода тарифная ставка задается для каждой смены отдельно и может меняться каждый день. В информационной базе необходимо хранить историю ее изменения.<br>
 Руководителям подразделений выплачивается премия в виде процента от суммы оплат по тарифу за предыдущий месяц сотрудников его подразделения, за исключением оплаты самого руководителя. Ввод надбавки руководителю подразделения осуществляется документом «Начисление зарплаты». Информацию о должностях сотрудников в информационной базе хранить не надо.<br>
 Необходимо предоставить пользователю возможность самостоятельно создавать новые виды расчетов и привязывать их к существующим алгоритмам расчета.<br>
 Для анализа полученных сотрудниками предприятия премий в конфигурации необходимо предусмотреть отчет следующего вида:". Колонки Подразделение, Сотрудник, % премии, Сумма премии. Отчет должен быть построен только за определенный календарным месяц.<br>
 Создать отчет «Перерасчет зарплаты», в котором пользователь должен увидеть записи регистра расчета, которые возможно требуется пересчитать.<br>
 <br>
 Объект перерасчета<br>
 Вид расчета<br>
 Сотрудник<br>
 Подразделение<br>
 <br>
 <br>
 <br>
 <br>
 Саму процедуру перерасчета записей в рамках данной задачи реализовывать не требуется. Ввод всех начислений происходит документом «Начисление зарплаты». Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление по тарифу с 10.01 по 31.01, а запись: тариф с 10.01 по 03.02 вводить нельзя.<br>
 <br>
 <br>
Управляемые формы<br>
 Для контроля правильности формирования движений по документу «Расходная накладная», необходимо создать управляемые основные форму документа и форму списка, чтобы пользователь мог иметь возможность просмотра движений этого документа по всем регистрам, в которые документ делает записи. Доступ к данным регистров должен осуществляться в форме документа из панели навигации, а в форме списка из командной панели формы.<br>
 В целях ведения кадрового учета необходимо предоставить пользователю возможность для каждого сотрудника хранить его фотографию. Выбор и просмотр фотографии необходимо осуществлять из формы соответствующего элемента справочника «Сотрудники». Сама фотография должна храниться либо в информационной базе, либо в виде отдельного файла, в зависимости от желания пользователя. Запись картинки в базу должна происходить только при записи самого элемента справочника, а отображение на форме сразу же после выбора, то есть, до записи.<br>
 <br>
 <br>
 </p>

<p>Билет 5<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Взаиморасчеты с покупателями ведутся в разрезе проектов. Поступления денежных средств от покупателя отражается документом «Приход денег», отгрузка товаров документом «Расходная накладная».<br>
 Весь учет ведется в рублях и дополнительно в разных валютах в зависимости от проекта. Валюта указывается непосредственно в самом проекте. Для каждого проекта валюта может быть указана только одна.<br>
 Возникновение курсовых разниц при поставке и оплате не предполагается.<br>
 При проведении документа курс валюты должен быть взять на дату этого документа.<br>
 В документе «Приход денег» указывается контрагент и сумма платежа. Задолженности погашаются по проектам в порядке их даты оплаты (дата оплаты указывается в проекте). В случае, когда сумма платежа больше всех долгов по отгрузке, оставшаяся сумма в рублях зачитывается как аванс.<br>
 В документе «Расходная накладная» может быть указан только один проект (проект в реквизите шапки). При проведении документа «Расходная накладная» необходимо производить проверку авансов. В том случае, если аванс есть, необходимо его погасить. Оставшаяся сумма должна быть учтена как долг по проекту по отгрузке.<br>
 Учет остатков номенклатуры не ведется.<br>
 Необходимо создать отчет по состоянию взаиморасчетов на дату.<br>
 <br>
 <br>
 Состояние взаиморасчетов на 31.03.2010<br>
 Контрагент/Проект<br>
 Пр-т №1<br>
 Руб./USD<br>
 Пр-т №2<br>
 Руб./EUR<br>
 …<br>
 Аванс<br>
 Руб.<br>
 Красный цветок<br>
 10 000<br>
 5000<br>
 <br>
 <br>
 <br>
 200<br>
 90<br>
 <br>
 <br>
 Красный пролетарий<br>
 <br>
 <br>
 <br>
 2000<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо реализовать возможность закупки и продажи редких товаров. Поступление таких товаров осуществляется документом «Приходная накладная». В документе поступления каждая единица товара оформляется отдельной строкой (с количеством равным 1). Каждой позиции закупаемого товара присваивается уникальный инвентарный номер (считается, что за уникальностью следит пользователь, автоматизировать получение уникальных инвентарных номеров в рамках задачи не требуется). Одним документом может оформляться поступление нескольких одинаковых товаров, но с разными инвентарными номерами.<br>
 Документ «Приходная накладная» реализует следующую проводку:<br>
Дт «Товары» - Kт «Поставщики» на сумму закупаемого товара<br>
 Продажа товара регистрируется документом «Расходная накладная». При продаже инвентарный номер вводится в табличную часть документа вручную. При проведении документа должен производиться контроль наличия указанного в документе товара (по указанному инвентарному номеру). Себестоимость списываемого товара определяется как средняя по номенклатурной позиции по всем ее инвентарным номерам.<br>
 Документ «Расходная накладная» реализует следующие проводки;<br>
Дт «Прибыли и убытки» - Kт «Товары» на сумму себестоимости;<br>
Дт «Покупатели» - Kт «Прибыли и убытки» на сумму в продажных ценах.<br>
 По данным бухгалтерского учета необходимо сформировать отчет, который за указанный интервал дат показывал бы данные о проданном товаре.<br>
 Продажи за период с 01 01.2010 по 31.01.2010<br>
Товар<br>
Инв. номер<br>
Себестоимость<br>
Продажа<br>
 Скрипка<br>
0001<br>
120 000<br>
200 000<br>
 Барабан<br>
0002<br>
51 000<br>
70 000<br>
 Барабан<br>
5008<br>
51 000<br>
75 890<br>
 <br>
 Себестоимость - списанная при продаже себестоимость, Продажа - сумма, за которую товар был продан.<br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, т.е. совместительство допускается. <br>
 Каждый сотрудник компании работает по своему собственному графику. При одновременной работе в разных подразделениях у каждого сотрудника в конкретном подразделении может быть собственный график. Если сотрудник опоздал на работу, то за каждые целые 15 минут опоздания начисляется штраф в размере 100 рублей.<br>
 Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в часах. Сумма начисления по окладу определяется как начальное значение оклада, деленное на количество рабочих часов в том же периоде, что и фактически отработанные часы. Начальное значение оклада одинаково для всех сотрудников конкретного подразделения и должно быть определено по специальной шкале в зависимости от отработанного времени, которая вводится пользователем в режиме 1С: Предприятия. Например:<br>
 <br>
 Подразделение<br>
 Фактически отработанные часы<br>
 Начальный оклад<br>
 Отдел внедрения<br>
 До 60<br>
 2000<br>
 Отдел внедрения<br>
 От 60 до 130<br>
 2500<br>
 Отдел внедрения<br>
 От 130<br>
 3500<br>
 Бухгалтерия<br>
 До 50<br>
 1500<br>
 Бухгалтерия<br>
 От 50 до 150<br>
 2000<br>
 Бухгалтерия<br>
 От 150<br>
 3000<br>
 <br>
 Дополнительно, сотрудникам компании выплачивается надбавка, рассчитываемая как общая сумма продаж товаров за предыдущий месяц по подразделению, в котором работает сотрудник, умноженная на определенный процент. Сумма продаж по подразделению должна быть получена по данным бухгалтерского учета. Значение процента надбавки может быть задано в документе «Начисление зарплаты». <br>
 Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 <br>
 Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 Месяц: Июнь 2012 г.<br>
Подразделение<br>
Сотрудник<br>
Начисление по окладу</p>

<p>Начислено от продаж</p>

<p>Итого:<br>
(Сумма)<br>
 </p>

<p>Отработано (час)<br>
Сумма<br>
%<br>
Сумма</p>

<p> </p><br>
<br>
<br>
<br>
<br>
<p> Итого:</p><br>
<br>
<br>
<br>
<br>
<p> <br>
 Отчет должен быть построен только за определенный календарный месяц.<br>
 <br>
Бизнес-процессы<br>
 <br>
 Сотрудник<br>
 Подразделение<br>
 Должность<br>
 Васина<br>
 Бухгалтерия<br>
 Кассир<br>
 Мишина<br>
 Бухгалтерия<br>
 Кассир<br>
 Мишина<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Кротов<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Иванов<br>
 Бухгалтерия<br>
 Гл. бухгалтер<br>
 Xабибулин<br>
 Отдел продаж<br>
 Начальник отдела<br>
 Галкин<br>
 Отдел продаж<br>
 Менеджер<br>
 Палкин<br>
 Отдел продаж<br>
 Менеджер<br>
 Малкин<br>
 Отдел продаж<br>
 Менеджер<br>
 Залкинд<br>
 Отдел продаж<br>
 Кладовщик <br>
 Лоханкина<br>
 Отдел продаж<br>
 Кладовщик<br>
 Рахимов<br>
 Отдел закупок<br>
 Менеджер<br>
 Жупиков<br>
 Отдел закупок<br>
 Кладовщик<br>
 </p>

<br>
<p>Билет 6<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей складских стеллажей и их комплектующих. Закупка комплектующих отражается документом «Приходная Накладная», продажа – «Расходная накладная».<br>
 Каждый стеллаж представляет собой некоторый фиксированный набор комплектующих (например, 4 стойки, 5 полок и 20 болтов). Необходимо обеспечить уникальность деталей, т.е. одна и та же деталь не может относиться к разным стеллажам. <br>
 Учет остатков ведется в разрезе складов. В документах «приходная накладная» и «Расходная накладная» склад только один (склад – реквизит шапки).<br>
 Возможна продажа как отдельных комплектующих, так и целых стеллажей, причем и стеллажи и их комплектующие указываются в одной табличной части. В случае продажи стеллажа осуществляется списание со склада соответствующего количества комплектующих. В том случае, если каких-либо комплектующих на складе не хватает, документ проводиться не должен. Учет себестоимости деталей вести не требуется. <br>
 Используя планы видов характеристик, необходимо предоставить возможность пользователю добавить произвольное количество характеристик к каждому стеллажу (материал, страна). <br>
 Создать отчет, который в разрезе складов будет показывать количество стеллажей. Например, если стеллаж состоит из 4 стоек, 5 полок и 20 болтов, а на складе есть 8 стоек, 15 полок и 30 болтов, то целый стеллаж только один.<br>
 Также в отчете вывести информацию о стране стеллажа.<br>
 Наличие деталей на дату 31 января 2021 г<br>
 Склад<br>
 Стеллаж, страна<br>
 Кол-во<br>
 Основной<br>
 <br>
 <br>
 <br>
 Высокий, США<br>
 <br>
 <br>
 Низкий, Россия<br>
 3<br>
 Дополнительный<br>
 <br>
 <br>
 4<br>
 <br>
Низкий, Россия<br>
10<br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность вести проводки с произвольной корреспонденцией счетов. При решении задачи следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Требуется реализовать возможность ведения учета товаров в разрезе мест хранения и партий товаров. Под партией товара понимается документ, регистрирующий его (товара) поступление.<br>
 В документе «Приходная накладная» склад указывается в табличной части для каждой строки и формируются следующие проводки:<br>
Дт «Товары» - Кт «Поставщики» на количество и сумму закупаемого товара.<br>
 Продажа товара производится со склада и регистрируется документом «Расходная накладная»<br>
 Склад указывается в реквизите самого документа. При заполнении документа партия товара не указывается. При проведении производится проверка достаточности количества на указанном складе продаваемого товара.<br>
 Документ «Расходная накладная» реализует следующие проводки:<br>
 Дт «Прибыли и убытки» - Кт «Товары» на количество и сумму себестоимости;<br>
 Дт «Покупатели» - Кт «Прибыли и убытки» на сумму в продажных ценах.<br>
 При продаже товара списание партий этого товара производится либо по дисциплине LIFO («последним пришел, первым ушел»), либо FIFO («первым пришел, первым ушел»). Какая из дисциплин будет использоваться, определяется в начале года и в течение года не меняется.<br>
 Себестоимость товара рассчитывается в разрезе партий поступления этого товара.<br>
 Необходимо построить отчет о товарах на складах.<br>
 <br>
 Остатки товаров на 10.01.2010<br>
 Товар<br>
 Склад<br>
 Количество<br>
 Сумма<br>
 Йогурт<br>
 <br>
 550<br>
 65000<br>
 <br>
 «Центральный»<br>
 50<br>
 <br>
 <br>
 «Ближний свет»<br>
 500<br>
 <br>
 Кефир<br>
 <br>
 20<br>
 400<br>
 <br>
 «Центральный»<br>
 20<br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам авто предприятия осуществляется ежемесячно с использованием метода отклонений. Сотрудники работают на автомобилях предприятия, поэтому возможен обмен автомобилями между водителями. <br>
 Все сотрудники работают по графику работы, установленному для каждого автомобиля отдельно.<br>
 Не зависимо от отработанного времени сотрудникам предприятия ежемесячно выплачивается фиксированная сумма денег. Размер суммы одинаков для всех сотрудников и не меняется в течение расчетного периода.<br>
 Сотруднику предприятия выплачивается надбавка, рассчитываемая как общая сумма оплат пассажиров за прошлый месяц, полученная сотрудником, умноженная на определенный процент. Считать, что после расчета сумма оплат корректировке не подлежит. Значение процента для надбавки может изменяться не чаще, чем один раз в месяц. В информационной базе необходимо хранить историю его изменения. <br>
 Один календарный месяц в году сотрудникам предоставляется оплачиваемый отпуск, размер которого определяется как количество дней отпуска, умноженное на среднюю дневную ставку.<br>
 Дни отпуска рассчитываются по пятидневному графику. Средняя дневная ставка определяется как сумма всех начислений за три предыдущих месяца /на кол-во рабочих дней за пред. 3 месяца. Следует учесть, что данные об отпуске не могут вводиться в систему задним числом. <br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетом периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклада: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 Создать отчет «Перерасчеты зарплаты», в котором пользователь должен увидеть записи регистра расчета, которые возможно требуется пересчитать. Обратите внимание, в отчете должна отражаться также информация о необходимости перерасчета надбавки при исправлении суммы оплат пассажиров." Колонки Объект перерасчета, Вид расчета, …<br>
 Саму процедуру перерасчета записей в рамках данной задачи реализовывать не требуется.<br>
 Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 Период март 2012 – июнь 2012г.<br>
Автомобиль<br>
Сотрудник<br>
Вид начисления<br>
Период 1<br>
Период 2<br>
...<br>
 </p><br>
<br>
<br>
<br>
<p> ИТОГО:</p><br>
<br>
<br>
<br>
<p> <br>
Управляемые формы<br>
 Организовать хранение продажных цен деталей в разрезе типов цен (оптовые, розничные и т.д.) в документе «Расходная накладная» необходимо иметь возможность указывать тип цен, по которым осуществляется отпуск товара. В форме выбора деталей, для каждой детали, дополнительно необходимо отражать ее цену (согласно указанному в документе типу цен), а так же текущий остаток на складе. Склад, как и тип цен, указывается в шапке документа «Расходная накладная». При выборе детали в документ должна добавляться не только сама деталь, но и соответствующая цена.<br>
 </p>

<br>
<p>Билет 7<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Поступление товаров отражается документом «Приходная накладная», продажа – «Расходная накладная». Помимо продажи товара, могут оказываться дополнительные услуги, например по доставке. И услуги и товары указываются в одной табличной части.<br>
 Весь учет ведется одновременно в 2-х валютах: рубли и доллары. При проведении документов курс указывается непосредственно в самом документе. Возникновение курсовых разниц на себестоимость при продаже не предполагается.<br>
 Складской учет товаров не ведется.<br>
 Списание себестоимости товаров должно быть организовано по партиям, в зависимости метода списания (FIFO или LIFO), принятого в учетной политике. Значение учетной политики меняется не чаще одного раза в год. При проведении документа необходимо использовать метод, актуальный на момент проведения.<br>
 <br>
 Необходимо построить отчет по продажам товаров за период.<br>
 Продажи с 01.01.2010 по 31.03.2010<br>
Номенклатура<br>
Кол-во<br>
Себест-сть<br>
руб./дол.<br>
Продажа<br>
руб./дол.<br>
Прибыль<br>
руб./дол.<br>
 Куртка замшевая<br>
3<br>
9 000<br>
300<br>
20 000<br>
620<br>
11 000<br>
320<br>
 Портсигар<br>
3<br>
1 000<br>
30<br>
1 800<br>
50<br>
800<br>
20<br>
 Доставка<br>
1</p>

<p>3 200<br>
100<br>
3 200<br>
100<br>
 <br>
 Прибыль по каждой валюте рассчитывается как:<br>
 «Сумма продаж» - «Себестоимость»<br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задачи следует учитывать возможность наличия проводок, формированных с помощью данного документа.<br>
 Взаиморасчеты с покупателями ведутся в разрезе договоров с детализацией до документа отгрузки. С каждым контрагентом может быть заключено произвольное количество договоров. В каждом договоре указывается дата окончания действия этого договора. Задолженность покупателей возникает при проведении документа «Расходная накладная». В этом документе пользователем указывается сам покупатель («Контрагент») и договор (договор вместе с контрагентом указывается в шапке документа). Пользователю должно быть запрещено указывать не соответствующий контрагенту договор.<br>
 Взаиморасчеты с покупателями ведутся одновременно в рублях и евро. Курс евро указывается пользователем вручную в документе.<br>
 Документ «Расходная накладная» формирует следующую проводку:<br>
Дт «Покупатели» - Кт «Прибыли и убытки» на сумму продажи<br>
 Погашение задолженности (оплата переданного покупателю товара) регистрируется с помощью документа «Приход денег». В реквизитах документа указывается контрагент и сумма оплаты. Погашение задолженности происходит в первую очередь по тем договорам, у которых срок окончания действия самый ранний. В рамках каждого договора задолженность погашается в хронологическом порядке, начиная с самой первой недоплаченной накладной. Сумма оплаты не может превосходить сумму задолженности. В том случае, если сумма оплаты больше суммы общей задолженности, то документ не должен проводиться.<br>
 Контроль задолженностей должен производиться по рублевым суммам.<br>
 Незакрытые в евро задолженности, закрытые в рублях, закрываются пользователем вручную с помощью документа «Операция».<br>
 Документ «Приход денег» формирует следующую проводку:<br>
Дт «Касса» - Кт «Покупатели» на расчетную сумму оплат<br>
 Необходимо создать отчет по состоянию взаиморасчетов с покупателями.<br>
Контрагент<br>
Договор<br>
Документ<br>
Оплата<br>
Руб./Евро<br>
Отгрузка<br>
Руб./Евро<br>
 Красный<br>
Пролетарий</p>

<br>
<p>15 000<br>
340<br>
27 000<br>
540<br>
 <br>
1-кр/пр</p>

<p>15 000<br>
340<br>
22 000<br>
540<br>
 </p>

<p>Расх. Накладная № 2<br>
10 000<br>
240<br>
10 000<br>
240<br>
 </p>

<p>Расх. Накладная № 4<br>
5 000<br>
100<br>
12 000<br>
300<br>
 <br>
18-кр/пр</p><br>
<br>
<p> </p>

<p>Расх. Накладная № 14</p>

<p>5000<br>
105<br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, то есть совместительство допускается.<br>
 Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам.<br>
 Количество фактически отработанных часов вводится в систему с помощью документа «Табель». Документ должен заполняться на список сотрудников только определенного подразделения. Для каждого сотрудника, на каждый день месяца, вводится количество фактически отработанных часов на основном месте работы и в командировке.<br>
 Затем в задании будет представлен внешний вид формы табеля.<br>
 На форме в шапке документа поля «Номер», «Дата», «Подразделение».<br>
 Ниже табличная часть. В ней колонки «Сотрудник» и «1», «2», «3»...<br>
 В колонке «Сотрудник» отображается список сотрудников, а на пересечении сотрудника и дня месяца один из трех вариантов: «8», «8К» либо пустое поле.<br>
 <br>
 Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в часах. Часовая ставка рассчитывается как начальное значение оклада, деленное на количество рабочих часов в том же периоде, что и фактически отработанные часы. Первоначальное значение оклада может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.<br>
 По мере необходимости любой сотрудник может быть отправлен в командировку. В этом случае начисление по окладу не происходит. Часы, проведенные в командировке, определяются по пятидневному графику работы, исходя из 40 часовой рабочей недели.<br>
 Часовая ставка для расчета командировки определяется как сумма всех начислений за два предыдущих месяца, деленная на количество рабочих часов в двух предыдущих месяцах. Следует учесть, что данные о командировке не могут вводиться в систему задним числом.<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:<br>
Подразделение<br>
Сотрудник<br>
Вид расчета<br>
Период 1<br>
Период 2<br>
…<br>
 </p><br>
<br>
<br>
<br>
<p> Итого:</p><br>
<br>
<br>
<br>
<p> Отчет может быть построен за любой расчетный период.<br>
 <br>
 <br>
Управляемые формы<br>
 В специальной форме подбора, открываемой из формы документа «Расходная накладная», пользователь должен иметь возможность выбрать произвольное количество номенклатурных позиций, которые в результате отображаются в таблице «Отобранные товары», с указанием самого товара и его количества.<br>
 Дополнительно должна поддерживаться возможность перетаскивания мышкой выбранного товара из списка товаров в таблицу «Отобранные товары».<br>
 После окончания подбора в табличной части документа должны появиться строки со всеми выбранными товарами в указанном количестве.<br>
 Далее будет представлен примерный вид формы.<br>
 На форме две таблицы, в первой отображается «Список товаров», она состоит из двух колонок – «Наименование» и «Код».<br>
 Вторая таблица – «Отобранные товары». В ней две колонки – «Номенклатура» и «Количество».<br>
 Ниже второй таблицы кнопка «Ок».</p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<p> </p>

<p>Билет 8<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Все операции отражаются документами «Приходная накладная», «Расходная накладная», «Приход денег» и «Расход денег», причем для каждого из них может быть указана своя статья затрат. Таким образом, документ «Расход денег» может отражать операции, например, по оплате поставщику или возврата от покупателя в зависимости от выбранной статьи затрат.<br>
 Структурно компания состоит из нескольких подразделений. В целях ведения управленческого учета для каждого отдела заводится бюджет (документ «Бюджет») на произвольный месяц период (указывается в шапке документа) с указанием всех предполагаемых статей затрат, сумм по ним и возможного превышения этих сумм в суммовом выражении. Следует считать, что каждое подразделение может вводить несколько документов «Бюджет», данные которых должны суммироваться для формирования итогового бюджета.<br>
 В целях контроля над исполнением бюджета при проведении любого документа должен происходить анализ фактических затрат и выводится соответствующее предупреждение, в случае превышения над бюджетом. Например, если по статье «оплата поставщикам» запланировано 100 000 и 20 000, то при суммарной оплате более 100 000 и более 120 000 должны быть выданы соответствующие предупреждения.<br>
 Можно считать, что документы задним числом не вводятся, но существующие документы могут быть перепроведены.<br>
 Необходимо создать отчет по исполнению бюджета за период, кратный месяцу.<br>
 Исполнение бюджета за период с 01.01.2010 по 29.02.2010<br>
Подразделение<br>
Статья<br>
Январь</p>

<br>
<p>Февраль</p>

<br>
<p> </p>

<p>План<br>
Факт<br>
% исп.<br>
План<br>
Факт<br>
% исп.<br>
 Отд. закупок</p><br>
<br>
<br>
<br>
<br>
<br>
<p> <br>
Оплата поставщикам<br>
500<br>
450<br>
90<br>
500<br>
500<br>
100<br>
 <br>
Закупка товара<br>
500<br>
470<br>
 94<br>
500<br>
530<br>
106<br>
 <br>
Зарплата<br>
20<br>
22<br>
110<br>
20<br>
25<br>
125<br>
 Розница</p><br>
<br>
<br>
<br>
<br>
<br>
<p> <br>
Оплата покупателей<br>
800<br>
880<br>
110<br>
800<br>
840<br>
105<br>
 <br>
Возвраты покупателей<br>
5</p>

<br>
<p>5<br>
2<br>
40<br>
 <br>
 «% исп.» рассчитывается как процент фактических затрат относительно плановых.<br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задачи следует учитывать возможность наличия проводок, формированных с помощью данного документа.<br>
 Необходимо реализовать возможность закупки и продажи редких товаров. Поступление таких товаров осуществляется документом «Приходная накладная». В документе поступления каждая единица товара оформляется отдельной строкой с количеством равным 1. Каждой позиции закупаемого товара присваивается уникальный инвентарный номер (считается, что за уникальностью следит пользователь, автоматизировать получение уникальных инвентарных номеров в рамках задачи не требуется). Одним документом может оформляться поступление нескольких одинаковых товаров, но с разными инвентарными номерами.<br>
 Документ «Приходная накладная» реализует следующую проводку:<br>
Дт «Товары» - Km «Поставщики» на сумму закупаемого товара.<br>
 Продажа товара регистрируется документом «Расходная накладная». При продаже инвентарный номер вводится в табличную часть документа вручную. При проведении документа должен производиться контроль наличия указанного в документе товара (по указанному инвентарному номеру). Себестоимость списываемого товара определяется по каждой номенклатурной позиции для каждого ее инвентарного номера. При списании себестоимости следует учесть, что она может быть скорректирована пользователем документом «Операция» и не совпадать с закупочной ценой.<br>
 Документ «Расходная накладная» реализует следующие проводки:<br>
Дт «Прибыли и убытки» - Km «Товары» на сумму себестоимости;<br>
Дт «Покупатели» - Km «Прибыли и убытки» на сумму в продажных ценах.<br>
 Также в документе «Расходная накладная» указывается сотрудник, осуществивший продажу. Для сотрудников нужна возможность указывать различные свойства – пол, образование, наличие прав и т.п. <br>
 Необходимо сформировать отчет, который за указанный интервал дат показывал бы данные о продажах товара сотрудниками.<br>
 <br>
 Сотрудник<br>
 Образование (свойство)<br>
 Товар<br>
 Стоимость<br>
 Продажа<br>
 Бельдыев<br>
 Среднее<br>
 Скрипка/0012<br>
 150 000<br>
 200 000<br>
 Иванов<br>
 Высшее<br>
 Барабан/0014<br>
 50 000<br>
 70 000<br>
 Иванов<br>
 Высшее<br>
 Барабан / 0024<br>
 52 000<br>
 75 990<br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений и ведется одновременно в двух валютах (долларах США и евро). В информационной базе нужно хранить историю изменений курса валют. При начислении зарплаты необходимо использовать курс валюты, актуальный на дату документа.<br>
 В информационной базе нужно хранить историю изменений курса валют. При начислении зарплаты необходимо использовать курс валюты, актуальный на дату документа.<br>
 Сотрудники предприятия получают оплату по часовому тарифу. Сумма начисления по тарифу определяется как тарифная ставка, умноженная на количество фактически отработанных часов. Тарифная ставка должна быть определена отдельно для каждого подразделения по специальной шкале в зависимости от отработанного времени и вводится пользователем в режиме 1С:Предприятие. Например:<br>
 <br>
 Подразделение<br>
 Фактически отработанные часы<br>
 Размер ставки<br>
 Отдел внедрения<br>
 до 60<br>
 12,5<br>
 Отдел внедрения<br>
 от 60 до 130<br>
 25<br>
 Отдел внедрения<br>
 от 130<br>
 35<br>
 Бухгалтерия<br>
 до 50<br>
 10<br>
 Бухгалтерия<br>
 от 50 до 150<br>
 20<br>
 Бухгалтерия<br>
 от 150<br>
 40<br>
 Сотрудники могут работать сверхурочно по плану, установленному заранее. За каждый час сверхурочно отработанного времени начисляется сумма в размере 150% от средней часовой ставки за предыдущий месяц. Средняя часовая ставка рассчитывается как сумма всех начислений за указанный период, поделенная на количество рабочих часов в этом периоде.<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление по тарифу с 10.01 по 31.01, а запись: тариф с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за один расчетный период.<br>
 Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 Подразделение<br>
 Сотрудник<br>
 Вид<br>
 расчета<br>
 Период 1<br>
 <br>
 Период 2<br>
 <br>
 ...<br>
 <br>
 <br>
 <br>
 Сумма в USD<br>
 Сумма в EUR<br>
 Сумма в USD<br>
 Сумма в EUR<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Итого:<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Отчет может быть построен за любой расчетный период</p>

<p>Управляемые формы<br>
 В компании продажами занимаются обычные менеджеры и старшие менеджеры. С целью дополнительного контроля при продаже в документах «Приход денег» и «Расходная накладная» может быть указан ответственный старший менеджер, контролирующий данную операцию. Указывать эту информацию может не каждый пользователь, а только обладающий соответствующими привилегиями. В том случае, если у пользователя отсутствуют необходимые полномочия, информация об ответственном менеджере должна быть для него не видима. Управление видимостью должно быть реализовано с помощью механизма функциональных опций. Следует учитывать, что права на просмотр и внесение данных об ответственном сотруднике могут меняться не чаще, чем 1 раз в день. Информация в документе должна отображаться только в том случае, если на дату документа пользователь имел соответствующие права.<br>
 </p>

<p>Билет 9<br>
Оперативный учет<br>
 Организация занимается оптовой торговлей. Для описания товаров существуют различные характеристики, набор которых составляет свойство. Учет товаров ведется в разрезе свойств этих товаров, причем для каждого товара набор этих свойств может быть произвольный. Например, «ботинки черные 42 размера», «ботинки коричневые 42 размера» и «ботинки коричневые 44 размера утепленные» это один товар «ботинки», но с разными свойствами. «Черные 42 размера» будет являться свойством, а цвет «черный» и размер «42» являются характеристиками.<br>
 Поступление товаров отражается документом «Приходная накладная», продажа - «Расходная накладная». И в документе поступления, и в документе списания для каждого товара указывается его свойство.<br>
 Механизм свойств и характеристик товаров должен быть реализован с использованием плана видов характеристик.<br>
 Складской учет товаров не ведется.<br>
 Списание себестоимости товаров должно быть организовано в разрезе свойств.<br>
 Необходимо построить отчет о движениях товаров за период по выбранной характеристике в количественном и суммовом выражении.<br>
 <br>
 Ведомость товаров с 01.01.2010 по 31.03.2010 по характеристике «производитель».<br>
Харак-ка<br>
Товар<br>
Нач. остаток<br>
Приход<br>
Расход<br>
Кон. остаток<br>
 Adidas</p><br>
<br>
<br>
<br>
<p> <br>
Куртка замшевая<br>
2</p>

<p>4</p>

<p>5</p>

<p>1</p>

<p> <br>
Портсигар<br>
1</p>

<p>2</p>

<br>
<p>3</p>

<p> Puma</p><br>
<br>
<br>
<br>
<p> <br>
Куртка замшевая<br>
1</p>

<p>2</p>

<p>3</p>

<br>
<p> Nike</p><br>
<br>
<br>
<br>
<p> <br>
Куртка замшевая</p>

<p>3</p>

<p>1</p>

<p>2</p>

<p> <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность вести проводки с произвольной корреспонденцией счетов. При решении задачи следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Необходимо реализовать возможность торговли товара с использованием агентов. Т.е. товар может продаваться самостоятельно (обычным порядком) и через агента. В обоих случаях используется документ «Расходная накладная». При продаже через агента заполняется дополнительный реквизит шапки «Агент».<br>
 Продажа через агента заключается в том, что агент «приводит» клиента в компанию. Таким образом, в документе «Расходная накладная» в качестве контрагента указывается реальный покупатель. В табличной части указываются цены, по которым покупатель приобретает товарные позиции. Агент получает вознаграждение в виде 20% от разницы между продажной стоимостью и себестоимостью проданных с его участием позиций. Сама выплата вознаграждения агенту отражается ручной операцией.<br>
 Учет ведется в рублях, а с агентами дополнительно ведется в валюте, причем для каждого агента установлена своя собственная валюта, не подлежащая пересмотру. При начислении вознаграждения агенту, валютная сумма определяется исходя из рублевой суммы, валюты агента и курса, установленного для данной валюты на дату документа.<br>
 Документ «Расходная накладная» делает следующие проводки:<br>
Дт «Прибыли и убытки» - Кт «Товары» на количество и себестоимость товара;<br>
Дт «Покупатели» - Кт «Прибыли и убытки» на сумму продажи.<br>
 В случае если товар продается через агента, то делается дополнительная проводка:<br>
Дт «Прибыли и убытки» - Кт «Агенты» на сумму вознаграждения агента.<br>
 Документ не должен проводиться в случае, если каких-либо из указанных товаров не хватает. Учет товаров ведется в разрезе складов. Себестоимость рассчитывается как средняя по номенклатурной позиции на складе.<br>
 <br>
 Необходимо построить отчет о задолженности перед агентами на 10.01.2010<br>
 Агент<br>
 Валюта<br>
 Сумма валютная<br>
 Сумма рублевая<br>
 <br>
 <br>
 <br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление методом отклонений. Все работают по одному графику, но нужно предусмотреть возможность работы по нескольким графикам. Сотрудники могут работать в разных подразделениях.<br>
 Оклад по часам. Ставка часовая меняется раз в месяц и берётся на начало расчетного периода. <br>
 Больничный. Рассчитывается как количество дней болезни умноженное на среднюю дневную ставку. Средняя дневная ставка = Сумма оклада, начисленного за предыдущий месяц, деленная на количество рабочих дней в том же месяце.<br>
 Перерасчеты использовать не нужно. <br>
 В одном документе Начисление ЗП может быть и оклад и больничный. Данные могут вводиться задним числом. Оклад вводится всегда в пределах месяца. Больничный можно вводить с 25.01 по 10.02 одной строкой.<br>
 Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 <br>
Подразделение<br>
Сотрудник<br>
Дней болезни<br>
Сумма начисленного больничного<br>
 </p><br>
<br>
<p> <br>
 <br>
Управляемые формы<br>
 Фотография в справочнике «Сотрудники» - выбирать фотку из файла и сохранять в самой базе. <br>
 <br>
 Комментарии при сдаче<br>
 БУ: аналитика по валюте заведена некорректно. Я создал субконто Валюта, но валюта у нас задается в справочнике Контрагентов и не подлежит пересмотру, поэтому субконто не нужно, это излишняя информация. Достаточно ресурса "Вал сумма" по признаку учета "Валютный", устанавливаемых на счетах с субконто "Контрагент". А в отчете валюту можно подтянуть из контрагента. <br>
 </p>

<br>
<p>Билет 10<br>
Оперативный учет<br>
 Компания является заведением общественного питания. Возможна продажа как отдельных продуктов, так наборов этих продуктов и готовых блюд.<br>
 Набор представляет из себя перечень продуктов, хранящихся на складе. Например, можно продавать в виде набора пирожное и чай, а можно по отдельности - отдельно чай, отдельно пирожное.<br>
 В том случае, если из продуктов изготовлено блюдо, например из овощей сделан салат, то продаваться может только само блюдо, а входящие в его состав продукты проданы быть не могут.<br>
 Для каждой номенклатурной позиции (продукта, блюда) к ней добавляются любое количество характеристик. Набор характеристик является свойством. Например,Салат «огуречный, входит в комплексный обед, диетический» или томат «мелкий, красный, тепличный». «Огуречный», «входит в комплексный обед», «диетический» - это характеристики, а «Огуречный, входит в комплексный обед, диетический» - свойство.<br>
 Учет номенклатур, но не наборов, ведется в разрезе свойств. Механизм должен быть реализован с помощью плана видов характеристик. Одно и то же свойство может быть указано для различных номенклатурных позиций.<br>
 Закупка продуктов отражается документом «Приходная накладная», продажа - «Расходная накладная». Для отражения приготовления блюд служит документ «Комплектация». Документом комплектация пользователь делает движения в любой регистр накопления и правильность записей контролирует сам.<br>
 Учет номенклатуры в разрезе складов не ведется.<br>
 При продаже в одной табличной части указываются продукты, наборы и готовые блюда.<br>
 Со временем (не чаще, чем 1 раз в день) состав набора может изменяться. При продаже должен приниматься тот состав набора, который был актуальным на момент продажи.<br>
 <br>
 Ведомость продуктов и блюд за период с 01.01.2010 по 31.03.2010<br>
Номенклатура<br>
Нач. ост.<br>
Приход<br>
Расход<br>
Кон. ост.<br>
 Салат «Столичный»<br>
2<br>
4<br>
5<br>
1<br>
 Салат «Капрезе»<br>
1<br>
2</p>

<p>3<br>
 Булочки<br>
100<br>
200<br>
300</p>

<p> Отчет строится по количеству для продуктов и блюд. <br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задач следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Необходимо организовать учет перемещений товаров. Складской учет ведется в рамках одной организации в разрезе складов. Склады территориально удалены друг от друга. Перемещение из одного склада на другой может идти несколько дней.<br>
 Факт отправления регистрируется в системе с помощью документа «Отправление». В шапке документа указывается склад. В табличной части указывается перемещаемый товар и его количество. Документ делает следующие проводки:<br>
Дт «Товары в пути» - Кт «Товары» в указанном количестве. <br>
 Себестоимость определяется как средняя по товару в разрезе склада.<br>
 Если на складе отправителе товар в нужном количестве отсутствует, документ не проводится.<br>
 Факт прибытия товара на склад получатель отражается документом «Прибытие». В документе указываются склад получатель, документ отправки, а в табличной части указывается перечень прибывших товаров и их количество. Товар может теряться в дороге или приходить по частям (табличная часть может подвергаться корректировке), но в результате корректировки недопустимо прибытие товара, который не отправляли. Документ реализует следующие проводки:<br>
Дт «Товары» - Кт «Товары в пути» па количество и стоимость прибывшего товара<br>
 Стоимость одной единицы товара остается неизменной в процессе перемещения и соответствует себестоимости одной единицы отправленного товара.<br>
 Потери товара необходимо регистрировать вручную с помощью документа "Операция":<br>
Дт «Прибыли Убытки» - Кт «Товары в пути» на количество и стоимость потерянного товара.<br>
 Необходимо получать отчет о потерях товара.<br>
 <br>
 Недошедшие товары на 01.02.2010<br>
Склад получатель<br>
Товар<br>
Отправлено кол/сум<br>
Получено кол/сум<br>
Потери кол./сум.<br>
 Основной</p><br>
<br>
<br>
<p> <br>
Сосиска<br>
5<br>
500<br>
1<br>
100<br>
4<br>
400<br>
 В колонку «Потери» должны попадать все записи счета ТоварыВПути, за исключением записей по прибытию товара.<br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, то есть совместительство допускается.<br>
 Сотрудники предприятия получают оплату по часовому тарифу. Сумма начисления по тарифу определяется как тарифная ставка, умноженная на количество фактически отработанных часов. <br>
 За каждый день работы сотрудникам предприятия начисляется определенная сумма денег в качестве компенсации затрат на обеды. Компенсация за один обед рассчитывается как 5% от суммы начисления по тарифу в текущем расчетном периоде, деленная на количество рабочих дней в том же периоде.<br>
 Невыход сотрудника на работу без уважительной причины должен быть зафиксирован в информационной базе, но не оплачивается, может вводиться задним числом.<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление по тарифу с 10.01 но 31.01, а запись: тариф с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 Для анализа начисленных сотрудникам предприятия компенсаций за обеды в конфигурации необходимо предусмотреть отчет следующего вида:<br>
Подразделение<br>
Сотрудник<br>
Кол-во дней, за которые начислена комп-я<br>
Сумма компенсации<br>
 Отдел внедрения</p><br>
<br>
<p> <br>
Иванов<br>
18<br>
630,00<br>
 <br>
Петров<br>
20<br>
700,00<br>
 Бухгалтерия</p><br>
<br>
<p> <br>
 Сидоров<br>
15<br>
300,00<br>
 Отчет может быть построен за любой расчетный период.<br>
 <br>
Бизнес-процесс</p>

<p>Сотрудник<br>
Подразделение<br>
Должность<br>
 Васина<br>
Бухгалтерия<br>
Кассир<br>
 Мишина<br>
Бухгалтерия<br>
Кассир<br>
 Мишина<br>
Бухгалтерия<br>
Бухгалтер<br>
 Кротов<br>
Бухгалтерия<br>
Бухгалтер<br>
 Иванов<br>
Бухгалтерия<br>
Гл. бухгалтер<br>
 Онопко<br>
Отдел закупок<br>
Начальник отдела<br>
 Бельдыев<br>
Отдел закупок<br>
Менеджер<br>
 Рахимов<br>
Отдел закупок<br>
Менеджер<br>
 Мансуров<br>
Отдел закупок<br>
Менеджер<br>
 Мансуров<br>
Отдел закупок<br>
Кладовщик<br>
 Халиков<br>
Отдел закупок<br>
Кладовщик<br>
 Петров<br>
Отдел закупок<br>
Кладовщик<br>
 Васина<br>
Отдел закупок<br>
Менеджер<br>
 Петров<br>
Отдел продаж<br>
Кладовщик<br>
 <br>
Комментарии при сдаче</p>

<p>ОУ: 1 регистр "остатки номенклатуры" - измерение номенклатура, ресурс количество; <br>
документ "комплектация" - по типу документа "операция" из бухгалтерии - блюдо с видом движения "приход", продукты с видом движения "расход", препод сказал "молодец, угадал" (до этого долго его спрашивал, что от меня хотят в задаче). В расходной проведение по новой методике (примерно как в 1.13). Реализацию условия про то, что нельзя продавать продукты, из которых сделано блюдо, сделал по-тупому - через булевный реквизит справочника номенклатура "используется в блюдах", потом в расходной отсекал такие продукты через параметры выбора - препод не смотрел. В целом препод был доволен.<br>
БУ: в отправлении допустил ужасный страшный косяк - вместо себестоимости товара зафигачил сумму по документу (которая наверно вообще не нужна), т.е. кроме неправильных цифр, выбрал неверную методику проведения, использовал не ту блокировку. В прибытии преподу не понравилось внутреннее соединение табличной части и остатков, хотя по-моему тут только так и можно (не понял я его, короче). Отчет тоже плохой - чтобы получить склад использовал обороты по счету "товары", оказалось нужно было его вытаскивать из "Товаров в пути".<br>
СПР: увидел в отчете подразделения и, совершенно не думая, засунул его в измерения регистров - за что сразу получил по носу, в условии явно сказано "совместительство не допускается" (будьте бдительны wink );</p>

<p>ОУ: на экзамене решила использовать только приготовление блюд, регистр <br>
сведений "Комплектация" сделала независимым от регистратора - похоже это сочли за ошибку: документ "Комплектация сделан неверно"(в комментариях).<br>
БУ №39 , без особых изменений. Добавлено, что потери списываются ручной операцией на счет "ПрибылиУбытки", отчет немного другой - склад,товары, отправлено,получено,потери (в отчете потери нужно показать по проводкам, в корреспонденции не со счетом "Товары"). <br>
СПР сделана на основе З.20, но сильно изменена:нет условия про подразделения, что у каждого свой график, нет шкалы,нет условия про исправление результата в форме документа.Отчет проще - подразделение,сотрудник,количество дней,сумма компенсации. Добавлено совместительство,плюс это условие, когда разные виды расчетов могут считаться в одном документе, а могут отдельно, и в одном документе за разные периоды расчет. У меня замечания именно по этим добавленным пунктам: совместительство реализовано неверно(измерение "Подразделение" в РР у меня было), база получается до расчета записей, входящих в нее, это про компенсацию,если в одном док-те оклад и компенсация( я приоритеты ввела, но использовать их в алгоритме расчета не сумела).</p>

<p>ОУ: Сказано, что документ Комплектация может делать движения по любому регистру накопления. Этот момент оказался мне не совсем понятен. Делал обычным способом, проводил по единственному остаточному регистру накопления. На защите экзаменатор сказал, что этот документ должен быть неким аналогом документа "Операция" из БУ. Как это реализовать, а главное зачем, не очень понял. <br>
БУ: При решении в документе "Отправление" все равно указывал склад-получатель, по-другому просто не придумал, как построить отчет в требуемом виде. Судя по комментарию, экзаменатор на это ничего не сказал.<br>
 </p>

<br>
<p>Билет 11<br>
Оперативный учет<br>
 Организация занимается торговлей скоропортящимися продуктами. Доставка товара покупателю отражается документом «Расходная накладная», оплата покупателя - документом «Приход денег». При получении товара покупатель по каждой накладной составляет акт о фактическом поступлении товара, за вычетом испортившегося при транспортировке. Данная информация также указывается в документе «Расходная накладная».<br>
 Оплата покупателя поступает общей суммой по нескольким накладным (накладные указываются в табличной части, сумма в шапке). При проведении документа оплаты должны автоматически распределяться по накладным, начиная с самой ранней недооплаченной, причем оплаты должны распределяться с учетом фактической (реально получено согласно акту) задолженности покупателя. Следует считать, что переплат и авансов нет.<br>
 Необходимо создать отчеты о состоянии отгрузок товаров за период.<br>
 <br>
 Отгрузки товаров за период с 01.01.2010 по 31.03.2010<br>
Товар<br>
Отгружено нами<br>
Кол./сум.<br>
Получено покупателем<br>
Кол./сум.<br>
 Куртка замшевая<br>
10<br>
100000<br>
8<br>
80000<br>
 Портсигар<br>
50<br>
50000<br>
50<br>
50000<br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задач следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Требуется организовать учет перемещений товаров. Складской учет ведется в рамках одной организации в разрезе складов. Склады территориально удалены друг от друга. Перемещение из одного склада на другой может идти несколько дней.<br>
 Факт отправления регистрируется в системе с помощью документа «Отправление». В шапке документа указывается склад - отправитель и ожидаемая дата прибытия товара. В табличной части указывается перемещаемый товар и его количество. Документ делает следующие проводки:<br>
Дт «Товары в пути» - Km «Товары» в указанном количестве. <br>
 Себестоимость определяется как средняя по товару в разрезе склада.<br>
 Если на складе отправителе товар в нужном количестве отсутствует, документ не проводится.<br>
 Факт прибытия товара на склад получатель отражается документом «Прибытие». Документ вводится только на основании документа «Отправление». Считается, что отправляемый товар доходит до получателя в полном объеме, но дата фактического прибытия может отличаться от запланированной. Кроме того, в процессе передачи могут происходить потери. Подобного рода потери отражаются пользователем с помощью документа «Операция» до того, как будет оформлено прибытие товара. В документе «Прибытие» указывается только дата фактического прибытия товара и документ отправления.<br>
 Документ «Прибытие» реализует следующие проводки:<br>
Дт «Товары» - Km «Товары в пути»<br>
 Количество и стоимость соответствуют количеству и сумме отправленного товара.<br>
 Необходимо иметь возможность сформировать отчет о задержках перемещаемого товара. В отчет должны выводиться данные только о тех перемещениях, у которых прибытие произошло позже запланированного срока.<br>
 <br>
 Задержки товара, поступившего за период с 01.01.2010 по 31.01.2010<br>
 Отправитель<br>
 Получатель<br>
 Дата прибытия<br>
 Задержка<br>
 Основной<br>
 Региональный 1<br>
 15 января 2010<br>
 2<br>
 Основной<br>
 Региональный 2<br>
 17 января 2010<br>
 7<br>
 <br>
 Данные отчета должны содержать сведения только о тех товарах, которые прибыли в выбранном периоде. Задержка показывает количество дней просрочки относительно плановой даты.<br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, то есть совместительство допускается.<br>
 Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам.<br>
 Количество фактически отработанных часов вводится в систему с помощью документа «Табель», Документ должен заполняться на список сотрудников только определенного подразделения. Для каждого сотрудника, на каждый день месяца, вводится количество фактически отработанных часов на основном месте работы.<br>
 Затем в задании будет представлен внешний вид формы табеля.<br>
 На форме в шапке документа поля «Номер», «Дата», «Подразделение».<br>
 Ниже табличная часть. В ней колонки «Сотрудник» и «1», «2», «3»...<br>
 В колонке «Сотрудник» отображается список сотрудников, а на пересечении сотрудника и дня месяца один из трех вариантов: «8», «К» либо пустое поле.<br>
 <br>
 Сотрудники предприятия получают оплату по часовому тарифу. Сумма начисления по тарифу определяется как тарифная ставка, умноженная на количество фактически отработанных часов. В течение расчетного периода тарифная ставка может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.<br>
 Дополнительно, сотрудникам компании должна быть начислена премия процентом от начисленного в том же расчетном периоде оклада. Процент премии должен храниться в информационной базе и не меняется в течение периода начисления и задается в документе «Начисление зарплаты».<br>
 Невыход сотрудника на работу должен быть зафиксирован в информационной базе, но не оплачен.<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление по тарифу с 10.01 но 31.01, а запись: тариф с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 <br>
 Подразделение<br>
 Сотрудник<br>
 Вид расчета<br>
 Период 1<br>
 Период 2<br>
 ...<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Итого:<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Отчет может быть построен за любой расчетный период. <br>
 <br>
 <br>
Бизнес-процесс</p>

<p> <br>
 Сотрудник<br>
 Подразделение<br>
 Должность<br>
 Мишина<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Кротов<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Иванов<br>
 Бухгалтерия<br>
 Гл. бухгалтер<br>
 Онопко<br>
 Отдел закупок<br>
 Начальник отдела<br>
 Петренко<br>
 Отдел закупок<br>
 Зам. начальника отдела<br>
 Коваленко<br>
 Отдел закупок<br>
 Зам. начальника отдела<br>
 Бельдыев<br>
 Отдел закупок<br>
 Менеджер<br>
 Рахимов<br>
 Отдел закупок<br>
 Менеджер<br>
 Мансуров<br>
 Отдел закупок<br>
 Менеджер<br>
 Жупиков<br>
 Отдел закупок<br>
 Кладовщик<br>
 Халиков<br>
 Отдел закупок<br>
 Кладовщик<br>
 Галкин<br>
 Отдел продаж<br>
 Менеджер<br>
 Бельдыев<br>
 Отдел продаж<br>
 Менеджер<br>
 Халиков<br>
 Отдел продаж<br>
 Кладовщик<br>
 Лоханкина<br>
 Отдел продаж<br>
 Кладовщик<br>
 <br>
 Комментарии при сдаче<br>
 <br>
 http://chistov.spb.ru/forum/16-993-24058-16-1344618788<br>
 БУ: В задаче сказано в документе прихода, указывается фактическая дата прихода и документ отправления. Преподаватель сказал что факт дата прихода и есть дата дока, что надо было уточнить.<br>
 СПР: Расчеты про табель. <br>
 Все часы указаны в табеле. Обошелся без графиков, что оказалось правильно. Кроме оклада есть еще премия(% от оклада начисленного в том же периоде). Преподаватель сказал что у оклада не должно быть периода.<br>
 Также смотрел на разделение итогов и спрашивал на что в коде влияет эта галочка.<br>
 <br>
 http://chistov.spb.ru/forum/16-993-26844-16-1354806659<br>
 ОУ в этой задаче прямо в т.ч. расходной указывал сколько фактически пришло. Контроль остатков я не делал. <br>
 БУ задача 2.38, на счете "ТоварыВПути" сделал следующие субконто: накладная, номенклатура, складотправитель(об), датаприбытия(об). В ошибках написали: аналитика задана избыточно. <br>
 СПР показалась мне очень мутной, ее я так и не понял. В общем документом табель писал данные о факт. отр.ч. в РН, а также им же фиксировал невыходы в РР, т.е. если в ТЧ документа табель встречалась "Н", то заносил в РР основные начисления даные по невыходу на каждый день отдельно, причем оклад у меня не вытеснялся невыходом. Документом НЗ соответственно вносил данные об окладе и премии(с ней все просто). <br>
 В ошибках по СПР написали следующее: использование ПД для видов расчета, не нуждающихся в нем. К окладу или невыходу относится это замечание я так и не понял. Возможно в этой задаче стоит у ПВР ОН завести реквизит типа перечисление, где указывать что-то типа вида расчета и по невыходу фиксировать данные только в РН с указанием значения перечисления "Невыход", но это лишь догадки. <br>
 Комментарий от romansun: только сегодня решал её... Там действительно не нужен ПД, ибо оплата по тарифу = табель*фикс. ставку. Т.е. не нужен график тут, по сути. Другое дело, что в шапке-то указано, что предусмотреть возможность работы по нескольким графикам... Но если нет ПД, то нет и графика. Т.е. шапка задачи противоречит тому, что написано под рисунком )))<br>
 <br>
 </p>

<p>Билет 12<br>
Оперативный учет<br>
 Компания занимается торговлей специализированного оборудования. Принят следующий порядок работы: поступает заказ покупателя (документ «Заказ покупателя»). На основании заказов покупателей производится закупка оборудования у поставщика (документ «Приходная накладная»), причем можно приобрести только то оборудование, которое заказано покупателем. После того, как оборудование поступило, оно может быть отгружено покупателю (документ «Расходная накладная»).<br>
 В документе «Приходная накладная» для каждой номенклатурной позиции указывается заказ покупателя, для которого приобретено это оборудование. Оборудование для одного заказа покупателя может поставляться несколькими документами. Закупать можно только заказанное покупателем оборудование.<br>
 Отгрузка оборудования по одному заказу покупателя может происходить несколькими документами «Расходная накладная». Следует считать, что оборудование по заказу будет отгружено полностью и отгрузка может происходить только на основании заказа. Себестоимость оборудования рассчитывается как средняя в рамках закупок под заказ покупателя.<br>
 Используя планы видов характеристик, необходимо предоставить возможность пользователю добавить произвольное количество дополнительных характеристик к каждому заказу. Например, для одного заказа могут быть указаны регион и срочность, а для другого заказа может быть указан регион и необходимость в дополнительном контроле поставки.<br>
 Необходимо создать отчет по анализу недоотгруженных заказов покупателей на выбранную дату в разрезе выбранной характеристики.<br>
 Анализ недоотгруженных заказов покупателей на 31.01.2010<br>
 Регион<br>
 Заказ<br>
 Оборудование<br>
 Не закуплено<br>
 Не отгружено<br>
 Москва<br>
 Заказ № 1 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Кинокамера<br>
 5<br>
 2<br>
 <br>
 <br>
 Портсигар<br>
 2<br>
 <br>
 <br>
 Заказ №5<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Кинокамера<br>
 1<br>
 1<br>
 <br>
 <br>
 Телефон<br>
 <br>
 8<br>
 Новгород<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Заказ №2<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Кинокамера<br>
 1<br>
 <br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задач следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Организация занимается сборкой и продажей персональных компьютеров. Сборка готовых компьютеров происходит из отдельных комплектующих. Учет комплектующих ведется на счете «Материалы», а готовых изделий на счете «Товары». Сборка и хранение всех материалов происходят в головном офисе, а готовая продукция развозится на разные склады, поэтому складской учет ведется только по счету «Товары».<br>
 Продажа отражается документом «Расходная накладная», причем продаваться могут как готовые компьютеры; так и отдельные комплектующие, которые указываются в одной табличной части. В документе обязательно должен быть указан склад, с которого будет произведена отгрузка готовых компьютеров.<br>
 При проведении документ «Расходная накладная» формирует проводки:<br>
Дт «Прибыли и убытки» - Кт «Товары» <br>
 на количество и себестоимость компьютеров. Себестоимость рассчитывается как средняя по номенклатурной позиции на складе;<br>
Дт «Прибыли и убытки» - Кт «Материалы»<br>
на количество и себестоимость комплектующих. Себестоимость рассчитывается как средняя но номенклатурной позиции;<br>
Дт «Покупатели» - Кт «Прибыли и убытки» на сумму в продажи.<br>
 Необходимо создать отчет о продажах товаров.<br>
 <br>
 Продажи товаров за период с 01.01.2010 по 31.01.2010<br>
Товар<br>
Количество<br>
Себестоимость<br>
Сумма продажи<br>
 Монитор NEC<br>
5<br>
100 000<br>
210 000<br>
 Комп. «Чайник»<br>
2<br>
37 500<br>
50 000<br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам автопредприятия осуществляется ежемесячно с использованием метода отклонений. Сотрудники работают на собственных автомобилях, поэтому обмен автомобилями между водителями не возможен.<br>
 Все сотрудники работают только по пятидневному графику.<br>
 Сотрудники предприятия получают оплату по часовому тарифу. Сумма начисления по тарифу определяется как тарифная ставка, умноженная на количество фактически отработанных часов. В течение расчетного периода тарифная ставка может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю ее изменения.<br>
 Если сотрудник не вышел на работу по неуважительной причине, то за каждый день прогула начисляется штраф в размере 5000 рублей. Следует учесть, что данные о невыходе не могут вводиться в систему задним числом.<br>
 Если водитель в расчетном периоде наездил больше 1000 часов, то ему должна быть начислена компенсация на ремонт автомобиля процентом от начисленной в том же расчетном периоде оплаты по тарифу. Процент компенсации общий для всех сотрудников и может изменяться не чаще, чем один раз в месяц. В информационной базе необходимо хранить историю изменения данного процента. В момент начисления компенсации значение процента определяется пользователем самостоятельно и заносится в документ “Начисление зарплаты”. Компенсация начисляется только в случае отсутствия невыходов, однако контролировать программным образом данное обстоятельство не требуется.<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление по тарифу с 10.01 по 31.01, а запись тариф: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 Для анализа полученных сотрудниками предприятия компенсаций на ремонт в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 <br>
 <br>
 <br>
 Сотрудник<br>
 Отработано часов<br>
 Был штраф?<br>
 Сумма компенсации<br>
 <br>
 <br>
 <br>
 <br>
 Итого:<br>
 <br>
 <br>
 <br>
 Отчет должен быть построен за текущий расчетный период.<br>
 <br>
 <br>
Бизнес-процесс<br>
 </p>

<p> Сотрудник<br>
 Подразделение<br>
 Должность<br>
 Васина<br>
 Бухгалтерия<br>
 Кассир<br>
 Мишина<br>
 Бухгалтерия<br>
 Кассир<br>
 Мишина<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Кротов<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Иванов<br>
 Бухгалтерия<br>
 Гл. бухгалтер<br>
 Степанов<br>
 Отдел внедрения<br>
 Начальник отдела<br>
 Петров<br>
 Отдел внедрения<br>
 Руководитель проекта<br>
 Федорова<br>
 Отдел внедрения<br>
 Руководитель проекта<br>
 Федорова<br>
 Отдел внедрения<br>
 Ведущий специалист<br>
 Васин<br>
 Отдел внедрения<br>
 Ведущий специалист<br>
 Головлев<br>
 Отдел внедрения<br>
 Специалист<br>
 Кротова<br>
 Отдел внедрения<br>
 Специалист<br>
 Мишин<br>
 Отдел внедрения<br>
 Специалист<br>
 <br>
 Комментарии при сдаче<br>
 http://chistov.spb.ru/forum/16-993-24018-16-1344410148<br>
 ОУ: 1.32 + ПВХ (у заказа есть свойства: «регион» (Тагил или область или т.п.), «статус» (срочно, не срочно) и пользовательские) + в отчете, в СКД надо использовать ПВХ – сделать группировку по региону.<br>
 БУ: 2.37 в билете просят только второй отчет из сборника. На счете «Прибыли и убытки» советую сделать субконто номенклатура для отчета. Остальное без изменений. <br>
 СПР: задача про авто-предприятие перекуверкана так, что я ее в сборнике не узнал. Задание: Расчетный период один месяц. Нужен контроль: один ВР в текущем расчетном периоде не должен повторяться. <br>
 Тариф = ставка * Факт (все работают только по пятидневке – график не нужен!); <br>
 Штраф = 5000 руб. <br>
 Компенсация = % от тарифа в этом периоде, если факт более 1000 часов!!! <br>
 Внимание: в самом большом месяце (31 день) всего 744 часа! Как водитель может наездить 1000 часов в расчетном периоде? Сделал «в лоб» - получил двойку! Преподаватель сказал, что мне необходимо было уточнять данный момент. Как правильно, естественно не сказал! <br>
 Так же был бизнес процесс.<br>
 Комментарий от sv_mikh: Про 1000 часов в данном месяце уже не раз говорили... Суть в том, что превышение не полностью сформировалось в текущем месяце, но достигло превышения в текущем месяце... Т.е. например водителя приняли в том месяце и он за прошлый месяц наездил 500 часов. В этом месяце еще 600. Превышение 1000 произошло в текущем месяце. Реализуется оборотным регистром. Были ли наезды до 1000 через: <br>
 КоличествоНаездов1000 = Окр(Оборот с начала времен до конца месяца/1000,2,1) - Окр(оборот с начала времен до начала месяца / 1000,2,1); <br>
 <br>
 http://chistov.spb.ru/forum/16-993-26731-16-1354280393<br>
 СПР: И еще была Компенсация за проезд- разовая выплата при условии внимание беру слова из задания "Если в расчетном периоде работник наездит больше 1000 часов" (подразумевалось что работают на машинах.) Так как расчетный период - месяц. То я справедливо подумал что нужно брать базу по часам из оклада и если она более 1000 часов то тогда платить компенсацию. Но оказалось это неверно решение (так как сотрудник физический не сможет отработать более 1000 часов в месяц).<br>
 Только после экзамена до меня дошло что здесь нужен регистр накопления куда нужно записывать отработанные часы и они будут копиться. И если в текущем месяце количество часов превысит 1000 то выплачиваем компенсацию , и делаем расход по регистру накопления на 1000 часов. Думаю примерно так нужно решать.<br>
 <br>
 http://chistov.spb.ru/forum/16-993-27141-16-1356624683<br>
 ОУ 1.32 + внимание! ПВХ для документа "Заказ". Три документа, два регистра. Новая методика в приходной и старая методика в расходной. Создание доков на основании - это смотрелось! <br>
 БУ 2.37 Не забываем количественный учет на "Материалах" и "Товарах", субконто "Склад" только на "Товарах"; субконто "Номенклатура" на ПрибыляхИУбытках оборотное (это для отчета). Эти все галки внимательнейшим образом смотрятся экзаменатором! В запросе расходной проверка остатков как на "материалах" так и на "товарах" - без складов и со складами. <br>
 Смотрелась ручная операция. Смотрелись запросы. <br>
 СПР 3.35 изменена. Пробег в РН. Обращаем внимание, что пробег здесь - это часы, а не километры. И что в базе уже мог быть пробег до нашего расчета. Только в этом случае получится 1000 часов. В запросе обороты надо брать за рассчитываемый период. <br>
 Процент компенсации - внимание, это новое - вводится непосредственно в документе "Начисление" и записывается в месячный РС. Что это за ноу-хау такое и зачем - я хз. Я не успел это сделать. И Дмитрий не смотрел этот момент.. <br>
 В остальном - всё как здесь на форуме разобрано - три плана вида расчета, четыре вида расчета (можно обойтись тремя вроде, кстати..): <br>
 1. Основные: Тариф(вытесняется невыходом), Невыход. ПД, базы нет <br>
 2. Дополнительные: Компенсация (база-тариф), без ПД <br>
 3. Удержания: Штраф (база-невыход), без ПД <br>
 БП 4.4. Адресацию и регистр адресации Дмитрий посмотрел. <br>
 Смотрелись все связи. Отчет. Все запросы. <br>
 <br>
 <br>
 ОУ РН Остатки, Измерения Номенклатура, Заказ, Ресурсы Количество, Сумма <br>
 РН ТоварыКПоступлению (остатки), Измерения Номенклатура, Заказ, Ресурс Количество <br>
 В Расходной списание по старой методике сделал. <br>
 Ошибки: неверная методика проведения; избыточное соединение в запросе; неверно настроен механизм характеристик <br>
 БУ Субконто - Номенклатура, Склад <br>
 Счет Товары - Количественный, Субконто Склад, Номенклатура <br>
 Счет Материалы - Количественный, Субконто Номенклатура <br>
 Счет ПрибылиУбытки - Субконто Номенклатура <br>
 РБ "Управленческий", Сумма, Количество (ПУ Количественный) <br>
 Ошибки: неверное соединение в запросе при проведени РН; проведение РН сделано неоптимально; неверно заведена аналитика на плане счетов <br>
 ПВР ОН - Период действия - Нет базы <br>
 Оклад, Невыход, без каких либо взаимосвязей, так как подумал что раз явно не указано, что невыход неоплачивается окладов, то и не нужно вытеснять (так и написал в пояснительной записке) <br>
 ПВР ДП - Зависит по ПД от ПВР ОН (Оклад) <br>
 РР ОН Измерения Сотрудник, Ресурс Результат, Реквизит Размер <br>
 РР ДП Измерения Сотрудник, Ресурс Результат, Реквизиты Размер, ОтработаноЧасов <br>
 РН НакопленоЧасов(Обороты), Измерение Сотрудник, Ресурс Часов. <br>
 Оклад по фактическому действию, тут все понятно. +запись фактически отработанных часов в РН НакопленоЧасов для расчета компенсации. <br>
 Невыход считал тоже по ДаннымГрафика, только из реквизита РабочийДень(В РС ГрафикиРаботы 2 ресурса Значение и РабочийДень) <br>
 Компенсация записывала в регистр только строки, где по сотруднику в РН НакопленоЧасов значение > 1000. И после расчета делаем расходную проводку на 1000 часов по РН.<br>
 Ошибки: расчет невыхода и компенсации выполнен неверно.<br>
 <br>
 <br>
 <br>
Билет 13<br>
Оперативный учет<br>
 В компании используется оборудование, имеющее ограничения к эксплуатации. Для каждого устройства устанавливается срок годности и срок использования. Срок годности считается с момента приобретения оборудования и указывается в документе поступления, а срок эксплуатации с момента его ввода в эксплуатацию и указывается непосредственно для оборудования и не меняется. Поступление оборудования отражается документом «Приходная накладная». Через некоторое время оборудование вводится в эксплуатацию документом «Ввод в эксплуатацию».<br>
 При передаче оборудования в эксплуатацию в первую очередь передастся оборудование, у которого минимальный срок годности. В документе «Ввод в эксплуатацию» указывается перечень и количество передаваемого оборудования. При проведении должна происходить проверка на наличие оборудования и его срок годности. В том случае, если срок годности истек или оборудования недостаточно, документ не проводится и выдается соответствующее сообщение.<br>
 Раз в месяц формируется регламентный документ «Выбытие оборудования», который при проведении проверяет эксплуатируемое оборудование и, если оно негодно, то списывает его. При проверке определяется, вышел ли срок эксплуатации устройства с момента его ввода в эксплуатацию. Если срок эксплуатации истек или истек срок годности, то оборудование должно быть списано. Кроме того, этот же документ должен списывать еще не введенное в эксплуатацию оборудование, но срок годности, которого уже истек.<br>
 Учет оборудования в разрезе складов не ведется. Себестоимость оборудования рассчитывается как средняя.<br>
 Необходимо создать отчет о состоянии эксплуатируемого оборудования на выбранную дату.<br>
 Состояние оборудования в эксплуатации на 31.01.2010<br>
 Оборудование<br>
 Кол-во<br>
 Сумма<br>
 Оставшийся срок годн.<br>
 Оставшийся срок эксп.<br>
 Кинокамера<br>
 3<br>
 3 000<br>
 60<br>
 20<br>
 Портсигар<br>
 2 <br>
 400<br>
 500<br>
 520<br>
 <br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задач следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Требуется организовать возможность учета продажи комплектов. В системе должна храниться информация о составе комплекта (какие номенклатурные позиции и в каком количестве входят в данный комплект). В состав комплекта не могут входить другие комплекты. Следует обеспечить уникальность деталей в рамках комплектов, т.е. одна и та же деталь не должна входить в состав разных комплектов.<br>
 Операция сборки как таковая в компании не осуществляется. Когда покупатель приходит получать комплект ответственный сотрудник компании в соответствии со спецификацией отгружает необходимое количество комплектующих.<br>
 Продажи осуществляются документом «Расходная накладная». В табличной части документа указываются комплекты и их количество.<br>
 Документ реализует следующие проводки:<br>
Дт «Прибыли и убытки» - Кт «Товары» на количество и себестоимость списываемых комплектующих.<br>
 В случае продажи комплекта необходимо списать его комплектующие согласно составу комплекта<br>
Дт «Покупатели» - Кт «Прибыли и убытки» на сумму в продажных ценах.<br>
 Себестоимость рассчитывается как средняя по номенклатурной позиции на складе.<br>
 Необходимо построить отчет по продажам комплектов за период.<br>
 <br>
 Продажи комплектов за период с 01.01.2010 по 31.01.2010<br>
Комплект<br>
Продажа<br>
Себестоимость<br>
 Комплект № 1<br>
500 000<br>
200 000<br>
 Комплект № 3<br>
620 000<br>
350 000<br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно только в одной бригаде, то есть совместительство не допускается.<br>
 Все сотрудники работают только по пятидневному графику работы.<br>
 Сотрудники предприятия получают оплату по часовому тарифу. Сумма начисления по тарифу определяется как тарифная ставка, умноженная на количество фактически отработанных часов. В момент начисления значения тарифной ставки определяется пользователем самостоятельно и заносится в документ «Начисление зарплаты».<br>
 Сотрудникам предприятия выплачивается надбавка, рассчитываемая как общая сумма продаж товаров за предыдущий квартал по бригаде, в которой работает сотрудник, умноженная на определенный процент. Значение процента в течение периода начисления не меняется и задается в документе «Начисление зарплаты».<br>
 Помимо надбавки, начальникам бригад выплачивается премия в виде процента от надбавки сотрудника своей бригады, получившего максимальную сумму надбавки. Ввод премии начальнику бригады осуществляется документом «Начисление зарплаты».<br>
 Информацию о должностях сотрудников в информационной базе хранить не надо.<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление по тарифу с 10.01 по 31.01, а запись тариф: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 Для анализа полученных сотрудниками предприятия надбавок в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 Бригада<br>
 Сотрудник<br>
 Сумма продаж<br>
 % надбавки<br>
 Сумма премии<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Итого:<br>
 <br>
 <br>
 <br>
 <br>
 Отчет может быть построен за любой расчетный период.<br>
 <br>
 <br>
Бизнес процессы</p>

<p> Сотрудник<br>
 Подразделение<br>
 Должность<br>
 Васина<br>
 Бухгалтерия<br>
 Кассир<br>
 Мишина<br>
 Бухгалтерия<br>
 Кассир<br>
 Мишина<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Кротов<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Иванов<br>
 Бухгалтерия<br>
 Гл. бухгалтер<br>
 Онопко<br>
 Отдел закупок<br>
 Начальник отдела<br>
 Бельдыев<br>
 Отдел закупок<br>
 Менеджер<br>
 Рахимов<br>
 Отдел закупок<br>
 Менеджер<br>
 Мансуров<br>
 Отдел закупок<br>
 Менеджер<br>
 Жупиков<br>
 Отдел закупок<br>
 Кладовщик<br>
 Хабибулин<br>
 Отдел продаж<br>
 Начальник отдела<br>
 Галкин<br>
 Отдел продаж<br>
 Менеджер<br>
 Палкин<br>
 Отдел продаж<br>
 Менеджер<br>
 Малкин<br>
 Отдел продаж<br>
 Менеджер<br>
 Петров<br>
 </p>

<p>Билет 14<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Отгрузка товаров покупателю отражается документом «Расходная накладная», причем каждая накладная может быть выставлена в своей валюте. Оплата от покупателя приходит в рублях и отражается документом «Приход денег». Одна оплата может относиться к нескольким накладным, в этом случае при проведении документа автоматически закрывается долг покупателя по отгрузке, начиная с самой ранней недоплаченной накладной и т.д. Курс валюты берется на дату оплаты.<br>
 В том случае, если сумма оплат превышает долг по отгрузке, то эта переплата засчитывается как аванс. При отгрузке товара необходимо проверять наличие аванса от покупателя. Если есть аванс, то он засчитывается как оплата накладной по курсу на дату накладной.<br>
 Складской учет товаров не ведется.<br>
 Необходимо построить отчеты по взаиморасчетам за период.<br>
 Взаиморасчеты за период с 01.01.2010 по 31.01.2010<br>
Валюта<br>
Накладная<br>
Нач. ост.<br>
Отгружено<br>
Оплачено<br>
Кон. ост.<br>
 Евро</p><br>
<br>
<br>
<br>
<p> <br>
Расх.Накл. №1</p>

<p>1000<br>
600<br>
400<br>
 <br>
Расх.Накл. №3<br>
500</p>

<p>500</p>

<p> <br>
«Аванс»<br>
500<br>
500</p>

<br>
<p> Доллар</p><br>
<br>
<br>
<br>
<p> <br>
Расх.Накл. №3</p>

<p>800<br>
200<br>
600<br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задач следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Необходимо организовать возможность учета сборки комплектов. Сами комплекты определяются в справочнике «Номенклатура» наравне с обычными товарами, услугами. В системе также должна храниться информация о составе комплекта (какие номенклатурные позиции и в каком количестве входят в данный комплект по умолчанию). В состав комплекта не могут входить другие комплекты.<br>
 Операция сборки комплекта оформляется в системе с помощью документа «Сборка». В шапке этого документа указывается комплект, склад с которого происходит списание и склад на который приходуется готовая продукция. В табличной части указывается перечень комплектующих для изготовления комплекта. Состав комплекта может изменяться пользователем (меняются комплектующие, их количество). В том случае, когда фактически указанный состав на сборку отличается (по количеству или составу) от справочного состава, то считается, что это нестандартная сборка.<br>
 Документ «Сборка» реализует следующие проводки:<br>
Дт «Основное производство» - Кт «Материалы» на списываемое количество комплектующих и их себестоимость;<br>
Дт «Товары» - Кт «Основное производство» на собранное количество комплектов и сумму списанных материалов.<br>
 Документ не должен проводиться, если соответствующих комплектующих не оказалось в компании. Учет остатков ведется в разрезе складов, себестоимость определяется как средняя по номенклатурной позиции на складе.<br>
 Необходимо создать отчет о собранных комплектах.<br>
 Сборка комплектов за период с 01.01.2010 но 31.01.2010<br>
 Комплект<br>
 Собрано<br>
 Стандарт<br>
 Нестандарт<br>
 Комплект1<br>
 10<br>
 8<br>
 2<br>
 Комплект2<br>
 16<br>
 12<br>
 4<br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, то есть совместительство допускается.<br>
 Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам.<br>
 Количество фактически отработанных часов вводится в систему с помощью документа «Табель». Документ должен заполняться еженедельно на весь список сотрудников компании. Для каждого сотрудника каждый отработанный день недели отмечается флажком в табличной части документа.<br>
 Затем в задании будет представлен внешний вид формы табеля.<br>
 На форме в шапке документа поля: «Номер», «Дата».<br>
 Ниже следующие поля: «Период с:» 01.01.2013 «Период по:» 07.01.2013<br>
 Ниже табличная часть. В ней колонки «Сотрудник» и «Д1», «Д2», «Д3», «Д4», «Д5», «Д6», «Д7».<br>
 В колонке «Сотрудник» отображается список сотрудников, а на пересечении сотрудника и дня недели поля флага, на некоторых днях флаг установлен, на других нет.</p>

<p> Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в днях. Дневная ставка рассчитывается как начальное значение оклада, деленное на количество рабочих дней в том же периоде, что и фактически отработанные дни. Первоначальное значение оклада может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.<br>
 Дополнительно, каждому сотруднику компании может быть начислена премия в виде процента от суммы окладов всех сотрудников его подразделения за текущий месяц. Процент премии в течение периода не меняется и задается в документе “Начисление зарплаты”.<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 Подразделение<br>
 Сотрудник<br>
 Вид расчета<br>
 Период1<br>
 Период2<br>
 …<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Итого:<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
Управляемые формы.<br>
 Необходимо для каждого менеджера реализовать список дополнительных сведений, которые он будет вводить для своего контрагента.<br>
 Сам менеджер будет указываться в форме контрагента.<br>
 Список дополнительных сведений указывается в форме менеджера, должен быть реализован с помощью плана видов характеристик.<br>
 В форме же контрагента в зависимости от выбранного менеджера должны появиться дополнительные поля для ввода информации.<br>
 То есть если, например, у менеджера список дополнительных реквизитов такой:<br>
 <br>
 <br>
 То при выборе этого менеджера вид формы контрагента должен быть следующий:<br>
 <br>
 <br>
 <br>
 <br>
 Комментарии при сдаче<br>
 <br>
 http://chistov.spb.ru/forum/16-993-30375-16-1376602708<br>
 ОУ: Реализовал через два регистра накопления - Взаиморасчеты и Авансы. <br>
 БУ: все стандартно + 3 субконто (ТипКомплекта, Склад, Номенклатура) в счета товары, сделал лишнюю работу в виде подключения документа приходная накладная(в задаче не было это написано), но для быстроты разработки сделал док с движениями, не хотелось документом операция вводить остатки материалов.<br>
 Когда с преподавателем разбирал задачи, придирки оказались в БУ - в виртуальной таблице не добавил список материалов с табличной части.<br>
 СПР: Сделал табель, который делает движения в регистр накопления в разрезе сотрудника и периода со значением дня (это 1). Далее получить оклад сотрудника не составляет труда связать таблицу основных начислений с регистром накопления оборотами (указать там за период) со сведениями сотрудников. <br>
 По началу сложностью показалось получить премию руководителя, а оказалось все просто, когда получаем данные с виртуальной таблицы дополнительных начислений связанную с основными начислениям измерения указываем подразделение и база результат отлично получается. Ошибка, на которую указал преподаватель: в расчетах не убрал галки в дополнительных начислениях базовый на реквизитах подразделение и сотрудники.<br>
 <br>
 http://chistov.spb.ru/forum/16-993-30869-16-1378553033<br>
 ОУ. Сделал на одном регистре, Измерения - Контрагент, Валюта, Документ расчетов, ресурс - сумма. Так как спросить не у кого, решил, что авансы всегда рублях - если есть авансы, пишу их в регистр с пустым "Документом расчетов". Далее при проведении Расходной сначала проверяю авансы, потом пишу в долг. <br>
 БУ. Ничего сложного, счет Товары с двумя субконто "Номенклатура" и "Тип комплекта", счет "Материалы" с субконто "Склад" и "Номенклатура". Сборка списывает с материалов, если их хватило, приходует 1 товар, при этом в момент списания определяется, стандартная сборка, или нет. <br>
 СПР. То, чего я боялся - попался этот долбаный табель. Сделал, как видел в других решениях - оборотный регистр "Отработано дней", куда табель пишет дни, а потом при проведении "Начисления ЗП" беру оттуда факт. В связи с тем, что мне нужно было знать планируемое количество дней, указал, что Основные начисления используют период действия, добавил графики. <br>
 В итоге - написали, что нет документа “Поступление товаров” и поставили 3. Выкладываю базу с дописанным документом - судя по тому, что больше замечаний не было, можно считать что это решение на 5: https://docs.google.com/file/d/0BwbaIyfrRVI1emNLaTE2cFZOZHM/edit<br>
 </p>

<p> <br>
Билет 15<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Поступление товаров отражается документом «Приходная накладная», продажа – «Расходная накладная». Помимо продажи товара, могут оказываться дополнительные услуги, например по доставке. И услуги и товары указываются в одной табличной части.<br>
 Складской учет товаров не ведется.<br>
 Списание себестоимости товаров должно быть организовано по партиям, в зависимости метода списания (FIFO или LIFO), принятого в учетной политике. Значение учетной политики меняется не чаще одного раза в год. При проведении документа необходимо использовать метод, актуальный на момент проведения.<br>
 Дополнительные затраты при продаже вводятся отдельным документом «Дополнительные затраты» с указанием расходной накладной, к которой относятся эти затраты, номенклатуры и суммы затрат по каждой номенклатурной позиции.<br>
 Необходимо построить отчет по продажам товаров за период. В отчете себестоимость должна отражаться с учетом распределенных затрат, вне зависимости от того, в каком периоде был введен документ «Дополнительные затраты».<br>
 <br>
 Продажи с 01.01.2010 по 31.03.2010<br>
Номенклатура<br>
Кол-во<br>
Себест-сть<br>
Продажа<br>
Прибыль<br>
 Куртка замшевая<br>
3<br>
300<br>
620<br>
320<br>
 Портсигар<br>
3<br>
30<br>
50<br>
20<br>
 Доставка<br>
1</p>

<p>100<br>
100<br>
 <br>
 Прибыль рассчитывается как: «Сумма продаж» - «Себестоимость».<br>
 <br>
 <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность вести проводки с произвольной корреспонденцией счетов. При решении задачи следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Требуется реализовать возможность ведения учета товаров в разрезе мест хранения и партий товаров. Под партией товара понимается документ, регистрирующий его (товара) поступление.<br>
 В документе «Приходная накладная» склад указывается в табличной части для каждой строки и формируются следующие проводки:<br>
 Дт «Товары» - Кт «Поставщики» на количество и сумму закупаемого товара.<br>
 Продажа товара производится со склада и регистрируется документом «Расходная накладная», cклад указывается в реквизите самого документа. При заполнении документа партия товара не указывается. При проведении производится проверка достаточности количества на указанном складе продаваемого товара.<br>
 Документ «Расходная накладная» реализует следующие проводки:<br>
 Дт «Прибыли и убытки» - Кт «Товары» на количество и сумму себестоимости;<br>
 Дт «Покупатели» - Кт «Прибыли и убытки» на сумму в продажных ценах.<br>
 При продаже товара списание партий этого товара производится либо по дисциплине LIFO («последним пришел, первым ушел»), либо FIFO («первым пришел, первым ушел»). Какая из дисциплин будет использоваться, определяется в начале года и в течение года не меняется.<br>
 Себестоимость товара рассчитывается в разрезе партий на складе для данного товара. <br>
 <br>
 Используя план видов характеристик необходимо предоставить возможность пользователю добавить произвольное количество дополнительных характеристик к каждому товару (материал, цвет, страна-производитель и т.д.) <br>
 <br>
 <br>
 Необходимо построить отчет о продажах товаров. Дополнительно данные в отчете должны быть сгруппированы по выбранной характеристике.<br>
 <br>
 <br>
 <br>
 Продажи товаров за период с 01.01.2014 по 31.01.2014<br>
 <br>
 Страна<br>
Количество<br>
Себестоимость<br>
Сумма продажи<br>
 Товар<br>
 <br>
 <br>
 <br>
 Россия<br>
7<br>
137500<br>
260000<br>
 Монитор NEC<br>
5<br>
100 000<br>
210 000<br>
 Комп. «Чайник»<br>
2<br>
37 500<br>
50 000<br>
 <br>
 <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно только в одном подразделении компании, то есть совместительство не допускается.<br>
 Сотрудники компании работают в 3 смены по графику Сутки через двое.<br>
 Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в часах. Часовая ставка рассчитывается как начальное значение оклада, деленное на количество рабочих часов в том же периоде, что и фактически отработанные часы. Первоначальное значение оклада может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.<br>
 Сотрудники могут находиться на больничном, размер которого определяется как количество дней болезни, умноженное на среднюю дневную ставку. Дни болезни рассчитываются по пятидневному графику. Средняя дневная ставка определяется как сумма всех начислений за предыдущий месяц, поделенная на количество рабочих дней в предыдущем месяце. Следует учесть, что данные об отпуске не могут вводиться в систему задним числом.<br>
 В любой момент времени каждому из сотрудников может быть начислено поощрение в виде произвольной суммы денег.<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Ввод всех начислений происходит документом «Начисления зарплаты». Документ в расчетном периоде может быть только один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.<br>
 С помощью диаграммы Ганта показать фактический период действия записей с разбивкой по сотрудникам, и для каждого сотрудника – по видам расчета. Отчет может быть построен за любой расчетный период.<br>
Бизнес-процессы</p>

<p> Сотрудник<br>
 Должность<br>
 Подразделение<br>
 Васина<br>
 Бухгалтерия<br>
 Кассир<br>
 Мишина<br>
 Бухгалтерия<br>
 Кассир<br>
 Мишина<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Кротов<br>
 Бухгалтерия<br>
 Бухгалтер<br>
 Иванов<br>
 Бухгалтерия<br>
 Гл. бухгалтер<br>
 Онопко<br>
 Отдел закупок<br>
 Начальник отдела<br>
 Петренко<br>
 Отдел закупок<br>
 Зам. начальника отдела<br>
 Бельдыев<br>
 Отдел закупок<br>
 Менеджер<br>
 Рахимов<br>
 Отдел закупок<br>
 Менеджер<br>
 Мансуров<br>
 Отдел закупок<br>
 Менеджер<br>
 Жупиков<br>
 Отдел закупок<br>
 Кладовщик<br>
 Сидоров<br>
 Отдел закупок<br>
 Кладовщик<br>
 Галкин<br>
 Отдел продаж<br>
 Менеджер<br>
 ІІалкин<br>
 Отдел продаж<br>
 Менеджер<br>
 </p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<p> <br>
 </p>

<p>Билет 16<br>
Оперативный учет<br>
 Компания занимается оптовой торговлей. Отгрузка товара осуществляется<br>
по предоплате. Оплата оформляется документом «Приход денег», а отпуск товара<br>
документом «Расходная накладная».<br>
 Для постоянных покупателей может быть предоставлен кредит на некоторый срок. Срок и размер кредита определяется для каждого контрагента индивидуально. В том случае, если сумма накладной меньше суммы предоставленного ему кредита, то может быть произведена отгрузка товаров без поступления денег. Далее, пока не превышен размер кредита, могут быть оформлены еще накладные, но только пока самая первая неоплаченная накладная не будет просрочена больше, чем на срок кредита. Например, если покупателю предоставлен кредит на 1000 и 5 дней, то взаимоотношения с ним выглядят следующим образом: никаких задолженностей нет, 1-го числа происходит отгрузка на сумму 600 и 2-го числа оплата на сумму 100, тогда 3-го числа можно произвести еще отгрузку, но на сумму не более 500, пока не превышена сумма кредита. 8-го числа отгрузок не может быть, поскольку превышен срок кредита. <br>
 При поступлении денег гасятся задолженности по накладным, начиная с<br>
самой первой недоплаченной накладной. Авансов и переплат быть не может.<br>
 Складской учет товаров не ведется.<br>
 Сформировать отчет по взаиморасчетам с покупателем за произвольный<br>
период.</p>

<p> Взаиморасчеты за период с 01.01.2010 по 31.03.2010<br>
Контрагент<br>
Накладная<br>
Нач. ост.</p>

<p>Отгрузка<br>
Оплата<br>
Кон. ост.<br>
 Красный цветок</p><br>
<br>
<br>
<br>
<p> <br>
Расх. Накл. №1<br>
2000</p>

<p>2000</p>

<p> <br>
Расх. Накл. №2</p>

<p>2500<br>
2000<br>
500<br>
 Красный пролетарий</p><br>
<br>
<br>
<br>
<p> <br>
Расх. Накл. №3</p>

<p>500<br>
500</p>

<p> <br>
Расх. Накл. №4</p>

<p>200<br>
200</p>

<p> </p><br>
<br>
<br>
<br>
<br>
<p> </p>

<p> <br>
Бухгалтерский учет<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задач следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Компания занимается оптовой торговлей. Поступление товара отражается документом «Приходная накладная», продажа – «Расходная накладная».<br>
 Документ «Приходная накладная» реализует следующие проводки:<br>
 <br>
Дт «Товары» - Кт «Поставщики» на количество и сумму закупаемого товара.</p>

<p> Списание себестоимости товаров должно быть организовано по партиям, в зависимости от текущего значения принятого на этот год в учетной политике метода списания себестоимости (FIFO или LIFO). Еще раз подчеркивается - учетная политика действует год. На следующий год метод списания может смениться.<br>
 Документ «Расходная накладная» реализует следующие проводки:<br>
 <br>
Дт «Прибыли и убытки» - Кт «Товары» на количество и сумму себестоимости;<br>
 Дт «Покупатели» - Кт «Прибыли и убытки» на сумму в продажных ценах.<br>
 <br>
 В силу особенности номенклатуры, периодически товар портится. Весь товар и плохой и испорченный учитывается на счете «Товары», но при продаже необходимо отгружать только неиспорченный товар. Факт порчи товара определяется и отражается пользователем вручную самостоятельно. В дальнейшем испорченный товар списывается посредством документа «Операция» со следующей проводкой:<br>
 <br>
 Дт «Прибыли и убытки» - Кт «Товары» на количество и сумму себестоимости<br>
 <br>
 Необходимо построить отчет по продажам товаров за период<br>
 <br>
 Продажи с 01.01.2014 по 31.03.2014 <br>
Номенклатура<br>
Себест-ть продаж<br>
Продажа кол./сумма<br>
Списано кол./сумма<br>
 </p><br>
<br>
<p> <br>
 <br>
Периодические расчеты<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, то есть совместительство допускается.<br>
 Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам.<br>
 Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в часах. Часовая ставка рассчитывается как начальное значение оклада, деленное на количество рабочих часов в том же периоде, что и фактически отработанные часы. Первоначальное значение оклада определяется пользователем самостоятельно и заносится в документ «Начисление зарплаты».<br>
 За каждый отработанный день в течение периода начисления сотрудникам предприятия полагается фиксированная сумма денег в качестве компенсации затрат на разговоры по мобильному телефону. Данная ставка едина для всех сотрудников компании и должна быть зафиксирована в информационной базе.<br>
 <br>
 Создать отчет «Перерасчет зарплаты», в котором пользователь должен иметь возможность увидеть записи регистра расчета, которые возможно требуется пересчитать. В отчете должна быть возможность выполнить процедуру перерасчета записей.<br>
 <br>
 Объект перерасчета<br>
 Вид расчета<br>
 …<br>
 <br>
 <br>
 <br>
 <br>
 </p>

<p>Управляемые формы<br>
 Доступ для пользователей по основным подсистемам (ОУ, БУ, Расчеты) нужно ограничить с помощью функциональных опций. Возможность работы с подсистемой должна быть установлена в соответствии с должностью сотрудника.<br>
 Бухгалтер видит только подсистемы БУ и Расчеты, менеджер видит только ОУ, директор видит всё. Помимо того что пользователь не должен видеть подсистему в интерфейсе, он также не должен получить доступ к регистрам этой подсистемы.<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Дополнительные задачи экзамена (новые задачи экзамена 2019 г. -2020 г., не включенные в 16 билетов).<br>
 <br>
 <br>
 Оперативный учет.<br>
 Задача № 1 (трансфертные цен, продажа с торговых точек с перемещением товара)<br>
 Компания занимается оптовой торговлей. Поступление товаров отражается документом «Приходная накладная», продажа – «Расходная накладная». <br>
 Закупка товара может производиться в любой отдел, а непосредственно продажа происходит в торговых точках. Считается, что большая часть закупается отделом закупок, откуда потом передается торговым точкам. Перемещение товара происходит автоматически по трансфертной цене при продаже в торговой точке. Товар может перемещаться только из отдела закупок в торговую точку. Трансфертная цена определяется как себестоимость перемещаемого товара, увеличенная на процент наценки. Процент наценки задается пользователем для каждой номенклатурной позиции.<br>
 При продаже товара необходимо в первую очередь контролировать хватает ли товара в данной торговой точке. Если нет – необходимо не создавая документ* для перемещения товаров добавить соответствующие движения в регистре для передачи товара по трансфертной цене. В том случае, когда и в отделе закупок товара не хватает, продажа не производится (документ не проводится).<br>
 Себестоимость товаров рассчитывается как средняя по отделу.<br>
 Необходимо построить отчет по движениям товаров за период по количеству и сумме.<br>
 <br>
 Движения товаров с 01.01.2014 по 31.03.2014<br>
Товар<br>
Нач. ост.<br>
Приход<br>
Расход<br>
Кон. ост.<br>
 Куртка замшевая<br>
2<br>
32 000<br>
4<br>
100 000<br>
5<br>
110 000<br>
1<br>
22 000<br>
 Портсигар<br>
1<br>
1 000<br>
2<br>
2 300</p>

<p>3<br>
3300<br>
 <br>
 <br>
 * Имеется отзыв, что эта же задача попадала на экзамене с требованием программного создания документа.<br>
 <br>
 <br>
 <br>
 Задача № 2 (комитенты) *<br>
 Покупка товаров осуществляется через комитентов, в документе Приходная накладная нужно указать комитента. Продажа - без указания комитента. При проведении расходной накладной нужно распределять списание по партиям - товар который раньше пришел - тот и списывается. С каждой продажи комитенту начисляется комиссия. Процент комиссии для каждого комитента свой и может меняться со временем не чаще 1 раза в месяц. Если списывается товар, который пришел от разных комитентов, то сумма вознаграждения рассчитывается пропорционально списанному количеству. <br>
 Комиссию надо перечислять комитенту отдельным документом Расход денег. В документе Расход денег нужна табличная часть: Контрагент и Сумма. Выплачивать нельзя больше, чем должны.<br>
 Суммового учета товара нет, складской учет не ведется.<br>
 <br>
 В отчете Взаиморасчеты следующие поля:<br>
 Комитент + процент комиссии (в скобках) | Начальный остаток | Продажи | Выплачено комиссии | Конечный остаток<br>
 В отчете процент комиссии - это процент на начало месяца<br>
 *Данная задача представлена на экзамене еще в одной вариации. Отличия от текущего условия следующие: суммовой учет по товарам ведется, вознаграждение комитенту считается от суммы прибыли (выручка – себестоимость), в отчете вместо колонки «Продажи» колонка «Начислено».<br>
 <br>
 Бухгалтерский учет.<br>
 <br>
 Задача № 1 (Кролики)<br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задачи следует учесть возможность наличия проводок, сформированных с помощью данного документа.<br>
 Организация занимается разведением и продажей животных. Для описания каждого животного к нему добавляется произвольное количество характеристик. Набор этих характеристик является свойством. Например: кролик «мясной, крупный» или кролик «меховой, крупный, белый». «Мясной», «белый» - это характеристики, а «меховой, крупный, белый» - это свойство. Учет ведется в разрезе свойств животных. Механизм должен быть реализован с помощью плана вида характеристик.<br>
 Поступление животных отражается документом «Приходная накладная», формирующим следующие проводки:<br>
 Дт «Товары» - Кт «Поставщики» - на вес и сумму закупленных животных.<br>
 Откорм животных отражается пользователем самостоятельно документом «Операция», формирующим следующие проводки:<br>
 Дт «Товары» - Кт «Поставщики» - на привес животных.<br>
 <br>
 Продажа животных отражается документом «Расходная накладная», формирующим следующие проводки:<br>
 <br>
 Дт «Прибыли и убытки» - Кт «Товары» - на вес и сумму себестоимости,<br>
 Дт «Покупатели» - Кт «Прибыли и убытки» - на сумму в продажных ценах.<br>
 <br>
 Себестоимость рассчитывается как средняя по свойству номенклатуры.<br>
 Необходимо построить отчет о продажах животных в разрезе характеристик.<br>
 <br>
 Продажи с 01.01.2014 по 31.03.2014 по характеристике «Цвет»<br>
Характеристика<br>
 Номенклатура<br>
 Себест - сть<br>
Продажа кол./сумма<br>
 Черный<br>
 <br>
 <br>
 <br>
 <br>
 Кролик<br>
 5000<br>
 2<br>
 8500<br>
 Белый<br>
 <br>
 <br>
 <br>
 <br>
 Кролик<br>
 3000<br>
 3<br>
 6200<br>
 <br>
 Гусь<br>
 2500<br>
 20<br>
 5000<br>
 <br>
 <br>
 <br>
 <br>
 <br>
 Задача № 2 (Возврат товара)<br>
 <br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задач следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Компания занимается оптовой торговлей. Поступление товара отражается документом «Приходная накладная», продажа – «Расходная накладная».<br>
 Документ «Приходная накладная» реализует следующие проводки:<br>
 <br>
 Дт «Товары» - Кт «Поставщики» на количество и сумму закупаемого товара.<br>
 <br>
 Списание себестоимости товаров должно быть организовано по партиям, в зависимости от текущего значения принятого на этот год в учетной политике метода списания себестоимости (FIFO или LIFO). Еще раз подчеркивается - учетная политика действует год. На следующий год метод списания может смениться.<br>
 Документ «Расходная накладная» реализует следующие проводки:<br>
 <br>
 Дт «Прибыли и убытки» - Кт «Товары» на количество и сумму себестоимости;<br>
 Дт «Покупатели» - Кт «Прибыли и убытки» на сумму в продажных ценах.<br>
 <br>
 В том случае, когда какой-либо товар не устраивает покупателя, покупатель может вернуть этот товар, если с момента продажи прошло не более чем 3 дня. Возврат товара отражается документом «Приходная накладная» с соответствующим признаком и указанием документа, по которому производится возврат. В том случае, когда с момента возврата прошло более 3-х дней, товар к возврату не принимается и документ не проводится. Себестоимость принятого товара считается как средняя списанная себестоимость этого товара из документа<br>
 «Расходная накладная», по которой происходит возврат.</p><br>
<br>
<p> <br>
 Необходимо построить отчет по продажам товаров за период<br>
 Продажи с 01.01.2014 по 31.03.2014<br>
Номенклатура<br>
Себест-ть продаж<br>
Продажа<br>
кол./сумма<br>
Возврат<br>
кол./сумма<br>
 <br>
 <br>
 <br>
 <br>
 </p><br>
<br>
<p> <br>
 Задача № 3 (Сроки годности, Партии, списание просроченного товара)*<br>
 <br>
 Необходимо создать документ «Операция», с помощью которого пользователь должен иметь возможность ввести проводки с произвольной корреспонденцией счетов. При решении задачи следует учитывать возможность наличия проводок, сформированных с помощью данного документа.<br>
 Компания занимается оптовой торговлей. Поступление товаров отражается документом «Приходная Накладная», продажа - «Расходная накладная».<br>
 Учет товаров ведется в разрезе партий и сроков годности. У каждого товара указывается максимальный срок годности, который не может подвергаться изменению, например, максимальный срок годности сосисок составляет 10 дней. Сам срок годности отслеживается от момента поступления товара. Например, если сосиски поступили 1 января, то через 10 дней – с 11 января они считаются просроченными <br>
 <br>
 Документ «Расходная накладная» реализует следующие проводки:<br>
 Дт «Товары» - Кт «Поставщики» на количество и сумму закупаемого товара.<br>
 <br>
 Списание себестоимости товара должно быть организованно по партиям, по методу FIFO, или по Средней. Кроме того, должен происходить контроль срока годности, если срок годности больше даты документа, то данный товар продаваться не может.<br>
 Значение учетной политики может меняться не чаще, чем 1 раз в год. Следует считать, что пользователь вручную самостоятельно корректно будет устанавливать учетную политику на соответствующий период.<br>
 Про проведении документа необходимо использовать метод, актуальный на момент проведения документа.<br>
 В пользовательском режиме необходимо реализовать два примера ввода и проведения документов:<br>
* Переход с «партийного» учета на «среднюю»<br>
* Переход со «средней» себестоимости на использования метода FIFO<br>
 <br>
 Документ «Расходная накладная» реализует следующие проводки:<br>
 Дт «Прибыли и убытки» - Кт «Товары» на количество и сумму себестоимости<br>
 Дт «Покупатели» - Кт «Прибыли и убытки» на сумму в продажных ценах.<br>
 Товар с истекшим сроком годности списывается с помощью документа «Операция» проводкой:<br>
 Дт «Прибыли и убытки» - Кт «Товары» на количество и сумму себестоимости<br>
 Необходимо построить отчет по продажам товаров за период.<br>
 Отчет может быть построен за любой расчетный период, границы которого должны задаваться пользователем напрямую в форме отчета.<br>
 Продажа товаров<br>
Номенклатура<br>
Себестоимость<br>
 продаж<br>
 Продажа<br>
 кол. / сумма<br>
Списано<br>
 кол. / сумма<br>
 Йогурт многополезный<br>
 3000,00<br>
 <br>
 3<br>
 6200,00<br>
 <br>
 Йогурт сильновкусный<br>
 3000,00<br>
 <br>
 3<br>
 6200,00<br>
 <br>
 <br>
 Тефтельки<br>
 2500,00<br>
 <br>
 20<br>
 5000,00<br>
 2<br>
 240,00<br>
 В печатной форме расположение данных, заголовков и шапки отчета должны соответствовать заданию.<br>
 <br>
 *Существует еще одна разновидность этой задачи. Отличия следующие: в документе «Приходная накладная» сразу указывается срок годности для поступающего товара, методы списания – FIFO и LIFO.</p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<p> Сложные периодические расчеты.<br>
 <br>
 Задача № 1 (Учет рабочего времени)<br>
 Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно. Каждый сотрудник может работать только в одном подразделении компании, то есть без совместительства.<br>
 Все сотрудники работают по индивидуальному графику. <br>
 Начисление фактически отработанных часов осуществляется документом "Учет рабочего времени". Данные заносятся за неделю. Сформировать форму документа как на картинке (в шапке указывается сотрудник и недельный период - дата начала и дата окончания, в ТЧ – колонки дата, количество часов), сделать обработчик кнопки "Заполнить", при нажатии на которую будут формировать строки на неделю.<br>
 Сотрудники предприятия получают оплату по часовому тарифу. Сумма начисления по тарифу определяется как тарифная ставка, умноженная на количество фактически отработанных часов. В течение расчетного периода тарифная ставка может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.<br>
 Также сотрудникам может быть начислено поощрение в виде произвольной суммы.<br>
 Один календарный месяц в году* сотрудникам представляется оплачиваемый отпуск, размер которого определяется как количество календарных дней отпуска, умноженное на среднюю дневную ставку. Средняя дневная ставка определяется как сумма начислений по тарифу за последний год, поделенная на количество отработанных дней. Следует учесть, что данные об отпуске не могут вводиться в систему задним числом.<br>
 Механизм перерасчетов в рамках данной задачи использовать не надо.<br>
 Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:<br>
 Подразделение Сотрудник Вид расчета Период 1 Период 2 ... Итого: <br>
 <br>
 <br>
 *Возможно, что условие об одном календарном месяце в задании отсутствует.<br>
 </p>

<p> Управляемые формы.<br>
 <br>
 Задача № 1 (Настройка управляемой формы физического лица)<br>
 <br>
 Необходимо создать управляемую основную форму в справочнике «Физические лица».<br>
 <br>
 <br>
 <br>
 При нажатии на гиперссылку «Показать личные данные» должны отображаться дополнительные поля формы, при этом заголовок раздела также должен измениться.<br>
 <br>
 <br>
 <br>
 На закладке «Контактная информация» должны отображаться контактные данные физического лица.<br>
 <br>
 <br>
 <br>
 <br>
 На закладке «Начисление зарплаты» должны быть выведен список документов «Начисление зарплаты», в табличной части которых присутствует данное физическое лицо.<br>
 <br>
 </p>

<p>#ОУ1</p>

<p>1. Создать справочник Склады</p>

<p>2. Регистры накопления:<br>
ОстаткиНоменклатуры, изм: Номенклатура, Склад; рес: Количество<br>
ПартииНоменклатуры, изм: Номенклатура, Партия (ДокументСсылка.ПриходнаяНакладная); рес: Количество, Сумма</p>

<p>3. В справочник Номенклатура добавить реквизит ВидНоменклатуры (ПеречислениеСсылка.ВидыНоменклатуры)</p>

<p>4. Создать регистр сведений УчетнаяПолитика, периодичность В пределах года, Независимый, основной отбор по периоду Истина,<br>
 рес МетодСписания(ПеречислениеСсылка.МетодыСписания)</p>

<p>5. Документ ПриходнаяНакладная добавить реквизит документа Склад, реквизит ТЧ СрокГодности (тип Дата), создать ФормуДокумента<br>
 в ТЧ Номенклатура выставить ПараметрыВыбора "Отбор.ВидНоменклатуры(Товар)"</p>

<p>Процедуры:</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ()<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРАМ ОСТАТКИ НОМЕНКЛАТУРЫ И ПАРТИИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина; <br>
 Движения.ПартииНоменклатуры.Записывать = Истина;<br>
 <br>
 // Запрос для получения сгруппированных записей табличной части<br>
 // Можно движения сформировать и конструктором, группировка строк необязательна, но желательна на экзамене<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 // Движения по регистру Остатки номенклатуры<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Склад = Склад;<br>
 Движение.Количество = Выборка.Количество;<br>
 <br>
 // Движения по регистру Партии номенклатуры<br>
 Движение = Движения.ПартииНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Партия = Ссылка;<br>
 Движение.Количество = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<p>7. Документ РасходнаяНакладная добавить реквизит документа Склад, создать ФормуДокумента</p>

<p>Процедуры:</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ (Отказ);<br>
 ОбработкаПроведенияБУ (Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ)<br>
 <br>
 // Определение текущего метода списания себестоимости<br>
 МетодСписания = РегистрыСведений.УчетнаяПолитика.ПолучитьПоследнее(Дата).МетодСписания;<br>
 <br>
 Если Не ЗначениеЗаполнено(МетодСписания) Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Не заполнен метод списания учетной политики";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли; <br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (НОВАЯ МЕТОДИКА ПРОВЕДЕНИЯ) <br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц; // будем несколько раз использовать временную таблицу данных ТЧ<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 | И НЕ РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры = &ВидНоменклатурыУслуга<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК Количество<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка); <br>
 Запрос.УстановитьПараметр("ВидНоменклатурыУслуга", Перечисления.ВидыНоменклатуры.Услуга);<br>
 <br>
 РезультатДанныеТЧ = Запрос.Выполнить();<br>
 Выборка = РезультатДанныеТЧ.Выбрать();<br>
 <br>
 // Формирование набора записей, запись движений в регистр<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Склад = Склад;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Количество = Выборка.Количество;<br>
 КонецЦикла;<br>
 <br>
 Движения.ОстаткиНоменклатуры.БлокироватьДляИзменения = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 // Запрос получения данных для контроля появления отрицательных остатков<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОстаткиНоменклатурыОстатки.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | -ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Превышение<br>
 |ИЗ<br>
 | РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремениВключая,<br>
 | Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)<br>
 | И Склад = &Склад) КАК ОстаткиНоменклатурыОстатки<br>
 |ГДЕ<br>
 | ОстаткиНоменклатурыОстатки.КоличествоОстаток < 0";<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремениВключая", Новый Граница(МоментВремени()));<br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 <br>
 // Если результат запроса не пустой, то вывод данных по превышениям остатка и отказ от проведения документа<br>
 Результат = Запрос.Выполнить();<br>
 Если Не Результат.Пустой() Тогда<br>
 Выборка = Результат.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2 (оперативный учет, регистр ""Остатки номенклатуры"")",<br>
 Выборка.НоменклатураПредставление, Выборка.Превышение);<br>
 Сообщение.Сообщить();<br>
 КонецЦикла;<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ПАРТИИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ) <br>
 <br>
 Движения.ПартииНоменклатуры.Записывать = Истина;<br>
 Движения.ПартииНоменклатуры.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Партии товаров по номенклатурам табличной части <br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ПартииНоменклатуры");<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = РезультатДанныеТЧ;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 ТекстЗапроса = <br>
 "ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ПРЕДСТАВЛЕНИЕ(ВТ_ТабЧасть.Номенклатура) КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ПартииНоменклатурыОстатки.Партия КАК Партия,<br>
 | ЕСТЬNULL(ПартииНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ПартииНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПартииНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК ПартииНоменклатурыОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ПартииНоменклатурыОстатки.Номенклатура<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ПартииНоменклатурыОстатки.Партия.МоментВремени УБЫВ<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Если МетодСписания = Перечисления.МетодыСписания.ФИФО Тогда<br>
 ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "УБЫВ", "");<br>
 КонецЕсли;<br>
 <br>
 Запрос.Текст = ТекстЗапроса;<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); <br>
 <br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2 (оперативный учет, регистр ""Партии номенклатуры"")", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 <br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 <br>
 // Движение по регистру партии номенклатуры<br>
 Списываем = Мин (ОсталосьСписать, Выборка.КоличествоОстаток);<br>
 <br>
 Движение = Движения.ПартииНоменклатуры.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Партия = Выборка.Партия;<br>
 <br>
 Движение.Количество = Списываем; <br>
 Движение.Сумма = Списываем / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 КонецЦикла;<br>
 <br>
 КонецЦикла; <br>
 <br>
КонецПроцедуры</p>

<p>8. Отчет ОстаткиТоваровОУ<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОстаткиНоменклатурыОстатки.Номенклатура КАК Номенклатура,<br>
 ОстаткиНоменклатурыОстатки.Склад КАК Склад,<br>
 ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Количество<br>
ИЗ<br>
 РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки</p>

<p>ресурсы<br>
 Количество выражение Сумма(Количество)</p>

<p>Группировки <br>
1 Заголовок<br>
2 Склад -> Номенклатура</p>

<p>Для группировки "<Дополнительная информация> (Заголовок)" Вариант использования группировки - Дополнительная информация<br>
ПКМ, Установить имя "Заголовок". В макете "Шаблон" <Остатки товаров на [Период]> , Выражение Формат(ПараметрыДанных.Период, "ДЛФ = D")</p>

<p>Расположение полей группировок - Отдельно и только в итогах<br>
Расположение общих итогов по вертикали - Нет<br>
Выводить параметры - Не выводить<br>
Параметр Период включить в пользовательские настройки.</p>

<p>#ОУ2</p>

<p>1. Регистры накопления:<br>
ОстаткиНоменклатуры, изм: Номенклатура, Партия (ДокументСсылка.ПриходнаяНакладная); рес: Количество 10,0, Сумма 12,2; регистраторы приходная, расходная<br>
Продажи, изм. Номенклатура, рес: Количество, Выручка, Себестоимость; регистраторы расходная</p>

<p>2. В справочник Номенклатура добавить реквизит ВидНоменклатуры (ПеречислениеСсылка.ВидыНоменклатуры)</p>

<p>3. Документ ПриходнаяНакладная добавить реквизит документа Склад, реквизит ТЧ СрокГодности (тип Дата), создать ФормуДокумента<br>
 в ТЧ Номенклатура выставить ПараметрыВыбора "Отбор.ВидНоменклатуры(Товар)"</p>

<p>В модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ()<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Партия = Ссылка;<br>
 Движение.Количество = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>4. Документ РасходнаяНакладная, в ТЧ добавить ресурс Партия (ДокументСсылка.ПриходнаяНакладная), создать формуДокумента добавить партию в ТЧ</p>

<p>В модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ) И РЕГИСТРУ ПРОДАЖИ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 Движения.Продажи.Записывать = Истина; <br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по списку номенклатур и партий табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Партия", "Партия");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Партия КАК Партия<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Партия<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура,<br>
 | Партия<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ВТ_ТабЧасть.Номенклатура.ВидНоменклатуры = &ВидНоменклатурыУслуга КАК ЭтоУслуга,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВТ_ТабЧасть.Партия.Представление КАК ПартияПредставление,<br>
 | ВТ_ТабЧасть.Партия КАК Партия<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | (Номенклатура, Партия) В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура,<br>
 | Т.Партия<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК ОстаткиНоменклатурыОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура<br>
 | И ВТ_ТабЧасть.Партия = ОстаткиНоменклатурыОстатки.Партия<br>
 |ИТОГИ<br>
 | СУММА(КоличествоВДокументе),<br>
 | СУММА(СуммаВДокументе)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыУслуга", Перечисления.ВидыНоменклатуры.Услуга);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); <br>
 Пока ВыборкаНоменклатура.Следующий() Цикл <br>
 СписаннаяСтоимость = 0; // для суммирования списанной себестоимости по номенклатуре, используется для заполнения Стоимости регистра Продажи <br>
 Если Не ВыборкаНоменклатура.ЭтоУслуга Тогда<br>
 <br>
 ВыборкаДетальные = ВыборкаНоменклатура.Выбрать(); <br>
 Пока ВыборкаДетальные.Следующий() Цикл <br>
 // Контроль наличия номенклатуры в партии<br>
 Превышение = ВыборкаДетальные.КоличествоВДокументе - ВыборкаДетальные.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 и партии %2 в количестве %3", <br>
 ВыборкаДетальные.НоменклатураПредставление, ВыборкаДетальные.ПартияПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Движение по регистру Остатки номенклатуры<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Партия = ВыборкаДетальные.Партия;<br>
 Движение.Номенклатура = ВыборкаДетальные.Номенклатура;<br>
 <br>
 Движение.Количество = ВыборкаДетальные.КоличествоВДокументе; <br>
 Движение.Сумма = ВыборкаДетальные.КоличествоВДокументе / ВыборкаДетальные.КоличествоОстаток * ВыборкаДетальные.СуммаОстаток;<br>
 <br>
 СписаннаяСтоимость = СписаннаяСтоимость + Движение.Сумма;<br>
 <br>
 КонецЦикла;<br>
 <br>
 КонецЕсли;<br>
 <br>
 // Движение по регистру Продажи<br>
 Движение = Движения.Продажи.Добавить();<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = ВыборкаНоменклатура.Номенклатура;<br>
 Движение.Количество = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 Движение.Выручка = ВыборкаНоменклатура.СуммаВДокументе;<br>
 Движение.Себестоимость = СписаннаяСтоимость;<br>
 <br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>5. отчет ПродажиОУ<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ПродажиОбороты.Номенклатура,<br>
 ПродажиОбороты.КоличествоОборот КАК Количество,<br>
 ПродажиОбороты.ВыручкаОборот КАК Продажа,<br>
 ПродажиОбороты.СебестоимостьОборот КАК Себестоимость,<br>
 ПродажиОбороты.Период,<br>
 ПродажиОбороты.Регистратор<br>
ИЗ<br>
 РегистрНакопления.Продажи.Обороты(, , Регистратор, ) КАК ПродажиОбороты</p>

<p>Вычисляемые поля: Прибыль (выражение Продажа - Себестоимость), Интервал, Срок<br>
Ресурсы: Прибыль (Сумма(Прибыль)), Количество (Сумма(Количество)), Продажа (Сумма(Продажа)), Себестоимость (Сумма(Себестоимость)),<br>
 Интервал (Выбор Когда Количество (Различные Регистратор)>1 Тогда РазностьДат (Минимум (Период), Максимум(Период), "День")/Количество (Различные Регистратор) Иначе "Разовая" Конец),<br>
 Срок (РазностьДат (Максимум (Период), &КонецПериода, "День"))</p>

<p>Параметры НачалоПериода, Дата, выражение &Период.ДатаНачала, ограничение доступности = Истина; КонецПериода, Дата, выражение &Период.ДатаОкончания, ограничение доступности = Истина;<br>
 Период, СтандартныйПериод, ограничение доступности = Ложь</p>

<p>Группировки <br>
1 Заголовок<br>
2 Номенклатура</p>

<p>Для группировки "<Дополнительная информация> (Заголовок)" Вариант использования группировки - Дополнительная информация<br>
ПКМ, Установить имя "Заголовок". В макете "Шаблон" <Продажи с [НачалоПериода] по [КонецПериода]> , Выражение Формат(ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат(ПараметрыДанных.КонецПериода, "ДЛФ = Д"))</p>

<p>Параметр Период включить в пользовательские настройки.</p>

<p>Отчет Выбранные поля = Кол-во (Количество), Себест-ть (Себестоимость), Продажа, Прибыль, Интервал, Срок<br>
Расположение общих итогов по вертикали = Нет<br>
Выводить параметры = Не выводить</p>

<p>#ОУ3</p>

<p>1. Создать регистр сведений УчетнаяПолитика, периодичность В пределах месяца, регистратор документ ИзменениеУчетнойПолитики, основной отбор по периоду ложь,<br>
 рес МетодСписания(ПеречислениеСсылка.МетодыСписания)</p>

<p>2. ПеречислениеСсылка.МетодыСписания поменять ЛИФО на ПоСредней</p>

<p>3. Регистр накопления ОстаткиНоменклатуры вид Остатки<br>
 изм: Номенклатура, Партия (тип составной ДокументСсылка.ПриходнаяНакладная, ДокументСсылка.ИзменениеУчетнойПолитики)<br>
 рес: Количество 10.0, Сумма 12.2<br>
 регистраторы ПрихНакл, РасхНакл, ИзменениеУчетнойПолитики</p>

<p>4. спр Номенклатура добавить в шапку рекв ВидНоменклатуры (ПеречислениеСсылка.ВидыНоменклатуры)</p>

<p>5. Документ ПриходнаяНакладная добавить реквизит документа Склад, реквизит ТЧ СрокГодности (тип Дата), создать ФормуДокумента<br>
 в ТЧ Номенклатура выставить ПараметрыВыбора "Отбор.ВидНоменклатуры(Товар)"</p>

<p>6. Док ПриходнаяНакладная<br>
в модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ</p>

<p> // Получение текущего метода списания и регистратора установки метода списания<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | УчетнаяПолитикаСрезПоследних.Регистратор,<br>
 | УчетнаяПолитикаСрезПоследних.МетодСписания<br>
 |ИЗ<br>
 | РегистрСведений.УчетнаяПолитика.СрезПоследних(&ДатаСреза, ) КАК УчетнаяПолитикаСрезПоследних";<br>
 <br>
 Запрос.УстановитьПараметр("ДатаСреза", Дата);<br>
 Результат = Запрос.Выполнить();<br>
 <br>
 Если Результат.Пустой() Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Не заполнена учетная политика.";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 // Если текущий метод списания - по средней, то в качестве партии берем документ установки партии, иначе - текущий документ<br>
 Данные = Результат.Выбрать();<br>
 Данные.Следующий();<br>
 Партия = ?(Данные.МетодСписания = Перечисления.МетодыСписания.ПоСредней, Данные.Регистратор, Ссылка);<br>
 <br>
 // Формирование набора записей регистра на основании сгруппированных строк табличной части<br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина; <br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьПриход();<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Партия = Партия;<br>
 Движение.Количество = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>7. Создать документ ИзменениеУчетнойПолитики, рекв.шапки МетодСписания (ПеречислениеСсылка.МетодыСписания)<br>
в модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 // Так как периодичность регистра - месяц, то чтобы избежать ошибки при вводе пользовательских данных, <br>
 // принудительно устанавливаем дату в начало месяца. Тогда не будет расхождений в дате документа,<br>
 // даты установки учетной политики и даты получения и записи данных в регистр остатков.<br>
 Дата = НачалоМесяца(Дата);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УЧЕТНАЯ ПОЛИТИКА<br>
 Движения.УчетнаяПолитика.Записывать = Истина;<br>
 <br>
 // Отражение в регистре Учетная политика метода списания, указанного в документе<br>
 Движение = Движения.УчетнаяПолитика.Добавить();<br>
 Движение.Период = Дата;<br>
 Движение.МетодСписания = МетодСписания;<br>
 <br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 // Если устанавливаемый метод списаний - по средней, то получаем все остатки из регистра по партиям, <br>
 // списываем их и помещаем их на одну партию - сам документ установки учетной политики<br>
 Если МетодСписания = Перечисления.МетодыСписания.ПоСредней Тогда<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по всем записям<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос для формирования движений. Итоги для того, чтобы минимизировать количество записей помещаемых в регистр<br>
 // по оприходованию остатков: данные по одной номенклатуре разных партий будут записаны одной строкой<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОстаткиНоменклатурыОстатки.Номенклатура КАК Номенклатура,<br>
 | ОстаткиНоменклатурыОстатки.Партия КАК Партия,<br>
 | ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Количество,<br>
 | ОстаткиНоменклатурыОстатки.СуммаОстаток КАК Сумма<br>
 |ИЗ<br>
 | РегистрНакопления.ОстаткиНоменклатуры.Остатки(&МоментИтогов, ) КАК ОстаткиНоменклатурыОстатки<br>
 |ИТОГИ<br>
 | СУММА(Количество),<br>
 | СУММА(Сумма)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("МоментИтогов", МоментВремени());<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 // Оприходование остатков на одну партию - текущий документ<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.Период = Дата;<br>
 ЗаполнитьЗначенияСвойств(Движение, ВыборкаНоменклатура);<br>
 Движение.Партия = Ссылка;<br>
 <br>
 ВыборкаДетальные = ВыборкаНоменклатура.Выбрать();<br>
 Пока ВыборкаДетальные.Следующий() Цикл<br>
 // Списание имеющихся движений по партиям<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 ЗаполнитьЗначенияСвойств(Движение, ВыборкаДетальные);<br>
 КонецЦикла;<br>
 КонецЦикла; <br>
 КонецЕсли;<br>
 <br>
КонецПроцедуры</p>

<p>8. Документ РасходнаяНакладная<br>
в модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаДокумента = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
 <br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | МИНИМУМ(РасходнаяНакладнаяСписокНоменклатуры.НомерСтроки) КАК НомерСтроки,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 | И РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры <> &ВидНоменклатурыУслуга<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.НомерСтроки КАК НомерСтроки,<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ОстаткиНоменклатурыОстатки.Партия КАК Партия,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК ОстаткиНоменклатурыОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ОстаткиНоменклатурыОстатки.Партия.МоментВремени<br>
 |ИТОГИ<br>
 | МАКСИМУМ(НомерСтроки),<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыУслуга", Перечисления.ВидыНоменклатуры.Услуга);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Если ВыборкаНоменклатура.КоличествоВДокументе > ВыборкаНоменклатура.КоличествоОстаток Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1. Имеющийся остаток: %2",<br>
 ВыборкаНоменклатура.НоменклатураПредставление, ВыборкаНоменклатура.КоличествоОстаток); <br>
 // Привязка выводимого сообщения к полю формы (требование задачи по управляемым формам) <br>
 Сообщение.Поле = "Объект.СписокНоменклатуры["+(ВыборкаНоменклатура.НомерСтроки-1)+"].Количество";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 Пока Выборка.Следующий() И ОсталосьСписать <> 0 Цикл<br>
 <br>
 // Движение по регистру Остатки номенклатуры<br>
 Списываем = Мин (Выборка.КоличествоОстаток, ОсталосьСписать);<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Партия = Выборка.Партия;<br>
 <br>
 Движение.Количество = Списываем;<br>
 Движение.Сумма = Списываем / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 <br>
 КонецЦикла;<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>9. Отчет ДвиженияТовара<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОстаткиНоменклатурыОстаткиИОбороты.Номенклатура КАК Номенклатура,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.Партия КАК Партия,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоНачальныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоКонечныйОстаток КАК КоличествоКонечныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоПриход КАК КоличествоПриход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоРасход КАК КоличествоРасход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаПриход КАК СуммаПриход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаРасход КАК СуммаРасход<br>
ИЗ<br>
 РегистрНакопления.ОстаткиНоменклатуры.ОстаткиИОбороты КАК ОстаткиНоменклатурыОстаткиИОбороты</p>

<p>ресурсы КоличествоКонечныйОстаток, КоличествоНачальныйОстаток, КоличествоПриход, КоличествоРасход, СуммаКонечныйОстаток, СуммаНачальныйОстаток, СуммаПриход, СуммаРасход; все выражения - сумма<br>
параметры НачалоПериода Дата &Период.ДатаНачала, КонецПериода Дата &Период.ДатаОкончания, ограничение доступности оба<br>
 Период СтандартныйПериод</p>

<p>группировки<br>
1. Заголовок<br>
2. Номенклатура -> детальные записи<br>
Макет заколовок шаблон <Движения товаров за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д") и для конца также</p>

<p>Номенклатура | Партия | "Нач. ост. Кол./Сум." | "Приход Кол./Сум." | "Расход Кол./Сум." | "Кон. ост. Кол./Сум." нарисовать, выбранные поля вертикально сгруппировать</p>

<br>
<p>Выражение представления для партии в наборе данных: <br>
Выбор Когда ТипЗначения(Партия) = Тип("Документ.ПриходнаяНакладная") Тогда "ПН" Иначе "УП" Конец + " № "+ Строка(Партия.Номер) + " от " +Формат(Партия.Дата, "ДФ= дд.ММ.гг")</p>

<p>Расположение общих итогов по вертикали = нет<br>
Расположение полей группировок = Отдельно и только в итогах</p>

<p>#ОУ4</p>

<p>1. Создать справочник Склады</p>

<p>3. В справочник Номенклатура добавить реквизит ВидНоменклатуры (ПеречислениеСсылка.ВидыНоменклатуры)</p>

<p>2. Регистры накопления:<br>
ОстаткиНоменклатуры, изм: Номенклатура, Склад; рес: Количество 15,2, Сумма 12,2</p>

<p>4. Создать регистр сведений ПриоритетыСкладов, периодичность В пределах месяца, Независимый, основной отбор по периоду Истина,<br>
 изм: Склад, рес: Приоритет 5,0</p>

<p>5. Документ ПриходнаяНакладная добавить реквизит документа Склад, создать ФормуДокумента<br>
 в ТЧ Номенклатура выставить ПараметрыВыбора "Отбор.ВидНоменклатуры(Товар)"</p>

<p>в модуле документа</p>

<br>
<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ() <br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Склад = Склад;<br>
 Движение.Количество = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 КонецЦикла; </p>

<p>КонецПроцедуры</p>

<p>7. Документ РасходнаяНакладная добавить реквизит документа Склад, создать ФормуДокумента</p>

<p>в модуле документа<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 | И РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры <> &ВидНоменклатурыУслуга<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК Количество,<br>
 | ОстаткиНоменклатурыОстатки.Склад КАК Склад,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток<br>
 |ПОМЕСТИТЬ ВТ_ТабЧастьСОстатками<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК ОстаткиНоменклатурыОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Склад<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧастьСОстатками.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧастьСОстатками.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧастьСОстатками.Склад КАК Склад,<br>
 | ВТ_ТабЧастьСОстатками.КоличествоОстаток КАК КоличествоОстаток,<br>
 | ВТ_ТабЧастьСОстатками.СуммаОстаток КАК СуммаОстаток,<br>
 | ВЫБОР<br>
 | КОГДА ВТ_ТабЧастьСОстатками.Склад = &Склад<br>
 | ТОГДА -1<br>
 | ИНАЧЕ ЕСТЬNULL(ПриоритетыСкладовСрезПоследних.Приоритет, 99999)<br>
 | КОНЕЦ КАК Приоритет,<br>
 | ВТ_ТабЧастьСОстатками.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧастьСОстатками КАК ВТ_ТабЧастьСОстатками<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПриоритетыСкладов.СрезПоследних(<br>
 | &МоментВремени,<br>
 | Склад В<br>
 | (ВЫБРАТЬ РАЗЛИЧНЫЕ<br>
 | Т.Склад<br>
 | ИЗ<br>
 | ВТ_ТабЧастьСОстатками КАК Т)) КАК ПриоритетыСкладовСрезПоследних<br>
 | ПО ВТ_ТабЧастьСОстатками.Склад = ПриоритетыСкладовСрезПоследних.Склад<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | Приоритет<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыУслуга", Перечисления.ВидыНоменклатуры.Услуга);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 <br>
 // Движение по регистру Остатки номенклатуры<br>
 Списываем = Мин (ОсталосьСписать, Выборка.КоличествоОстаток);<br>
 <br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Склад = Выборка.Склад;<br>
 <br>
 Движение.Количество = Списываем;<br>
 Движение.Сумма = Списываем / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 <br>
 КонецЦикла;<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>8. Отчет ДвиженияТоваров<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОстаткиНоменклатурыОстаткиИОбороты.Номенклатура КАК Товар,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.Склад,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоНачальныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоКонечныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоПриход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоРасход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаНачальныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаКонечныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаПриход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаРасход<br>
ИЗ<br>
 РегистрНакопления.ОстаткиНоменклатуры.ОстаткиИОбороты КАК ОстаткиНоменклатурыОстаткиИОбороты<br>
Ресурсы: все (кроме склад, товар)<br>
Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
группировки<br>
1. Заголовок<br>
2. Номенклатура -> детальные записи<br>
Макет заколовок шаблон <Движения товаров с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д") и для конца также<br>
Склад| Товар| "Нач. ост." | "Приход" | "Расход" | "Кон. ост." нарисовать, выбранные поля вертикально сгруппировать</p>

<p>Расположение полей группировок = Отдельно и только в итогах, Расположение общих итогов по вертикали = Нет, Выводить параметры = Не выводить</p>

<p>#ОУ5</p>

<p>1. Создать справочник Проекты, рекв.шапки ДатаОплаты (Дата) и Валюта (спр.ссылка), предопрюэлемент - Аванс</p>

<p>2. Создать регистр сведений КурсыВалют периодичность В пределах дня, Независимый, основной отбор по периоду Истина,<br>
 изм: Валюта, рес: Курс 5,2 неотр</p>

<p>3. Регистры накопления:<br>
Взаиморасчеты, изм: Контрагент, Проект; рес: СуммаВРублях 12,2, СуммаВВалюте 12,2<br>
рег: РасходнаяНакладная, ПриходДенег </p>

<p>4. Создать док ПриходДенег рекв.шапки Контрагент, Сумма 12,2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ВЗАИМОРАСЧЕТЫ</p>

<p> Движения.Взаиморасчеты.Записывать = Истина;<br>
 Движения.Взаиморасчеты.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Взаиморасчеты по контрагенту из документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Взаиморасчеты");<br>
 ЭлементБлокировки.УстановитьЗначение("Контрагент", Контрагент); <br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать(); <br>
 <br>
 ПроектАванс = Справочники.Проекты.Аванс;<br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ВзаиморасчетыОстатки.Проект КАК Проект,<br>
 | ВзаиморасчетыОстатки.СуммаВРубляхОстаток КАК СуммаВРубляхОстаток,<br>
 | ВзаиморасчетыОстатки.СуммаВВалютеОстаток КАК СуммаВВалютеОстаток,<br>
 | ВзаиморасчетыОстатки.Проект.Валюта КАК Валюта,<br>
 | ВзаиморасчетыОстатки.Проект.ДатаОплаты КАК ДатаОплаты<br>
 |ИЗ<br>
 | РегистрНакопления.Взаиморасчеты.Остатки(<br>
 | &МоментВремени,<br>
 | Контрагент = &Контрагент<br>
 | И Проект <> &Аванс) КАК ВзаиморасчетыОстатки<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ВзаиморасчетыОстатки.Проект.ДатаОплаты";<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Контрагент", Контрагент);<br>
 Запрос.УстановитьПараметр("Аванс", ПроектАванс);<br>
 <br>
 // Гасим долг по проектам<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 ОсталосьСписать = Сумма;<br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 СписываемВРублях = Мин (ОсталосьСписать, Выборка.СуммаВРубляхОстаток);<br>
 Движение = Движения.Взаиморасчеты.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Проект = Выборка.Проект;<br>
 <br>
 Движение.СуммаВРублях = СписываемВРублях;<br>
 Движение.СуммаВВалюте = СписываемВРублях / Выборка.СуммаВРубляхОстаток * Выборка.СуммаВВалютеОстаток;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - СписываемВРублях;<br>
 КонецЦикла;<br>
 <br>
 // Если после закрытия долга по всем проектам сумма еще осталась, то отражаем её как аванс<br>
 Если ОсталосьСписать <> 0 Тогда<br>
 Движение = Движения.Взаиморасчеты.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Проект = ПроектАванс;<br>
 Движение.СуммаВРублях = ОсталосьСписать;<br>
 КонецЕсли;<br>
 <br>
КонецПроцедуры</p><br>
<br>
<p>7. Документ РасходнаяНакладная добавить реквизиты документа Контрагент, Проект создать ФормуДокумента</p>

<p>в модуле документа<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 <br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);</p>

<p>КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ВЗАИМОРАСЧЕТЫ<br>
 <br>
 Движения.Взаиморасчеты.Записывать = Истина;<br>
 Движения.Взаиморасчеты.Записать();<br>
 <br>
 ПроектАванс = Справочники.Проекты.Аванс;<br>
 <br>
 // Установка блокировки данных в регистре Взаиморасчеты по контрагенту документа и проекту - авансу<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Взаиморасчеты");<br>
 ЭлементБлокировки.УстановитьЗначение("Контрагент", Контрагент);<br>
 ЭлементБлокировки.УстановитьЗначение("Проект", ПроектАванс);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать();<br>
 <br>
 // В первом запросе пакета определяем курс валюты проекта, указанного в документе<br>
 // Во втором запросе пакета получаем имеющийся аванс контрагента<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | КурсыВалютСрезПоследних.Курс КАК Курс<br>
 |ИЗ<br>
 | РегистрСведений.КурсыВалют.СрезПоследних(&ДатаСреза, Валюта = ВЫРАЗИТЬ(&Проект КАК Справочник.Проекты).Валюта) КАК КурсыВалютСрезПоследних<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | -ВзаиморасчетыОстатки.СуммаВРубляхОстаток КАК СуммаАванс,<br>
 | ВзаиморасчетыОстатки.Контрагент КАК Контрагент<br>
 |ИЗ<br>
 | РегистрНакопления.Взаиморасчеты.Остатки(<br>
 | &МоментВремени,<br>
 | Контрагент = &Контрагент<br>
 | И Проект = &Аванс) КАК ВзаиморасчетыОстатки";<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("ДатаСреза", Дата);<br>
 Запрос.УстановитьПараметр("Контрагент", Контрагент);<br>
 Запрос.УстановитьПараметр("Аванс", ПроектАванс);<br>
 Запрос.УстановитьПараметр("Проект", Проект);<br>
 <br>
 МассивРезультатов = Запрос.ВыполнитьПакет();<br>
 <br>
 РезультатКурсПроекта = МассивРезультатов[0];<br>
 КурсПроекта = 0;<br>
 Если Не РезультатКурсПроекта.Пустой() Тогда<br>
 Данные = РезультатКурсПроекта.Выбрать();<br>
 Данные.Следующий();<br>
 КурсПроекта = Данные.Курс;<br>
 КонецЕсли;<br>
 <br>
 РезультатОсновной = МассивРезультатов[1];<br>
 ГасимИзАванса = 0;<br>
 Если Не РезультатОсновной.Пустой() Тогда<br>
 // Если аванс есть, то гасим сумму долга по документу из аванса<br>
 Данные = РезультатОсновной.Выбрать();<br>
 Данные.Следующий();<br>
 СуммаАванса = Данные.СуммаАванс;<br>
 ГасимИзАванса = Мин (СуммаАванса, СуммаПоДокументу);<br>
 <br>
 Движение = Движения.Взаиморасчеты.ДобавитьПриход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Проект = ПроектАванс;<br>
 Движение.СуммаВРублях = ГасимИзАванса;<br>
 КонецЕсли;<br>
 <br>
 // Если сумма документа не была полностью погашена авансом, отражаем остаток долга в регистре<br>
 ОстатокДолга = СуммаПоДокументу - ГасимИзАванса;<br>
 Если ОстатокДолга <> 0 Тогда <br>
 Движение = Движения.Взаиморасчеты.ДобавитьПриход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Проект = Проект;<br>
 Движение.СуммаВРублях = ОстатокДолга;<br>
 Движение.СуммаВВалюте = ?(КурсПроекта = 0, 0, ОстатокДолга / КурсПроекта);<br>
 КонецЕсли;<br>
 <br>
КонецПроцедуры</p><br>
<br>
<p>8. Отчет ДвиженияТоваров<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ВзаиморасчетыОстатки.Контрагент КАК Контрагент,<br>
 ВзаиморасчетыОстатки.Проект КАК Проект,<br>
 ВЫБОР<br>
 КОГДА ВзаиморасчетыОстатки.Проект = &ПроектАванс<br>
 ТОГДА -ВзаиморасчетыОстатки.СуммаВРубляхОстаток<br>
 ИНАЧЕ ВзаиморасчетыОстатки.СуммаВРубляхОстаток<br>
 КОНЕЦ КАК СуммаВРубляхОстаток,<br>
 ВзаиморасчетыОстатки.СуммаВВалютеОстаток КАК СуммаВВалютеОстаток<br>
ИЗ<br>
 РегистрНакопления.Взаиморасчеты.Остатки КАК ВзаиморасчетыОстатки</p>

<p>Вычисл.поля ВалютаПредставление "Выбор Когда Проект <> &ПроектАванс Тогда "/" + Проект.Валюта.Наименование КОНЕЦ"<br>
Ресурсы: СуммаВВалютеОстаток, СуммаВРубляхОстаток<br>
Параметры: Период Дата, ПроектАванс СправочникСсылка.Проекты знач Справочник.Проекты.Аванс огр.доступн.<br>
группировки<br>
1. Заголовок<br>
2. Таблица строки: Контрагент, колонки: Проект</p>

<p>Макет заколовок шаблон <Состояние взаиморасчетов на [Период]> Формат (ПараметрыДанных.Период, "ДЛФ = Д") <br>
<"[Проект] Представление(Проект)<br>
Руб.[Валюта]"> ВалютаПредставление<br>
Контрагент/Проект (Текст)</p>

<p>Отчет выб поля: Контрагент, Проект, Сумма (группа Вертикально) = (СуммаВРубляхОстаток, СуммаВВалютеОстаток)</p>

<p>Расположение общих итогов по вертикали = Нет, Расположение общих итогов по горизонтали = Нет, Выводить параметры = Не выводить</p>

<p>#ОУ6</p>

<p>1. Перечисления ВидыНоменклатуры Значения "Стеллаж" и "Комплектующее"</p>

<p>2. Создать регистр сведений ЗначенияСвойств<br>
 изм: Стеллаж (СправочникСсылка.Номенклатура, ПараметрыВыбора Отбор.ВидНоменклатуры(Стеллаж)), Характеристика (ПланВидовХарактеристикСсылка.СвойстваОбъектов)<br>
 рес: Значение (Характеристика.СвойстваОбъектов)</p>

<p>3. Создать спр Склады и ЗначенияСвойств (владелец ПланВидовХарактеристик.СвойстваОбъектов)</p>

<p>4. В ПВХ СвойстваОбъектов тип знач СправочникСсылка.ЗначенияСвойств, Булево, Строка, Дата, Число<br>
 создать предопр.значение Страна (СправочникСсылка.ЗначенияСвойств)</p>

<p>5. Создать регистр сведений СоставСтеллажей<br>
 изм: Деталь (СправочникСсылка.Номенклатура, ПараметрыВыбора Отбор.ВидНоменклатуры(Комплектующее))<br>
 рес: Стеллаж (СправочникСсылка.Номенклатура, ПараметрыВыбора Отбор.ВидНоменклатуры(Стеллаж)), Количество 12,3</p>

<p>6. В спр Номенклатура в шапку добавить ВидыНоменклатуры </p>

<p>7. Создать регистр накопления ОстаткиНоменклатуры,<br>
 изм: Номенклатура, Склад, рес: Количество 10,0<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная</p>

<p>8. док ПриходнаяНакладная добавить рекв Склад в шапку<br>
в ТЧ Номенклатура Рараметры выбора Отбор.ВидНоменклатуры(Комплектующее)</p>

<p>в модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ() <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Склад = СкладОУ;<br>
 Движение.Количество = Выборка.Количество;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>9. Док РасходнаяНакладная добавить в шапку Склад, (ОУ и БУ булево - если разделять)<br>
в модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ)<br>
 <br>
 Если Не ОУ Тогда<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (НОВАЯ МЕТОДИКА ПРОВЕДЕНИЯ) <br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.БлокироватьДляИзменения = Истина;<br>
 <br>
 // Запрос получения данных для формирования движений (данные табличной части соединяются с регистром составов стеллажей,<br>
 // детали ТЧ заменяются на стеллажи, количество рассчитывается с учетом количества табличной части и количества из данных по регистру)<br>
 Запрос = Новый Запрос;<br>
 Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц; // временная таблица данных ВТ_ТабЧасть будет использоваться несколько раз<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ЕСТЬNULL(СоставСтеллажей.Деталь, РасходнаяНакладнаяСписокНоменклатуры.Номенклатура) КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество * ЕСТЬNULL(СоставСтеллажей.Количество, 1)) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СоставСтеллажей КАК СоставСтеллажей<br>
 | ПО РасходнаяНакладнаяСписокНоменклатуры.Номенклатура = СоставСтеллажей.Стеллаж<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ЕСТЬNULL(СоставСтеллажей.Деталь, РасходнаяНакладнаяСписокНоменклатуры.Номенклатура)<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК Количество<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 // Формирование набора записей, запись движений в регистр<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход(); <br>
 Движение.Период = Дата;<br>
 Движение.Склад = Склад;<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 КонецЦикла;<br>
 <br>
 Движения.Записать();<br>
 <br>
 // Запрос получения данных для контроля появления отрицательных остатков<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | -ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Превышение,<br>
 | ОстаткиНоменклатурыОстатки.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)<br>
 | И Склад = &Склад) КАК ОстаткиНоменклатурыОстатки<br>
 |ГДЕ<br>
 | ОстаткиНоменклатурыОстатки.КоличествоОстаток < 0";<br>
 <br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 Запрос.УстановитьПараметр("МоментВремени", Новый Граница(МоментВремени()));<br>
 <br>
 // Если результат запроса не пустой, то вывод данных по превышениям остатка и отказ от проведения документа<br>
 Результат = Запрос.Выполнить();<br>
 Если Не Результат.Пустой() Тогда<br>
 Выборка = Результат.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2",<br>
 Выборка.НоменклатураПредставление, Выборка.Превышение);<br>
 Сообщение.Сообщить();<br>
 КонецЦикла;<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<p>10 Отчет НаличиеСтеллажей<br>
Запрос:<br>
ВЫБРАТЬ РАЗЛИЧНЫЕ<br>
 ОстаткиНоменклатурыОстатки.Склад КАК Склад,<br>
 СоставСтеллажей.Стеллаж КАК Стеллаж<br>
ПОМЕСТИТЬ ВТ_СтелажиПоСкладамСДеталямиВОстатках<br>
ИЗ<br>
 РегистрНакопления.ОстаткиНоменклатуры.Остатки(, ) КАК ОстаткиНоменклатурыОстатки<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СоставСтеллажей КАК СоставСтеллажей<br>
 ПО ОстаткиНоменклатурыОстатки.Номенклатура = СоставСтеллажей.Деталь</p>

<p>ИНДЕКСИРОВАТЬ ПО<br>
 Стеллаж<br>
;</p>

<p>////////////////////////////////////////////////////////////////////////////////<br>
ВЫБРАТЬ<br>
 ВТ_СтелажиПоСкладамСДеталямиВОстатках.Склад КАК Склад,<br>
 ВТ_СтелажиПоСкладамСДеталямиВОстатках.Стеллаж КАК Стеллаж,<br>
 СоставСтеллажей.Деталь КАК Деталь,<br>
 СоставСтеллажей.Количество КАК Количество<br>
ПОМЕСТИТЬ ВТ_ДанныеПоСоставуСтеллажей<br>
ИЗ<br>
 ВТ_СтелажиПоСкладамСДеталямиВОстатках КАК ВТ_СтелажиПоСкладамСДеталямиВОстатках<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СоставСтеллажей КАК СоставСтеллажей<br>
 ПО ВТ_СтелажиПоСкладамСДеталямиВОстатках.Стеллаж = СоставСтеллажей.Стеллаж</p>

<p>ИНДЕКСИРОВАТЬ ПО<br>
 Деталь,<br>
 Склад<br>
;</p>

<p>////////////////////////////////////////////////////////////////////////////////<br>
ВЫБРАТЬ<br>
 ВТ_ДанныеПоСоставуСтеллажей.Склад КАК Склад,<br>
 ВТ_ДанныеПоСоставуСтеллажей.Стеллаж КАК Стеллаж,<br>
 МИНИМУМ(ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) / ВТ_ДанныеПоСоставуСтеллажей.Количество) КАК Количество<br>
ИЗ<br>
 ВТ_ДанныеПоСоставуСтеллажей КАК ВТ_ДанныеПоСоставуСтеллажей<br>
 ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 ,<br>
 (Номенклатура, Склад) В<br>
 (ВЫБРАТЬ<br>
 ВТ_ДанныеПоСоставуСтеллажей.Деталь КАК Деталь,<br>
 ВТ_ДанныеПоСоставуСтеллажей.Склад КАК Склад<br>
 ИЗ<br>
 ВТ_ДанныеПоСоставуСтеллажей КАК ВТ_ДанныеПоСоставуСтеллажей)) КАК ОстаткиНоменклатурыОстатки<br>
 ПО ВТ_ДанныеПоСоставуСтеллажей.Склад = ОстаткиНоменклатурыОстатки.Склад<br>
 И ВТ_ДанныеПоСоставуСтеллажей.Деталь = ОстаткиНоменклатурыОстатки.Номенклатура</p>

<p>СГРУППИРОВАТЬ ПО<br>
 ВТ_ДанныеПоСоставуСтеллажей.Склад,<br>
 ВТ_ДанныеПоСоставуСтеллажей.Стеллаж</p>

<p>ИМЕЮЩИЕ<br>
 МИНИМУМ(ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) / ВТ_ДанныеПоСоставуСтеллажей.Количество) >= 1</p>

<p>Выч поля КоличествоЦелое выражение = Цел(Количество) заголовок Кол-во<br>
ресурс КоличествоЦелое Сумма(КоличествоЦелое) рассчитывать по Стеллаж<br>
параметр Период Дата</p>

<p>1. Заголовок <Наличие стеллажей на дату [Период]> Формат (ПараметрыДанных.Период, "ДЛФ = ДД")<br>
2. Склад -> Стеллаж, Стеллаж.Страна</p>

<p>Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#ОУ7</p>

<p>1. В спр Номенклатура в шапку добавить ВидыНоменклатуры </p>

<p>2. Перечисления УчетнаяПолитика = МетодыСписания</p>

<p>3. Создать регистр сведений УчетнаяПолитика (В пределах года) рес: МетодСписания</p>

<p>4. Создать Регистр накопления "ОстаткиНоменклатуры" (Остатки)<br>
изм: Номенклатура, Партия; рес: Количество 10.0, СуммаВРублях 12.2, СуммаВВалюте 12.2<br>
Регистратор РасхНакл, ПрихНакл</p>

<p>5. Создать Регистр накопления "Продажи" (Обороты)<br>
изм: Номенклатура; рес: Количество 10.0, СтоимостьВРублях 12.2, СтоимостьВВалюте 12.2, ВыручкаВРублях 12.2, ВыручкаВВалюте 12.2<br>
Регистратор РасхНакл</p>

<p>6. док ПриходнаяНакладная добавить рекв КурсДоллара в шапку<br>
в ТЧ Номенклатура Рараметры выбора Отбор.ВидНоменклатуры(Товар)</p>

<p>в модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ, Режим)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Партия = Ссылка;<br>
 Движение.Количество = Выборка.Количество;<br>
 Движение.СуммаВРублях = Выборка.Сумма;<br>
 Движение.СуммаВВалюте = ?(КурсДоллара = 0, 0, Выборка.Сумма / КурсДоллара);<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>9. Док РасходнаяНакладная добавить в шапку КурсДоллара, (ОУ и БУ булево - если разделять)<br>
в модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения) <br>
 <br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);</p>

<p>КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ)<br>
 <br>
 // Определение текущего метода списания себестоимости</p>

<p> МетодСписания = РегистрыСведений.УчетнаяПолитика.ПолучитьПоследнее(Дата).МетодСписания;<br>
 <br>
 Если Не ЗначениеЗаполнено(МетодСписания) Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Не заполнен метод списания учетной политики";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли; <br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ) И РЕГИСТРУ ПРОДАЖИ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записать(); <br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.Продажи.Записывать = Истина;<br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по номенклатурам табличной части <br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 ТекстЗапроса = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВЫБОР<br>
 | КОГДА ВТ_ТабЧасть.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Товар)<br>
 | ТОГДА ИСТИНА<br>
 | ИНАЧЕ ЛОЖЬ<br>
 | КОНЕЦ КАК ЭтоТовар,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | ОстаткиНоменклатурыОстатки.Партия,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаВРубляхОстаток, 0) КАК СуммаВРубляхОстаток,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаВВалютеОстаток, 0) КАК СуммаВВалютеОстаток<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК ОстаткиНоменклатурыОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ОстаткиНоменклатурыОстатки.Партия.МоментВремени УБЫВ<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | МАКСИМУМ(СуммаВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Если МетодСписания = Перечисления.МетодыСписания.ФИФО Тогда<br>
 ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "УБЫВ", "");<br>
 КонецЕсли;<br>
 <br>
 Запрос.Текст = ТекстЗапроса;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 <br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 <br>
 СтоимостьВРублях = 0; // для накопления списанной стоимости для помещения в регистр продаж<br>
 СтоимостьВВалюте = 0; // для накопления списанной стоимости в валюте для помещения в регистр продаж<br>
 <br>
 Если ВыборкаНоменклатура.ЭтоТовар Тогда<br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 ВыборкаДетальные = ВыборкаНоменклатура.Выбрать();<br>
 Пока ВыборкаДетальные.Следующий() И ОсталосьСписать <> 0 Цикл<br>
 // Движение по регистру Остатки номенклатуры<br>
 Списываем = Мин (ВыборкаДетальные.КоличествоОстаток, ОсталосьСписать);<br>
 <br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = ВыборкаДетальные.Номенклатура;<br>
 Движение.Партия = ВыборкаДетальные.Партия;<br>
 Движение.Количество = Списываем; <br>
 Движение.СуммаВРублях = Списываем / ВыборкаДетальные.КоличествоОстаток * ВыборкаДетальные.СуммаВРубляхОстаток;<br>
 Движение.СуммаВВалюте = Списываем / ВыборкаДетальные.КоличествоОстаток * ВыборкаДетальные.СуммаВВалютеОстаток;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 СтоимостьВРублях = СтоимостьВРублях + Движение.СуммаВРублях;<br>
 СтоимостьВВалюте = СтоимостьВВалюте + Движение.СуммаВВалюте;<br>
 <br>
 КонецЦикла;<br>
 КонецЕсли;</p>

<p> // Движение по регистру Продажи<br>
 Движение = Движения.Продажи.Добавить(); <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = ВыборкаНоменклатура.Номенклатура;<br>
 Движение.Количество = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 Движение.ВыручкаВРублях = ВыборкаНоменклатура.СуммаВДокументе;<br>
 Движение.ВыручкаВВалюте = ?(КурсДоллара = 0, 0, ВыборкаНоменклатура.СуммаВДокументе / КурсДоллара); <br>
 Движение.СтоимостьВРублях = СтоимостьВРублях;<br>
 Движение.СтоимостьВВалюте = СтоимостьВВалюте;</p>

<p> КонецЦикла;<br>
КонецПроцедуры</p>

<p>10 Отчет Продажи<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ПродажиОбороты.Номенклатура,<br>
 ПродажиОбороты.КоличествоОборот КАК Количество,<br>
 ПродажиОбороты.СтоимостьВРубляхОборот КАК СтоимостьВРублях,<br>
 ПродажиОбороты.СтоимостьВВалютеОборот КАК СтоимостьВВалюте,<br>
 ПродажиОбороты.ВыручкаВРубляхОборот КАК ВыручкаВРублях,<br>
 ПродажиОбороты.ВыручкаВВалютеОборот КАК ВыручкаВВалюте<br>
ИЗ<br>
 РегистрНакопления.Продажи.Обороты КАК ПродажиОбороты</p>

<p>В набор: Выражение упорядочивания для поля Номенклатура: Номенклатура.ВидНоменклатуры возр автоупорядочивание, Номенклатура.Наименование возр автоупорядочивание</p>

<br>
<p>Выч поля ПрибыльВРублях выражение = ВыручкаВРублях - СтоимостьВРублях, заголовок Прибыль в рублях<br>
 ПрибыльВВалюте выражение = ВыручкаВВалюте - СтоимостьВВалюте, Прибыль в валюте</p>

<p>ресурсы ВыручкаВРублях, Количество, ПрибыльВВалюте, ПрибыльВРублях, СтоимостьВРублях, ВыручкаВВалюте, СтоимостьВВалюте (все сумма)</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод</p>

<p>1. Заголовок <Продажи с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = D"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = D")<br>
 Номенлатура Кол-во "Себест-сть/руб./дол." "Продажа/руб./дол." "Прибыль/руб./дол."<br>
2. Номенклатура</p>

<p>Отч выб поля Количество,<br>
 Себестоимость, вертикально (СтоимостьВРублях, СтоимостьВВалюте)<br>
 Продажа, вертикально (ВыручкаВРублях, ВыручкаВВалюте)<br>
 Прибыль, вертикально (ПрибыльВРублях, ПрибыльВВалюте)</p>

<p>Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#ОУ8</p>

<p>1. Создать спр СтатьиЗатрат</p>

<p>2. Создать рег накопл Бюджет (Обороты)<br>
регистраторы Бюджет, ПрихНакл, РасхНакл, ПриходДенег, РасходДенег<br>
изм: Подразделение, СтатьяЗатрат; рес: Факт 12.2, План 12.2, ДопустимоеПревышение 12.2</p>

<br>
<p>3. док ПриходнаяНакладная добавить рекв Подразделение, СтатьяЗатрат в шапку</p>

<p>4. док РасходнаяНакладная добавить рекв Подразделение, СтатьяЗатрат в шапку</p>

<p>5. создать док ПриходДенег, рекв СуммаПоДокументу 12.2, Подразделение, СтатьяЗатрат</p>

<p>6. создать док РасходДенег, рекв СуммаПоДокументу 12.2, Подразделение, СтатьяЗатрат</p>

<p>7. Создать модуль ОперативныйУчет (Сервер)<br>
в модуле <br>
// Через подписку на событие обработки проведения вызывается сразу для 4ых документов (Приходная и Расходная накладная, Приход и Расход денег)<br>
Процедура ОбработкаПроведенияДокументовКонтрольБюджета(Источник, Отказ, РежимПроведения) Экспорт<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ БЮДЖЕТ<br>
 <br>
 ДвиженияБюджет = Источник.Движения.Бюджет;<br>
 <br>
 ДвиженияБюджет.Записывать = Истина;<br>
 ДвиженияБюджет.БлокироватьДляИзменения = Истина;<br>
 <br>
 // Отражение движения по регистру Бюджет по подразделению, Статье и сумме документа<br>
 Движение = ДвиженияБюджет.Добавить();<br>
 Движение.Период = Источник.Дата;<br>
 Движение.Подразделение = Источник.Подразделение;<br>
 Движение.СтатьяЗатрат = Источник.СтатьяЗатрат;<br>
 Движение.Факт = Источник.СуммаПоДокументу;<br>
 <br>
 // Запись движений в регистр<br>
 Источник.Движения.Записать(); <br>
 <br>
 // Запрос контроля превышения планируемой суммы бюджета <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | БюджетОбороты.ФактОборот - БюджетОбороты.ПланОборот КАК ДопустимоеПревышение,<br>
 | БюджетОбороты.ФактОборот - БюджетОбороты.ПланОборот - БюджетОбороты.ДопустимоеПревышениеОборот КАК ПревышениеСверхДопустимого<br>
 |ИЗ<br>
 | РегистрНакопления.Бюджет.Обороты(<br>
 | &НачалоПериода,<br>
 | &КонецПериода,<br>
 | ,<br>
 | Подразделение = &Подразделение<br>
 | И СтатьяЗатрат = &СтатьяЗатрат) КАК БюджетОбороты<br>
 |ГДЕ<br>
 | БюджетОбороты.ФактОборот > БюджетОбороты.ПланОборот";<br>
 <br>
 ДатаДокумента = Источник.Дата;<br>
 <br>
 Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(ДатаДокумента));<br>
 Запрос.УстановитьПараметр("НачалоПериода", НачалоМесяца(ДатаДокумента));<br>
 Запрос.УстановитьПараметр("Подразделение", Источник.Подразделение);<br>
 Запрос.УстановитьПараметр("СтатьяЗатрат", Источник.СтатьяЗатрат);<br>
 <br>
 // Обход результатов запроса<br>
 РезультатЗапроса = Запрос.Выполнить(); <br>
 Если Не РезультатЗапроса.Пустой() Тогда<br>
 // Бюджет превышен, выводим соответствующее сообщение о превышении<br>
 Данные = РезультатЗапроса.Выбрать(); <br>
 Данные.Следующий();<br>
 <br>
 Если Данные.ПревышениеСверхДопустимого > 0 Тогда<br>
 ТекстСообщения = СтрШаблон("Превышение запланированного бюджета сверх допустимого на %1",<br>
 Данные.ПревышениеСверхДопустимого);<br>
 Иначе<br>
 ТекстСообщения = СтрШаблон("Превышение запланированного бюджета в пределах допустимого на %1",<br>
 Данные.ДопустимоеПревышение); <br>
 КонецЕсли;<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = ТекстСообщения;<br>
 Сообщение.Сообщить();<br>
 <br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<p>8. Создать Подписку на события ОбработкаПроведенияДокументовКонтрольБюджета<br>
 Источник: ДокументОбъект.РасходДенег, ДокументОбъект.ПриходДенег, ДокументОбъект.РасходнаяНакладная, ДокументОбъект.ПриходнаяНакладная<br>
 Событие: ОбработкаПроведения<br>
 Обработчик: ОперативныйУчет.ОбработкаПроведенияДокументовКонтрольБюджета</p>

<br>
<p>9. Создать док Бюджет, рекв Подразделение, НачалоПериода, КонецПериода (дата)<br>
 ТЧ СписокСтатей рекв СтатьяЗатрат, Сумма 12.2, Превышение 12.2<br>
В модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ПЛАН ПО БЮДЖЕТУ<br>
 <br>
 Движения.Бюджет.Записывать = Истина; <br>
 <br>
 // Заполнения соответствия ДоляБюджетаПоМесяцам<br>
 // Ключ соответствия - первое число месяца, значение - доля дней в месяце от общего количества дней периода<br>
 ДоляБюджетаПоМесяцам = Новый Соответствие; <br>
 НачалоТекущегоПериода = НачалоПериода; <br>
 ДнейЗаВесьПериод = (КонецПериода - НачалоПериода) / 86400 + 1; <br>
 Пока НачалоТекущегоПериода < КонецПериода Цикл <br>
 ОкончаниеТекущегоПериода = Мин(КонецМесяца(НачалоТекущегоПериода), КонецДня(КонецПериода));<br>
 <br>
 ДнейВТекущемМесяце = (ОкончаниеТекущегоПериода + 1 - НачалоТекущегоПериода) / 86400;<br>
 ДоляБюджетаПоМесяцам.Вставить(НачалоМесяца(НачалоТекущегоПериода), ДнейВТекущемМесяце / ДнейЗаВесьПериод);<br>
 <br>
 НачалоТекущегоПериода = ОкончаниеТекущегоПериода + 1; <br>
 КонецЦикла; <br>
 <br>
 Для Каждого СтрокаТЧ Из СписокСтатей Цикл<br>
 СуммаВРегистре = 0; // для контроля распределения всей суммы, указанной в реквизите Сумма табличной части<br>
 ПревышениеВРегистре = 0; // для контроля распределения всей суммы, указанной в реквизите Превышение табличной части<br>
 <br>
 // Распределяем сумму в строке ТЧ по месяцам пропорционально определенной ранее доле каждого месяца<br>
 Для Каждого ДоляБюджетаМесяца Из ДоляБюджетаПоМесяцам Цикл <br>
 Движение = Движения.Бюджет.Добавить();<br>
 Движение.Период = ДоляБюджетаМесяца.Ключ;<br>
 Движение.Подразделение = Подразделение;<br>
 Движение.СтатьяЗатрат = СтрокаТЧ.СтатьяЗатрат;<br>
 Движение.План = ДоляБюджетаМесяца.Значение * СтрокаТЧ.Сумма;<br>
 Движение.ДопустимоеПревышение = ДоляБюджетаМесяца.Значение * СтрокаТЧ.Превышение;<br>
 <br>
 СуммаВРегистре = СуммаВРегистре + Движение.План;<br>
 ПревышениеВРегистре = ПревышениеВРегистре + Движение.ДопустимоеПревышение;<br>
 КонецЦикла;<br>
 <br>
 // Проверка распределения всей суммы, указанной в строке табличной части в поле Сумма<br>
 РасхождениеСумма = СтрокаТЧ.Сумма - СуммаВРегистре;<br>
 Если РасхождениеСумма <> 0 Тогда<br>
 Движение.План = Движение.План + РасхождениеСумма;<br>
 КонецЕсли;<br>
 <br>
 // Проверка распределения всей суммы, указанной в строке табличной части в поле Превышение<br>
 РасхождениеПревышение = СтрокаТЧ.Превышение - ПревышениеВРегистре;<br>
 Если РасхождениеПревышение <> 0 Тогда<br>
 Движение.ДопустимоеПревышение = Движение.ДопустимоеПревышение + РасхождениеПревышение;<br>
 КонецЕсли;<br>
 КонецЦикла;<br>
КонецПроцедуры</p><br>
<br>
<br>
<br>
<p>10 Отчет ИсполнениеБюджета<br>
Запрос:<br>
ВЫБРАТЬ<br>
 БюджетОбороты.Подразделение КАК Подразделение,<br>
 БюджетОбороты.СтатьяЗатрат КАК Статья,<br>
 БюджетОбороты.ПланОборот КАК План,<br>
 БюджетОбороты.ФактОборот КАК Факт,<br>
 БюджетОбороты.Период КАК Месяц<br>
ИЗ<br>
 РегистрНакопления.Бюджет.Обороты(, , Месяц, ) КАК БюджетОбороты</p>

<p>В набор: Формат для поля Месяц: ДФ='ММММ гггг'</p>

<p>Выч поля ПроцентИсполнения выражение = Выбор Когда План = 0 Тогда 0 Иначе Факт/План * 100 Конец , заголовок "% исп".</p>

<br>
<p>ресурсы План, Факт, ПроцентИсполнения (все сумма)</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод</p>

<p>1. Заголовок <Исполнение бюджета за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2. Таблица<br>
 Строки: Подразделение -> Статья<br>
 Колонки: Месяц</p>

<p>Отч выб поля План, Факт, ПроцентИсполнения</p>

<p>Расположение полей группировок = Отдельно и только в итогах<br>
Выводить параметры = Не выводить</p>

<p>Для таблицы:<br>
 Расположение общих итогов по горизонтали = нет<br>
 Расположение общих итогов по вертикали = нет</p>

<p>#ОУ9</p>

<p>1. Создать спр СвойстваНоменклатуры (владелец спр Номенклатура)</p>

<p>2. Создать ПВХ ХарактеристикиОбъектов, тип знач Булево, СправочникСсылка.ЗначенияХарактеристик, Строка, Дата, Число</p>

<p>3. Создать спр ЗначенияХарактеристик (владелец ПВХ ХарактеристикиОбъектов)</p>

<p>4. Создать рег свед ЗначенияХарактеристикНоменклатур, изм: СвойствоНоменклатуры (СправочникСсылка.СвойстваНоменклатуры), Характеристика (ПланВидовХарактеристикСсылка.ХарактеристикиОбъектов)<br>
 рес: Значение (Характеристика.ХарактеристикиОбъектов)</p>

<p>5. Док ПриходнаяНакладная добавить в ТЧ СвойствоНоменклатуры<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ()<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры КАК СвойствоНоменклатуры,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка); <br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.СвойствоНоменклатуры = Выборка.СвойствоНоменклатуры;<br>
 Движение.Количество = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>6. Док РасходнаяНакладная добавить в ТЧ СвойствоНоменклатуры<br>
в модуле объекта<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ); <br>
 <br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)</p>

<p> Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по списку номенклатур и свойств табличной части<br>
 Блокировка = Новый БлокировкаДанных();<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("СвойствоНоменклатуры", "СвойствоНоменклатуры");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры КАК СвойствоНоменклатуры,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура,<br>
 | СвойствоНоменклатуры<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ТабЧасть.СвойствоНоменклатуры КАК СвойствоНоменклатуры,<br>
 | ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ТабЧасть.СвойствоНоменклатуры.Представление КАК СвойствоНоменклатурыПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | (Номенклатура, СвойствоНоменклатуры) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура,<br>
 | ВТ_ТабЧасть.СвойствоНоменклатуры<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК ОстаткиНоменклатурыОстатки<br>
 | ПО ТабЧасть.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура<br>
 | И ТабЧасть.СвойствоНоменклатуры = ОстаткиНоменклатурыОстатки.СвойствоНоменклатуры";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 <br>
 Если Превышение > 0 Тогда<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон ("Превышение остатка по номенклатуре %1, свойству %2 в количестве %3",<br>
 Выборка.НоменклатураПредставление, Выборка.СвойствоНоменклатурыПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Движение по регистру Остатки номенклатуры<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.СвойствоНоменклатуры = Выборка.СвойствоНоменклатуры;<br>
 <br>
 Движение.Количество = Выборка.КоличествоВДокументе;<br>
 Движение.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>7. Отчет ВедомостьТоваров<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОстаткиНоменклатурыОстаткиИОбороты.Номенклатура КАК Товар,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СвойствоНоменклатуры КАК СвойствоНоменклатуры,<br>
 ЗначенияХарактеристикНоменклатур.Характеристика КАК ХарактеристикаНоменклатуры,<br>
 ЗначенияХарактеристикНоменклатур.Значение КАК ЗначениеХарактеристики,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоНачальныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоКонечныйОстаток КАК КоличествоКонечныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоПриход КАК КоличествоПриход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоРасход КАК КоличествоРасход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаПриход КАК СуммаПриход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаРасход КАК СуммаРасход<br>
ИЗ<br>
 РегистрНакопления.ОстаткиНоменклатуры.ОстаткиИОбороты КАК ОстаткиНоменклатурыОстаткиИОбороты<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияХарактеристикНоменклатур КАК ЗначенияХарактеристикНоменклатур<br>
 ПО ОстаткиНоменклатурыОстаткиИОбороты.СвойствоНоменклатуры = ЗначенияХарактеристикНоменклатур.СвойствоНоменклатуры <br>
ГДЕ<br>
 ЗначенияХарактеристикНоменклатур.Характеристика = &Характеристика</p>

<p>В набор: Характеристика заголовок = Харак-ка</p>

<p>Выч поля ПроцентИсполнения выражение = Выбор Когда План = 0 Тогда 0 Иначе Факт/План * 100 Конец , заголовок "% исп".</p>

<br>
<p>ресурсы План, Факт, ПроцентИсполнения (все сумма)</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 Характеристика ПланВидовХарактеристикСсылка.ХарактеристикиОбъектов</p>

<p>1. Заголовок <Ведомость товаров с [НачалоПериода] по [КонецПериода] по характеристике «[НазваниеХарактеристики]».> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
 НазваниеХарактеристики = Представление(ПараметрыДанных.Характеристика)<br>
2. ЗначениеХарактеристики -> Товар</p>

<p>Отч выб поля Все ресурсы (можно отключить суммы, если по шаблону картинки делать, но в тексте они есть)</p>

<p>Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = Нет<br>
Выводить параметры = Не выводить</p>

<p>#ОУ10</p>

<p>1. Перечисления ВидыНоменклатуры заменить на Продукт, Набор, Блюдо</p>

<p>2. В Спр Номенклатура добавить рекв. ВидНоменклатуры</p>

<p>3. Создать справочник СвойстваНоменклатуры</p>

<p>4. Создать ПВХ ХарактеристикиОбъектов</p>

<p>5. Создать справочник ЗначенияХарактеристик (Владелец ПланВидовХарактеристик.ХарактеристикиОбъектов)</p>

<p>6. Создать рег свед СоставыНаборов (в пределах дня)<br>
изм: Набор (СправочникСсылка.Номенклатура параметры выбора: Отбор.ВидНоменклатуры(Набор)), <br>
 Продукт (СправочникСсылка.Номенклатура параметры выбора: Отбор.ВидНоменклатуры(Продукт)),<br>
 Свойство (СправочникСсылка.СвойстваНоменклатуры)<br>
рес: Количество 10.0</p>

<p>7. Создать рег свед ЗначенияХарактеристик (Непериодический)<br>
изм: СвойствоНоменклатуры (СправочникСсылка.СвойстваНоменклатуры), <br>
 Характеристика (ПланВидовХарактеристикСсылка.ХарактеристикиОбъектов)<br>
рес: Значение (Характеристика.ХарактеристикиОбъектов связи параметров выбора Отбор.Владелец(Характеристика))</p>

<p>8. создать рег накопл ОстаткиНоменклатуры<br>
изм: Номенклатура, СвойствоНоменклатуры (СправочникСсылка.СвойстваНоменклатуры)<br>
рес: Количество 10.0<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная, Комплектация</p>

<br>
<p>9. Док ПриходнаяНакладная добавить в ТЧ СвойствоНоменклатуры<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ()<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры КАК СвойствоНоменклатуры,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.СвойствоНоменклатуры = Выборка.СвойствоНоменклатуры;<br>
 Движение.Количество = Выборка.Количество;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<br>
<p>6. Док РасходнаяНакладная добавить в ТЧ СвойствоНоменклатуры<br>
в модуле объекта<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ); <br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // Движения по регистру Остатки номенклатуры (новая методика проведения)<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.БлокироватьДляИзменения = Истина;<br>
 <br>
 // Получение данных для формирования движений<br>
 // Наборы заменяем на продукты в соответствии с количеством в документе и составом набора из регистра сведений<br>
 // Остальные номенклатуры (готовые блюда и продукты) добавляем к полученной выборке<br>
 Запрос = Новый Запрос;<br>
 Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры = &ВидНоменклатурыНабор КАК ЭтоНабор,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры КАК СвойствоНоменклатуры<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры = &ВидНоменклатурыНабор,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура,<br>
 | ЭтоНабор<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ЕСТЬNULL(СоставыНаборовСрезПоследних.Продукт, ВТ_ТабЧасть.Номенклатура) КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество * ЕСТЬNULL(СоставыНаборовСрезПоследних.Количество, 1) КАК Количество,<br>
 | ЕСТЬNULL(СоставыНаборовСрезПоследних.Свойство, ЗНАЧЕНИЕ(Справочник.СвойстваНоменклатуры.ПустаяСсылка)) КАК СвойствоНоменклатуры<br>
 |ПОМЕСТИТЬ ВТ_ВсеБлюдаИПродукты<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СоставыНаборов.СрезПоследних(<br>
 | &ДатаСреза,<br>
 | Набор В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ГДЕ<br>
 | ВТ_ТабЧасть.ЭтоНабор)) КАК СоставыНаборовСрезПоследних<br>
 | ПО ВТ_ТабЧасть.Номенклатура = СоставыНаборовСрезПоследних.Набор<br>
 |ГДЕ<br>
 | ВТ_ТабЧасть.ЭтоНабор<br>
 |<br>
 |ОБЪЕДИНИТЬ ВСЕ<br>
 |<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура,<br>
 | ВТ_ТабЧасть.Количество,<br>
 | ВТ_ТабЧасть.СвойствоНоменклатуры<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 |ГДЕ<br>
 | НЕ ВТ_ТабЧасть.ЭтоНабор<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ВсеБлюдаИПродукты.Номенклатура КАК Номенклатура,<br>
 | ВТ_ВсеБлюдаИПродукты.СвойствоНоменклатуры КАК СвойствоНоменклатуры,<br>
 | СУММА(ВТ_ВсеБлюдаИПродукты.Количество) КАК Количество<br>
 |ИЗ<br>
 | ВТ_ВсеБлюдаИПродукты КАК ВТ_ВсеБлюдаИПродукты<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ВТ_ВсеБлюдаИПродукты.Номенклатура,<br>
 | ВТ_ВсеБлюдаИПродукты.СвойствоНоменклатуры";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("ДатаСреза", Дата);<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыНабор", Перечисления.ВидыНоменклатуры.Набор);<br>
 <br>
 // Формирование движений и запись в регистр<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.СвойствоНоменклатуры = Выборка.СвойствоНоменклатуры;<br>
 Движение.Количество = Выборка.Количество;<br>
 КонецЦикла;<br>
 <br>
 Движения.Записать();<br>
 <br>
 // Контроль появления отрицательных остатков в регистре<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | -ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Превышение,<br>
 | ОстаткиНоменклатурыОстатки.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ОстаткиНоменклатурыОстатки.СвойствоНоменклатуры.Представление КАК СвойствоПредставление<br>
 |ИЗ<br>
 | РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | (Номенклатура, СвойствоНоменклатуры) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ВсеБлюдаИПродукты.Номенклатура КАК Номенклатура,<br>
 | ВТ_ВсеБлюдаИПродукты.СвойствоНоменклатуры КАК СвойствоНоменклатуры<br>
 | ИЗ<br>
 | ВТ_ВсеБлюдаИПродукты КАК ВТ_ВсеБлюдаИПродукты)) КАК ОстаткиНоменклатурыОстатки<br>
 |ГДЕ<br>
 | ОстаткиНоменклатурыОстатки.КоличествоОстаток < 0";<br>
 <br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", Новый Граница(МоментВремени()));<br>
 <br>
 Результат = Запрос.Выполнить(); <br>
 Если Не Результат.Пустой() Тогда <br>
 Отказ = Истина;<br>
 <br>
 Выборка = Результат.Выбрать();<br>
 Пока Выборка.Следующий() Цикл <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон ("Превышение остатка по номенклатуре %1 и свойству %2 в количестве %3", <br>
 Выборка.НоменклатураПредставление, Выборка.СвойствоПредставление, Выборка.Превышение); <br>
 Сообщение.Сообщить(); <br>
 КонецЦикла;<br>
 КонецЕсли; <br>
КонецПроцедуры</p>

<p>7. созд док Комплектация<br>
в модуле объекта<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 ДвиженияОстаткиНоменклатуры = Движения.ОстаткиНоменклатуры;<br>
 <br>
 Если Не ДвиженияОстаткиНоменклатуры.Модифицированность() И Не ЭтоНовый() Тогда<br>
 ДвиженияОстаткиНоменклатуры.Прочитать();<br>
 КонецЕсли; <br>
 <br>
 Если ДвиженияОстаткиНоменклатуры.Количество() > 0 Тогда<br>
 Для каждого Движение Из ДвиженияОстаткиНоменклатуры Цикл<br>
 Движение.Период = Дата;<br>
 КонецЦикла;<br>
 ДвиженияОстаткиНоменклатуры.УстановитьАктивность(Не ПометкаУдаления);<br>
 КонецЕсли;<br>
 <br>
 ДвиженияОстаткиНоменклатуры.Записывать = Истина;<br>
КонецПроцедуры</p>

<p>8. Отчет ВедомостьПродуктовИБлюд<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОстаткиНоменклатурыОстаткиИОбороты.Номенклатура КАК Номенклатура,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоНачальныйОстаток КАК НачальныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоПриход КАК Приход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоРасход КАК Расход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоКонечныйОстаток КАК КонечныйОстаток<br>
ИЗ<br>
 РегистрНакопления.ОстаткиНоменклатуры.ОстаткиИОбороты КАК ОстаткиНоменклатурыОстаткиИОбороты</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод</p>

<br>
<p>1. Заголовок < Ведомость продуктов и блюд за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2. <Детальные записи></p>

<p>Отч выб поля Номенклатура, Нач. ост. (НачальныйОстаток), Приход, Расход, Кон. ост. (КонечныйОстаток)</p>

<p>Выводить параметры = Не выводить</p>

<p>#ОУ11</p>

<p>1. спр Номенклатура и Контрагенты</p>

<p>2. Создать рег накопл Отгрузки (обороты)<br>
изм: Номенклатура<br>
рес: КоличествоОтгружено 10.0, СуммаОтружено 12.2, КоличествоПолучено 10.0, СуммаПолучено 12.2<br>
регисстратор расхНакл</p>

<p>3. Создать рег накопл Взаиморасчеты (остатки)<br>
изм: Контрагент, Накладная (ДокументСсылка.РасходнаяНакладная)<br>
рес: КоличествоОтгружено 10.0, СуммаОтружено 12.2, КоличествоПолучено 10.0, СуммаПолучено 12.2<br>
регисстратор расхНакл, ПриходДенег</p>

<br>
<p>4. Док РасходнаяНакладная добавить в шапку Контрагент, СуммаПолучено 12.2; в ТЧ СписокНоменклатуры: Номенклатура, КоличествоОтгружено 10.0, СуммаОтружено 12.2, КоличествоПолучено 10.0, СуммаПолучено 12.2<br>
в модуле объекта<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПолучено = СписокНоменклатуры.Итог("СуммаПолучено");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОТГРУЗКИ<br>
 Движения.Отгрузки.Записывать = Истина;<br>
 <br>
 // Запрос получения данных для формирования движений в регистре Отгрузки<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.КоличествоОтгружено) КАК КоличествоОтгружено,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.СуммаОтгружено) КАК СуммаОтгружено,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.КоличествоПолучено) КАК КоличествоПолучено,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.СуммаПолучено) КАК СуммаПолучено<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 // Обход результата запроса, формирования движений в регистр Отгрузки<br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Отгрузки.Добавить();<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.КоличествоОтгружено = Выборка.КоличествоОтгружено;<br>
 Движение.СуммаОтружено = Выборка.СуммаОтгружено;<br>
 Движение.КоличествоПолучено = Выборка.КоличествоПолучено;<br>
 Движение.СуммаПолучено = Выборка.СуммаПолучено;<br>
 КонецЦикла;</p>

<p> <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ВЗАИМОРАСЧЕТЫ<br>
 <br>
 Движения.Взаиморасчеты.Записывать = Истина;<br>
 <br>
 Движение = Движения.Взаиморасчеты.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент; <br>
 Движение.Накладная = Ссылка;<br>
 Движение.Сумма = СуммаПолучено;<br>
КонецПроцедуры</p>

<p>7. созд док ПриходДенег в шапке Контрагент, СуммаОплаты 12.2; в ТЧ СписокНакладных: Накладная (ДокументСсылка.РасходнаяНакладная)<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ВЗАИМОРАСЧЕТЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 Движения.Взаиморасчеты.Записывать = Истина;<br>
 Движения.Взаиморасчеты.Записать();<br>
 <br>
 // Установка управляемой блокировки в регистре Взаиморасчеты по контрагенту и списку накладных табличной чаcти<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Взаиморасчеты");<br>
 ЭлементБлокировки.УстановитьЗначение("Контрагент", Контрагент);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНакладных;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Накладная", "Накладная");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Получение данных для формирования движений (остатки по накладным из табличной части по регистру Взаиморасчеты)<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ РАЗЛИЧНЫЕ<br>
 | ПриходДенегСписокНакладных.Накладная КАК Накладная<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.ПриходДенег.СписокНакладных КАК ПриходДенегСписокНакладных<br>
 |ГДЕ<br>
 | ПриходДенегСписокНакладных.Ссылка = &Ссылка<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Накладная<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Накладная КАК Накладная,<br>
 | ВзаиморасчетыОстатки.СуммаОстаток КАК СуммаОстаток<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.Взаиморасчеты.Остатки(<br>
 | &МоментВремени,<br>
 | Контрагент = &Контрагент<br>
 | И Накладная В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Накладная КАК ВТ_ТабЧасть<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК ВзаиморасчетыОстатки<br>
 | ПО ВТ_ТабЧасть.Накладная = ВзаиморасчетыОстатки.Накладная<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ВзаиморасчетыОстатки.Накладная.МоментВремени";<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("Контрагент", Контрагент);<br>
 <br>
 // Распределение суммы документа по накладным, формирование расходных движений в регистр Взаиморасчеты<br>
 ОсталосьСписать = СуммаОплаты;<br>
 <br>
 Результат = Запрос.Выполнить();<br>
 Если Не Результат.Пустой() Тогда<br>
 <br>
 Выборка = Результат.Выбрать();<br>
 <br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 Списываем = Мин (Выборка.СуммаОстаток, ОсталосьСписать);<br>
 <br>
 Движение = Движения.Взаиморасчеты.ДобавитьРасход();<br>
 Движение.Контрагент = Контрагент; <br>
 Движение.Период = Дата;<br>
 Движение.Накладная = Выборка.Накладная;<br>
 Движение.Сумма = Списываем;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;</p>

<p> КонецЦикла;<br>
 КонецЕсли;<br>
 <br>
 // Проверка на отсутствие переплат<br>
 Если ОсталосьСписать > 0 Тогда<br>
 Отказ = Истина;<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Переплат быть не должно! Сумма оплаты превышает долг по всем накладным на %1", <br>
 ОсталосьСписать);<br>
 Сообщение.Сообщить(); <br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<br>
<p>8. Отчет ОтгрузкиТоваров<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОтгрузкиОбороты.Номенклатура КАК Товар,<br>
 ОтгрузкиОбороты.КоличествоОтгруженоОборот КАК КоличествоОтгружено,<br>
 ОтгрузкиОбороты.СуммаОтруженоОборот КАК СуммаОтружено,<br>
 ОтгрузкиОбороты.КоличествоПолученоОборот КАК КоличествоПолучено,<br>
 ОтгрузкиОбороты.СуммаПолученоОборот КАК СуммаПолучено<br>
ИЗ<br>
 РегистрНакопления.Отгрузки.Обороты КАК ОтгрузкиОбороты</p>

<p>рес: все числовые</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод</p>

<br>
<p>1. Заголовок < Отгрузки товаров за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
 Товар "Отгружено нами Кол./сум." "Получено покупателем Кол./сум."<br>
2. Товар</p>

<p>Отч выб поля Товар, Отгружено = вертикально (КоличествоОтгружено, СуммаОтружено), Получено = вертикально (КоличествоПолучено, СуммаПолучено)</p>

<p>Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#ОУ12</p>

<p>1. спр Номенклатура <br>
 добавить в шапку ВидНоменклатуры</p>

<p>2. Создать спр ЗначенияСвойств, подчинить ПВХ СвойстваОбъектов</p>

<p>3. В ПВХ СвойстваОбъектов тип знач хар Булево, Строка, Дата, Число, СправочникСсылка.ЗначенияСвойств</p>

<p>4. создать рег свед ЗначенияСвойств (Непериодический, Независимый)<br>
изм: ЗаказПокупателя, Свойство (ПланВидовХарактеристикСсылка.СвойстваОбъектов)<br>
рес: Значение (Характеристика.СвойстваОбъектов)</p>

<p>5. Создать рег накопл ОстаткиНоменклатуры (Остатки)<br>
изм: ЗаказПокупателя, Номенклатура<br>
рес: Количество 10.0, Сумма 12.2<br>
регисстратор расхНакл, прихНакл</p>

<p>6. Создать рег накопл ЗаказыПокупателей (Остатки)<br>
изм: ЗаказПокупателя, Номенклатура<br>
рес: Количество 10.0<br>
регисстратор ЗаказПокупателя, прихНакл</p>

<p>7. Создать док ЗаказПокупателя, в ТЧ СписокНоменклатуры рекв Номенклатура и Количество 10.0<br>
в модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ЗАКАЗЫ ПОКУПАТЕЛЕЙ<br>
 <br>
 Движения.ЗаказыПокупателей.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ЗаказПокупателяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ЗаказПокупателяСписокНоменклатуры.Количество) КАК Количество<br>
 |ИЗ<br>
 | Документ.ЗаказПокупателя.СписокНоменклатуры КАК ЗаказПокупателяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ЗаказПокупателяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ЗаказПокупателяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ЗаказыПокупателей.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.ЗаказПокупателя = Ссылка;<br>
 Движение.Количество = Выборка.Количество;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>8. Док ПриходнаяНакладная в ТЧ СписокНоменклатуры добавить ЗаказПокупателя<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ЗАКАЗЫ ПОКУПАТЕЛЕЙ (НОВАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.ЗаказыПокупателей.Записывать = Истина;<br>
 Движения.ЗаказыПокупателей.БлокироватьДляИзменения = Истина;<br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;<br>
 <br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.ЗаказПокупателя КАК ЗаказПокупателя,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_СписокНоменклатуры<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.ЗаказПокупателя<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура,<br>
 | ЗаказПокупателя<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ВТ_СписокНоменклатуры.Количество КАК Количество,<br>
 | ВТ_СписокНоменклатуры.Сумма КАК Сумма,<br>
 | ВТ_СписокНоменклатуры.ЗаказПокупателя КАК ЗаказПокупателя<br>
 |ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 ВыборкаТЧ = Запрос.Выполнить().Выбрать(); <br>
 <br>
 // Формирование движений и запись в регистр<br>
 Пока ВыборкаТЧ.Следующий() Цикл<br>
 Движение = Движения.ЗаказыПокупателей.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = ВыборкаТЧ.Номенклатура;<br>
 Движение.ЗаказПокупателя = ВыборкаТЧ.ЗаказПокупателя;<br>
 Движение.Количество = ВыборкаТЧ.Количество;<br>
 КонецЦикла;<br>
 <br>
 Движения.Записать();<br>
 <br>
 // Контроль появления отрицательных остатков в регистре<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ЗаказыПокупателейОстатки.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ЗаказыПокупателейОстатки.ЗаказПокупателя.Представление КАК ЗаказПокупателяПредставление,<br>
 | -ЗаказыПокупателейОстатки.КоличествоОстаток КАК Превышение<br>
 |ИЗ<br>
 | РегистрНакопления.ЗаказыПокупателей.Остатки(<br>
 | &МоментВремени,<br>
 | (Номенклатура, ЗаказПокупателя) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ВТ_СписокНоменклатуры.ЗаказПокупателя КАК ЗаказПокупателя<br>
 | ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры)) КАК ЗаказыПокупателейОстатки<br>
 |ГДЕ<br>
 | ЗаказыПокупателейОстатки.КоличествоОстаток < 0";<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", Новый Граница(МоментВремени()));<br>
 Результат = Запрос.Выполнить(); <br>
 Если Не Результат.Пустой() Тогда <br>
 Выборка = Результат.Выбрать();<br>
 Пока Выборка.Следующий() Цикл <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон ("Превышение остатка по номенклатуре %1 заказу %2 в количестве %3", <br>
 Выборка.НоменклатураПредставление, Выборка.ЗаказПокупателяПредставление, Выборка.Превышение); <br>
 Сообщение.Сообщить(); <br>
 КонецЦикла;<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли; <br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 ВыборкаТЧ.Сбросить(); // используем ту же выборку, что использовали для заполнения движений по регистру Заказы Номенклатуры<br>
 Пока ВыборкаТЧ.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьПриход();<br>
 Движение.Период = Дата;<br>
 Движение.ЗаказПокупателя = ВыборкаТЧ.ЗаказПокупателя;<br>
 Движение.Номенклатура = ВыборкаТЧ.Номенклатура;<br>
 Движение.Количество = ВыборкаТЧ.Количество;<br>
 Движение.Сумма = ВыборкаТЧ.Сумма;<br>
 КонецЦикла; <br>
КонецПроцедуры</p>

<p>4. Док РасходнаяНакладная добавить в шапку ЗаказПокупателя<br>
в модуле объекта<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПолучено = СписокНоменклатуры.Итог("СуммаПолучено");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)<br>
 // Согласно условию закупка производится на основании Заказа покупателя, реализуем ввод на основании<br>
 Если ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.ЗаказПокупателя") Тогда<br>
 ЗаказПокупателя = ДанныеЗаполнения.Ссылка;<br>
 Для Каждого ТекСтрокаСписокНоменклатуры Из ДанныеЗаполнения.СписокНоменклатуры Цикл<br>
 НоваяСтрока = СписокНоменклатуры.Добавить();<br>
 НоваяСтрока.Количество = ТекСтрокаСписокНоменклатуры.Количество;<br>
 НоваяСтрока.Номенклатура = ТекСтрокаСписокНоменклатуры.Номенклатура;<br>
 КонецЦикла;<br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(Отказ)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 // Установка блокировки данных в регистре по Заказу покупателя документа и списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.УстановитьЗначение("ЗаказПокупателя", ЗаказПокупателя);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 Блокировка.Заблокировать(); <br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_СписокНоменклатуры <br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ВТ_СписокНоменклатуры.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВТ_СписокНоменклатуры.Количество КАК КоличествоВДокументе<br>
 |ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | ЗаказПокупателя = &ЗаказПокупателя<br>
 | И Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура<br>
 | ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры)) КАК ОстаткиНоменклатурыОстатки<br>
 | ПО ВТ_СписокНоменклатуры.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("ЗаказПокупателя", ЗаказПокупателя);<br>
 <br>
 // Обход результатов запроса <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 // Контроль наличия номенклатуры<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Движение по регистру Остатки номенклатуры<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.ЗаказПокупателя = ЗаказПокупателя;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Количество = Выборка.КоличествоВДокументе;<br>
 Движение.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>7. Отчет НедоотгруженныеЗаказы<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ЗаказыПокупателейОстатки.ЗаказПокупателя КАК Заказ,<br>
 ЗаказыПокупателейОстатки.Номенклатура КАК Оборудование,<br>
 ЗаказыПокупателейОстатки.КоличествоОстаток КАК НеЗакуплено,<br>
 0 КАК НеОтгружено,<br>
 ЗначенияСвойств.Значение КАК Значение<br>
ИЗ<br>
 РегистрНакопления.ЗаказыПокупателей.Остатки КАК ЗаказыПокупателейОстатки<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойств КАК ЗначенияСвойств<br>
 ПО ЗаказыПокупателейОстатки.ЗаказПокупателя = ЗначенияСвойств.ЗаказПокупателя<br>
ГДЕ<br>
 ЗначенияСвойств.Свойство = &Свойство</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 ОстаткиНоменклатурыОстатки.ЗаказПокупателя,<br>
 ОстаткиНоменклатурыОстатки.Номенклатура,<br>
 0,<br>
 ОстаткиНоменклатурыОстатки.КоличествоОстаток,<br>
 ЗначенияСвойств.Значение<br>
ИЗ<br>
 РегистрНакопления.ОстаткиНоменклатуры.Остатки(, ) КАК ОстаткиНоменклатурыОстатки<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойств КАК ЗначенияСвойств<br>
 ПО ОстаткиНоменклатурыОстатки.ЗаказПокупателя = ЗначенияСвойств.ЗаказПокупателя<br>
ГДЕ<br>
 ЗначенияСвойств.Свойство = &Свойство</p>

<p>в наборе выражение представления для заказа ""Заказ № " + Строка(Заказ.Номер)"</p>

<p>рес: все числовые</p>

<p>Параметры: Период Дата<br>
 Свойство заголовок = Характеристика ПланВидовХарактеристикСсылка.СвойстваОбъектов</p>

<p>1. Заголовок <Анализ недоотгруженных заказов покупателей на [Период]> Формат (ПараметрыДанных.Период, "ДЛФ = Д")<br>
 Регион Заказ Оборудование "Незакуплено" "Неотгружено"<br>
2. Значение, Заказ -> Оборудование</p>

<p>Отч выб поля Товар, Отгружено = вертикально (КоличествоОтгружено, СуммаОтружено), Получено = вертикально (КоличествоПолучено, СуммаПолучено)</p>

<p>Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#ОУ13</p>

<p>1. спр Номенклатура <br>
 добавить в шапку СрокЭксплуатации 10.0</p>

<p>2. Созд Регистр накопления ОстаткиНоменклатуры (Остатки)<br>
изм: Номенклатура, СрокГодности (Дата)<br>
рес: Количество 10.0, Сумма 12.2<br>
регистраторы ПриходнаяНакладная, ВводВЭксплуатацию, ВыбытиеОборудования</p>

<p>3. Созд Регистр накопления ЭксплуатируемоеОборудование (Остатки)<br>
изм: Номенклатура, СрокГодности (Дата), СрокЭксплуатации (Дата)<br>
рес: Количество 10.0, Сумма 12.2<br>
регистраторы ВводВЭксплуатацию, ВыбытиеОборудования</p>

<p>4. В Док ПриходнаяНакладная в ТЧ СписокНоменклатуры добавить СрокГодности 10.2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)</p>

<p> ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
 <br>
КонецПроцедуры<br>
 <br>
Процедура ОбработкаПроведенияОУ(Отказ)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма,<br>
 | ДОБАВИТЬКДАТЕ(&Дата, ДЕНЬ, ПриходнаяНакладнаяСписокНоменклатуры.СрокГодности) КАК СрокГодности<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | ДОБАВИТЬКДАТЕ(&Дата, ДЕНЬ, ПриходнаяНакладнаяСписокНоменклатуры.СрокГодности)";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("Дата", Дата);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.СрокГодности = Выборка.СрокГодности;<br>
 Движение.Количество = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<p>5. создать документ ВводВЭксплуатациюдобавить в ТЧ СписокНоменклатуры: Номенклатура, Количество 10.0<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРАМ ОСТАТКИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ) И ЭКСПЛУАТИРУЕМОЕ ОБОРУДОВАНИЕ <br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 Движения.ЭксплуатируемоеОборудование.Записывать = Истина;<br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по номенклатурам табличной части <br>
 // и действующему сроку годности (сроку годности, превышающему дату документа)<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.УстановитьЗначение("СрокГодности", Новый Диапазон(Дата));<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 Блокировка.Заблокировать(); <br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ВводВЭксплуатациюСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ВводВЭксплуатациюСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_СписокНоменклатуры<br>
 |ИЗ<br>
 | Документ.ВводВЭксплуатацию.СписокНоменклатуры КАК ВводВЭксплуатациюСписокНоменклатуры<br>
 |ГДЕ<br>
 | ВводВЭксплуатациюСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ВводВЭксплуатациюСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ВТ_СписокНоменклатуры.Количество КАК КоличествоВДокументе,<br>
 | ВТ_СписокНоменклатуры.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ДОБАВИТЬКДАТЕ(&Дата, ДЕНЬ, ВТ_СписокНоменклатуры.Номенклатура.СрокЭксплуатации) КАК СрокЭксплуатации,<br>
 | ОстаткиНоменклатурыОстатки.СрокГодности КАК СрокГодности<br>
 |ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура<br>
 | ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры)<br>
 | И СрокГодности > &Дата) КАК ОстаткиНоменклатурыОстатки<br>
 | ПО ВТ_СписокНоменклатуры.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ОстаткиНоменклатурыОстатки.СрокГодности<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("Дата", Дата);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 // Обход результатов запроса, формирование движений в регистры <br>
 <br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда<br>
 // Контроль наличия номенклатуры с действующим сроком годности<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 с действующим сроком годности в количестве %2", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;</p>

<p> ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 Списываем = Мин (ОсталосьСписать, Выборка.КоличествоОстаток);<br>
 <br>
 // списание из регистра Остатки номенклатуры<br>
 ДвижениеОстаткиНоменклатуры = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 ДвижениеОстаткиНоменклатуры.Период = Дата;<br>
 ДвижениеОстаткиНоменклатуры.Номенклатура = Выборка.Номенклатура;<br>
 ДвижениеОстаткиНоменклатуры.СрокГодности = Выборка.СрокГодности;<br>
 ДвижениеОстаткиНоменклатуры.Количество = Списываем;<br>
 ДвижениеОстаткиНоменклатуры.Сумма = Списываем / Выборка.КоличествоОстаток * Выборка.СуммаОстаток; <br>
 <br>
 // приход в регистр Эксплуатируемое оборудование<br>
 ДвижениеЭксплуатируемоеОборудование = Движения.ЭксплуатируемоеОборудование.Добавить();<br>
 ЗаполнитьЗначенияСвойств(ДвижениеЭксплуатируемоеОборудование, ДвижениеОстаткиНоменклатуры);<br>
 ДвижениеЭксплуатируемоеОборудование.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 ДвижениеЭксплуатируемоеОборудование.СрокЭксплуатации = Выборка.СрокЭксплуатации; <br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 <br>
 КонецЦикла;<br>
 <br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>6. создать док ВыбытиеОборудования<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по записям с истекшим сроком годности<br>
 Блокировка = Новый БлокировкаДанных; <br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры"); <br>
 ЭлементБлокировки.УстановитьЗначение("СрокГодности", Новый Диапазон(, Дата));<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать(); <br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ОстаткиНоменклатурыОстатки.Номенклатура КАК Номенклатура,<br>
 | ОстаткиНоменклатурыОстатки.СрокГодности КАК СрокГодности,<br>
 | ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Количество,<br>
 | ОстаткиНоменклатурыОстатки.СуммаОстаток КАК Сумма<br>
 |ИЗ<br>
 | РегистрНакопления.ОстаткиНоменклатуры.Остатки(&МоментВремени, СрокГодности < &Дата) КАК ОстаткиНоменклатурыОстатки";<br>
 <br>
 Запрос.УстановитьПараметр("Дата", Дата);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 // Заполнение набора записей регистра<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 Движение.Период = Дата;<br>
 КонецЦикла;<br>
 <br>
 //ДВИЖЕНИЯ ПО РЕГИСТРУ ЭКСПЛУАТИРУЕМОЕ ОБОРУДОВАНИЕ<br>
 <br>
 Движения.ЭксплуатируемоеОборудование.Записывать = Истина;<br>
 Движения.ЭксплуатируемоеОборудование.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Эксплуатируемое оборудование по записям <br>
 // с истекшим сроком годности и записям с истекшим сроком эксплуатации<br>
 Блокировка = Новый БлокировкаДанных; <br>
 <br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ЭксплуатируемоеОборудование");<br>
 ЭлементБлокировки.УстановитьЗначение("СрокГодности", Новый Диапазон(, Дата));<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 <br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ЭксплуатируемоеОборудование");<br>
 ЭлементБлокировки.УстановитьЗначение("СрокЭксплуатации", Новый Диапазон(, Дата));<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 <br>
 Блокировка.Заблокировать(); <br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ЭксплуатируемоеОборудованиеОстатки.Номенклатура КАК Номенклатура,<br>
 | ЭксплуатируемоеОборудованиеОстатки.СрокГодности КАК СрокГодности,<br>
 | ЭксплуатируемоеОборудованиеОстатки.СрокЭксплуатации КАК СрокЭксплуатации,<br>
 | ЭксплуатируемоеОборудованиеОстатки.КоличествоОстаток КАК Количество,<br>
 | ЭксплуатируемоеОборудованиеОстатки.СуммаОстаток КАК Сумма<br>
 |ИЗ<br>
 | РегистрНакопления.ЭксплуатируемоеОборудование.Остатки(<br>
 | &МоментВремени,<br>
 | СрокГодности < &Дата<br>
 | ИЛИ СрокЭксплуатации < &Дата) КАК ЭксплуатируемоеОборудованиеОстатки";<br>
 <br>
 Запрос.УстановитьПараметр("Дата", Дата);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 // Заполнение набора записей регистра<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ЭксплуатируемоеОборудование.ДобавитьРасход();<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 Движение.Период = Дата;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>7. Отчет ОборудованиеВЭксплуатации<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ЭксплуатируемоеОборудованиеОстатки.Номенклатура КАК Оборудование,<br>
 ЭксплуатируемоеОборудованиеОстатки.СуммаОстаток КАК Сумма,<br>
 ЭксплуатируемоеОборудованиеОстатки.КоличествоОстаток КАК Количество,<br>
 РАЗНОСТЬДАТ(&Период, ЭксплуатируемоеОборудованиеОстатки.СрокГодности, ДЕНЬ) КАК ОставшийсяСрокГодности,<br>
 РАЗНОСТЬДАТ(&Период, ЭксплуатируемоеОборудованиеОстатки.СрокЭксплуатации, ДЕНЬ) КАК ОставшийсяСрокЭксплуатации<br>
ИЗ<br>
 РегистрНакопления.ЭксплуатируемоеОборудование.Остатки КАК ЭксплуатируемоеОборудованиеОстатки</p>

<p>Параметры: Период Дата</p>

<br>
<p>1. Заголовок < Состояние оборудования в эксплуатации на [Период]> Формат (ПараметрыДанных.Период, "ДЛФ = Д")<br>
2. <Детальные записи></p>

<p>Отч выб поля Оборудование, Кол-во (Количество), Сумма, Оставшийся срок годн. (ОставшийсяСрокГодности), Оставшийся срок эксп. (ОставшийсяСрокЭксплуатации)</p>

<p>Выводить параметры = Не выводить</p>

<p>#ОУ14</p>

<p>1. Спр Валюты и Контрагенты в подсистему</p>

<p>2. Создать Регистр сведений КурсыВалют (В пределах дня); изм: Валюта, рес: Курс 5.2</p>

<p>3. Создать Регистр накопления Взаиморасчеты (Остатки); изм: Контрагент, Накладная (ДокументСсылка.РасходнаяНакладная); рес: Сумма 12.2<br>
регистраторы РасходнаяНакладная, ПриходДенег</p>

<p>4. Создать док РасходнаяНакладная, в Шапку Контрагент, Валюта<br>
в модуле объекта<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ВЗАИМОРАСЧЕТЫ</p>

<p> Движения.Взаиморасчеты.Записывать = Истина;<br>
 Движения.Взаиморасчеты.Записать();<br>
 <br>
 // Отражение возникновения долга у покупателя<br>
 Движение = Движения.Взаиморасчеты.ДобавитьПриход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Накладная = Ссылка;<br>
 Движение.Сумма = СуммаПоДокументу;<br>
 <br>
 // Установка блокировки данных в регистре Взаиморасчеты по контрагенту из документа и авансу (пустая накладная)<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Взаиморасчеты");<br>
 ЭлементБлокировки.УстановитьЗначение("Контрагент", Контрагент);<br>
 ЭлементБлокировки.УстановитьЗначение("Накладная", Документы.РасходнаяНакладная.ПустаяСсылка());<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать(); <br>
 <br>
 // Получение имеющегося аванса у контрагента<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ВзаиморасчетыОстатки.Контрагент КАК Контрагент,<br>
 | ВзаиморасчетыОстатки.СуммаОстаток КАК СуммаОстаток<br>
 |ИЗ<br>
 | РегистрНакопления.Взаиморасчеты.Остатки(<br>
 | &МоментВремени,<br>
 | Контрагент = &Контрагент<br>
 | И Накладная = &Аванс) КАК ВзаиморасчетыОстатки";<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Контрагент", Контрагент);<br>
 Запрос.УстановитьПараметр("Аванс", Документы.РасходнаяНакладная.ПустаяСсылка());<br>
 <br>
 Результат = Запрос.Выполнить();<br>
 <br>
 // Если аванс имеется, то гасим долг контрагента<br>
 Если Не Результат.Пустой() Тогда<br>
 Данные = Результат.Выбрать();<br>
 Данные.Следующий();<br>
 Аванс = Данные.СуммаОстаток;<br>
 <br>
 ОтборПоВалюте = Новый Структура("Валюта", Валюта);<br>
 КурсВалюты = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(Дата, ОтборПоВалюте).Курс;<br>
 Если КурсВалюты = 0 Тогда<br>
 КурсВалюты = 1;<br>
 КонецЕсли;<br>
 <br>
 СуммаДокументаВРублях = СуммаПоДокументу * КурсВалюты; <br>
 СписываемСАванса = Мин (Аванс, СуммаДокументаВРублях);<br>
 <br>
 // Списание аванса<br>
 Движение = Движения.Взаиморасчеты.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Накладная = Документы.РасходнаяНакладная.ПустаяСсылка();<br>
 Движение.Сумма = СписываемСАванса;<br>
 <br>
 // Гасим долг покупателя<br>
 Движение = Движения.Взаиморасчеты.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Накладная = Ссылка;<br>
 <br>
 Если СуммаДокументаВРублях = СписываемСАванса Тогда <br>
 Движение.Сумма = СуммаПоДокументу; // аванса хватило чтобы погасить всю сумму по документу<br>
 Иначе<br>
 Движение.Сумма = СписываемСАванса / КурсВалюты; // аванс гасит только часть суммы документа<br>
 КонецЕсли;<br>
 <br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<p>5. Создать док ПриходДенег, в Шапку Контрагент, СуммаОплаты 12.2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ВЗАИМОРАСЧЕТЫ<br>
 <br>
 Движения.Взаиморасчеты.Записывать = Истина;<br>
 Движения.Взаиморасчеты.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Взаиморасчеты по контрагенту из документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Взаиморасчеты");<br>
 ЭлементБлокировки.УстановитьЗначение("Контрагент", Контрагент);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать(); <br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ВзаиморасчетыОстатки.Контрагент КАК Контрагент,<br>
 | ВзаиморасчетыОстатки.Накладная.Валюта КАК Валюта,<br>
 | ВзаиморасчетыОстатки.Накладная КАК Накладная,<br>
 | ВзаиморасчетыОстатки.СуммаОстаток КАК СуммаОстаток<br>
 |ПОМЕСТИТЬ ВТ_ОстаткиДолгаПоНакладным<br>
 |ИЗ<br>
 | РегистрНакопления.Взаиморасчеты.Остатки(<br>
 | &МоментВремени,<br>
 | Контрагент = &Контрагент<br>
 | И Накладная <> &Аванс) КАК ВзаиморасчетыОстатки<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Валюта<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ОстаткиДолгаПоНакладным.Контрагент КАК Контрагент,<br>
 | ВТ_ОстаткиДолгаПоНакладным.Валюта КАК Валюта,<br>
 | ВТ_ОстаткиДолгаПоНакладным.Накладная КАК Накладная,<br>
 | ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) КАК Курс,<br>
 | ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) * ВТ_ОстаткиДолгаПоНакладным.СуммаОстаток КАК СуммаОстаткаВРублях,<br>
 | ВТ_ОстаткиДолгаПоНакладным.СуммаОстаток КАК СуммаОстаткаВВалюте<br>
 |ИЗ<br>
 | ВТ_ОстаткиДолгаПоНакладным КАК ВТ_ОстаткиДолгаПоНакладным<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют.СрезПоследних(<br>
 | &МоментВремени,<br>
 | Валюта В<br>
 | (ВЫБРАТЬ РАЗЛИЧНЫЕ<br>
 | ВТ_ОстаткиДолгаПоНакладным.Валюта КАК Валюта<br>
 | ИЗ<br>
 | ВТ_ОстаткиДолгаПоНакладным КАК ВТ_ОстаткиДолгаПоНакладным)) КАК КурсыВалютСрезПоследних<br>
 | ПО ВТ_ОстаткиДолгаПоНакладным.Валюта = КурсыВалютСрезПоследних.Валюта<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ВТ_ОстаткиДолгаПоНакладным.Накладная.МоментВремени";<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Контрагент", Контрагент);<br>
 Запрос.УстановитьПараметр("Аванс", Документы.РасходнаяНакладная.ПустаяСсылка());<br>
 <br>
 // Заполнение набора записей регистра. <br>
 // Гасим долг по накладным, сравнивая сумму распределения (документа) с валютным остатком по накладным, переведенным в рубли<br>
 ОсталосьРаспределить = СуммаОплаты;<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() И ОсталосьРаспределить <> 0 Цикл<br>
 <br>
 Распределяем = Мин(ОсталосьРаспределить, Выборка.СуммаОстаткаВРублях);<br>
 <br>
 Движение = Движения.Взаиморасчеты.ДобавитьРасход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Накладная = Выборка.Накладная;<br>
 <br>
 Если Распределяем = Выборка.СуммаОстаткаВРублях Тогда<br>
 Движение.Сумма = Выборка.СуммаОстаткаВВалюте; // полностью списываем долг по накладной<br>
 Иначе<br>
 Движение.Сумма = Распределяем / Выборка.Курс; // частично списываем долг по накладной<br>
 КонецЕсли;<br>
 <br>
 ОсталосьРаспределить = ОсталосьРаспределить - Распределяем;<br>
 <br>
 КонецЦикла;<br>
 <br>
 // Если после закрытия долга по всем накладным сумма еще осталась, то отражаем её как аванс<br>
 Если ОсталосьРаспределить <> 0 Тогда<br>
 Движение = Движения.Взаиморасчеты.ДобавитьПриход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Накладная = Документы.РасходнаяНакладная.ПустаяСсылка();<br>
 Движение.Сумма = ОсталосьРаспределить;<br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<br>
<p>6. Отчет Взаиморасчеты<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ВЫБОР<br>
 КОГДА ВзаиморасчетыОстаткиИОбороты.Накладная = ЗНАЧЕНИЕ(Документ.РасходнаяНакладная.ПустаяСсылка)<br>
 ТОГДА ЗНАЧЕНИЕ(Справочник.Валюты.РоссийскийРубль)<br>
 ИНАЧЕ ВзаиморасчетыОстаткиИОбороты.Накладная.Валюта<br>
 КОНЕЦ КАК Валюта,<br>
 ВзаиморасчетыОстаткиИОбороты.Накладная КАК Накладная,<br>
 ВзаиморасчетыОстаткиИОбороты.СуммаНачальныйОстаток КАК НачальныйОстаток,<br>
 ВЫБОР<br>
 КОГДА ВзаиморасчетыОстаткиИОбороты.Накладная = ЗНАЧЕНИЕ(Документ.РасходнаяНакладная.ПустаяСсылка)<br>
 ТОГДА ВзаиморасчетыОстаткиИОбороты.СуммаРасход<br>
 ИНАЧЕ ВзаиморасчетыОстаткиИОбороты.СуммаПриход<br>
 КОНЕЦ КАК Отгружено,<br>
 ВЫБОР<br>
 КОГДА ВзаиморасчетыОстаткиИОбороты.Накладная = ЗНАЧЕНИЕ(Документ.РасходнаяНакладная.ПустаяСсылка)<br>
 ТОГДА ВзаиморасчетыОстаткиИОбороты.СуммаПриход<br>
 ИНАЧЕ ВзаиморасчетыОстаткиИОбороты.СуммаРасход<br>
 КОНЕЦ КАК Оплачено,<br>
 ВзаиморасчетыОстаткиИОбороты.СуммаКонечныйОстаток КАК КонечныйОстаток<br>
ИЗ<br>
 РегистрНакопления.Взаиморасчеты.ОстаткиИОбороты КАК ВзаиморасчетыОстаткиИОбороты</p>

<p>в наборе для поля Накладная выражение представления "Выбор Когда Накладная = Значение(Документ.РасходнаяНакладная.ПустаяСсылка) Тогда "Аванс" Иначе "Расх.Накл. № " + Строка(Накладная.Номер) Конец"</p>

<p>ресурсы НачальныйОстаток, Оплачено, Отгружено, КонечныйОстаток</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод</p>

<br>
<p>1. Заголовок <Взаиморасчеты за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2. Валюта -> Накладная</p>

<p>Отч выб поля Нач. ост. (НачальныйОстаток), Отгружено, Оплачено, Кон.ост. (КонечныйОстаток)</p>

<p>Выводить параметры = Не выводить<br>
Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = Нет</p>

<p>для группировки Валюта<br>
Расположение итогов = нет</p>

<p>#ОУ15</p>

<p>1. создать Спр Склады </p>

<p>2. в спр Номенклатура в шапку ВидНоменклатуры</p>

<p>3. Перечисления МетодыСписания ЛИФО и ФИФО, ВидыНоменклатуры Товар, Услуга </p>

<p>4. Регистры сведений УчетнаяПолитика рес МетодСписания</p>

<p>5. Регистры накопления ОстаткиНоменклатуры (Остатки)<br>
Измерения Номенклатура, Партия (ДокументСсылка.ПриходнаяНакладная)<br>
Ресурсы Количество 10.0, Сумма 12.2<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная</p>

<p>6. Регистры накопления Продажи (Обороты)<br>
Измерения Номенклатура<br>
Ресурсы Количество 10.0, Стоимость 12.2, Выручка 12.2<br>
регистраторы ДополнительныеЗатраты, РасходнаяНакладная</p>

<p>7. док ПриходнаяНакладная в шапке СуммаПоДокументу, в ТЧ СписокНоменклатуры добавить склад<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ()<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Партия = Ссылка;<br>
 Движение.Количество = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>8. Создать док РасходнаяНакладная, в Шапку Склад<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // Определение текущего метода списания себестоимости<br>
 МетодСписания = РегистрыСведений.УчетнаяПолитика.ПолучитьПоследнее(Дата).МетодСписания;<br>
 <br>
 Если Не ЗначениеЗаполнено(МетодСписания) Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Не заполнен метод списания учетной политики";<br>
 Сообщение.Сообщить();<br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли; <br>
 <br>
 ТекущийМетодФИФО = МетодСписания = Перечисления.МетодыСписания.ФИФО;<br>
 <br>
 ОбработкаПроведенияОУ(ТекущийМетодФИФО, Отказ);<br>
 ОбработкаПроведенияБУ(ТекущийМетодФИФО, Отказ);<br>
 <br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ(ТекущийМетодФИФО, Отказ)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ И ПРОДАЖИ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.Продажи.Записывать = Истина;<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записать(); <br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 ТекстЗапроса =<br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Товар) КАК ЭтоТовар,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | ОстаткиНоменклатурыОстатки.Партия КАК Партия,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК ОстаткиНоменклатурыОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ОстаткиНоменклатурыОстатки.Партия.МоментВремени УБЫВ<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | МАКСИМУМ(СуммаВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Если ТекущийМетодФИФО Тогда<br>
 ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "УБЫВ", "");<br>
 КонецЕсли;<br>
 <br>
 Запрос.Текст = ТекстЗапроса;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 // Обход результатов запроса, формирование движений в регистры <br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); <br>
 Пока ВыборкаНоменклатура.Следующий() Цикл <br>
 СписаннаяСтоимость = 0; // Для суммирования списанной себестоимости по номенклатуре, используется для заполнения Стоимости регистра Продажи<br>
 Если ВыборкаНоменклатура.ЭтоТовар Тогда<br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2 (оперативный учет)", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 ВыборкаДетальные = ВыборкаНоменклатура.Выбрать();<br>
 Пока ВыборкаДетальные.Следующий() И ОсталосьСписать <> 0 Цикл<br>
 <br>
 // Формирование движений по регистру Остатки номенклатуры<br>
 Списываем = Мин (ВыборкаДетальные.КоличествоОстаток, ОсталосьСписать);<br>
 <br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = ВыборкаДетальные.Номенклатура;<br>
 Движение.Партия = ВыборкаДетальные.Партия;<br>
 <br>
 Движение.Количество = Списываем; <br>
 Движение.Сумма = Списываем / ВыборкаДетальные.КоличествоОстаток * ВыборкаДетальные.СуммаОстаток;<br>
 <br>
 СписаннаяСтоимость = СписаннаяСтоимость + Движение.Сумма; <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 КонецЦикла;<br>
 КонецЕсли;<br>
 <br>
 // Формирование движений по регистру Продажи<br>
 Движение = Движения.Продажи.Добавить();<br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = ВыборкаНоменклатура.Номенклатура;<br>
 Движение.Количество = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 Движение.Выручка = ВыборкаНоменклатура.СуммаВДокументе;<br>
 Движение.Стоимость = СписаннаяСтоимость;<br>
 <br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>9. Создать док ДополнительныеЗатраты, в Шапку Накладная (ДокументСсылка.РасходнаяНакладная), В ТЧ СписокНоменклатур Номенклатура, СуммаЗатрат 12.2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ПРОДАЖИ</p>

<p> Движения.Продажи.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеЗатратыСписокНоменклатур.Номенклатура КАК Номенклатура,<br>
 | СУММА(ДополнительныеЗатратыСписокНоменклатур.СуммаЗатрат) КАК СуммаЗатрат<br>
 |ИЗ<br>
 | Документ.ДополнительныеЗатраты.СписокНоменклатур КАК ДополнительныеЗатратыСписокНоменклатур<br>
 |ГДЕ<br>
 | ДополнительныеЗатратыСписокНоменклатур.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ДополнительныеЗатратыСписокНоменклатур.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 ДатаНакладной = Накладная.Дата;<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Продажи.Добавить();<br>
 Движение.Период = ДатаНакладной;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Стоимость = Выборка.СуммаЗатрат;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<br>
<p>10. Отчет ПродажиОУ<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ПродажиОбороты.Номенклатура КАК Номенклатура,<br>
 ПродажиОбороты.КоличествоОборот КАК Количество,<br>
 ПродажиОбороты.СтоимостьОборот КАК Себестоимость,<br>
 ПродажиОбороты.ВыручкаОборот КАК Продажа<br>
ИЗ<br>
 РегистрНакопления.Продажи.Обороты КАК ПродажиОбороты</p>

<p>выч поля Прибыль (Продажа - Себестоимость)</p>

<p>ресурсы Количество, Прибыль, Продажа, Себестоимость</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод</p>

<br>
<p>1. Заголовок <Продажи с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2. Номенклатура</p>

<p>Отч выб поля Кол-во (Количество), Себест-ть (Себестоимость), Продажа, Прибыль</p>

<p>Выводить параметры = Не выводить<br>
Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = Нет</p>

<p>для группировки Валюта<br>
Расположение итогов = нет</p>

<p>#ОУ16</p>

<p>1. в спр Контрагенты в шапке СрокКредита 5.0, СуммаКредита 12.2</p>

<p>2. Регистры накопления Взаиморасчеты Остатки<br>
Измерения Контрагент, Накладная (ДокументСсылка.РасходнаяНакладная)<br>
рес: Сумма 12.2<br>
регистраторы ПриходДенег, РасходнаяНакладная</p>

<p>7. док ПриходДенег в шапке Контрагент, СуммаОплаты 12.2<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // Движения по регистру Взаиморасчеты (старая методика проведения)</p>

<p> Движения.Взаиморасчеты.Записывать = Истина;<br>
 Движения.Взаиморасчеты.Записать();<br>
 <br>
 // Установка управляемой блокировки по контрагенту документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Взаиморасчеты");<br>
 ЭлементБлокировки.УстановитьЗначение("Контрагент", Контрагент);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать();</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ВзаиморасчетыОстатки.Накладная КАК Накладная,<br>
 | ВзаиморасчетыОстатки.СуммаОстаток КАК СуммаОстаток<br>
 |ИЗ<br>
 | РегистрНакопления.Взаиморасчеты.Остатки(&МоментВремени, Контрагент = &Контрагент) КАК ВзаиморасчетыОстатки<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ВзаиморасчетыОстатки.Накладная.МоментВремени";<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Контрагент", Контрагент);<br>
 <br>
 // Распределение суммы документа по накладным, формирование расходных движений в регистре Взаиморасчеты<br>
 ОсталосьСписать = СуммаОплаты;<br>
 <br>
 Результат = Запрос.Выполнить();<br>
 Если Не Результат.Пустой() Тогда<br>
 <br>
 Выборка = Результат.Выбрать();<br>
 <br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 Списываем = Мин (Выборка.СуммаОстаток, ОсталосьСписать);<br>
 <br>
 Движение = Движения.Взаиморасчеты.ДобавитьРасход();<br>
 Движение.Контрагент = Контрагент; <br>
 Движение.Период = Дата;<br>
 Движение.Накладная = Выборка.Накладная;<br>
 Движение.Сумма = Списываем;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;</p>

<p> КонецЦикла;<br>
 КонецЕсли;<br>
 <br>
 // Контроль отсутствия переплаты<br>
 Если ОсталосьСписать > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Переплат быть не должно! Сумма оплаты превышает долг по всем накладным на %1", <br>
 ОсталосьСписать);<br>
 Сообщение.Сообщить(); <br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
КонецПроцедуры</p>

<br>
<p>8. Создать док РасходнаяНакладная, в Шапку Контрагент, СуммаПоДокументу<br>
в модуле объекта<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
 <br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияОУ (Отказ)<br>
 <br>
 // Движения по регистру Взаиморасчеты (старая методика проведения)<br>
 <br>
 Движения.Взаиморасчеты.Записывать = Истина;<br>
 Движения.Взаиморасчеты.Записать();<br>
 <br>
 // Установка управляемой блокировки по контрагенту документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Взаиморасчеты");<br>
 ЭлементБлокировки.УстановитьЗначение("Контрагент", Контрагент);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Получение данных для контроля непревышения кредита по контрагенту<br>
 // Первым запросом просто получаем данные по контрагенту. Можно и без запроса (через Контрагент.СрокКредита и Контрагент.СуммаКредита),<br>
 // но это очень неоптимально (при обращении через точку для получения реквизита из базы сначала считывается весь объект)<br>
 // Вторым запросом в пакете получаем сумму долга по всем накладным и дату первой неоплаченной накладной<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = "ВЫБРАТЬ<br>
 | Контрагенты.СрокКредита КАК СрокКредита,<br>
 | Контрагенты.СуммаКредита КАК СуммаКредита<br>
 |ИЗ<br>
 | Справочник.Контрагенты КАК Контрагенты<br>
 |ГДЕ<br>
 | Контрагенты.Ссылка = &Контрагент<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ЕСТЬNULL(СУММА(ВзаиморасчетыОстатки.СуммаОстаток), 0) КАК ДолгПоНакладным,<br>
 | ЕСТЬNULL(МИНИМУМ(ВзаиморасчетыОстатки.Накладная.Дата), ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаПервойНакладной<br>
 |ИЗ<br>
 | РегистрНакопления.Взаиморасчеты.Остатки(&МоментВремени, Контрагент = &Контрагент) КАК ВзаиморасчетыОстатки";<br>
 <br>
 Запрос.УстановитьПараметр("Контрагент", Контрагент);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 МассивРезультатов = Запрос.ВыполнитьПакет();<br>
 <br>
 РезультатДанныеКонтрагента = МассивРезультатов [0]; <br>
 ДанныеКонтрагента = РезультатДанныеКонтрагента.Выбрать();<br>
 ДанныеКонтрагента.Следующий();<br>
 <br>
 //Если не установлен срок или сумма кредита дальнейшие проверки смысла выполнять нет, отгрузка в кредит невозможна<br>
 Если ДанныеКонтрагента.СрокКредита = 0 Или ДанныеКонтрагента.СуммаКредита = 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Для контрагента не установлено значение срока или суммы кредита";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 РезультатПоОстаткам = МассивРезультатов[1];<br>
 ДанныеПоОстаткам = РезультатПоОстаткам.Выбрать();<br>
 ДанныеПоОстаткам.Следующий();<br>
 <br>
 // Контроль непревышения суммы кредиты контрагента<br>
 Если СуммаПоДокументу + ДанныеПоОстаткам.ДолгПоНакладным > ДанныеКонтрагента.СуммаКредита Тогда<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Отгрузка невозможна! Превышена предоставленная сумма кредита для контрагента";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 <br>
 КонецЕсли;<br>
 <br>
 // Контроль непревышения срока кредита контрагента<br>
 Если ЗначениеЗаполнено(ДанныеПоОстаткам.ДатаПервойНакладной) Тогда // контроль имеет смысл только если есть долг по накладным<br>
 Если Дата > ДанныеПоОстаткам.ДатаПервойНакладной + ДанныеКонтрагента.СрокКредита * 24 * 60 * 60 Тогда<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Отгрузка невозможна! Превышен предоставленный срок кредита для контрагента";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 <br>
 КонецЕсли; <br>
 КонецЕсли;<br>
 <br>
 // Формирование движений<br>
 Движение = Движения.Взаиморасчеты.ДобавитьПриход();<br>
 Движение.Период = Дата;<br>
 Движение.Контрагент = Контрагент;<br>
 Движение.Накладная = Ссылка;<br>
 Движение.Сумма = СуммаПоДокументу;<br>
 <br>
КонецПроцедуры</p><br>
<br>
<br>
<p>10. Отчет ПродажиОУ<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ВзаиморасчетыОстаткиИОбороты.Контрагент КАК Контрагент,<br>
 ВзаиморасчетыОстаткиИОбороты.Накладная КАК Накладная,<br>
 ВзаиморасчетыОстаткиИОбороты.СуммаНачальныйОстаток КАК НачальныйОстаток,<br>
 ВзаиморасчетыОстаткиИОбороты.СуммаПриход КАК Отгрузка,<br>
 ВзаиморасчетыОстаткиИОбороты.СуммаРасход КАК Оплата,<br>
 ВзаиморасчетыОстаткиИОбороты.СуммаКонечныйОстаток КАК КонечныйОстаток<br>
ИЗ<br>
 РегистрНакопления.Взаиморасчеты.ОстаткиИОбороты КАК ВзаиморасчетыОстаткиИОбороты</p>

<p>"Расх. Накл. № " + Строка(Накладная.Номер) для Накладная представление</p>

<p>ресурсы НачальныйОстаток, Оплата, Отгрузка, КонечныйОстаток</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод</p>

<br>
<p>1. Заголовок <Взаиморасчеты за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2. Контрагент -> Накладная</p>

<p>Отч выб поля Нач.ост. (НачальныйОстаток), Отгрузка, Оплата, Кон. ост. (КонечныйОстаток)</p>

<p>Выводить параметры = Не выводить<br>
Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = Нет</p>

<p>для группировки Контрагент<br>
Расположение итогов = нет</p>

<p>#ОУдоп1</p>

<p>1. Справочники Подразделения</p>

<p>2. В справочник Номенклатура добавить реквизит ПроцентНадбавки 5.2</p>

<p>3. Регистры накопления:<br>
ОстаткиНоменклатуры, изм: Номенклатура, Подразделение; рес: Количество, Сумма</p>

<br>
<p>5. Документ ПриходнаяНакладная добавить реквизит документа Отдел</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Подразделение = Отдел;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Количество = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<br>
<p>7. Документ РасходнаяНакладная добавить реквизит документа ТорговаяТочка</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 ОтделЗакупок = Справочники.Подразделения.ОтделЗакупок;<br>
 <br>
 Блокировка = Новый БлокировкаДанных;<br>
 // Определение блокировки данных в регистре Остатки номенклатуры по списку номенклатур табличной части и Торговой точке<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.УстановитьЗначение("Подразделение", ТорговаяТочка);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 // Определение блокировки данных в регистре Остатки номенклатуры по списку номенклатур табличной части и Отделу закупок<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.УстановитьЗначение("Подразделение", ОтделЗакупок);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура"); <br>
 <br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.Номенклатура.ПроцентНадбавки КАК ПроцентНадбавки,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыВТорговойТочке.КоличествоОстаток, 0) КАК КоличествоОстатокВТорговойТочке,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыВТорговойТочке.СуммаОстаток, 0) КАК СуммаОстатокВТорговойТочке,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыВОтделеЗакупок.КоличествоОстаток, 0) КАК КоличествоОстатокВОтделеЗакупок,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыВОтделеЗакупок.СуммаОстаток, 0) КАК СуммаОстатокВОтделеЗакупок<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Подразделение = &ТорговаяТочка<br>
 | И Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК ОстаткиНоменклатурыВТорговойТочке<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ОстаткиНоменклатурыВТорговойТочке.Номенклатура<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Подразделение = &ОтделЗакупок<br>
 | И Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК ОстаткиНоменклатурыВОтделеЗакупок<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ОстаткиНоменклатурыВОтделеЗакупок.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("ОтделЗакупок", ОтделЗакупок);<br>
 Запрос.УстановитьПараметр("ТорговаяТочка", ТорговаяТочка);<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры в торговой точке и отделе закупок<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстатокВТорговойТочке - Выборка.КоличествоОстатокВОтделеЗакупок;<br>
 <br>
 Если Превышение > 0 Тогда<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон ("Превышение остатка по номенклатуре %1 в количестве %2",<br>
 Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 КоличествоПеремещено = 0;<br>
 СуммаПеремещено = 0; <br>
 ПревышениеВТорговойТочке = Выборка.КоличествоВДокументе - Выборка.КоличествоОстатокВТорговойТочке;<br>
 <br>
 Если ПревышениеВТорговойТочке > 0 Тогда // отражаем перемещение товара с отдела закупок в торговую точку<br>
 // Списание товара с отдела закупок<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Подразделение = ОтделЗакупок;<br>
 <br>
 Движение.Количество = ПревышениеВТорговойТочке;<br>
 Движение.Сумма = ПревышениеВТорговойТочке / Выборка.КоличествоОстатокВОтделеЗакупок * Выборка.СуммаОстатокВОтделеЗакупок;<br>
 СуммаСписано = Движение.Сумма;<br>
 <br>
 // Оприходование товара в торговую точку <br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьПриход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Подразделение = ТорговаяТочка;<br>
 <br>
 Движение.Количество = ПревышениеВТорговойТочке; <br>
 Движение.Сумма = СуммаСписано + СуммаСписано * Выборка.ПроцентНадбавки / 100; <br>
 <br>
 КоличествоПеремещено = ПревышениеВТорговойТочке;<br>
 СуммаПеремещено = Движение.Сумма;<br>
 КонецЕсли;<br>
 <br>
 // Списание товара с торговой точки<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Подразделение = ТорговаяТочка;<br>
 <br>
 Движение.Количество = Выборка.КоличествоВДокументе; <br>
 <br>
 КоличествоОстатокВТорговойТочке = Выборка.КоличествоОстатокВТорговойТочке + КоличествоПеремещено;<br>
 СуммаОстатокВТорговойТочке = Выборка.СуммаОстатокВТорговойТочке + СуммаПеремещено;<br>
 <br>
 Движение.Сумма = Выборка.КоличествоВДокументе / КоличествоОстатокВТорговойТочке * СуммаОстатокВТорговойТочке; <br>
 КонецЦикла; <br>
 <br>
КонецПроцедуры</p>

<p>9. Документ Перемещение Реквизиты ТорговаяТочка, ТЧ СписокНоменклатуры: Номенклатура, Количество //это если надо создават документ<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.ОстаткиНоменклатуры.Записать();<br>
 <br>
 ОтделЗакупок = Справочники.Подразделения.ОтделЗакупок;<br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по списку номенклатур табличной части и Отделу закупок<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.УстановитьЗначение("Подразделение", ОтделЗакупок);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПеремещениеСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПеремещениеСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.Перемещение.СписокНоменклатуры КАК ПеремещениеСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПеремещениеСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПеремещениеСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.Номенклатура.ПроцентНадбавки КАК ПроцентНадбавки,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Подразделение = &ОтделЗакупок<br>
 | И Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК ОстаткиНоменклатурыОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("ОтделЗакупок", ОтделЗакупок);<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 <br>
 Если Превышение > 0 Тогда<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон ("Превышение остатка по номенклатуре %1 в количестве %2",<br>
 Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Списание товара с отдела закупок<br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Подразделение = ОтделЗакупок;<br>
 <br>
 Движение.Количество = Выборка.КоличествоВДокументе; <br>
 Движение.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 СуммаСписано = Движение.Сумма;<br>
 <br>
 // Оприходование товара в торговую точку <br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьПриход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Подразделение = ТорговаяТочка;<br>
 <br>
 Движение.Количество = Выборка.КоличествоВДокументе; <br>
 Движение.Сумма = СуммаСписано + СуммаСписано * Выборка.ПроцентНадбавки / 100; // Оприходуем списанную сумму, увеличенную на процент надбавки<br>
 <br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<br>
<p>8. Отчет ОстаткиТоваровОУ<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОстаткиНоменклатурыОстаткиИОбороты.Номенклатура КАК Номенклатура,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоНачальныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоПриход КАК КоличествоПриход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоРасход КАК КоличествоРасход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.КоличествоКонечныйОстаток КАК КоличествоКонечныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаПриход КАК СуммаПриход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаРасход КАК СуммаРасход,<br>
 ОстаткиНоменклатурыОстаткиИОбороты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток<br>
ИЗ<br>
 РегистрНакопления.ОстаткиНоменклатуры.ОстаткиИОбороты КАК ОстаткиНоменклатурыОстаткиИОбороты</p>

<p>ресурсы<br>
 все кроме номенклатуры, суммы</p>

<p>параметры период, началопериода, конецпериода как обычно</p>

<p>Группировки <br>
1 Заголовок<br>
2 Номенклатура</p>

<p>Для группировки "<Дополнительная информация> (Заголовок)" Вариант использования группировки - Дополнительная информация<br>
ПКМ, Установить имя "Заголовок". В макете "Шаблон" <Движения товаров с [НачалоПериода] по [КонецПериода].> , Выражение Формат(ПараметрыДанных.Период, "ДЛФ = D")</p>

<p>Товар Нач. ост. Приход Расход Кон. ост.</p>

<p>Расположение общих итогов по вертикали - Нет<br>
Выводить параметры - Не выводить<br>
Параметр Период включить в пользовательские настройки.</p>

<p>#ОУдоп2</p>

<p>1. Регистры сведений ПроцентыКомиссии В пределах месяца<br>
 Измерения Комитент, Ресурсы Процент 3.0</p>

<p>2 Регистры накопления<br>
 ОстаткиНоменклатуры остатки Измерения Номенклатура, Партия; Ресурсы Количество 10.0 регистраторы ПриходнаяНакладная, РасходнаяНакладная<br>
 Продажи обороты Измерения Комитент; Ресурсы Сумма 12.2 регистраторы РасходнаяНакладная<br>
 Взаиморасчеты остатки змерения Комитент; Ресурсы Сумма 12.2 регистраторы РасходнаяНакладная, РасходДенег</p>

<br>
<p>5. Документ ПриходнаяНакладная добавить реквизит документа Комитент</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСТАТКИ НОМЕНКЛАТУРЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОстаткиНоменклатуры.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Приход;<br>
 Движение.Период = Дата;<br>
 Движение.Партия = Ссылка;<br>
 Движение.Номенклатура = Выборка.Номенклатура;<br>
 Движение.Количество = Выборка.Количество;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p><br>
<br>
<p>7. Документ РасходнаяНакладная</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРАМ ОСТАТКИ НОМЕНКЛАТУРЫ, ПРОДАЖИ И ВЗАИМОРАСЧЕТЫ<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записывать = Истина;<br>
 Движения.Продажи.Записывать = Истина;<br>
 Движения.Взаиморасчеты.Записывать = Истина;<br>
 <br>
 Движения.ОстаткиНоменклатуры.Записать(); <br>
 <br>
 // Установка блокировки данных в регистре Остатки номенклатуры по списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиНоменклатуры");<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | ОстаткиНоменклатурыОстатки.Партия КАК Партия,<br>
 | ОстаткиНоменклатурыОстатки.Партия.Комитент КАК Комитент,<br>
 | ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(ПроцентыКомиссииСрезПоследних.Процент, 0) КАК Процент<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(<br>
 | &МоментВремени,<br>
 | Номенклатура В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК ОстаткиНоменклатурыОстатки<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПроцентыКомиссии.СрезПоследних(&МоментВремени, ) КАК ПроцентыКомиссииСрезПоследних<br>
 | ПО ОстаткиНоменклатурыОстатки.Партия.Комитент = ПроцентыКомиссииСрезПоследних.Комитент<br>
 | ПО ВТ_ТабЧасть.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ОстаткиНоменклатурыОстатки.Партия.МоментВремени<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | МАКСИМУМ(СуммаВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 // Обход результатов запроса, формирование движений в регистры <br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); <br>
 Пока ВыборкаНоменклатура.Следующий() Цикл <br>
 <br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписатьКоличество = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 ОсталосьСписатьПродажи = ВыборкаНоменклатура.СуммаВДокументе; //Для контроля распределения всей суммы продаж по комитентам<br>
 <br>
 ВыборкаДетальные = ВыборкаНоменклатура.Выбрать();<br>
 Пока ВыборкаДетальные.Следующий() И ОсталосьСписатьКоличество <> 0 Цикл<br>
 <br>
 // Формирование движений по регистру Остатки номенклатуры<br>
 Списываем = Мин (ВыборкаДетальные.КоличествоОстаток, ОсталосьСписатьКоличество);<br>
 <br>
 Движение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Номенклатура = ВыборкаДетальные.Номенклатура;<br>
 Движение.Партия = ВыборкаДетальные.Партия;<br>
 <br>
 Движение.Количество = Списываем; <br>
 <br>
 // Формирование движений по регистру Продажи<br>
 Движение = Движения.Продажи.Добавить();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Комитент = ВыборкаДетальные.Комитент;<br>
 <br>
 Если Списываем = ОсталосьСписатьКоличество Тогда<br>
 ПродажаПоКомитенту = ОсталосьСписатьПродажи; // Если списываем последнее количество, значит списываем и остаток суммы продажи<br>
 Иначе<br>
 ПродажаПоКомитенту = Окр (Списываем / ВыборкаДетальные.КоличествоВДокументе * ВыборкаДетальные.СуммаВДокументе, 2); <br>
 КонецЕсли;<br>
 <br>
 Движение.Сумма = ПродажаПоКомитенту;<br>
 <br>
 ОсталосьСписатьПродажи = ОсталосьСписатьПродажи - ПродажаПоКомитенту;<br>
 ОсталосьСписатьКоличество = ОсталосьСписатьКоличество - Списываем; <br>
 <br>
 // Формирование движений по регистру Взаиморасчеты<br>
 Движение = Движения.Взаиморасчеты.ДобавитьПриход();<br>
 <br>
 Движение.Период = Дата;<br>
 Движение.Комитент = ВыборкаДетальные.Комитент;<br>
 <br>
 Движение.Сумма = ПродажаПоКомитенту * ВыборкаДетальные.Процент / 100; <br>
 <br>
 КонецЦикла;<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<br>
<p>9. Документ РасходДенег Реквизиты ТЧ СписокКомитентов: Комитент, Сумма<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ВЗАИМОРАСЧЕТЫ (НОВАЯ МЕТОДИКА ПРОВЕДЕНИЯ) <br>
 <br>
 Движения.Взаиморасчеты.Записывать = Истина;<br>
 Движения.Взаиморасчеты.БлокироватьДляИзменения = Истина;<br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц; // временная таблица данных ВТ_ТабЧасть будет использоваться несколько раз<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходДенегСписокКомитентов.Комитент КАК Комитент,<br>
 | СУММА(РасходДенегСписокКомитентов.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходДенег.СписокКомитентов КАК РасходДенегСписокКомитентов<br>
 |ГДЕ<br>
 | РасходДенегСписокКомитентов.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходДенегСписокКомитентов.Комитент<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Комитент КАК Комитент,<br>
 | ВТ_ТабЧасть.Сумма КАК Сумма<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 // Формирование набора записей, запись движений в регистр<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Взаиморасчеты.ДобавитьРасход(); <br>
 Движение.Период = Дата;<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 КонецЦикла;<br>
 <br>
 Движения.Записать();<br>
 <br>
 // Получение данных для контроля появления отрицательных остатков<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | -ВзаиморасчетыОстатки.СуммаОстаток КАК Превышение,<br>
 | ВзаиморасчетыОстатки.Комитент.Представление КАК КомитентПредставление<br>
 |ИЗ<br>
 | РегистрНакопления.Взаиморасчеты.Остатки(<br>
 | &МоментВремени,<br>
 | Комитент В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Комитент<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК ВзаиморасчетыОстатки<br>
 |ГДЕ<br>
 | ВзаиморасчетыОстатки.СуммаОстаток < 0";<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", Новый Граница(МоментВремени()));<br>
 <br>
 // Если результат запроса не пустой, то вывод данных по превышениям остатка и отказ от проведения документа<br>
 Результат = Запрос.Выполнить();<br>
 Если Не Результат.Пустой() Тогда<br>
 Выборка = Результат.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Оплата превышает остаток долга по комитенту %1 на сумму %2",<br>
 Выборка.КомитентПредставление, Выборка.Превышение);<br>
 Сообщение.Сообщить();<br>
 КонецЦикла;<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
КонецПроцедуры</p>

<br>
<p>8. Отчет Взаиморасчеты<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ЕСТЬNULL(ВзаиморасчетыОстаткиИОбороты.Комитент, ПродажиОбороты.Комитент) КАК Комитент,<br>
 ЕСТЬNULL(ВзаиморасчетыОстаткиИОбороты.СуммаНачальныйОстаток, 0) КАК НачальныйОстаток,<br>
 ЕСТЬNULL(ВзаиморасчетыОстаткиИОбороты.СуммаРасход, 0) КАК ВыплаченоКомиссии,<br>
 ЕСТЬNULL(ВзаиморасчетыОстаткиИОбороты.СуммаКонечныйОстаток, 0) КАК КонечныйОстаток,<br>
 ЕСТЬNULL(ПродажиОбороты.СуммаОборот, 0) КАК Продажи<br>
ПОМЕСТИТЬ ВТ_Взаиморасчеты<br>
ИЗ<br>
 РегистрНакопления.Взаиморасчеты.ОстаткиИОбороты КАК ВзаиморасчетыОстаткиИОбороты<br>
 ПОЛНОЕ СОЕДИНЕНИЕ РегистрНакопления.Продажи.Обороты КАК ПродажиОбороты<br>
 ПО ВзаиморасчетыОстаткиИОбороты.Комитент = ПродажиОбороты.Комитент</p>

<p>ИНДЕКСИРОВАТЬ ПО<br>
 Комитент<br>
;</p>

<p>////////////////////////////////////////////////////////////////////////////////<br>
ВЫБРАТЬ<br>
 ВТ_Взаиморасчеты.Комитент КАК Комитент,<br>
 ВТ_Взаиморасчеты.НачальныйОстаток КАК НачальныйОстаток,<br>
 ВТ_Взаиморасчеты.ВыплаченоКомиссии КАК ВыплаченоКомиссии,<br>
 ВТ_Взаиморасчеты.КонечныйОстаток КАК КонечныйОстаток,<br>
 ВТ_Взаиморасчеты.Продажи КАК Продажи,<br>
 ЕСТЬNULL(ПроцентыКомиссииСрезПоследних.Процент, 0) КАК ПроцентКомиссии,<br>
 ВТ_Взаиморасчеты.Комитент.Наименование КАК НаименованиеКомитента<br>
ИЗ<br>
 ВТ_Взаиморасчеты КАК ВТ_Взаиморасчеты<br>
 ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПроцентыКомиссии.СрезПоследних(<br>
 НАЧАЛОПЕРИОДА(&НачалоПериода, МЕСЯЦ),<br>
 Комитент В<br>
 (ВЫБРАТЬ<br>
 ВТ_Взаиморасчеты.Комитент КАК Комитент<br>
 ИЗ<br>
 ВТ_Взаиморасчеты КАК ВТ_Взаиморасчеты)) КАК ПроцентыКомиссииСрезПоследних<br>
 ПО ВТ_Взаиморасчеты.Комитент = ПроцентыКомиссииСрезПоследних.Комитент</p>

<p>выч поля [Комитент с процентом комиссии] = (НаименованиеКомитента + " ("+ Строка(ПроцентКомиссии) + " %)")</p>

<br>
<p>ресурсы (и выб поля отчета)<br>
 НачальныйОстаток, Продажи, ВыплаченоКомиссии, КонечныйОстаток</p>

<p>параметры периодОтбора (вместо обыч периода, польз настр), началопериода, конецпериода как обычно и Период = &НачалоПериода</p>

<p>Группировки <br>
1 [Комитент с процентом комиссии]</p>

<br>
<p>Параметр Период включить в пользовательские настройки.</p>

<br>
<p>#БУ_Операция</p>

<p>создать док Операция </p>

<p>в модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 <br>
 НаборЗаписей = Движения.Управленческий;<br>
 <br>
 Если Не ЭтоНовый() И Не НаборЗаписей.Модифицированность() Тогда<br>
 НаборЗаписей.Прочитать();<br>
 КонецЕсли; <br>
 <br>
 Если НаборЗаписей.Количество() > 0 Тогда<br>
 НаборЗаписей.УстановитьАктивность(Не ПометкаУдаления);<br>
 КонецЕсли;<br>
 <br>
 НаборЗаписей.Записывать = Истина;<br>
 <br>
КонецПроцедуры</p>

<p>#БУ1</p>

<p>1. В ПВХ ВидыСубконто добавить предопределенный вид субконто СрокиГодности (тип Дата)<br>
Тип значения характеристик составной: Дата, СправочникСсылка.Номенклатура</p>

<p>2. В плане счетов "Управленческий" добавить признак учета "Количественный" и признак учета субконто "Суммовой" (оба типа Булево)<br>
Указать макс колво субконто - 2<br>
По счету товары указать признак учета Количественный = Истина<br>
Добавить виды субконто Номенклатура и СрокГодности<br>
Вид субконто Номенклатура: Суммовой = Истина</p>

<p>3. Создать регистр бухгалтерии "Управленческий", указать план счетов: Управленческий, включить флаг "Корреспонденция"<br>
создать ресурсы "Количество" (Признак учета Количественный), "Сумма" (флаг Балансовый, признак учета субконто - суммовой)</p>

<p>4. Документ ПриходнаяНакладная </p>

<p>Процедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ()<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СрокГодности,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СрокГодности,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.СрокиГодности] = Выборка.СрокГодности;<br>
 КонецЦикла; </p>

<p>КонецПроцедуры</p>

<p>5. Документ РасходнаяНакладная </p>

<p>Процедуры</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ (Отказ);<br>
 ОбработкаПроведенияБУ (Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ(Отказ)</p>

<p> // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 | И НЕ РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры = &ВидНоменклатурыУслуга<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | УправленческийОстаткиПоНоменклатуреИСрокам.Субконто2 КАК СрокГодности,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоНоменклатуреИСрокам.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоНоменклатуре.СуммаОстаток, 0) КАК СуммаОстаток<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоНоменклатура,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК УправленческийОстаткиПоНоменклатуре<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоНоменклатуре.Субконто1<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоНоменклатураСрок,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК УправленческийОстаткиПоНоменклатуреИСрокам<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоНоменклатуреИСрокам.Субконто1<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | СрокГодности<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | СУММА(КоличествоОстаток),<br>
 | МАКСИМУМ(СуммаОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 СубконтоНоменклатура = Новый Массив(1);<br>
 СубконтоНоменклатура[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 <br>
 СубконтоНоменклатураСрок = Новый Массив(2);<br>
 СубконтоНоменклатураСрок[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 СубконтоНоменклатураСрок[1] = ПланыВидовХарактеристик.ВидыСубконто.СрокиГодности; <br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("СубконтоНоменклатура", СубконтоНоменклатура);<br>
 Запрос.УстановитьПараметр("СубконтоНоменклатураСрок", СубконтоНоменклатураСрок);<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыУслуга", Перечисления.ВидыНоменклатуры.Услуга);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 <br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2 (бухгалтерский учет)", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 // Эти переменные будем использовать при расчете себестоимости списания<br>
 КоличествоПоНоменклатуре = ВыборкаНоменклатура.КоличествоОстаток;<br>
 СуммаПоНоменклатуре = ВыборкаНоменклатура.СуммаОстаток;<br>
 <br>
 // с помощью этих переменных будем контролировать, чтобы при списании всего количества по номенклатуре, <br>
 // суммовой остаток также был списан полностью<br>
 КоличественныйОстатокПоНоменклатуре = ВыборкаНоменклатура.КоличествоОстаток; <br>
 СуммовойОстатокПоНоменклатуре = ВыборкаНоменклатура.СуммаОстаток;<br>
 <br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 Пока Выборка.Следующий() И ОсталосьСписать <> 0 Цикл<br>
 <br>
 // Проводка отражения списания товара<br>
 КоличествоСписываем = Мин (Выборка.КоличествоОстаток, ОсталосьСписать);<br>
 <br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура; <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.СрокиГодности] = Выборка.СрокГодности; <br>
 <br>
 Проводка.КоличествоКт = КоличествоСписываем; <br>
 Если КоличествоСписываем = КоличественныйОстатокПоНоменклатуре Тогда<br>
 СуммаСписываем = СуммовойОстатокПоНоменклатуре;<br>
 Иначе<br>
 СуммаСписываем = КоличествоСписываем / КоличествоПоНоменклатуре * СуммаПоНоменклатуре;<br>
 КонецЕсли; <br>
 Проводка.Сумма = СуммаСписываем;<br>
 <br>
 КоличественныйОстатокПоНоменклатуре = КоличественныйОстатокПоНоменклатуре - КоличествоСписываем;<br>
 СуммовойОстатокПоНоменклатуре = СуммовойОстатокПоНоменклатуре - Проводка.Сумма; <br>
 <br>
 ОсталосьСписать = ОсталосьСписать - КоличествоСписываем; <br>
 <br>
 КонецЦикла; <br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.Сумма = СуммаПоДокументу;<br>
 <br>
КонецПроцедуры</p>

<p>6. Отчет ОстаткиТоваровБУ<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОстаткиТолькоНоменклатура.Субконто1 КАК Товар,<br>
 УправленческийОстатки.Субконто2 КАК СрокГодности,<br>
 УправленческийОстатки.КоличествоОстаток * (УправленческийОстаткиТолькоНоменклатура.СуммаОстаток / УправленческийОстаткиТолькоНоменклатура.КоличествоОстаток) КАК Сумма,<br>
 УправленческийОстатки.КоличествоОстаток КАК Количество<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Остатки(, Счет = &СчетТовары, &СубконтоНоменклатура, ) КАК УправленческийОстаткиТолькоНоменклатура<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(, Счет = &СчетТовары, &Субконто, ) КАК УправленческийОстатки<br>
 ПО УправленческийОстаткиТолькоНоменклатура.Субконто1 = УправленческийОстатки.Субконто1</p>

<p>ресурсы<br>
 Количество выражение Сумма(Количество)<br>
 Сумма выражение Сумма(Сумма)</p>

<p>Параметры Субконто флаг "Доступен список значений</p>

<p>Группировки <br>
1 Заголовок<br>
2 Товар -> СрокГодности</p>

<p>Для группировки "<Дополнительная информация> (Заголовок)" Вариант использования группировки - Дополнительная информация<br>
ПКМ, Установить имя "Заголовок". В макете "Шаблон" <Остатки товаров на [Период]> , Выражение Формат(ПараметрыДанных.Период, "ДЛФ = D")</p>

<p>Отчет Выбранные поля - Кол-во и Сумма<br>
Расположение полей группировок - Отдельно и только в итогах<br>
Расположение общих итогов по вертикали - Нет<br>
Выводить параметры - Не выводить<br>
Параметр Период включить в пользовательские настройки.</p>

<br>
<p>7. Создать Документ Операция, движения по регистру Управленческий, Проведение Запретить, Создать ФормуДокумента, добавить Движения, вытащить дату в шапку</p>

<p>В модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 НаборЗаписей = Движения.Управленческий;</p>

<p> Если Не ЭтоНовый() И Не НаборЗаписей.Модифицированность() Тогда<br>
 НаборЗаписей.Прочитать();<br>
 КонецЕсли; </p>

<p> Если НаборЗаписей.Количество() > 0 Тогда<br>
 НаборЗаписей.УстановитьАктивность(Не ПометкаУдаления);<br>
 КонецЕсли;<br>
 <br>
 НаборЗаписей.Записывать = Истина;<br>
КонецПроцедуры</p>

<p>#БУ2</p>

<p>1. Создать справочники "Склады" и "Проекты"</p>

<p>2. В ПВХ ВидыСубконто добавить предопределенные виды субконто "Проекты" и "Склады" (тип - ссылка на справочники)<br>
Тип значения характеристик составной: СправочникСсылка.Проекты, СправочникСсылка.Номенклатура, СправочникСсылка.Склады</p>

<p>3. В плане счетов "Управленческий" добавить признак учета "Количественный" и признак учета субконто "Суммовой" (оба типа Булево)<br>
Указать макс колво субконто - 2</p>

<p>По счету товары указать признак учета Количественный = Истина<br>
Добавить виды субконто Номенклатура и Склады<br>
Вид субконто Номенклатура: Суммовой = Истина</p>

<p>По счету ПрибылиУбытки Добавить виды субконто Номенклатура и Проекты<br>
Вид субконто Номенклатура: Суммовой = Истина, Только обороты = Истина<br>
Вид субконто Проекты: Суммовой = Истина, Только обороты = Истина</p>

<p>4. Создать регистр бухгалтерии "Управленческий", указать план счетов: Управленческий, включить флаг "Корреспонденция"<br>
создать ресурсы "Количество" (Признак учета Количественный), "Сумма" (флаг Балансовый, признак учета субконто - суммовой)</p>

<p>Регистраторы: ПрихНакл, РасхНакл, Операция, Затраты</p>

<p>5. Документ ПриходнаяНакладная, Добавить в шапку Склады, создать Форму<br>
В модуле объекта Процедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ()<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<br>
<p>6. Документ РасходнаяНакладная, Добавить в шапку Склад, Проект, создать Форму, добавить в ТЧ Партию</p>

<p>В модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ(Отказ)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 | И РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры <> &ВидНоменклатурыУслуга<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоНоменклатуре.КоличествоОстаток, 0) КАК ОбщееКоличествоНоменклатуры,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоНоменклатуре.СуммаОстаток, 0) КАК ОбщаяСуммаНоменклатуры,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоНоменклатуреИСкладу.КоличествоОстаток, 0) КАК КоличествоНаСкладе<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоНоменклатура,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)) КАК УправленческийОстаткиПоНоменклатуре<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоНоменклатуре.Субконто1<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоНоменклатураСклад,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | Т.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК Т)<br>
 | И Субконто2 = &Склад) КАК УправленческийОстаткиПоНоменклатуреИСкладу<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоНоменклатуреИСкладу.Субконто1";<br>
 <br>
 СубконтоНоменклатура = Новый Массив(1);<br>
 СубконтоНоменклатура[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 <br>
 СубконтоНоменклатураСклад = Новый Массив(2);<br>
 СубконтоНоменклатураСклад[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 СубконтоНоменклатураСклад[1] = ПланыВидовХарактеристик.ВидыСубконто.Склады; <br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыУслуга", Перечисления.ВидыНоменклатуры.Услуга);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("СубконтоНоменклатура", СубконтоНоменклатура);<br>
 Запрос.УстановитьПараметр("СубконтоНоменклатураСклад", СубконтоНоменклатураСклад);<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 <br>
 // Контроль наличия номенклатуры<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоНаСкладе;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли; <br>
 <br>
 // Проводка отражения списания товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Проекты] = Проект;<br>
 <br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 <br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе; <br>
 Проводка.Сумма = Выборка.КоличествоВДокументе / Выборка.ОбщееКоличествоНоменклатуры * Выборка.ОбщаяСуммаНоменклатуры; <br>
 <br>
 // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Проекты] = Проект; <br>
 Проводка.Сумма = Выборка.СуммаВДокументе; <br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>7. Создать Документ Операция, движения по регистру Управленческий, Проведение Запретить, Создать ФормуДокумента, добавить Движения, вытащить дату в шапку</p>

<p>В модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 НаборЗаписей = Движения.Управленческий;</p>

<p> Если Не ЭтоНовый() И Не НаборЗаписей.Модифицированность() Тогда<br>
 НаборЗаписей.Прочитать();<br>
 КонецЕсли; </p>

<p> Если НаборЗаписей.Количество() > 0 Тогда<br>
 НаборЗаписей.УстановитьАктивность(Не ПометкаУдаления);<br>
 КонецЕсли;<br>
 <br>
 НаборЗаписей.Записывать = Истина;<br>
КонецПроцедуры</p>

<p>8. Создать Документ Затраты, ТЧ СписокПроектов, рекв. Проект и Сумма, Создать Форму</p>

<p>В модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ЗатратыСписокПроектов.Проект КАК Проект,<br>
 | СУММА(ЗатратыСписокПроектов.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.Затраты.СписокПроектов КАК ЗатратыСписокПроектов<br>
 |ГДЕ<br>
 | ЗатратыСписокПроектов.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ЗатратыСписокПроектов.Проект";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ОбщехозяйственныеЗатраты;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Проекты] = Выборка.Проект;<br>
 Проводка.Сумма = Выборка.Сумма;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>9. Отчет ПродажиБУ<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОбороты.Субконто1 КАК Номенклатура,<br>
 УправленческийОбороты.Субконто2 КАК Проект,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &Товары<br>
 ТОГДА УправленческийОбороты.КоличествоКорОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Количество,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &Товары<br>
 ТОГДА УправленческийОбороты.СуммаОборот<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Себестоимость,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &Покупатели<br>
 ТОГДА УправленческийОбороты.СуммаОборотКт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК СуммаПродажи,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &Затраты<br>
 ТОГДА УправленческийОбороты.СуммаОборот<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК СуммаЗатрат<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Обороты(, , , Счет = &СчетПрибыли, &СубконтоПрибыли, , КорСчет В (&СписокКорСчетов), ) КАК УправленческийОбороты</p>

<p>ресурсы: Количество Сумма(Количество) Номенклатура Иерархия, Себестоимость Сумма(Себестоимость) Номенклатура Иерархия, СуммаЗатрат Сумма(СуммаЗатрат), СуммаПродажи Сумма(СуммаПродажи) Номенклатура Иерархия</p>

<p>параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания,<br>
 Затраты ПланСчетовСсылка.Управленческий, значение ПланСчетов.Управленческий.ОбщехозяйственныеЗатраты<br>
 Покупатели, ПланСчетовСсылка.Управленческий, значение ПланСчетов.Управленческий.Покупатели<br>
 Товары, ПланСчетовСсылка.Управленческий, значение ПланСчетов.Управленческий.Товары<br>
 СписокКорСчетов, ПланСчетовСсылка.Управленческий, значение ПланСчетов.Управленческий.Покупатели; ПланСчетов.Управленческий.Товары; ПланСчетов.Управленческий.ОбщехозяйственныеЗатраты, доступен список значений<br>
 СубконтоПрибыли, ПланВидовХарактеристикСсылка.ВидыСубконто, значение ПланВидовХарактеристик.ВидыСубконто.Номенклатура; ПланВидовХарактеристик.ВидыСубконто.Проекты, доступен список значений<br>
 СчетПрибыли, ПланСчетовСсылка.Управленческий, значение ПланСчетов.Управленческий.ПрибылиУбытки<br>
 Период СтандартныйПериод, всё кроме периода - ограничение видимости. Всё включать в доступные поля</p>

<p>Группировки <br>
1 Заголовок<br>
2 Проект -> Номенклатура (только иерархия)</p>

<p>Для группировки "<Дополнительная информация> (Заголовок)" Вариант использования группировки - Дополнительная информация<br>
ПКМ, Установить имя "Заголовок". В макете "Шаблон" <Продажи за период с [НачалоПериода] по [КонецПериода]> , Выражение Формат(ПараметрыДанных.НачалоПериода, "ДЛФ = D"), Формат(ПараметрыДанных.КонецПериода, "ДЛФ = D")</p>

<p>Отчет выбранные поля: Кол-во (Количество), Себест-ть (Себестоимость), СуммаПродажи, СуммаЗатрат<br>
Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = Нет<br>
Выводить параметры = Не выводить<br>
Параметр Период включить в пользовательские настройки.</p>

<p>Проект выбранные поля = Проект+Авто</p>

<p>#БУ3</p>

<p>1. Создать справочник Валюты, если нету<br>
2. Создать справочник Договоры, в шапке реквизит Валюта<br>
3. Создать регистр сведений КурсыВалют (независимый, в пределах дня); изм: Валюта, рес: Курс 5,2<br>
4. В справочнике Контрагенты создать предопределенные данные групп Покупатели и Поставщики и команду ДвиженияБУ (вытащить в командный интерфейс на форме)<br>
в модуле команды:</p>

<p>&НаКлиенте<br>
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)<br>
 // Команда для открытия формы списка движений по контрагенту в регистре бухгалтерии<br>
 ПараметрыФормы = Новый Структура("Контрагент", ПараметрКоманды);<br>
 ОткрытьФорму("РегистрБухгалтерии.Управленческий.Форма.ФормаСпискаДвиженияКонтрагента", ПараметрыФормы, ПараметрыВыполненияКоманды.Источник,<br>
 ПараметрыВыполненияКоманды.Уникальность, ПараметрыВыполненияКоманды.Окно, ПараметрыВыполненияКоманды.НавигационнаяСсылка);<br>
КонецПроцедуры</p>

<p>5. В ПВХ ВидыСубконто тиз составной СправочникСсылка.Договоры, СправочникСсылка.Контрагенты</p>

<p>6. В ПланеСчетов Управленческий добавить признак учета Валютный (булево)<br>
Установить признак Валютный для счета Покупатели, добавить Субконто Контрагенты и Договоры, макс колво субконто = 2</p>

<p>7. Создать регистр бухгалтерии Управленческий, план сч. = Управленческий; изм: Сумма (балансовый = истина) и СуммаВалютная (балансовый = ложь, признак учета валютный)<br>
регистраторы расх.накл, ПриходДенег и операция, создать форму, вытащить динамический список<br>
запрос:<br>
ВЫБРАТЬ<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.Период КАК Период,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.Регистратор КАК Регистратор,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.НомерСтроки КАК НомерСтроки,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.Активность КАК Активность,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.СчетДт КАК СчетДт,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.СубконтоДт1 КАК СубконтоДт1,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.ВидСубконтоДт1 КАК ВидСубконтоДт1,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.СубконтоДт2 КАК СубконтоДт2,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.ВидСубконтоДт2 КАК ВидСубконтоДт2,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.СчетКт КАК СчетКт,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.СубконтоКт1 КАК СубконтоКт1,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.ВидСубконтоКт1 КАК ВидСубконтоКт1,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.СубконтоКт2 КАК СубконтоКт2,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.ВидСубконтоКт2 КАК ВидСубконтоКт2,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.Сумма КАК Сумма,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.СуммаВалютнаяДт КАК СуммаВалютнаяДт,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.СуммаВалютнаяКт КАК СуммаВалютнаяКт,<br>
 РегистрБухгалтерииУправленческийДвиженияССубконто.МоментВремени КАК МоментВремени<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ДвиженияССубконто(<br>
 ,<br>
 ,<br>
 Активность = ИСТИНА<br>
 И (Субконто1 = &Контрагент<br>
 ИЛИ Субконто2 = &Контрагент),<br>
 ,<br>
 ) КАК РегистрБухгалтерииУправленческийДвиженияССубконто</p>

<p>в модуле формы:<br>
&НаСервере<br>
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)<br>
 Список.Параметры.УстановитьЗначениеПараметра ("Контрагент", Параметры.Контрагент);<br>
КонецПроцедуры</p>

<p>8. Док РасходнаяНакладная добавить рекв шапки Контрагент и Договор (ссылки на спр)<br>
создать форму, вытащить на форму, в Договоре связи параметров выбора Отбор.Владелец(Контрагент)</p>

<p>в модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаДокумента = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ(Отказ)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 СтруктураОтбора = Новый Структура ("Валюта", Договор.Валюта);<br>
 КурсВалюты = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(Дата, СтруктураОтбора).Курс;<br>
 Если Не ЗначениеЗаполнено(КурсВалюты) Тогда<br>
 КурсВалюты = 1;<br>
 КонецЕсли;<br>
 <br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Контрагенты] = Контрагент;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Договоры] = Договор;<br>
 Проводка.СуммаВалютнаяДт = СуммаДокумента;<br>
 Проводка.Сумма = СуммаДокумента * КурсВалюты;<br>
 <br>
КонецПроцедуры</p>

<p>9. Создать док ПриходДенег, рекв: Контрагент, СуммаОплаты 12,2, создать форму (номер, дата, контрагент, сумма)</p>

<p>в модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий с отбором по контрагенту из документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Покупатели);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Контрагенты, Контрагент);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | УправленческийОстатки.СуммаОстаток КАК СуммаОстаток,<br>
 | УправленческийОстатки.СуммаВалютнаяОстаток КАК СуммаВалютнаяОстаток,<br>
 | УправленческийОстатки.Субконто2 КАК Договор,<br>
 | ВЫРАЗИТЬ(УправленческийОстатки.Субконто2 КАК Справочник.Договоры).Валюта КАК Валюта<br>
 |ПОМЕСТИТЬ ВТ_Остатки<br>
 |ИЗ<br>
 | РегистрБухгалтерии.Управленческий.Остатки(&МоментВремени, Счет = &СчетПокупатели, &МассивСубконто, Субконто1 = &Контрагент) КАК УправленческийОстатки<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Валюта<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_Остатки.СуммаВалютнаяОстаток КАК ВалютныйОстаток,<br>
 | ВТ_Остатки.Договор КАК Договор,<br>
 | ВТ_Остатки.Валюта КАК Валюта,<br>
 | ВТ_Остатки.СуммаВалютнаяОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) КАК ВалютныйОстатокВРублях,<br>
 | ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) КАК Курс<br>
 |ИЗ<br>
 | ВТ_Остатки КАК ВТ_Остатки<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют.СрезПоследних(<br>
 | &МоментВремени,<br>
 | Валюта В<br>
 | (ВЫБРАТЬ<br>
 | Т.Валюта<br>
 | ИЗ<br>
 | Вт_Остатки КАК Т)) КАК КурсыВалютСрезПоследних<br>
 | ПО ВТ_Остатки.Валюта = КурсыВалютСрезПоследних.Валюта<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ВТ_Остатки.СуммаОстаток УБЫВ<br>
 |ИТОГИ<br>
 | СУММА(ВалютныйОстатокВРублях)<br>
 |ПО<br>
 | ОБЩИЕ";<br>
 <br>
 <br>
 МассивСубконто = Новый Массив(2);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Контрагенты; <br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Договоры; <br>
 <br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто);<br>
 Запрос.УстановитьПараметр("СчетПокупатели", ПланыСчетов.Управленческий.Покупатели);<br>
 Запрос.УстановитьПараметр("Контрагент", Контрагент);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 // Обход результатов запроса<br>
 Результат = Запрос.Выполнить();<br>
 ВыборкаИтоги = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 ВыборкаИтоги.Следующий();<br>
 <br>
 Превышение = СуммаОплаты - ВыборкаИтоги.ВалютныйОстатокВРублях;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Сумма оплаты превышает имеющийся долг контрагента на " + Превышение;<br>
 Сообщение.Сообщить();<br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли;</p>

<p> ОсталосьСписать = СуммаОплаты;<br>
 <br>
 Выборка = ВыборкаИтоги.Выбрать(); <br>
 Пока Выборка.Следующий() И ОсталосьСписать <> 0 Цикл<br>
 Если ОсталосьСписать >= Выборка.ВалютныйОстатокВРублях Тогда <br>
 // списывается вся валютная сумма<br>
 СписываемВВалюте = Выборка.ВалютныйОстаток;<br>
 СписываемВРублях = Выборка.ВалютныйОстатокВРублях; <br>
 Иначе // списывается часть валютной суммы<br>
 СписываемВРублях = ОсталосьСписать;<br>
 СписываемВВалюте = ? (Выборка.Курс = 0, 0, СписываемВРублях / Выборка.Курс);<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - СписываемВРублях;<br>
 <br>
 // Проводка отражения поступления денег от контрагента<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Касса;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Контрагенты] = Контрагент;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Договоры] = Выборка.Договор;<br>
 Проводка.СуммаВалютнаяКт = СписываемВВалюте;<br>
 Проводка.Сумма = СписываемВРублях;<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>10. создать док Операция </p>

<p>в модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 <br>
 НаборЗаписей = Движения.Управленческий;<br>
 <br>
 Если Не ЭтоНовый() И Не НаборЗаписей.Модифицированность() Тогда<br>
 НаборЗаписей.Прочитать();<br>
 КонецЕсли; <br>
 <br>
 Если НаборЗаписей.Количество() > 0 Тогда<br>
 НаборЗаписей.УстановитьАктивность(Не ПометкаУдаления);<br>
 КонецЕсли;<br>
 <br>
 НаборЗаписей.Записывать = Истина;<br>
 <br>
КонецПроцедуры</p>

<p>11. Создать Обработку КорректировкаЗадолженности<br>
рекв.формы ДатаАктуализации, проверка заполн = Выдавать ошибку, команда СформироватьДокумент</p>

<p>в модуле формы:</p>

<p>&НаКлиенте<br>
Процедура СформироватьДокумент(Команда)<br>
 Если ПроверитьЗаполнение() Тогда // Проверка заполнения обязательных для заполнения реквизитов, в данном случае даты актуальности<br>
 СформироватьДокументНаСервере(ДатаАктуализации);<br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<p>&НаСервереБезКонтекста<br>
Процедура СформироватьДокументНаСервере(ДатаАктуализации)<br>
 <br>
 КонецДняДатыАктуализации = КонецДня(ДатаАктуализации);<br>
 <br>
 НачатьТранзакцию();<br>
 Попытка<br>
 <br>
 // Установка блокировки данных в регистре Управленческий с отбором по счету Покупатели<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Покупатели);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | УправленческийОстатки.Субконто1 КАК Контрагент,<br>
 | УправленческийОстатки.Субконто2 КАК Договор,<br>
 | ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) КАК Курс,<br>
 | УправленческийОстатки.СуммаВалютнаяОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) - УправленческийОстатки.СуммаОстаток КАК Отклонение<br>
 |ИЗ<br>
 | РегистрБухгалтерии.Управленческий.Остатки(&ДатаАктуализации, Счет = &СчетПокупатели, &Субконто, ) КАК УправленческийОстатки<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют.СрезПоследних(&ДатаАктуализации, ) КАК КурсыВалютСрезПоследних<br>
 | ПО УправленческийОстатки.Субконто2.Валюта = КурсыВалютСрезПоследних.Валюта<br>
 |ГДЕ<br>
 | (УправленческийОстатки.СуммаВалютнаяОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) - УправленческийОстатки.СуммаОстаток >= 0.01<br>
 | ИЛИ УправленческийОстатки.СуммаВалютнаяОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) - УправленческийОстатки.СуммаОстаток <= -0.01)";<br>
 <br>
 Субконто = Новый Массив(2);<br>
 Субконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Контрагенты;<br>
 Субконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Договоры;<br>
 <br>
 // Остатки будем получать включая сама дату актуализации, чтобы при запуске обработке с той же датой система не дублировала проводки<br>
 Запрос.УстановитьПараметр("ДатаАктуализации", Новый Граница(КонецДняДатыАктуализации, ВидГраницы.Включая));<br>
 Запрос.УстановитьПараметр("СчетПокупатели", ПланыСчетов.Управленческий.Покупатели);<br>
 Запрос.УстановитьПараметр("Субконто", Субконто);<br>
 <br>
 Результат = Запрос.Выполнить();<br>
 <br>
 Если Результат.Пустой() Тогда<br>
 ОтменитьТранзакцию();<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Отсутствуют данные для формирования документа.";<br>
 Сообщение.Сообщить();<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 // Создаем и записываем новый документ Операция<br>
 НовыйДокумент = Документы.Операция.СоздатьДокумент();<br>
 НовыйДокумент.Дата = КонецДняДатыАктуализации; <br>
 НовыйДокумент.Записать();<br>
 <br>
 // Создаем набор записей, привяызываем к документу и заполняем его<br>
 НаборЗаписей = РегистрыБухгалтерии.Управленческий.СоздатьНаборЗаписей();<br>
 НаборЗаписей.Отбор.Регистратор.Установить(НовыйДокумент.Ссылка);<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = Результат.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Проводка = НаборЗаписей.Добавить();<br>
 Проводка.Период = КонецДняДатыАктуализации;<br>
 <br>
 // Проводка корректировки рублевой суммы в соответствии с изменившимся курсом валюты<br>
 Если Выборка.Отклонение > 0 Тогда<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Контрагенты] = Выборка.Контрагент;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Договоры] = Выборка.Договор;<br>
 Проводка.Сумма = Выборка.Отклонение;<br>
 Иначе<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Контрагенты] = Выборка.Контрагент;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Договоры] = Выборка.Договор;<br>
 Проводка.Сумма = -Выборка.Отклонение;<br>
 КонецЕсли;<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать();<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Документ успешно сформирован: %1", НовыйДокумент);<br>
 Сообщение.КлючДанных = НовыйДокумент.Ссылка; // Делаем сообщение кликабельным - при нажатии будет открываться новый документ<br>
 Сообщение.Сообщить(); <br>
 <br>
 ЗафиксироватьТранзакцию(); <br>
 Исключение<br>
 ОтменитьТранзакцию();<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Произошла ошибка: %1", КраткоеПредставлениеОшибки(ИнформацияОбОшибке()));<br>
 Сообщение.Сообщить();<br>
 КонецПопытки; <br>
 <br>
КонецПроцедуры</p>

<p>12. Отчет Взаиморасчеты<br>
Запрос:</p>

<p>ВЫБРАТЬ<br>
 УправленческийОстаткиИОбороты.Субконто1 КАК Контрагент,<br>
 УправленческийОстаткиИОбороты.Субконто2 КАК Договор,<br>
 УправленческийОстаткиИОбороты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,<br>
 УправленческийОстаткиИОбороты.СуммаВалютнаяНачальныйОстаток КАК СуммаВалютнаяНачальныйОстаток,<br>
 УправленческийОстаткиИОбороты.Регистратор КАК Документ,<br>
 ВЫБОР<br>
 КОГДА УправленческийОстаткиИОбороты.СуммаОборот < 0<br>
 ТОГДА -1 * УправленческийОстаткиИОбороты.СуммаОборот<br>
 ИНАЧЕ УправленческийОстаткиИОбороты.СуммаОборот<br>
 КОНЕЦ КАК СуммаОборот,<br>
 ВЫБОР<br>
 КОГДА УправленческийОстаткиИОбороты.СуммаВалютнаяОборот < 0<br>
 ТОГДА -1 * УправленческийОстаткиИОбороты.СуммаВалютнаяОборот<br>
 ИНАЧЕ УправленческийОстаткиИОбороты.СуммаВалютнаяОборот<br>
 КОНЕЦ КАК СуммаВалютнаяОборот,<br>
 УправленческийОстаткиИОбороты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,<br>
 УправленческийОстаткиИОбороты.СуммаВалютнаяКонечныйОстаток КАК СуммаВалютнаяКонечныйОстаток,<br>
 УправленческийОстаткиИОбороты.ПериодСекунда КАК ПериодСекунда,<br>
 ТИПЗНАЧЕНИЯ(УправленческийОстаткиИОбороты.Регистратор) КАК ИмяДокумента<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОстаткиИОбороты(, , Авто, Движения, Счет = &СчетПокупатели, &Субконто, ВЫРАЗИТЬ(Субконто2 КАК Справочник.Договоры).Валюта = &Валюта) КАК УправленческийОстаткиИОбороты</p>

<br>
<p>Документ выражение представления "Выбор Когда Строка(ИмяДокумента) = "Операция" Тогда "Корректировка долга" Иначе Строка(ИмяДокумента) Конец + " № "+ Строка(Документ.Номер)"</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания,<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто знач ПланВидовХарактеристик.ВидыСубконто.Контрагенты, ПланВидовХарактеристик.ВидыСубконто.Договоры, флаг доступен список знач = истина<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели, Валюта СправочникСсылка.Валюты</p>

<p>Группировки <br>
1 Заголовок <Взаиморасчеты за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д")<br>
 <Валюта: [Валюта]> Представление(ПараметрыДанных.Валюта)<br>
2 Контрагент -> ДетальныеЗаписи</p>

<p>Отчет выбр.поля:<br>
Контрагент<br>
Договор<br>
"Нач.ост. руб/вал" Вертикально<br>
 (СуммаНачальныйОстаток) (СуммаВалютнаяНачальныйОстаток)<br>
Документ<br>
"Сумма руб/вал" Вертикально<br>
 (СуммаОборот) (СуммаВалютнаяОборот)<br>
"Кон.ост. руб/вал" Вертикально<br>
 (СуммаКонечныйОстаток) (СуммаВалютнаяКонечныйОстаток)</p>

<p>Расположение полей группировок = Отдельно и только в итогах<br>
Выводить параметры = Не выводить</p>

<p>#БУ4</p>

<p>1. Создать справочник "Организации" и "Склады"</p>

<p>2. В ПВХ ВидыСубконто добавить предопределенные виды субконто "Номенклатура", "Покупатели", "Склады" (тип - ссылка на справочники), "Партиии" тип- прих.накл<br>
тип знач хар составной: СправочникСсылка.Склады, СправочникСсылка.Организации, ДокументСсылка.ПриходнаяНакладная, ДокументСсылка.КупляПродажа, СправочникСсылка.Номенклатура</p>

<p>3. В плане счетов "Управленческий" добавить признак учета "Количественный" (тип Булево)<br>
По счету товары указать признак учета Количественный = Истина, Добавить виды субконто Номенклатура, Партии и Склады (только обороты = ложь)<br>
По счету ПрибылиУбытки Добавить виды субконто Покупатели (только обороты = истина)<br>
Указать макс колво субконто - 3</p>

<p>4. Создать регистр бухгалтерии "Управленческий", указать план счетов: Управленческий, включить флаг "Корреспонденция"<br>
изм: Организация (Балансовый = Истина), рес: Количество 10.0 (признак учета Количественный), Сумма (Балансовый = Истина)<br>
регистраторы ПриходнаяНакладная, КупляПродажа, Операция</p>

<p>5. ПриходнаяНакладная в шапку добавить рекв Организация, создать форму документа со складом и организацией в шапке<br>
в модуле объекта <br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 <br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();</p>

<p>КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ()<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.Организация = Организация;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Ссылка;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<p>6. Создать док КупляПродажа, в шапке рекв: ОрганизацияПокупатель, ОрганизацияПоставщик (ссылки на спр.орг), СкладПокупателя, СкладПоставщика (ссылки на спр склады)<br>
 в ТЧ Номенклатура, Количество 10.0, Сумма 12,2</p>

<p>в модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по складу, организации и списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Склады, СкладПоставщика);<br>
 ЭлементБлокировки.УстановитьЗначение("Организация", ОрганизацияПоставщик);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | КупляПродажаСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(КупляПродажаСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(КупляПродажаСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.КупляПродажа.СписокНоменклатуры КАК КупляПродажаСписокНоменклатуры<br>
 |ГДЕ<br>
 | КупляПродажаСписокНоменклатуры.Ссылка = &Ссылка<br>
 | И КупляПродажаСписокНоменклатуры.Номенклатура.ВидНоменклатуры <> &ВидНоменклатурыУслуга<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | КупляПродажаСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | УправленческийОстатки.Субконто2 КАК Партия,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &МассивСубконто,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | А.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК А)<br>
 | И Организация = &ОрганизацияПоставщик<br>
 | И Субконто3 = &СкладПоставщика) КАК УправленческийОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстатки.Субконто1<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | МАКСИМУМ(СуммаВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 МассивСубконто = Новый Массив (3);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Партии;<br>
 МассивСубконто[2] = ПланыВидовХарактеристик.ВидыСубконто.Склады;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыУслуга", Перечисления.ВидыНоменклатуры.Услуга);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто);<br>
 Запрос.УстановитьПараметр("СкладПоставщика", СкладПоставщика);<br>
 Запрос.УстановитьПараметр("ОрганизацияПоставщик", ОрганизацияПоставщик);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 <br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 // Проводка отражения списания товара для организации поставщика<br>
 Списываем = Мин (ОсталосьСписать, Выборка.КоличествоОстаток); <br>
 <br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.Организация = ОрганизацияПоставщик;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Выборка.Партия;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = СкладПоставщика;<br>
 <br>
 Проводка.КоличествоКт = Списываем;<br>
 Проводка.Сумма = Списываем / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения поступления товара для организации покупателя<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.Организация = ОрганизацияПокупатель;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаНоменклатура.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Ссылка;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = СкладПокупателя;<br>
 <br>
 Проводка.КоличествоДт = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 Проводка.Сумма = ВыборкаНоменклатура.СуммаВДокументе;<br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.Организация = ОрганизацияПоставщик; <br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Покупатели] = ОрганизацияПокупатель;<br>
 <br>
 Проводка.Сумма = СписокНоменклатуры.Итог("Сумма"); <br>
 <br>
КонецПроцедуры</p>

<p>7. Отчет ПродажиМеждуОрганизациями<br>
Запрос:<br>
ВЫБРАТЬ<br>
 Организации.Ссылка КАК Организация,<br>
 ОрганизацияДоп.Ссылка КАК ОрагинизацияДоп<br>
ПОМЕСТИТЬ ВсеОрганизации<br>
ИЗ<br>
 Справочник.Организации КАК Организации<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Организации КАК ОрганизацияДоп<br>
 ПО (ИСТИНА)<br>
;</p>

<p>////////////////////////////////////////////////////////////////////////////////<br>
ВЫБРАТЬ<br>
 ВсеОрганизации.Организация КАК Поставщик,<br>
 ВсеОрганизации.ОрагинизацияДоп КАК Покупатель,<br>
 УправленческийОборотыДтКт.СуммаОборот КАК Сумма<br>
ИЗ<br>
 ВсеОрганизации КАК ВсеОрганизации<br>
 ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетПокупатели, , СчетКт = &СчетПрибыли, &Субконто, ) КАК УправленческийОборотыДтКт<br>
 ПО ВсеОрганизации.Организация = УправленческийОборотыДтКт.Организация<br>
 И ВсеОрганизации.ОрагинизацияДоп = УправленческийОборотыДтКт.СубконтоКт1</p>

<p>Ресурсы Сумма Сумма(Сумма)<br>
Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто ПланВидовХарактеристик.ВидыСубконто.Покупатели<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки (все кроме период - огр.доступа = истина)</p>

<p>Группировки<br>
1. Заголовок <Продажи собственным организациям за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = ДД")<br>
 Поставщик Представление(Поставщик)<br>
2. Таблица, Строки = Покупатель (Без иерархии); Колонки = Поставщик (Без иерархии)</p>

<p>Отчтет выб поля: Сумма<br>
Усл.оформ. Текст = X, Условие Покупатель Равно Поставщик, Везде<br>
Расположение общих итогов по горизонтали = нет<br>
Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ5</p>

<p>1. Создать справочник "ИнвентарныеНомера"</p>

<p>2. В ПВХ ВидыСубконто добавить предопределенные виды субконто "Номенклатура", "ИнвНомер", (тип - ссылка на справочники)<br>
тип знач хар составной: СправочникСсылка.ИнвентарныеНомера, СправочникСсылка.Номенклатура</p>

<p>3. В плане счетов "Управленческий" добавить признак учета "Количественный" (тип Булево), добавить признак учета субконто Суммовой (тип Булево)</p>

<p>По счету товары указать признак учета Количественный = Истина, Добавить виды субконто Номенклатура (Суммовой), ИнвНомер (только обороты = ложь)<br>
По счету ПрибылиУбытки Добавить виды субконто Номенклатура, ИнвНомер (все = только обороты = истина, Суммовой = Истина)<br>
Указать макс колво субконто - 2</p>

<p>4. Создать регистр бухгалтерии "Управленческий", указать план счетов: Управленческий, включить флаг "Корреспонденция"<br>
изм: нет, рес: Количество 10.0 (признак учета Количественный), Сумма 12.2 (Балансовый = Истина, пр.учета субконто = суммовой)<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная, Операция</p>

<p>5. ПриходнаяНакладная в ТЧ добавить рекв ИнвНомер (СправочникСсылка.ИнвентарныеНомера), создать форму документа<br>
в модуле объекта <br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ();<br>
 ОбработкаПроведенияБУ();<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ()<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 <br>
 // Согласно условию каждая позиция табличной части уникальна, поэтому группировать строки нет смысла<br>
 Для Каждого ТекСтрокаСписокНоменклатуры Из СписокНоменклатуры Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = ТекСтрокаСписокНоменклатуры.Количество;<br>
 Движение.Сумма = ТекСтрокаСписокНоменклатуры.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ТекСтрокаСписокНоменклатуры.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ИнвНомер] = ТекСтрокаСписокНоменклатуры.ИнвНомер;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<p>6. Док РасходнаяНакладная в ТЧ добавить рекв ИнвНомер (СправочникСсылка.ИнвентарныеНомера), создать форму документа</p>

<p>в модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаДокумента = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ (Отказ)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по списку номенклатур табличной части и счету Товары<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.ИнвНомер КАК ИнвНомер,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.ИнвНомер,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура,<br>
 | ИнвНомер<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.ИнвНомер КАК ИнвНомер,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоНоменклатуре.СуммаОстаток, 0) КАК СуммаОстатокПоНоменклатуре,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоНоменклатуреИИнвНомеру.КоличествоОстаток, 0) КАК КоличествоОстатокПоИнвНомеру,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.ИнвНомер.Представление КАК ИнвНомерПредставление,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоНоменклатуре.КоличествоОстаток, 0) КАК КоличествоОстатокПоНоменклатуре<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоНоменклатура,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | А.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК А)) КАК УправленческийОстаткиПоНоменклатуре<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоНоменклатуре.Субконто1<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоНомИИнвНомер,<br>
 | (Субконто1, Субконто2) В<br>
 | (ВЫБРАТЬ<br>
 | А.Номенклатура,<br>
 | А.ИнвНомер<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК А)) КАК УправленческийОстаткиПоНоменклатуреИИнвНомеру<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоНоменклатуреИИнвНомеру.Субконто1<br>
 | И ВТ_ТабЧасть.ИнвНомер = УправленческийОстаткиПоНоменклатуреИИнвНомеру.Субконто2<br>
 |ИТОГИ<br>
 | МАКСИМУМ(СуммаОстатокПоНоменклатуре),<br>
 | МАКСИМУМ(КоличествоОстатокПоНоменклатуре)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 СубконтоНоменклатура = Новый Массив(1);<br>
 СубконтоНоменклатура[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 <br>
 СубконтоНомИИнвНомер = Новый Массив(2);<br>
 СубконтоНомИИнвНомер[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 СубконтоНомИИнвНомер[1] = ПланыВидовХарактеристик.ВидыСубконто.ИнвНомер; <br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 ЗАпрос.УстановитьПараметр("СубконтоНоменклатура", СубконтоНоменклатура);<br>
 Запрос.УстановитьПараметр("СубконтоНомИИнвНомер", СубконтоНомИИнвНомер);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 <br>
 // Переменные для расчета себестоимости списания<br>
 КоличественныйОстатокПоНоменклатуре = ВыборкаНоменклатура.КоличествоОстатокПоНоменклатуре;<br>
 СуммовойОстатокПоНоменклатуре = ВыборкаНоменклатура.СуммаОстатокПоНоменклатуре;<br>
 <br>
 // Переменные для контроля списания всей стоимости, если будет списано всё количество номенклатуры<br>
 КоличествоОсталосьСписать = ВыборкаНоменклатура.КоличествоОстатокПоНоменклатуре;<br>
 СуммаОсталосьСписать = ВыборкаНоменклатура.СуммаОстатокПоНоменклатуре;<br>
 <br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры и инвентарного номера<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстатокПоИнвНомеру;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по инвентарному номеру %1 и номенклатуре %2 в количестве %3", <br>
 Выборка.ИнвНомерПредставление, Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 <br>
 // Проводка отражения списания товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ИнвНомер] = Выборка.ИнвНомер;<br>
 <br>
 //Это для расчетов из СПР5<br>
 //Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Подразделения] = Подразделение;</p>

<p> Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.ИнвНомер] = Выборка.ИнвНомер;<br>
 <br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе; <br>
 Если Выборка.КоличествоВДокументе = КоличествоОсталосьСписать Тогда<br>
 СуммаСписываем = СуммаОсталосьСписать;<br>
 Иначе<br>
 СуммаСписываем = Выборка.КоличествоВДокументе / КоличественныйОстатокПоНоменклатуре * СуммовойОстатокПоНоменклатуре;<br>
 КонецЕсли;<br>
 <br>
 Проводка.Сумма = СуммаСписываем;<br>
 <br>
 КоличествоОсталосьСписать = КоличествоОсталосьСписать - Выборка.КоличествоВДокументе;<br>
 СуммаОсталосьСписать = СуммаОсталосьСписать - Проводка.Сумма;<br>
 <br>
 // Проводка отражения продажи<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.ИнвНомер] = Выборка.ИнвНомер;<br>
 <br>
 //Это для расчетов из СПР5<br>
 //Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Подразделения] = Подразделение;<br>
 <br>
 Проводка.Сумма = Выборка.СуммаВДокументе; <br>
 <br>
 КонецЦикла;<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<br>
<p>7. Отчет Продажи<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОбороты.Субконто1 КАК Товар,<br>
 УправленческийОбороты.Субконто2 КАК ИнвНомер,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ТОГДА УправленческийОбороты.СуммаОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Себестоимость,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетПокупатели<br>
 ТОГДА УправленческийОбороты.СуммаОборотКт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Продажа<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Обороты(, , , Счет = &СчетПрибыли, &Субконто, , КорСчет В (&КорСчета), ) КАК УправленческийОбороты</p>

<p>Ресурсы Продажа, Себестоимость<br>
Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто знач (ПланВидовХарактеристик.ВидыСубконто.Номенклатура, ПланВидовХарактеристик.ВидыСубконто.ИнвНомер) дост список знач<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки <br>
 КорСчета ПланСчетовСсылка.Управленческий знач (ПланСчетов.Управленческий.Товары, ПланСчетов.Управленческий.Покупатели) дост список знач<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели<br>
 СчетТовары ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Товары<br>
 (все кроме период - огр.доступа = истина)</p>

<p>Группировки<br>
1. Заголовок <Продажи за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = ДД")<br>
2. Товар, ИнвНомер</p>

<p>Отчтет выб поля: Товар, ИнвНомер, Себестоимость, Продажа<br>
Расположение общих итогов по горизонтали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ6</p>

<p>1. Создать спр Склады</p>

<p>2. В ПВХ ВидыСубконто<br>
тип знач хар: СправочникСсылка.Склады, СправочникСсылка.ФизическиеЛица, ДокументСсылка.ПриходнаяНакладная, СправочникСсылка.Номенклатура</p>

<p>3. В План счетов Управленческий добавить пр.учета Количественный, пр.учета субконто Суммовой (оба булево)<br>
По счету Товары Количественный = Истина, добавить виды субконто Номенклатура (Суммовой), Склады, Партии (Суммовой)<br>
макс колво субконто = 3</p>

<p>4. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10,0 (количественный), Сумма (балансовый, суммовой)<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная, Операция</p>

<p>5. создать Регистр св УчетнаяПолитика (В пределах года), ресурс: МетодСписания (ПеречислениеСсылка.МетодыСписания //тут надо наверн заменить на переч.учполитика как в каркасной)</p>

<p>6. док ПриходнаяНакладная добавить СкладБУ в ТЧ<br>
в модуле объекта<br>
Процедура ОбработкаПроведенияБУ()<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СкладБУ КАК СкладБУ,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СкладБУ";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Ссылка;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Выборка.СкладБУ;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>7. док РасходнаяНакладная добавить Склад в шапку<br>
в модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ(Отказ)<br>
 <br>
 Если Не БУ Тогда<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 // Определение текущего метода списания себестоимости<br>
 МетодСписания = РегистрыСведений.УчетнаяПолитика.ПолучитьПоследнее(МоментВремени()).МетодСписания;<br>
 <br>
 Если Не ЗначениеЗаполнено(МетодСписания) Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Не заполнена учетная политика";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по счету Товары и списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 ТекстЗапроса = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | УправленческийОстаткиПоПартиям.Субконто2 КАК Партия,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоСкладамИПартиям.КоличествоОстаток, 0) КАК КоличествоОстатокНаСкладе,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоПартиям.КоличествоОстаток, 0) КАК КоличествоОстатокПоПартии,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоПартиям.СуммаОстаток, 0) КАК СуммаОстатокПоПартии,<br>
 | ВЫРАЗИТЬ(УправленческийОстаткиПоПартиям.Субконто2 КАК Документ.ПриходнаяНакладная).МоментВремени КАК МоментВремениПартии<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоСкладыПартии,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)<br>
 | И Субконто2 = &Склад) КАК УправленческийОстаткиПоСкладамИПартиям<br>
 | ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоПартии,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК УправленческийОстаткиПоПартиям<br>
 | ПО УправленческийОстаткиПоСкладамИПартиям.Субконто1 = УправленческийОстаткиПоПартиям.Субконто1<br>
 | И УправленческийОстаткиПоСкладамИПартиям.Субконто3 = УправленческийОстаткиПоПартиям.Субконто2<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоСкладамИПартиям.Субконто1<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | МоментВремениПартии УБЫВ<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | СУММА(КоличествоОстатокНаСкладе)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Если МетодСписания = Перечисления.МетодыСписания.ФИФО Тогда<br>
 ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "УБЫВ", "");<br>
 КонецЕсли;<br>
 <br>
 Запрос.Текст = ТекстЗапроса;<br>
 <br>
 СубконтоСкладыПартии = Новый Массив(3);<br>
 СубконтоСкладыПартии[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 СубконтоСкладыПартии[1] = ПланыВидовХарактеристик.ВидыСубконто.Склады;<br>
 СубконтоСкладыПартии[2] = ПланыВидовХарактеристик.ВидыСубконто.Партии;<br>
 <br>
 СубконтоПартии = Новый Массив(2);<br>
 СубконтоПартии[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 СубконтоПартии[1] = ПланыВидовХарактеристик.ВидыСубконто.Партии;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("СубконтоСкладыПартии",СубконтоСкладыПартии);<br>
 Запрос.УстановитьПараметр("СубконтоПартии",СубконтоПартии);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстатокНаСкладе;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Переменная для прерывания обхода партий после того как будет списано все количество из документа<br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 // Проводка отражения списания товара<br>
 Списываем = Мин (ОсталосьСписать, Выборка.КоличествоОстатокНаСкладе);<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = Планысчетов.Управленческий.Товары;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Выборка.Партия;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 <br>
 Проводка.КоличествоКт = Списываем;<br>
 Проводка.Сумма = Списываем / Выборка.КоличествоОстатокПоПартии * Выборка.СуммаОстатокПоПартии;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 КонецЦикла;<br>
 <br>
 <br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = Планысчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.Сумма = СуммаПоДокументу; </p>

<p>КонецПроцедуры</p>

<p>8. Отчет ТоварыНаСкладах<br>
Запрос<br>
ВЫБРАТЬ<br>
 УправленческийОстатки.Субконто1 КАК Товар,<br>
 УправленческийОстатки.Субконто2 КАК Склад,<br>
 УправленческийОстатки.СуммаОстаток КАК Сумма,<br>
 УправленческийОстатки.КоличествоОстаток КАК Количество<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Остатки(, Счет = &СчетТовары, &Субконто, ) КАК УправленческийОстатки</p>

<p>ресурсы: Количество Сумма(Количество), Сумма Сумма(Сумма)<br>
Параметры: Период Дата <br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто знач (ПланВидовХарактеристик.ВидыСубконто.Номенклатура, ПланВидовХарактеристик.ВидыСубконто.Склады) дост список знач, огр дост<br>
 СчетТовары ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.Товары, огр дост</p>

<p>Группировки<br>
1. Заголовок <Остатки товаров на [Период]> Формат (ПараметрыДанных.Период, "ДЛФ = Д")<br>
2. Товар -> Склад</p>

<p>Отчет выб поля Количество, Сумма<br>
Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ7</p>

<p>1. Создать спр Договоры, в шапке рекв СрокДействия (Дата), Владелец - спр Контрагенты</p>

<p>2. В ПВХ ВидыСубконто<br>
тип знач хар: СправочникСсылка.Склады, СправочникСсылка.ФизическиеЛица, ДокументСсылка.ПриходнаяНакладная, СправочникСсылка.Номенклатура<br>
предопр характеристики: Договоры (СправочникСсылка.Договоры), Документы (ДокументСсылка.РасходнаяНакладная), Контрагенты (СправочникСсылка.Контрагенты)</p>

<p>3. В План счетов Управленческий добавить пр.учета Валютный булево <br>
По счету Покупатели Валютный = Истина, добавить виды субконто Контрагенты, Договоры, Документы (флагов нет)<br>
макс колво субконто = 3</p>

<p>4. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: СуммаВРублях 12,2 (балансовый), СуммаВВалюте(Валютный)<br>
регистраторы РасходнаяНакладная, Операция, ПриходДенег</p>

<br>
<p>5. док РасходнаяНакладная добавить КурсЕвро 5.2, Контрагент, Договор (связи параметров выбора Отбор.Владелец(Контрагент)) в шапку<br>
в модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ(Отказ)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Движение.Период = Дата;<br>
 Движение.СуммаВРублях = СуммаПоДокументу;<br>
 Движение.СуммаВВалютеДт = ?(КурсЕвро = 0, 0, СуммаПоДокументу / КурсЕвро);<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Контрагенты] = Контрагент;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Договоры] = Договор;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Документы] = Ссылка;<br>
 <br>
КонецПроцедуры</p>

<p>6. Док ПриходДенег в шапке Контрагент, СуммаОплаты 12.2, КурсЕвро 5.2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ</p>

<p> Движения.Управленческий.Записать();<br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по счету Покупатели по контрагенту документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Покупатели);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Контрагенты, Контрагент);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать();</p>

<p> // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | УправленческийОстатки.Субконто2 КАК Договор,<br>
 | УправленческийОстатки.Субконто3 КАК Документ,<br>
 | УправленческийОстатки.СуммаВРубляхОстаток,<br>
 | ВЫРАЗИТЬ(УправленческийОстатки.Субконто2 КАК Справочник.Договоры).СрокДействия КАК ПорядокПоСрокуДействия,<br>
 | ВЫРАЗИТЬ(УправленческийОстатки.Субконто3 КАК Документ.РасходнаяНакладная).МоментВремени КАК ПорядокПоМоментуВремени<br>
 |ИЗ<br>
 | РегистрБухгалтерии.Управленческий.Остатки(&МоментВремени, Счет = &СчетПокупатели, &МассивСубконто, Субконто1 = &Контрагент) КАК УправленческийОстатки<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ПорядокПоСрокуДействия,<br>
 | ПорядокПоМоментуВремени";<br>
 <br>
 МассивСубконто = Новый Массив;<br>
 МассивСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконто.Контрагенты);<br>
 МассивСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконто.Договоры);<br>
 МассивСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконто.Документы);<br>
 <br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетПокупатели", ПланыСчетов.Управленческий.Покупатели);<br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто);<br>
 Запрос.УстановитьПараметр("Контрагент", Контрагент);<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 ОсталосьСписать = СуммаОплаты;<br>
 Пока ОсталосьСписать <> 0 И Выборка.Следующий() Цикл<br>
 // Проводка погашения суммы долга<br>
 СписываемВРублях = Мин (ОсталосьСписать, Выборка.СуммаВРубляхОстаток);<br>
 <br>
 Движение = Движения.Управленческий.Добавить();<br>
 <br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Касса;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Покупатели;<br>
 Движение.Период = Дата;<br>
 Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Контрагенты] = Контрагент;<br>
 Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Договоры] = Выборка.Договор;<br>
 Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Документы] = Выборка.Документ;<br>
 <br>
 Движение.СуммаВРублях = СписываемВРублях;<br>
 Движение.СуммаВВалютеКт = ?(КурсЕвро = 0, 0, СписываемВРублях/КурсЕвро);<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - СписываемВРублях;<br>
 КонецЦикла;<br>
 <br>
 // Контроль непревышения суммы оплаты над суммой долга<br>
 Если ОсталосьСписать <> 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Сумма оплаты превышает общую сумма задолженности на %1 руб.", ОсталосьСписать);<br>
 Сообщение.Сообщить(); <br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли; <br>
КонецПроцедуры</p>

<p>7. Отчет Взаиморасчеты<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОборотыДтКтПродажи.СубконтоДт1 КАК Контрагент,<br>
 УправленческийОборотыДтКтПродажи.СубконтоДт2 КАК Договор,<br>
 УправленческийОборотыДтКтПродажи.СубконтоДт3 КАК Документ,<br>
 УправленческийОборотыДтКтПродажи.СуммаВРубляхОборот КАК ОтгрузкаВРублях,<br>
 УправленческийОборотыДтКтПродажи.СуммаВВалютеОборотДт КАК ОгрузкаВЕвро,<br>
 УправленческийОборотыДтКтОплата.СуммаВРубляхОборот КАК ОплатаВРублях,<br>
 УправленческийОборотыДтКтОплата.СуммаВВалютеОборотКт КАК ОплатаВЕвро<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетПокупатели, &Субконто, СчетКт = &СчетПрибыли, , ) КАК УправленческийОборотыДтКтПродажи<br>
 ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетКасса, , СчетКт = &СчетПокупатели, &Субконто, ) КАК УправленческийОборотыДтКтОплата<br>
 ПО УправленческийОборотыДтКтПродажи.СубконтоДт1 = УправленческийОборотыДтКтОплата.СубконтоКт1<br>
 И УправленческийОборотыДтКтПродажи.СубконтоДт2 = УправленческийОборотыДтКтОплата.СубконтоКт2<br>
 И УправленческийОборотыДтКтПродажи.СубконтоДт3 = УправленческийОборотыДтКтОплата.СубконтоКт3</p>

<p>в надоре для поля Документ выражение представления = "Расх. Накладная № " + Строка(Документ.Номер)</p>

<p>ресурсы: ОгрузкаВЕвро, ОплатаВЕвро, ОплатаВРублях, ОтгрузкаВРублях (все сумма)<br>
Параметры: Период СтандартныйПериод, НачалоПериода Дата &Период.ДатаНачала, КонецПериода Дата &Период.ДатаОкончания<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто знач (ПланВидовХарактеристик.ВидыСубконто.Контрагенты,<br>
 ПланВидовХарактеристик.ВидыСубконто.Договоры,<br>
 ПланВидовХарактеристик.ВидыСубконто.Документы) дост список знач, огр дост<br>
 СчетКасса ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.Касса, огр дост<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.Покупатели, огр дост<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.ПрибылиУбытки, огр дост</p>

<p>Группировки<br>
1. Заголовок: Контрагент Договор Документ "Оплата/Руб./Евро" "Отгрузка/Руб./Евро"<br>
2. Контрагент -> Договор -> Документ</p>

<p>Отчет выб поля Оплата вертикально (ОплатаВРублях, ОплатаВЕвро), Отгрузка Вертикально (ОтгрузкаВРублях, ОгрузкаВЕвро)</p>

<p>Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ8</p>

<p>1. Создать спр ИнвентарныеНомера</p>

<p>2. Создать спр ЗначенияСвойств<br>
Владелец ПВХ СвойстваОбъектов</p>

<p>3. В ПВХ СвойстваОбъектов тип знач Булево, Строка, Дата, Число, СправочникСсылка.ЗначенияСвойств</p>

<p>4. В ПВХ ВидыСубконто<br>
тип знач хар: СправочникСсылка.Номенклатура, СправочникСсылка.ИнвентарныеНомера, СправочникСсылка.ФизическиеЛица<br>
предопр характеристики: ИнвентарныеНомера (СправочникСсылка.ИнвентарныеНомера), Номенклатура (СправочникСсылка.Номенклатура), Сотрудники (СправочникСсылка.ФизическиеЛица)</p>

<p>5. Создать рег свед ЗначенияСвойств, изм: Сотрудник, Свойство (ПланВидовХарактеристикСсылка.СвойстваОбъектов), рес: Значение Характеристика.СвойстваОбъектов</p>

<p>6. В План счетов Управленческий добавить пр.учета Количественный булево <br>
По счету Товары Количественный = Истина, добавить виды субконто Номенклатура, ИнвентарныеНомера (флагов нет)<br>
По счету ПрибылиУбытки Количественный = Ложь, добавить виды субконто Номенклатура, ИнвентарныеНомера, Сотрудники (все только обороты = Истина)<br>
макс колво субконто = 3</p>

<p>7. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10.0 (Количественный), Сумма 12,2 (балансовый)<br>
регистраторы РасходнаяНакладная, Операция, ПрихНакл</p>

<p>8. В док ПриходнаяНакладная в ТЧ добавить ИнвентарныйНомер (СправочникСсылка.ИнвентарныеНомера)<br>
В модуле объекта <br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 // Согласно условию каждая позиция табличной части уникальна, поэтому группировать строки нет смысла<br>
 Для Каждого ТекСтрокаСписокНоменклатуры Из СписокНоменклатуры Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = ТекСтрокаСписокНоменклатуры.Количество;<br>
 Движение.Сумма = ТекСтрокаСписокНоменклатуры.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ТекСтрокаСписокНоменклатуры.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ИнвентарныеНомера] = ТекСтрокаСписокНоменклатуры.ИнвентарныйНомер;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>9. В док РасходнаяНакладная в шапку добавить рекв Сотрудник, в ТЧ добавить ИнвентарныйНомер (СправочникСсылка.ИнвентарныеНомера)<br>
В модуле объекта <br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по счету Товары и списку номенклатур и инв.номеров табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.ИнвентарныеНомера, "ИнвентарныйНомер");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.ИнвентарныйНомер КАК ИнвентарныйНомер,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.ИнвентарныйНомер,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура,<br>
 | ИнвентарныйНомер<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.ИнвентарныйНомер КАК ИнвентарныйНомер,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.ИнвентарныйНомер.Представление КАК ИнвентарныйНомерПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &МассивСубконто,<br>
 | (Субконто1, Субконто2) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.ИнвентарныйНомер КАК ИнвентарныйНомер<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК УправленческийОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстатки.Субконто1<br>
 | И ВТ_ТабЧасть.ИнвентарныйНомер = УправленческийОстатки.Субконто2";<br>
 <br>
 МассивСубконто = Новый Массив(2);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.ИнвентарныеНомера; <br>
 <br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 <br>
 РезультатЗапроса = Запрос.Выполнить();<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = РезультатЗапроса.Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры и инвентарного номера<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по инвентарному номеру %1 и номенклатуре %2 в количестве %3",<br>
 Выборка.ИнвентарныйНомерПредставление, Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Проводка отражения списания товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ИнвентарныеНомера] = Выборка.ИнвентарныйНомер;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Сотрудники] = Сотрудник; <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.ИнвентарныеНомера] = Выборка.ИнвентарныйНомер;<br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе; <br>
 Проводка.Сумма = Выборка.СуммаОстаток;<br>
 <br>
 // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.ИнвентарныеНомера] = Выборка.ИнвентарныйНомер;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Сотрудники] = Сотрудник; <br>
 Проводка.Сумма = Выборка.СуммаВДокументе; <br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>10. Отчет Продажи<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОборотыДтКт.СубконтоДт1 КАК Номенклатура,<br>
 УправленческийОборотыДтКт.СубконтоДт2 КАК ИнвентарныйНомер,<br>
 УправленческийОборотыДтКт.СубконтоДт3 КАК Сотрудник,<br>
 УправленческийОборотыДтКт.СуммаОборот КАК Стоимость,<br>
 0 КАК Продажа<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетПрибыли, &Субконто, СчетКт = &СчетТовары, , ) КАК УправленческийОборотыДтКт</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 УправленческийОборотыДтКт.СубконтоКт1,<br>
 УправленческийОборотыДтКт.СубконтоКт2,<br>
 УправленческийОборотыДтКт.СубконтоКт3,<br>
 0,<br>
 УправленческийОборотыДтКт.СуммаОборот<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетПокупатели, , СчетКт = &СчетПрибыли, &Субконто, ) КАК УправленческийОборотыДтКт</p>

<p>выч поля Товар выражение "Строка(Номенклатура) + "/" + Строка (ИнвентарныйНомер)" заголовок = Товар<br>
 Образование выражение "Сотрудник.Образование" заголовок = Образование (свойство)</p>

<p>ресурсы: Стоимость, Продажа (все сумма)<br>
Параметры: Период СтандартныйПериод, НачалоПериода Дата &Период.ДатаНачала, КонецПериода Дата &Период.ДатаОкончания<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто знач (ПланВидовХарактеристик.ВидыСубконто.Номенклатура,<br>
 ПланВидовХарактеристик.ВидыСубконто.ИнвентарныеНомера,<br>
 ПланВидовХарактеристик.ВидыСубконто.Сотрудники) дост список знач, огр дост<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.Покупатели, огр дост<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.ПрибылиУбытки, огр дост<br>
 СчетТовары ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.Товары, огр дост</p>

<p>Группировки<br>
1. Сотрудник, Образование, Товар</p>

<p>Отчет выб поля Стоимость, Продажа, Сотрудник, Образование, Товар</p>

<p>Расположение реквизитов = Отдельно<br>
Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ9</p>

<p>1. Создать спр Агенты<br>
В моделе объекта<br>
Процедура ПередЗаписью(Отказ)<br>
 Если НЕ ЭтоНовый() Тогда<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | Агенты.Валюта КАК Валюта,<br>
 | Агенты.Валюта.Представление КАК ВалютаПредставление<br>
 |ИЗ<br>
 | Справочник.Агенты КАК Агенты<br>
 |ГДЕ<br>
 | Агенты.Ссылка = &Ссылка";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 РезультатЗапроса = Запрос.Выполнить();<br>
 Выборка = РезультатЗапроса.Выбрать();<br>
 Выборка.Следующий();<br>
 Если НЕ Валюта = Выборка.Валюта Тогда<br>
 Отказ = Истина;<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "У агента " + Наименование + " уже задана валюта " + Выборка.ВалютаПредставление + ". Валюта не подлежит пересмотру!";<br>
 Сообщение.Сообщить();<br>
 КонецЕсли;<br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<p>2. Создать спр Склады</p>

<p>3. В ПВХ ВидыСубконто <br>
тип знач хар = СправочникСсылка.Склады, СправочникСсылка.Номенклатура, СправочникСсылка.Агенты<br>
предопр знач: Агенты (СправочникСсылка.Агенты), Номенклатура (СправочникСсылка.Номенклатура), Склады (СправочникСсылка.Склады)</p>

<p>4. В Плане счетов Управленческий добавить признаки учета Количественный и Валютный, оба = булево<br>
по счету товары указать пр.Количественный, Субконто1 = Склады, Субконто2 = Номенклатура, флагов нет<br>
по счету Агенты указать пр.Валютный, Субконто1 = Агенты, флагов нет</p>

<p>5. Создать регистр св КурсыВалют (в пределах дня), изм: Валюта, рес. Курс 5.2</p>

<p>6. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10.0 (Количественный), СуммаВРублях 12,2 (балансовый), СуммаВВалюте 12,2 (Валютный)<br>
регистраторы РасходнаяНакладная, Операция, ПрихНакл</p>

<p>7. Док ПриходнаяНакладная в Шапку добавить Склад<br>
В модуле объекта<br>
Процедура ОбработкаПроведенияБУ()<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.СуммаВРублях = Выборка.Сумма;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>8. Док РасходнаяНакладная в Шапку добавить Склад, Агент<br>
В модуле объекта<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ); <br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ(Отказ)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по счету Товары списку номенклатур табличной части и складу документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары); <br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Склады, Склад); <br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаВРубляхОстаток, 0) КАК СуммаВРубляхОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &МассивСубконто,<br>
 | Субконто1 = &Склад<br>
 | И Субконто2 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК УправленческийОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстатки.Субконто2";<br>
 <br>
 МассивСубконто = Новый Массив (2);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Склады;<br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 <br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто);<br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 <br>
 <br>
 // Обход результатов запроса<br>
 Результат = Запрос.Выполнить();<br>
 <br>
 Если Не Результат.Пустой() Тогда<br>
 <br>
 Выборка = Результат.Выбрать();<br>
 ОбщаяСуммаСписания = 0; // для накопления списанной суммы себестоимости, используется для расчета вознаграждения агенту <br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток; <br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2",<br>
 Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Проводка отражения списания товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 <br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе;<br>
 Проводка.СуммаВРублях = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаВРубляхОстаток;<br>
 <br>
 ОбщаяСуммаСписания = ОбщаяСуммаСписания + Проводка.СуммаВРублях;<br>
 <br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки; <br>
 <br>
 Проводка.СуммаВРублях = СуммаПоДокументу;<br>
 <br>
 Если ЗначениеЗаполнено(Агент) Тогда <br>
 <br>
 // Проводка отражения вознаграждения агенту<br>
 СуммаВознаграждения = 0.2 * (СуммаПоДокументу - ОбщаяСуммаСписания);</p>

<p> Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 <br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Агенты; <br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Агенты] = Агент; <br>
 Проводка.СуммаВРублях = СуммаВознаграждения;<br>
 <br>
 СтруктураОтбора = Новый Структура ("Валюта", Агент.Валюта); <br>
 КурсВалюты = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(Дата, СтруктураОтбора).Курс; <br>
 <br>
 Если КурсВалюты <> 0 Тогда<br>
 Проводка.СуммаВВалютеКт = СуммаВознаграждения / КурсВалюты;<br>
 КонецЕсли;<br>
 <br>
 КонецЕсли; <br>
 <br>
 КонецЕсли; <br>
КонецПроцедуры</p>

<p>9. Отчет ЗадолженностьПередАгентами<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОстатки.СуммаВРубляхОстатокКт КАК СуммаРублевая,<br>
 ВЫРАЗИТЬ(УправленческийОстатки.Субконто1 КАК Справочник.Агенты).Валюта КАК Валюта,<br>
 УправленческийОстатки.СуммаВВалютеОстатокКт КАК СуммаВалютная,<br>
 УправленческийОстатки.Субконто1 КАК Агент<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Остатки(, Счет = &СчетАгенты, &Субконто, ) КАК УправленческийОстатки<br>
Параметры: НачалоПериода Дата<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто знач ПланВидовХарактеристик.ВидыСубконто.Агенты, огр дост<br>
 СчетАгенты ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.Агенты, огр дост</p>

<p>Группировки<br>
1. Заголовок <Задолженность перед агентами на [НачалоПериода] п> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д")<br>
2. ДетальныеЗаписи</p>

<p>Выводить параметры = Не выводить</p>

<p>#БУ10</p>

<p>1. Создать спр Склады</p>

<p>2. В ПВХ ВидыСубконто <br>
тип знач хар = СправочникСсылка.Номенклатура, СправочникСсылка.Склады, ДокументСсылка.Отправление<br>
предопр знач: ДокументОтправления (ДокументСсылка.Отправление), Номенклатура (СправочникСсылка.Номенклатура), Склады (СправочникСсылка.Склады)</p>

<p>3. В Плане счетов Управленческий добавить признак учета Количественный булево<br>
по счету Товары указать пр.Количественный, Субконто1 = Номенклатура, Субконто2 = Склады, флагов нет<br>
по счету ТоварыВПути указать пр.Количественный, Субконто1 = Номенклатура, Субконто2 = ДокументОтправления, флагов нет</p>

<p>4. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10.0 (Количественный), Сумма 12,2 (балансовый)<br>
регистраторы ПриходнаяНакладная, Отправление, Прибытие, Операция</p>

<p>5. Док ПриходнаяНакладная в Шапку добавить Склад<br>
В модуле объекта<br>
Процедура ОбработкаПроведенияБУ()<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>6. Док Отправление в Шапку добавить Склад, В ТЧ СписокНоменклатуры рекв Номенклатура, Количество 10.0<br>
В модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // Движения по регистру бухгалтерии Управленческий (старая методика проведения)<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по счету Товары, списку номенклатур табличной части и складу документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Склады, Склад); <br>
 Блокировка.Заблокировать();</p>

<p> // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ОтправлениеСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ОтправлениеСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.Отправление.СписокНоменклатуры КАК ОтправлениеСписокНоменклатуры<br>
 |ГДЕ<br>
 | ОтправлениеСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ОтправлениеСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &Субконто,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)<br>
 | И Субконто2 = &Склад) КАК УправленческийОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстатки.Субконто1";<br>
 <br>
 <br>
 Субконто = Новый Массив(2);<br>
 Субконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 Субконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Склады;</p>

<p> Запрос.УстановитьПараметр("Субконто", Субконто);<br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 <br>
 // Обход результатов запроса, формирование движений в регистр бухгалтерии<br>
 Результат = Запрос.Выполнить();<br>
 <br>
 Если Не Результат.Пустой() Тогда<br>
 Выборка = Результат.Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Проводка отражения отправления товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ТоварыВПути;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ДокументОтправления] = Ссылка;<br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 <br>
 Проводка.КоличествоДт = Выборка.КоличествоВДокументе;<br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе;<br>
 <br>
 Проводка.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 КонецЦикла;<br>
 <br>
 КонецЕсли; <br>
КонецПроцедуры</p>

<p>7. док Прибытие в Шапку добавить Склад, ДокументОтправления; В ТЧ СписокНоменклатуры рекв Номенклатура, Количество 10.0<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // Движения по регистру бухгалтерии Управленческий (старая методика проведения)</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных по регистру Управленческий по счету Товары в пути по списку номенклатур табличной части и документу отправления<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.ТоварыВПути);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.ДокументОтправления, ДокументОтправления); <br>
 Блокировка.Заблокировать();</p>

<p> // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ПрибытиеСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПрибытиеСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.Прибытие.СписокНоменклатуры КАК ПрибытиеСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПрибытиеСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПрибытиеСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТоварыВПути,<br>
 | &Субконто,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)<br>
 | И Субконто2 = &ДокументОтправления) КАК УправленческийОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстатки.Субконто1";<br>
 <br>
 <br>
 Субконто = Новый Массив(2);<br>
 Субконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 Субконто[1] = ПланыВидовХарактеристик.ВидыСубконто.ДокументОтправления;</p>

<p> Запрос.УстановитьПараметр("Субконто", Субконто);<br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТоварыВПути", ПланыСчетов.Управленческий.ТоварыВПути);<br>
 Запрос.УстановитьПараметр("ДокументОтправления", ДокументОтправления);<br>
 <br>
 // Обход результатов запроса, формирование движений в регистр бухгалтерии<br>
 Результат = Запрос.Выполнить(); <br>
 <br>
 Если Не Результат.Пустой() Тогда<br>
 Выборка = Результат.Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Проводка отражения прибытия товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ТоварыВПути;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.ДокументОтправления] = ДокументОтправления;<br>
 <br>
 Проводка.КоличествоДт = Выборка.КоличествоВДокументе;<br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе;<br>
 <br>
 Проводка.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 КонецЦикла;<br>
 <br>
 КонецЕсли; <br>
КонецПроцедуры</p><br>
<br>
<p>8. Отчет ЗадолженностьПередАгентами<br>
Запрос:<br>
ВЫБРАТЬ<br>
 Отправления.СубконтоДт1 КАК Товар,<br>
 Прибытия.СубконтоДт2 КАК СкладПолучатель,<br>
 Отправления.КоличествоОборотДт КАК КоличествоОтправлено,<br>
 Отправления.СуммаОборот КАК СуммаОтправлено,<br>
 Потери.КоличествоОборотКт КАК КоличествоПотери,<br>
 Потери.СуммаОборот КАК СуммаПотери,<br>
 Прибытия.КоличествоОборотДт КАК КоличествоПолучено,<br>
 Прибытия.СуммаОборот КАК СуммаПолучено<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетТоварыВПути, &СубконтоТоварыВПути, СчетКт = &СчетТовары, &СубконтоТовары, ) КАК Отправления<br>
 ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт <> &СчетТовары, , СчетКт = &СчетТоварыВПути, &СубконтоТоварыВПути, ) КАК Потери<br>
 ПО Отправления.СубконтоДт1 = Потери.СубконтоКт1<br>
 И Отправления.СубконтоДт2 = Потери.СубконтоКт2<br>
 ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетТовары, &СубконтоТовары, СчетКт = &СчетТоварыВПути, &СубконтоТоварыВПути, ) КАК Прибытия<br>
 ПО Отправления.СубконтоДт1 = Прибытия.СубконтоКт1<br>
 И Отправления.СубконтоДт2 = Прибытия.СубконтоКт2</p>

<p>ресурсы = все числовые</p>

<p>Параметры: НачалоПериода Дата огр дост<br>
 КонецПериода Дата <br>
 СубконтоТовары ПланВидовХарактеристикСсылка.ВидыСубконто знач = (ПланВидовХарактеристик.ВидыСубконто.Номенклатура, ПланВидовХарактеристик.ВидыСубконто.Склады), дост спис, огр дост<br>
 СубконтоТоварыВПути ПланВидовХарактеристикСсылка.ВидыСубконто знач = (ПланВидовХарактеристик.ВидыСубконто.Номенклатура, ПланВидовХарактеристик.ВидыСубконто.ДокументОтправления), дост спис, огр дост<br>
 СчетТовары ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.Товары, огр дост<br>
 СчетТоварыВПути ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.ТоварыВПути, огр дост</p>

<p>Группировки<br>
1. Заголовок <Недошедшие товары на [Период]> Формат (ПараметрыДанных.КонецПериода, "ДЛФ= Д")<br>
 "Склад получатель" Товар "Отправлено кол/сум" "Получено кол/сум" "Потери кол./сум."<br>
2. СкладПолучатель -> Товар</p>

<p>Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ11</p>

<p>1. Создать спр Склады (и Номенклатура, если нет)</p>

<p>2. В ПВХ ВидыСубконто <br>
тип знач хар = СправочникСсылка.Номенклатура, СправочникСсылка.Склады, Дата, ДокументСсылка.Отправление<br>
предопр знач: ДатаПрибытия (Дата), ДокументОтправления (ДокументСсылка.Отправление), Номенклатура (СправочникСсылка.Номенклатура), Склады (СправочникСсылка.Склады)</p>

<p>3. В Плане счетов Управленческий добавить признак учета Количественный булево<br>
по счету Товары указать пр.Количественный, Субконто1 = Номенклатура, Субконто2 = Склады, флагов нет<br>
по счету ТоварыВПути указать пр.Количественный, Субконто1 = Номенклатура, Субконто2 = ДокументОтправления, Субконто3 = ДатаПрибытия (флаг только обороты = истина)</p>

<p>4. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10.0 (Количественный), Сумма 12,2 (балансовый)<br>
регистраторы ПриходнаяНакладная, Отправление, Прибытие, Операция</p>

<p>5. Док ПриходнаяНакладная в Шапку добавить Склад<br>
В модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>6. Док Отправление в Шапку добавить Склад, ПланируемаяДатаПрибытия (Дата), В ТЧ СписокНоменклатуры рекв Номенклатура, Количество 10.0<br>
В модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по счету Товары, складу документа и списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Склады, Склад); <br>
 Блокировка.Заблокировать();</p>

<p> // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОтправлениеСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ОтправлениеСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.Отправление.СписокНоменклатуры КАК ОтправлениеСписокНоменклатуры<br>
 |ГДЕ<br>
 | ОтправлениеСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ОтправлениеСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &Субконто,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)<br>
 | И Субконто2 = &Склад) КАК УправленческийОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстатки.Субконто1";<br>
 <br>
 <br>
 Субконто = Новый Массив(2);<br>
 Субконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 Субконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Склады;</p>

<p> Запрос.УстановитьПараметр("Субконто", Субконто);<br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 <br>
 <br>
 // Обход результатов запроса, формирование движений в регистр бухгалтерии<br>
 Результат = Запрос.Выполнить();<br>
 <br>
 Если Не Результат.Пустой() Тогда<br>
 Выборка = Результат.Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Проводка отражения отправления товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ТоварыВПути;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ДокументОтправления] = Ссылка;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ДатаПрибытия] = ПланируемаяДатаПрибытия;<br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 <br>
 Проводка.КоличествоДт = Выборка.КоличествоВДокументе;<br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе;<br>
 <br>
 Проводка.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 КонецЦикла;<br>
 <br>
 КонецЕсли; <br>
КонецПроцедуры</p>

<p>7. док Прибытие в Шапку добавить Склад, ДокументОтправления; В ТЧ пусто<br>
в модуле объекта<br>
Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)<br>
 Если ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.Отправление") Тогда<br>
 ДокументОтправления = ДанныеЗаполнения.Ссылка;<br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать(); </p>

<p> // Установка блокировки данных в регистре Управленческий по счету ТоварыВПути и документу отправления<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.ТоварыВПути);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.ДокументОтправления, ДокументОтправления);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Получение остаточных данных по регистру для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | УправленческийОстатки.Субконто2 КАК Номенклатура,<br>
 | УправленческийОстатки.КоличествоОстаток КАК КоличествоОстаток,<br>
 | УправленческийОстатки.СуммаОстаток КАК СуммаОстаток<br>
 |ИЗ<br>
 | РегистрБухгалтерии.Управленческий.Остатки(&МоментВремени, Счет = &СчетТоварыВПути, &Субконто, Субконто1 = &ДокументОтправления) КАК УправленческийОстатки";<br>
 <br>
 Субконто = Новый Массив (2);<br>
 Субконто[0] = ПланыВидовХарактеристик.ВидыСубконто.ДокументОтправления;<br>
 Субконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 <br>
 Запрос.УстановитьПараметр("Субконто", Субконто); <br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТоварыВПути", ПланыСчетов.Управленческий.ТоварыВПути);<br>
 Запрос.УстановитьПараметр("ДокументОтправления", ДокументОтправления);<br>
 <br>
 // Обход результатов запроса, формирование движений в регистр бухгалтерии<br>
 Результат = Запрос.Выполнить();<br>
 <br>
 Если Не Результат.Пустой() Тогда<br>
 Выборка = Результат.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 // Проводка отражения прибытия товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ТоварыВПути;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.ДокументОтправления] = ДокументОтправления;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.ДатаПрибытия] = Дата;<br>
 <br>
 Проводка.КоличествоДт = Выборка.КоличествоОстаток;<br>
 Проводка.КоличествоКт = Выборка.КоличествоОстаток;<br>
 <br>
 Проводка.Сумма = Выборка.СуммаОстаток;<br>
 КонецЦикла;<br>
 КонецЕсли; <br>
КонецПроцедуры</p>

<p>8. Отчет ЗадержкиТовара<br>
Запрос:<br>
ВЫБРАТЬ<br>
 Отправления.СубконтоКт1 КАК Отправитель,<br>
 РАЗНОСТЬДАТ(ВЫРАЗИТЬ(Отправления.СубконтоДт2 КАК ДАТА), ВЫРАЗИТЬ(Прибытия.СубконтоКт2 КАК ДАТА), ДЕНЬ) КАК Задержка,<br>
 Прибытия.СубконтоКт2 КАК ДатаПрибытия,<br>
 Прибытия.СубконтоДт1 КАК Получатель<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетТоварыВПути, &СубконтоТоварыВПути, СчетКт = &СчетТовары, &СубконтоТовары, ) КАК Отправления<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетТовары, &СубконтоТовары, СчетКт = &СчетТоварыВПути, &СубконтоТоварыВПути, ) КАК Прибытия<br>
 ПО Отправления.СубконтоДт1 = Прибытия.СубконтоКт1<br>
 И Отправления.СубконтоДт2 < Прибытия.СубконтоКт2</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 СубконтоТовары ПланВидовХарактеристикСсылка.ВидыСубконто знач = ПланВидовХарактеристик.ВидыСубконто.Склады, огр дост<br>
 СубконтоТоварыВПути ПланВидовХарактеристикСсылка.ВидыСубконто знач = (ПланВидовХарактеристик.ВидыСубконто.ДокументОтправления, ПланВидовХарактеристик.ВидыСубконто.ДатаПрибытия), дост спис, огр дост<br>
 СчетТовары ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.Товары, огр дост<br>
 СчетТоварыВПути ПланСчетовСсылка.Управленческий знач ПланСчетов.Управленческий.ТоварыВПути, огр дост</p>

<p>Группировки<br>
1. Заголовок < Задержки товара, поступившего за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2. <Детальные записи></p>

<p>выб поля Отправитель, Получатель, ДатаПрибытия, Задержка</p>

<p>Выводить параметры = Не выводить</p>

<p>#БУ12</p>

<p>1. Создать спр Склады (и Номенклатура, если нет)</p>

<p>2. добавить ВидНоменклатуры в шапку спр Номенклатура</p>

<p>3. Перечисления.ВидыНоменклатуры Комплектующее, ГотовоеИзделие</p>

<p>4. В ПВХ ВидыСубконто <br>
тип знач хар = СправочникСсылка.Номенклатура, СправочникСсылка.Склады<br>
предопр знач: Номенклатура (СправочникСсылка.Номенклатура), Склады (СправочникСсылка.Склады)</p>

<p>3. В Плане счетов Управленческий добавить признак учета Количественный булево<br>
по счету Товары указать пр.Количественный, Субконто1 = Номенклатура, Субконто2 = Склады, флагов нет<br>
по счету Материалы указать пр.Количественный, Субконто1 = Номенклатура (флагов нет)<br>
по счету ПрибылиУбытки указать Субконто1 = Номенклатура (флаг только обороты = истина)</p>

<p>4. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10.0 (Количественный), Сумма 12,2 (балансовый)<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная, Операция</p>

<p>5. Док ПриходнаяНакладная в Шапку добавить Склад<br>
В модуле объекта<br>
Процедура ОбработкаПроведенияБУ(Отказ)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры КАК ВидНоменклатуры<br>
 |ПОМЕСТИТЬ ВТ_СписокНоменклатуры<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | ВидНоменклатуры<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ВТ_СписокНоменклатуры.Количество КАК Количество,<br>
 | ВТ_СписокНоменклатуры.Сумма КАК Сумма<br>
 |ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры<br>
 |ГДЕ<br>
 | ВТ_СписокНоменклатуры.ВидНоменклатуры = &ВидНоменклатурыКомплектующее<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ВТ_СписокНоменклатуры.Количество КАК Количество,<br>
 | ВТ_СписокНоменклатуры.Сумма КАК Сумма<br>
 |ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры<br>
 |ГДЕ<br>
 | ВТ_СписокНоменклатуры.ВидНоменклатуры = &ВидНоменклатурыГотовоеИзделие";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыКомплектующее", Перечисления.ВидыНоменклатуры.Комплектующее);<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыГотовоеИзделие", Перечисления.ВидыНоменклатуры.ГотовоеИзделие);<br>
 <br>
 МассивРезультатов = Запрос.ВыполнитьПакет();<br>
 <br>
 // Отражение поступления комплектующих<br>
 ВыборкаКомплектующие = МассивРезультатов[1].Выбрать();<br>
 Пока ВыборкаКомплектующие.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Материалы;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = ВыборкаКомплектующие.Количество;<br>
 Движение.Сумма = ВыборкаКомплектующие.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаКомплектующие.Номенклатура;<br>
 КонецЦикла;<br>
 <br>
 // Отражение поступления готовых изделий (компьютеров)<br>
 ВыборкаГотовыеИзделия = МассивРезультатов[2].Выбрать();<br>
 Пока ВыборкаГотовыеИзделия.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = ВыборкаГотовыеИзделия.Количество;<br>
 Движение.Сумма = ВыборкаГотовыеИзделия.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаГотовыеИзделия.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<br>
<p>6. Док РасходнаяНакладная в Шапку добавить Склад<br>
В модуле объекта<br>
Процедура ОбработкаПроведенияБУ(Отказ)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных по счету Товары, складу документа и списку номенклатур табличной части,<br>
 // а также по счету Материалы по списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных; </p>

<p> ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Склады, Склад);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 <br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Материалы);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 <br>
 Блокировка.Заблокировать();</p>

<p> // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры = &ВидНоменклатурыГотовоеИзделие КАК ЭтоГотовоеИзделие<br>
 |ПОМЕСТИТЬ ВТ_СписокНоменклатуры<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры = &ВидНоменклатурыГотовоеИзделие<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ВТ_СписокНоменклатуры.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_СписокНоменклатуры.Количество КАК КоличествоВДокументе,<br>
 | ВТ_СписокНоменклатуры.Сумма КАК СуммаВДокументе,<br>
 | ВЫБОР<br>
 | КОГДА ВТ_СписокНоменклатуры.ЭтоГотовоеИзделие<br>
 | ТОГДА ЕСТЬNULL(УправленческийОстаткиТовары.КоличествоОстаток, 0)<br>
 | ИНАЧЕ ЕСТЬNULL(УправленческийОстаткиМатериалы.КоличествоОстаток, 0)<br>
 | КОНЕЦ КАК КоличествоОстаток,<br>
 | ВЫБОР<br>
 | КОГДА ВТ_СписокНоменклатуры.ЭтоГотовоеИзделие<br>
 | ТОГДА ЕСТЬNULL(УправленческийОстаткиТовары.СуммаОстаток, 0)<br>
 | ИНАЧЕ ЕСТЬNULL(УправленческийОстаткиМатериалы.СуммаОстаток, 0)<br>
 | КОНЕЦ КАК СуммаОстаток,<br>
 | ВТ_СписокНоменклатуры.ЭтоГотовоеИзделие КАК ЭтоГотовоеИзделие<br>
 |ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоНоменклатураСклады,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура<br>
 | ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры<br>
 | ГДЕ<br>
 | ВТ_СписокНоменклатуры.ЭтоГотовоеИзделие)<br>
 | И Субконто2 = &Склад) КАК УправленческийОстаткиТовары<br>
 | ПО ВТ_СписокНоменклатуры.Номенклатура = УправленческийОстаткиТовары.Субконто1<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетМатериалы,<br>
 | &СубконтоНоменклатура,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатуры.Номенклатура КАК Номенклатура<br>
 | ИЗ<br>
 | ВТ_СписокНоменклатуры КАК ВТ_СписокНоменклатуры<br>
 | ГДЕ<br>
 | НЕ ВТ_СписокНоменклатуры.ЭтоГотовоеИзделие)) КАК УправленческийОстаткиМатериалы<br>
 | ПО ВТ_СписокНоменклатуры.Номенклатура = УправленческийОстаткиМатериалы.Субконто1";<br>
 <br>
 СубконтоНоменклатураСклады = Новый Массив(2);<br>
 СубконтоНоменклатураСклады[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 СубконтоНоменклатураСклады[1] = ПланыВидовХарактеристик.ВидыСубконто.Склады;<br>
 <br>
 СубконтоНоменклатура = Новый Массив(1);<br>
 СубконтоНоменклатура[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыГотовоеИзделие", Перечисления.ВидыНоменклатуры.ГотовоеИзделие);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("СубконтоНоменклатураСклады", СубконтоНоменклатураСклады);<br>
 Запрос.УстановитьПараметр("СчетМатериалы", ПланыСчетов.Управленческий.Материалы);<br>
 Запрос.УстановитьПараметр("СубконтоНоменклатура", СубконтоНоменклатура);<br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуре<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 Выборка.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Проводка отражения списания товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 // Установка значения полей имеющих отличную друг от друга логику заполнения по счетам Товары и Материалы<br>
 Если Выборка.ЭтоГотовоеИзделие Тогда<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 Иначе<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Материалы;<br>
 КонецЕсли;<br>
 <br>
 // Установка значения полей, имеющих одинаковую логику заполнения по счетам Товары и Материалы<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки; <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура; <br>
 <br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе;<br>
 Проводка.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 // Проводка отражения продажи<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.Сумма = Выборка.СуммаВДокументе;<br>
 <br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>7. Отчет Продажи<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОбороты.Субконто1 КАК Товар,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ИЛИ УправленческийОбороты.КорСчет = &СчетМатериалы<br>
 ТОГДА УправленческийОбороты.СуммаОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Себестоимость,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетПокупатели<br>
 ТОГДА УправленческийОбороты.СуммаОборотКт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК СуммаПродажи,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ИЛИ УправленческийОбороты.КорСчет = &СчетМатериалы<br>
 ТОГДА УправленческийОбороты.КоличествоКорОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Количество<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Обороты(, , , Счет = &СчетПрибыли, &Субконто, , КорСчет В (&КорСчета), ) КАК УправленческийОбороты</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 КорСчета ПланСчетовСсылка.Управленческий (ПланСчетов.Управленческий.Товары, ПланСчетов.Управленческий.Материалы, ПланСчетов.Управленческий.Покупатели), дост спис, огр дост<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто ПланВидовХарактеристик.ВидыСубконто.Номенклатура, огр дост<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки, огр дост<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки, огр дост<br>
 СчетМатериалы ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Материалы, огр дост<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели, огр дост<br>
 СчетТовары ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Товары, огр дост</p>

<br>
<p>Группировки<br>
1. Заголовок < Продажи товаров за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2. Товар</p>

<p>выб поля Количество, Себестоимость, СуммаПродажи</p>

<p>Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ13</p>

<p>1. добавить ВидНоменклатуры в шапку спр Номенклатура</p>

<p>2. создать справ Склады //и Бригады, если есть в СПР</p>

<p>3. Перечисления.ВидыНоменклатуры Комплект, Деталь</p>

<p>4. В ПВХ ВидыСубконто <br>
тип знач хар = СправочникСсылка.Номенклатура, СправочникСсылка.Склады //и Бригады, если есть в СПР<br>
предопр знач: Номенклатура (СправочникСсылка.Номенклатура), Склады (СправочникСсылка.Склады) //и Бригада, если есть в СПР</p>

<p>5. В Плане счетов Управленческий добавить признак учета Количественный булево<br>
по счету Товары указать пр.Количественный, Субконто1 = Номенклатура, Субконто2 = Склады, флагов нет<br>
по счету ПрибылиУбытки указать Субконто1 = Номенклатура (флаг только обороты = истина) //и субконто2 Бригада, если есть в СПР</p>

<p>6. Создать Регистр сведений СоставыКомплектов (Непериодический, Независимый)<br>
изм: Комплект (СправочникСсылка.Номенклатура, ПараметрыВыбора Отбор.ВидНоменклатуры(Комплект)), Деталь (СправочникСсылка.Номенклатура ПараметрыВыбора Отбор.ВидНоменклатуры(Деталь))<br>
рес: Количество 10.0</p>

<p>7. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10.0 (Количественный), Сумма 12,2 (балансовый)<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная, Операция</p>

<p>8. Док ПриходнаяНакладная в Шапку добавить Склад, в ТЧ СписокНоменклатуры по полю Номенклатура ПараметрыВыбора Отбор.ВидНоменклатуры(Деталь)<br>
В модуле объекта<br>
Процедура ОбработкаПроведенияБУ (Отказ) </p>

<p> // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<p>9. Док РасходнаяНакладная в Шапку добавить Склад (и бригаду, если есть в СПР, но это не факт), в ТЧ СписокНоменклатуры по полю Номенклатура ПараметрыВыбора Отбор.ВидНоменклатуры(Комплект)<br>
В модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Получение данных для установки блокировки (по комплектам табличной части получается список деталей согласно состава комплектов)<br>
 Запрос = Новый Запрос;<br>
 Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;<br>
 <br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Комплект,<br>
 | СоставыКомплектов.Деталь КАК Деталь,<br>
 | ВТ_ТабЧасть.Количество * СоставыКомплектов.Количество КАК Количество,<br>
 | ВТ_ТабЧасть.Сумма КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧастьПоДеталям<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СоставыКомплектов КАК СоставыКомплектов<br>
 | ПО ВТ_ТабЧасть.Номенклатура = СоставыКомплектов.Комплект<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Деталь<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧастьПоДеталям.Деталь КАК Деталь<br>
 |ИЗ<br>
 | ВТ_ТабЧастьПоДеталям КАК ВТ_ТабЧастьПоДеталям";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Результат = Запрос.Выполнить();<br>
 <br>
 // Установка блокировки данных по счету Товары, складу документа и полученному запросом списку деталей<br>
 Блокировка = Новый БлокировкаДанных; <br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Склады, Склад);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = Результат;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Деталь"); <br>
 Блокировка.Заблокировать();</p>

<p> // Получение данных для формирования движений<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ВТ_ТабЧастьПоДеталям.Комплект КАК Комплект,<br>
 | ВТ_ТабЧастьПоДеталям.Деталь КАК Деталь,<br>
 | ПРЕДСТАВЛЕНИЕССЫЛКИ(ВТ_ТабЧастьПоДеталям.Деталь) КАК ДетальПредставление,<br>
 | ВТ_ТабЧастьПоДеталям.Количество КАК НеобходимоеКоличество,<br>
 | ВТ_ТабЧастьПоДеталям.Сумма КАК СуммаВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток<br>
 |ИЗ<br>
 | ВТ_ТабЧастьПоДеталям КАК ВТ_ТабЧастьПоДеталям<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &Субконто,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧастьПоДеталям.Деталь<br>
 | ИЗ<br>
 | ВТ_ТабЧастьПоДеталям)<br>
 | И Субконто2 = &Склад) КАК УправленческийОстатки<br>
 | ПО ВТ_ТабЧастьПоДеталям.Деталь = УправленческийОстатки.Субконто1<br>
 |ИТОГИ<br>
 | МАКСИМУМ(СуммаВДокументе)<br>
 |ПО<br>
 | Комплект";<br>
 <br>
 <br>
 Субконто = Новый Массив(2);<br>
 Субконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 Субконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Склады;<br>
 <br>
 Запрос.УстановитьПараметр("Субконто", Субконто);<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Склад", Склад);</p>

<p> // Обход результатов запроса, формирование движений в регистр бухгалтерии<br>
 ВыборкаПоКомплектам = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаПоКомплектам.Следующий() Цикл<br>
 Выборка = ВыборкаПоКомплектам.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Превышение = Выборка.НеобходимоеКоличество - Выборка.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 // Контроль наличия деталей <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по детали %1 в количестве %2", <br>
 Выборка.ДетальПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Проводка отражения списания товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Комплект;<br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Деталь;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 <br>
 Проводка.КоличествоКт = Выборка.НеобходимоеКоличество; <br>
 Проводка.Сумма = Выборка.НеобходимоеКоличество / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения продажи<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.Период = Дата;<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаПоКомплектам.Комплект;<br>
 //Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Бригады] = Бригада; это для СПР<br>
 Движение.Сумма = ВыборкаПоКомплектам.СуммаВДокументе; <br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>10. Отчет ПродажиКомплектов<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОбороты.Субконто1 КАК Комплект,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ТОГДА УправленческийОбороты.СуммаОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Себестоимость,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетПокупатели<br>
 ТОГДА УправленческийОбороты.СуммаОборотКт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Продажа<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Обороты(, , , Счет = &СчетПрибыли, &СубконтоНоменклатура, , КорСчет В (&КорСчета), ) КАК УправленческийОбороты</p>

<p>рес: все суммовые</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 КорСчета ПланСчетовСсылка.Управленческий (ПланСчетов.Управленческий.Товары, ПланСчетов.Управленческий.Покупатели), дост спис, огр дост<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто ПланВидовХарактеристик.ВидыСубконто.Номенклатура, огр дост<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки, огр дост<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели, огр дост<br>
 СчетТовары ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Товары, огр дост</p>

<br>
<p>Группировки<br>
1. Заголовок < Продажи комплектов за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2. Комплект</p>

<p>выб поля Продажа, Себестоимость</p>

<p>Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ14</p>

<p>1 Создать Перечисления ТипыСборки Значения(Стандарт, НеСтандарт)</p>

<p>1 Создать Перечисления ВидыНоменклатуры Значения(Деталь, Комплект, Услуга?)</p>

<p>2. создать справочник Склады</p>

<p>4. В ПВХ ВидыСубконто <br>
тип знач хар = СправочникСсылка.Номенклатура, СправочникСсылка.Склады, ПеречислениеСсылка.ТипыСборки<br>
предопр знач: Номенклатура (СправочникСсылка.Номенклатура), Склады (СправочникСсылка.Склады), ТипыСборки (ПеречислениеСсылка.ТипыСборки)</p>

<p>5. В Плане счетов Управленческий добавить признак учета Количественный булево<br>
по счету Товары указать пр.Количественный, Субконто1 = Номенклатура, Субконто2 = Склады, Субконто3 = ТипыСборки, флаг обороты для типовСборки = истина<br>
по счету Материалы указать Субконто1 = Номенклатура, субконто2 = Склады, флагов нет</p>

<p>6. Создать Регистр сведений СоставыКомплектов (Непериодический, Независимый)<br>
изм: Комплект (СправочникСсылка.Номенклатура, ПараметрыВыбора Отбор.ВидНоменклатуры(Комплект)), Деталь (СправочникСсылка.Номенклатура ПараметрыВыбора Отбор.ВидНоменклатуры(Деталь))<br>
рес: Количество 10.0</p>

<p>7. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10.0 (Количественный), Сумма 12,2 (балансовый)<br>
регистраторы ПриходнаяНакладная, Сборка, Операция</p>

<p>8. Док ПриходнаяНакладная в Шапку добавить Склад, в ТЧ СписокНоменклатуры по полю Номенклатура ПараметрыВыбора Отбор.ВидНоменклатуры(Деталь)<br>
В модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Материалы;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>9. Док Сборка в Шапку добавить Комплект (Отбор.ВидНоменклатуры(Комплект)), СкладСписания, СкладОприходования, в ТЧ СписокДеталей по полю Деталь ПараметрыВыбора Отбор.ВидНоменклатуры(Комплект)<br>
В модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных по счету Материалы, складу списания документа и списку номенклатур табличной части <br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Материалы);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Склады, СкладСписания);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокДеталей;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Деталь");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Получение данных для формирования движений. На выходе из пакетного запроса - две таблицы с данными, одна используется <br>
 // для определения типа сборки, вторая для формирования движений по списанию материалов и контроля количества материалов<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | СборкаСписокДеталей.Деталь КАК Деталь,<br>
 | СУММА(СборкаСписокДеталей.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_СписокДеталей<br>
 |ИЗ<br>
 | Документ.Сборка.СписокДеталей КАК СборкаСписокДеталей<br>
 |ГДЕ<br>
 | СборкаСписокДеталей.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | СборкаСписокДеталей.Деталь<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Деталь<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | СоставыКомлектов.Деталь КАК Деталь,<br>
 | СоставыКомлектов.Количество КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_СоставКомплекта<br>
 |ИЗ<br>
 | РегистрСведений.СоставыКомлектов КАК СоставыКомлектов<br>
 |ГДЕ<br>
 | СоставыКомлектов.Комплект = &Комплект<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_СписокДеталей.Деталь КАК Деталь<br>
 |ИЗ<br>
 | ВТ_СписокДеталей КАК ВТ_СписокДеталей<br>
 | ПОЛНОЕ СОЕДИНЕНИЕ ВТ_СоставКомплекта КАК ВТ_СоставКомплекта<br>
 | ПО ВТ_СписокДеталей.Деталь = ВТ_СоставКомплекта.Деталь<br>
 |ГДЕ<br>
 | ЕСТЬNULL(ВТ_СписокДеталей.Количество, 0) <> ЕСТЬNULL(ВТ_СоставКомплекта.Количество, 0)<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_СписокДеталей.Деталь КАК Деталь,<br>
 | ВТ_СписокДеталей.Деталь.Представление КАК ДетальПредставление,<br>
 | ВТ_СписокДеталей.Количество КАК КоличествоВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток<br>
 |ИЗ<br>
 | ВТ_СписокДеталей КАК ВТ_СписокДеталей<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетМатериалы,<br>
 | &МассивСубконто,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_СписокДеталей.Деталь КАК Деталь<br>
 | ИЗ<br>
 | ВТ_СписокДеталей КАК ВТ_СписокДеталей)<br>
 | И Субконто2 = &СкладСписания) КАК УправленческийОстатки<br>
 | ПО ВТ_СписокДеталей.Деталь = УправленческийОстатки.Субконто1";<br>
 <br>
 МассивСубконто = Новый Массив(2);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Склады;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("Комплект", Комплект);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетМатериалы", ПланыСчетов.Управленческий.Материалы);<br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто);<br>
 Запрос.УстановитьПараметр("СкладСписания", СкладСписания);<br>
 <br>
 МассивПакетов = Запрос.ВыполнитьПакет();<br>
 <br>
 // Обход результатов запроса, формирование движений по списанию материалов<br>
 РезультатПоОстаткам = МассивПакетов[3];<br>
 Выборка = РезультатПоОстаткам.Выбрать();<br>
 <br>
 СтоимостьМатериалов = 0; // переменная для накопления суммы списанной себестоимости материалов, это будет сумма оприходования комплекта<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 Выборка.ДетальПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Проводка отражения списания материалов<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ОсновноеПроизводство; <br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Материалы; <br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Деталь;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = СкладСписания;<br>
 <br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе;<br>
 Проводка.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 СтоимостьМатериалов = СтоимостьМатериалов + Проводка.Сумма;<br>
 КонецЦикла;<br>
 <br>
 Если Отказ Тогда<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 РезультатТипСборки = МассивПакетов[2];<br>
 ТипСборки = ?(РезультатТипСборки.Пустой(), Перечисления.ТипыСборки.Стандарт, Перечисления.ТипыСборки.НеСтандарт);<br>
 <br>
 // Проводка отражения оприходования собранного комплекта<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ОсновноеПроизводство;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Комплект;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = СкладОприходования;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ТипыСборки] = ТипСборки;<br>
 <br>
 Проводка.КоличествоДт = 1;<br>
 Проводка.Сумма = СтоимостьМатериалов;<br>
КонецПроцедуры</p>

<p>10. Отчет СборкаКомплектов<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОборотыДтКт.СубконтоДт1 КАК Комплект,<br>
 ВЫБОР<br>
 КОГДА УправленческийОборотыДтКт.СубконтоДт2 = &ТипСборкиСтандарт<br>
 ТОГДА УправленческийОборотыДтКт.КоличествоОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Стандарт,<br>
 ВЫБОР<br>
 КОГДА УправленческийОборотыДтКт.СубконтоДт2 = &ТипСборкиНеСтандарт<br>
 ТОГДА УправленческийОборотыДтКт.КоличествоОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК НеСтандарт,<br>
 УправленческийОборотыДтКт.КоличествоОборотДт КАК Собрано<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетТовары, &МассивСубконто, СчетКт = &СчетОсновноеПроизводство, , ) КАК УправленческийОборотыДтКт</p>

<p>рес: НеСтандарт, Собрано, Стандарт</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 КорСчета ПланСчетовСсылка.Управленческий (ПланСчетов.Управленческий.Товары, ПланСчетов.Управленческий.Покупатели), дост спис, огр дост<br>
 МассивСубконто ПланВидовХарактеристикСсылка.ВидыСубконто (ПланВидовХарактеристик.ВидыСубконто.Номенклатура, ПланВидовХарактеристик.ВидыСубконто.ТипыСборки), огр дост, дост спис знач<br>
 СчетОсновноеПроизводство ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ОсновноеПроизводство <br>
 СчетТовары ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Товары, огр дост<br>
 ТипСборкиНеСтандарт СправочникСсылка.Номенклатура,СправочникСсылка.Склады,ПеречислениеСсылка.ТипыСборки Перечисление.ТипыСборки.НеСтандарт, огр дост<br>
 ТипСборкиСтандарт СправочникСсылка.Номенклатура,СправочникСсылка.Склады,ПеречислениеСсылка.ТипыСборки Перечисление.ТипыСборки.Стандарт, огр дост</p>

<p>Группировки<br>
1. Заголовок < Сборка комплектов за период с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2. Комплект</p>

<p>выб поля Собрано, Стандарт, НеСтандарт</p>

<p>Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ15</p>

<p>1. Справочники Номенклатура, ВидНоменклатуры в шапку</p>

<p>2. создать Склады</p>

<p>3. создать спр ЗначенияСвойств владелец - ПВХ СвойстваОбъектов</p>

<p>4. Перечисления МетодыСписания ЛИФО ФИФО</p>

<p>5. Регистры сведений УчетнаяПолитика (В пределах года) рес МетодСписания</p>

<p>6. Регистры сведений ЗначенияСвойств Непериодический Независимый<br>
Измерения Номеклатура, Характеристика (ПланВидовХарактеристикСсылка.СвойстваОбъектов)<br>
Ресурсы Значение (Характеристика.СвойстваОбъектов) связи пар выбора Отбор.Владелец(Характеристика)</p>

<p>7. ПВХ СвойстваОбъектов (Булево, Строка, СправочникСсылка.ЗначенияСвойств, Дата, Число)</p>

<p>8. ПВХ ВидыСубконто (СправочникСсылка.Номенклатура, ДокументСсылка.ПриходнаяНакладная, СправочникСсылка.Склады)<br>
предопр Номенклатура СправочникСсылка.Номенклатура<br>
 Партии ДокументСсылка.ПриходнаяНакладная<br>
 Склады СправочникСсылка.Склады</p>

<p>9. В Плане счетов Управленческий добавить признак учета Количественный булево<br>
по счету Товары указать пр.Количественный, Субконто1 = Номенклатура, Субконто2 = Склады, Субконто3 = Партии, флагов нет<br>
по счету ПрибылиУбытки указать Субконто1 = Номенклатура только обороты</p>

<p>7. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10.0 (Количественный), Сумма 12,2 (балансовый)<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная, Операция</p>

<br>
<p>8. Док ПриходнаяНакладная в ТЧ СписокНоменклатуры добавить Склад, по полю Номенклатура ПараметрыВыбора Отбор.ВидНоменклатуры(Деталь)<br>
В модуле объекта<br>
Процедура ОбработкаПроведенияБУ()<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Склад КАК Склад<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Склад,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Выборка.Склад;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Ссылка;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<p>9. Док РасходнаяНакладная в Шапку добавить Склад<br>
В модуле объекта</p>

<p>Процедура ОбработкаПроведенияБУ(ТекущийМетодФИФО, Отказ)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по списку номенклатур табличной части и складу документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Склады, Склад);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Получение данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 ТекстЗапроса =<br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 | И НЕ РасходнаяНакладнаяСписокНоменклатуры.Номенклатура.ВидНоменклатуры = &ВидНоменклатурыУслуга<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | УправленческийОстатки.Субконто3 КАК Партия,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВЫРАЗИТЬ(УправленческийОстатки.Субконто3 КАК Документ.ПриходнаяНакладная).МоментВремени КАК ПорядокПоПартии<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &МассивСубконто,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)<br>
 | И Субконто2 = &Склад) КАК УправленческийОстатки<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстатки.Субконто1<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ПорядокПоПартии УБЫВ<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | МАКСИМУМ(СуммаВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Если ТекущийМетодФИФО Тогда<br>
 ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "УБЫВ", "");<br>
 КонецЕсли;<br>
 <br>
 Запрос.Текст = ТекстЗапроса;<br>
 <br>
 МассивСубконто = Новый Массив(3);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Склады;<br>
 МассивСубконто[2] = ПланыВидовХарактеристик.ВидыСубконто.Партии;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Склад", Склад);<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("МассивСубконто",МассивСубконто);<br>
 Запрос.УстановитьПараметр("ВидНоменклатурыУслуга", Перечисления.ВидыНоменклатуры.Услуга);<br>
 <br>
 // Обход результатов запроса, формирование движений в регистры <br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); <br>
 Пока ВыборкаНоменклатура.Следующий() Цикл <br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2 (бухгалтерский учет)", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 ВыборкаДетальные = ВыборкаНоменклатура.Выбрать();<br>
 Пока ВыборкаДетальные.Следующий() И ОсталосьСписать <> 0 Цикл<br>
 <br>
 // Проводка отражения списания товара<br>
 Списываем = Мин (ВыборкаДетальные.КоличествоОстаток, ОсталосьСписать);<br>
 <br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаДетальные.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = ВыборкаДетальные.Партия;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = Склад;<br>
 <br>
 Проводка.КоличествоКт = Списываем;<br>
 Проводка.Сумма = Списываем / ВыборкаДетальные.КоличествоОстаток * ВыборкаДетальные.СуммаОстаток;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения продажи<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаНоменклатура.Номенклатура;<br>
 Проводка.Сумма = ВыборкаНоменклатура.СуммаВДокументе;<br>
 <br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>10. Отчет ПродажиБУ<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОборотыДтКт.СубконтоКт1 КАК Товар,<br>
 УправленческийОборотыДтКт.КоличествоОборотКт КАК Количество,<br>
 УправленческийОборотыДтКт.СуммаОборот КАК Себестоимость,<br>
 0 КАК СуммаПродажи<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетПрибыли, , СчетКт = &СчетТовары, &СубконтоНоменклатура, ) КАК УправленческийОборотыДтКт</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 УправленческийОборотыДтКт.СубконтоКт1,<br>
 0,<br>
 0,<br>
 УправленческийОборотыДтКт.СуммаОборот<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетПокупатели, , СчетКт = &СчетПрибыли, &СубконтоНоменклатура, ) КАК УправленческийОборотыДтКт</p>

<p>рес: Количество, Себестоимость, СуммаПродажи</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 СубконтоНоменклатура ПланВидовХарактеристикСсылка.ВидыСубконто ПланВидовХарактеристик.ВидыСубконто.Номенклатура<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки<br>
 СчетТовары ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Товары</p>

<p>Группировки<br>
1. Заголовок <Продажи товаров за период с [НачалоПериода] по [КонецПериода] > Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
Страна Количество Себестоимость Сумма продажи<br>
Товар </p>

<p>2. Товар.Страна (Заголовок) - > Товар // фигня посмотреть в ОУ12 кажись, ты это сам делал</p>

<p>выб поля Собрано, Себестоимость, СуммаПродажи</p>

<p>Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#БУ16</p>

<p>1 Перечисления МетодыСписания ЛИФО ФИФО</p>

<p>2 Перечисления СостоянияТовара Испорченный Исправный</p>

<p>8. ПВХ ВидыСубконто (СправочникСсылка.Номенклатура, ДокументСсылка.ПриходнаяНакладная, ПеречислениеСсылка.СостоянияТовара)<br>
предопр Номенклатура СправочникСсылка.Номенклатура<br>
 Партии ДокументСсылка.ПриходнаяНакладная<br>
 СостоянияТоваров ПеречислениеСсылка.СостоянияТовара</p>

<br>
<p>9. В Плане счетов Управленческий добавить признак учета Количественный булево<br>
по счету Товары указать пр.Количественный, Субконто1 = Номенклатура, Субконто2 = СостоянияТовара , Субконто3 = Партии, флагов нет<br>
по счету ПрибылиУбытки указать Субконто1 = Номенклатура только обороты</p>

<p>5. Регистры сведений УчетнаяПолитика (В пределах года) рес МетодСписания</p>

<p>7. Создать регистр бух Управленческий, корреспонденция = Истина<br>
 рес: Количество 10.0 (Количественный), Сумма 12,2 (балансовый)<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная, Операция</p>

<br>
<p>8. Док ПриходнаяНакладная<br>
В модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)</p>

<p> // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 ИсправныйТовар = Перечисления.СостоянияТовара.Исправный;<br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.СостоянияТоваров] = ИсправныйТовар;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Ссылка;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<br>
<p>9. Док РасходнаяНакладная в Шапку добавить Контрагент<br>
В модуле объекта<br>
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");<br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 ОбработкаПроведенияОУ(Отказ);<br>
 ОбработкаПроведенияБУ(Отказ);<br>
 <br>
КонецПроцедуры</p>

<p>Процедура ОбработкаПроведенияБУ(Отказ)<br>
 <br>
 // Определение текущего метода списания себестоимости<br>
 МетодСписания = РегистрыСведений.УчетнаяПолитика.ПолучитьПоследнее(Дата).МетодСписания;<br>
 Если Не ЗначениеЗаполнено(МетодСписания) Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Не заполнена учетная политика";<br>
 Сообщение.Сообщить();<br>
 Отказ = Истина; <br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ) <br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по списку номенклатур табличной части и состоянию товара Исправный<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.СостоянияТоваров, Перечисления.СостоянияТовара.Исправный);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 ТекстЗапроса = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | УправленческийОстаткиПоПартиям.Субконто3 КАК Партия,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоПартиям.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоПартиям.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВЫРАЗИТЬ(УправленческийОстаткиПоПартиям.Субконто3 КАК Документ.ПриходнаяНакладная).МоментВремени КАК Порядок,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &МассивСубконто,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)<br>
 | И Субконто2 = &ИсправныйТовар) КАК УправленческийОстаткиПоПартиям<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоПартиям.Субконто1<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | Порядок УБЫВ<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | МАКСИМУМ(СуммаВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Если МетодСписания = Перечисления.МетодыСписания.ФИФО Тогда<br>
 ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "УБЫВ", "");<br>
 КонецЕсли; <br>
 <br>
 Запрос.Текст = ТекстЗапроса;<br>
 <br>
 МассивСубконто = Новый Массив(3);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.СостоянияТоваров;<br>
 МассивСубконто[2] = ПланыВидовХарактеристик.ВидыСубконто.Партии;<br>
 <br>
 ИсправныйТовар = Перечисления.СостоянияТовара.Исправный;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто);<br>
 Запрос.УстановитьПараметр("ИсправныйТовар", Перечисления.СостоянияТовара.Исправный);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение);<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 <br>
 // Проводка отражения списания товара<br>
 Списываем = Мин (ОсталосьСписать, Выборка.КоличествоОстаток); <br>
 <br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = Планысчетов.Управленческий.Товары;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Выборка.Партия;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.СостоянияТоваров] = ИсправныйТовар;<br>
 <br>
 Проводка.КоличествоКт = Списываем;<br>
 Проводка.Сумма = Списываем / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки; <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаНоменклатура.Номенклатура;<br>
 Проводка.Сумма = ВыборкаНоменклатура.СуммаВДокументе; <br>
 <br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>10. Отчет Продажи<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОборотыДтКт.СубконтоКт1 КАК Номенклатура,<br>
 УправленческийОборотыДтКт.СуммаОборот КАК СуммаПродано,<br>
 0 КАК Стоимость,<br>
 0 КАК СуммаСписано,<br>
 0 КАК КоличествоПродано,<br>
 0 КАК КоличествоСписано<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетПокупатели, , СчетКт = &СчетПрибыли, &СубконтоНоменклатура, ) КАК УправленческийОборотыДтКт</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 УправленческийОборотыДтКт.СубконтоДт1,<br>
 0,<br>
 ВЫБОР<br>
 КОГДА УправленческийОборотыДтКт.СубконтоКт1 = &ИсправныйТовар<br>
 ТОГДА УправленческийОборотыДтКт.СуммаОборот<br>
 КОНЕЦ,<br>
 ВЫБОР<br>
 КОГДА УправленческийОборотыДтКт.СубконтоКт1 = &ИспорченныйТовар<br>
 ТОГДА УправленческийОборотыДтКт.СуммаОборот<br>
 КОНЕЦ,<br>
 ВЫБОР<br>
 КОГДА УправленческийОборотыДтКт.СубконтоКт1 = &ИсправныйТовар<br>
 ТОГДА УправленческийОборотыДтКт.КоличествоОборотКт<br>
 КОНЕЦ,<br>
 ВЫБОР<br>
 КОГДА УправленческийОборотыДтКт.СубконтоКт1 = &ИспорченныйТовар<br>
 ТОГДА УправленческийОборотыДтКт.КоличествоОборотКт<br>
 КОНЕЦ<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.ОборотыДтКт(, , , СчетДт = &СчетПрибыли, &СубконтоНоменклатура, СчетКт = &СчетТовары, &СубконтоСостояниеТовара, ) КАК УправленческийОборотыДтКт</p>

<p>рес: Количество, КоличествоПродано, КоличествоСписано, СуммаПродано, СуммаСписано</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 СубконтоНоменклатура ПланВидовХарактеристикСсылка.ВидыСубконто ПланВидовХарактеристик.ВидыСубконто.Номенклатура<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки<br>
 СчетТовары ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Товары<br>
 ИсправныйТовар СправочникСсылка.Номенклатура,ДокументСсылка.ПриходнаяНакладная,ПеречислениеСсылка.СостоянияТовара Перечисление.СостоянияТовара.Исправный<br>
 СубконтоСостояниеТовара ПланВидовХарактеристикСсылка.ВидыСубконто ПланВидовХарактеристик.ВидыСубконто.СостоянияТоваров<br>
 ИспорченныйТовар СправочникСсылка.Номенклатура,ДокументСсылка.ПриходнаяНакладная,ПеречислениеСсылка.СостоянияТовара Перечисление.СостоянияТовара.Испорченный<br>
 СубконтоНоменклатура ПланВидовХарактеристикСсылка.ВидыСубконто ПланВидовХарактеристик.ВидыСубконто.Номенклатура</p>

<br>
<p>Группировки<br>
1. Заголовок < Продажи с [НачалоПериода] по [КонецПериода] > Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
Номенклатура "Себест-ть продаж" "Продажа кол./сумма" "Списано кол./сумма" </p>

<p>2. Номенклатура</p>

<p>выб поля Стоимость, Продажа вертикаль (КоличествоПродано, СуммаПродано), Списано вертиткаль (КоличествоСписано, СуммаСписано)</p>

<p>Выводить параметры = Не выводить</p>

<p>#БУдоп1</p>

<p>1. Создать спр СвойстваНоменклатуры (владелец справочник.Номенклатура)</p>

<p>2. Создать спр ЗначенияХарактеристик (владелец ПВХ ХарактеристикиОбъектов)</p>

<p>3. Создать ПВХ ХарактеристикиОбъектов (СправочникСсылка.ЗначенияХарактеристик, Булево, Строка, Дата, Число)</p>

<p>4. Создвть Регистр сведений ЗначенияХарактеристикНоменклатур<br>
Измерения: СвойствоНоменклатуры (СправочникСсылка.СвойстваНоменклатуры) ведущее<br>
 Характеристика (ПланВидовХарактеристикСсылка.ХарактеристикиОбъектов)<br>
Ресурсы: Значение (Характеристика.ХарактеристикиОбъектов) связи параметров выбора: Отбор.Владелец(Характеристика)</p>

<p>5. В ПВХ ВидыСубконто добавить предопределенный вид субконто СвойстваНоменклатуры (СправочникСсылка.СвойстваНоменклатуры)<br>
Тип значения характеристик составной: Дата, СправочникСсылка.Номенклатура</p>

<p>6. В плане счетов "Управленческий" добавить признак учета "Количественный" (Булево)<br>
Указать макс колво субконто - 2<br>
По счету товары указать признак учета Количественный = Истина<br>
Добавить виды субконто Номенклатура и СвойстваНоменклатуры<br>
По счету товары ПрибылиУбытки добавить виды субконто Номенклатура и СвойстваНоменклатуры (оба только обороты)</p>

<p>7. Создать регистр бухгалтерии "Управленческий", указать план счетов: Управленческий, включить флаг "Корреспонденция"<br>
создать ресурсы "Количество" (Признак учета Количественный), "Сумма" (флаг Балансовый)</p>

<p>9. Документ ПриходнаяНакладная в ТЧ СписокНоменклатуры добавить рекв СвойствоНоменклатуры (СправочникСсылка.СвойстваНоменклатуры) связи параметров выбора: Отбор.Владелец(СписокНоменклатуры.Номенклатура)<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры КАК СвойствоНоменклатуры,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.СвойстваНоменклатуры] = Выборка.СвойствоНоменклатуры;<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>10. Документ РасходнаяНакладная в ТЧ СписокНоменклатуры добавить рекв СвойствоНоменклатуры (СправочникСсылка.СвойстваНоменклатуры) связи параметров выбора: Отбор.Владелец(СписокНоменклатуры.Номенклатура)<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ)</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по счету Товары, списку номенклатур и свойств табличной части документа<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары); <br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.СвойстваНоменклатуры, "СвойствоНоменклатуры");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры КАК СвойствоНоменклатуры,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | РасходнаяНакладнаяСписокНоменклатуры.СвойствоНоменклатуры<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура,<br>
 | СвойствоНоменклатуры<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ТабЧасть.СвойствоНоменклатуры КАК СвойствоНоменклатуры,<br>
 | ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ТабЧасть.СвойствоНоменклатуры.Представление КАК СвойствоНоменклатурыПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &МассивСубконто,<br>
 | (Субконто1, Субконто2) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.СвойствоНоменклатуры КАК СвойствоНоменклатуры<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК УправленческийОстатки<br>
 | ПО ТабЧасть.Номенклатура = УправленческийОстатки.Субконто1<br>
 | И ТабЧасть.СвойствоНоменклатуры = УправленческийОстатки.Субконто2";<br>
 <br>
 МассивСубконто = Новый Массив (2);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.СвойстваНоменклатуры;<br>
 <br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто); <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 <br>
 Если Превышение > 0 Тогда<br>
 <br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон ("Превышение остатка по номенклатуре %1, свойству %2 в количестве %3",<br>
 Выборка.НоменклатураПредставление, Выборка.СвойствоНоменклатурыПредставление, Превышение); <br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Проводка отражения списания товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.Товары;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.СвойстваНоменклатуры] = Выборка.СвойствоНоменклатуры;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.СвойстваНоменклатуры] = Выборка.СвойствоНоменклатуры;<br>
 <br>
 Проводка.КоличествоКт = Выборка.КоличествоВДокументе;<br>
 Проводка.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;</p>

<p> // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели; <br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки; <br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.СвойстваНоменклатуры] = Выборка.СвойствоНоменклатуры;<br>
 <br>
 Проводка.Сумма = Выборка.СуммаВДокументе;<br>
 <br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>11. Отчет Продажи<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОбороты.Субконто1 КАК Номенклатура,<br>
 УправленческийОбороты.Субконто2 КАК СвойствоНоменклатуры,<br>
 ЗначенияХарактеристикНоменклатур.Значение КАК ЗначениеХарактеристики,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ТОГДА УправленческийОбороты.КоличествоКорОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК КоличествоПродано,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ТОГДА УправленческийОбороты.СуммаОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Себестоимость,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетПокупатели<br>
 ТОГДА УправленческийОбороты.СуммаОборотКт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК СуммаПродано<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Обороты(, , , Счет = &СчетПрибыли, &Субконто, , КорСчет В (&СчетТовары, &СчетПокупатели), ) КАК УправленческийОбороты<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияХарактеристикНоменклатур КАК ЗначенияХарактеристикНоменклатур<br>
 ПО УправленческийОбороты.Субконто2 = ЗначенияХарактеристикНоменклатур.СвойствоНоменклатуры<br>
 ГДЕ ЗначенияХарактеристикНоменклатур.Характеристика = &Характеристика</p>

<p>ресурсы<br>
 Себестоимость, СуммаПродано, КоличествоПродано (все расч по номенклатуре)</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто (ПланВидовХарактеристик.ВидыСубконто.Номенклатура,ПланВидовХарактеристик.ВидыСубконто.СвойстваНоменклатуры) дост спис знач<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки<br>
 СчетТовары ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Товары<br>
 Характеристика ПланВидовХарактеристикСсылка.ХарактеристикиОбъектов</p>

<p>Группировки <br>
1 Заголовок <Продажи с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2 ЗначениеХарактеристики -> Номенклатура</p>

<p>Для группировки "<Дополнительная информация> (Заголовок)" Вариант использования группировки - Дополнительная информация<br>
ПКМ, Установить имя "Заголовок". </p>

<p>Отчет Выбранные поля - Себест-ть (Себестоимость)<br>
 Продажа кол./сумма (вертикально) (КоличествоПродано), (СуммаПродано)</p>

<p>Расположение полей группировок - Отдельно и только в итогах<br>
Расположение общих итогов по вертикали - Нет<br>
Выводить параметры - Не выводить<br>
Параметр Период, Характеристика включить в пользовательские настройки.</p>

<br>
<p>7. Создать Документ Операция, движения по регистру Управленческий, Проведение Запретить, Создать ФормуДокумента, добавить Движения, вытащить дату в шапку</p>

<p>В модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 НаборЗаписей = Движения.Управленческий;</p>

<p> Если Не ЭтоНовый() И Не НаборЗаписей.Модифицированность() Тогда<br>
 НаборЗаписей.Прочитать();<br>
 КонецЕсли; </p>

<p> Если НаборЗаписей.Количество() > 0 Тогда<br>
 НаборЗаписей.УстановитьАктивность(Не ПометкаУдаления);<br>
 КонецЕсли;<br>
 <br>
 НаборЗаписей.Записывать = Истина;<br>
КонецПроцедуры</p>

<p>#БУдоп2</p>

<p>1. Перечисления МетодыСписания ЛИФО ФИФО</p>

<p>2. В ПВХ ВидыСубконто добавить предопределенный вид субконто ДокументыПродажи (ДокументСсылка.РасходнаяНакладная), Номенклатура (СправочникСсылка.Номенклатура), Партии (ДокументСсылка.ПриходнаяНакладная)<br>
Тип значения характеристик составной: СправочникСсылка.Номенклатура, ДокументСсылка.ПриходнаяНакладная, ДокументСсылка.РасходнаяНакладная</p>

<p>3. В плане счетов "Управленческий" добавить признак учета "Количественный" (Булево)<br>
Указать макс колво субконто - 2<br>
По счету товары указать признак учета Количественный = Истина, Добавить виды субконто Номенклатура, Партии<br>
По счету ПрибылиУбытки добавить виды субконто Номенклатура и ДокументыПродажи (оба только обороты)</p>

<p>4. Создать регистр бухгалтерии "Управленческий", указать план счетов: Управленческий, включить флаг "Корреспонденция"<br>
создать ресурсы "Количество" (Признак учета Количественный), "Сумма" (флаг Балансовый)<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная, Операция</p>

<br>
<p>9. Документ ПриходнаяНакладная в шапку добавить рекв ДокументПродажи (ДокументСсылка.РасходнаяНакладная), ВозвратТовара булево<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)</p>

<p> // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Если ВозвратТовара Тогда <br>
 <br>
 // Контроль сроков возврата<br>
 Если Дата - ДокументПродажи.Дата > 3 * 86400 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "С момента продажи прошло более трех дней. Возврат запрещен.";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 // Запись пустого набора, чтобы при получении данных из таблицы итогов не учесть движения самого документа<br>
 Движения.Управленческий.Записать(); <br>
 <br>
 // Установка блокировки данных в регистре Управленческий по списку номенклатур табличной части и документу продажи<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.ПрибылиУбытки);<br>
 ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.ДокументыПродажи, ДокументПродажи); <br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество<br>
 |ПОМЕСТИТЬ ВТ_СписокНоменклатур<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатур.Номенклатура КАК Номенклатура,<br>
 | ВТ_СписокНоменклатур.Количество КАК КоличествоВДокументе,<br>
 | ЕСТЬNULL(УправленческийОборотыДтКт_Продажи.КоличествоОборотКт, 0) - ЕСТЬNULL(УправленческийОборотыДтКт_Возвраты.КоличествоОборотДт, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОборотыДтКт_Продажи.СуммаОборот, 0) - ЕСТЬNULL(УправленческийОборотыДтКт_Возвраты.СуммаОборот, 0) КАК СуммаОстаток,<br>
 | ВТ_СписокНоменклатур.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | ВТ_СписокНоменклатур КАК ВТ_СписокНоменклатур<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.ОборотыДтКт(<br>
 | ,<br>
 | &МоментВремени,<br>
 | ,<br>
 | СчетДт = &СчетПрибыли,<br>
 | &МассивСубконто,<br>
 | СчетКт = &СчетТовары,<br>
 | ,<br>
 | СубконтоДт1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатур.Номенклатура КАК Номенклатура<br>
 | ИЗ<br>
 | ВТ_СписокНоменклатур КАК ВТ_СписокНоменклатур)<br>
 | И СубконтоДт2 = &ДокументПродажи) КАК УправленческийОборотыДтКт_Продажи<br>
 | ПО ВТ_СписокНоменклатур.Номенклатура = УправленческийОборотыДтКт_Продажи.СубконтоДт1<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.ОборотыДтКт(<br>
 | ,<br>
 | &МоментВремени,<br>
 | ,<br>
 | СчетДт = &СчетТовары,<br>
 | ,<br>
 | СчетКт = &СчетПрибыли,<br>
 | &МассивСубконто,<br>
 | СубконтоКт1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_СписокНоменклатур.Номенклатура КАК Номенклатура<br>
 | ИЗ<br>
 | ВТ_СписокНоменклатур КАК ВТ_СписокНоменклатур)<br>
 | И СубконтоКт2 = &ДокументПродажи) КАК УправленческийОборотыДтКт_Возвраты<br>
 | ПО ВТ_СписокНоменклатур.Номенклатура = УправленческийОборотыДтКт_Возвраты.СубконтоКт1";<br>
 <br>
 МассивСубконто = Новый Массив(2);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.ДокументыПродажи;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("СчетПрибыли", ПланыСчетов.Управленческий.ПрибылиУбытки);<br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто);<br>
 Запрос.УстановитьПараметр("ДокументПродажи", ДокументПродажи);<br>
 <br>
 // Обход результатов запроса<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 // Контроль непревышения возвращаемой номенклатуры над проданной<br>
 Превышение = Выборка.КоличествоВДокументе - Выборка.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение возврата по номенклатуре %1 в количестве %2", <br>
 Выборка.НоменклатураПредставление, Превышение);<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 <br>
 // Проводка отражения возврата товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Проводка.СчетКт = Планысчетов.Управленческий.ПрибылиУбытки;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Ссылка;<br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура; <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.ДокументыПродажи] = ДокументПродажи; <br>
 <br>
 Проводка.КоличествоДт = Выборка.КоличествоВДокументе;<br>
 Проводка.Сумма = Выборка.КоличествоВДокументе / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 КонецЦикла;<br>
 <br>
 Иначе // Обычное поступление товара<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать(); <br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Ссылка;<br>
 КонецЦикла;<br>
 <br>
 КонецЕсли;</p>

<p>КонецПроцедуры</p>

<p>10. Документ РасходнаяНакладная <br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)</p>

<p> // Определение текущего метода списания себестоимости<br>
 МетодСписания = РегистрыСведений.УчетнаяПолитика.ПолучитьПоследнее(Дата).МетодСписания;<br>
 Если Не ЗначениеЗаполнено(МетодСписания) Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Не заполнена учетная политика";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина; <br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ) <br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 ТекстЗапроса = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | УправленческийОстаткиПоПартиям.Субконто2 КАК Партия,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоПартиям.КоличествоОстаток, 0) КАК КоличествоОстаток,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоПартиям.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВЫРАЗИТЬ(УправленческийОстаткиПоПартиям.Субконто2 КАК Документ.ПриходнаяНакладная).МоментВремени КАК Порядок,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &МассивСубконто,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК УправленческийОстаткиПоПартиям<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоПартиям.Субконто1<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | Порядок УБЫВ<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | МАКСИМУМ(СуммаВДокументе),<br>
 | СУММА(КоличествоОстаток)<br>
 |ПО<br>
 | Номенклатура";<br>
 <br>
 Если МетодСписания = Перечисления.МетодыСписания.ФИФО Тогда<br>
 ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "УБЫВ", "");<br>
 КонецЕсли; <br>
 <br>
 Запрос.Текст = ТекстЗапроса;<br>
 <br>
 МассивСубконто = Новый Массив(2);<br>
 МассивСубконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 МассивСубконто[1] = ПланыВидовХарактеристик.ВидыСубконто.Партии;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("МассивСубконто", МассивСубконто);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение);<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 Выборка = ВыборкаНоменклатура.Выбрать();<br>
 Пока Выборка.Следующий() и ОсталосьСписать <> 0 Цикл<br>
 <br>
 // Проводка отражения списания товара<br>
 Списываем = Мин (ОсталосьСписать, Выборка.КоличествоОстаток); <br>
 <br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = Планысчетов.Управленческий.Товары;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ДокументыПродажи] = Ссылка;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Выборка.Партия; <br>
 <br>
 Проводка.КоличествоКт = Списываем;<br>
 Проводка.Сумма = Списываем / Выборка.КоличествоОстаток * Выборка.СуммаОстаток;<br>
 <br>
 ОсталосьСписать = ОсталосьСписать - Списываем;<br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки; <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаНоменклатура.Номенклатура;<br>
 Проводка.Сумма = ВыборкаНоменклатура.СуммаВДокументе; <br>
 <br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>11. Отчет Продажи<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОбороты.Субконто1 КАК Номенклатура,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ТОГДА УправленческийОбороты.КоличествоКорОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК КоличествоПродано,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ТОГДА УправленческийОбороты.СуммаОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Себестоимость,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ТОГДА УправленческийОбороты.КоличествоКорОборотКт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК КоличествоВозвращено,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 ТОГДА УправленческийОбороты.СуммаОборотКт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК СуммаВозвращено,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетПокупатели<br>
 ТОГДА УправленческийОбороты.СуммаОборотКт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК СуммаПродано<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Обороты(, , , Счет = &СчетПрибыли, &Субконто, , КорСчет В (&СчетТовары, &СчетПокупатели), ) КАК УправленческийОбороты</p>

<p>ресурсы<br>
 Себестоимость, СуммаПродано, КоличествоПродано, КоличествоВозвращено, СуммаВозвращено</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 Субконто ПланВидовХарактеристикСсылка.ВидыСубконто ПланВидовХарактеристик.ВидыСубконто.Номенклатура<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки<br>
 СчетТовары ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Товары<br>
 Характеристика ПланВидовХарактеристикСсылка.ХарактеристикиОбъектов</p>

<p>Группировки <br>
1 Заголовок < Продажи с [НачалоПериода] по [КонецПериода] > Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = Д"), Формат (ПараметрыДанных.КонецПериода, "ДЛФ = Д")<br>
2 Номенклатура</p>

<p>Для группировки "<Дополнительная информация> (Заголовок)" Вариант использования группировки - Дополнительная информация<br>
ПКМ, Установить имя "Заголовок". </p>

<p>Отчет Выбранные поля - Себест-ть (Себестоимость)<br>
 Продажа кол./сумма (вертикально) (КоличествоПродано), (СуммаПродано)<br>
 Возврат кол./сумма (вертикально) (КоличествоВозвращено), (СуммаВозвращено)</p>

<p>//Расположение полей группировок - Отдельно и только в итогах<br>
Расположение общих итогов по вертикали - Нет<br>
Выводить параметры - Не выводить<br>
Параметр Период включить в пользовательские настройки.</p>

<br>
<p>7. Создать Документ Операция, движения по регистру Управленческий, Проведение Запретить, Создать ФормуДокумента, добавить Движения, вытащить дату в шапку</p>

<p>В модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 НаборЗаписей = Движения.Управленческий;</p>

<p> Если Не ЭтоНовый() И Не НаборЗаписей.Модифицированность() Тогда<br>
 НаборЗаписей.Прочитать();<br>
 КонецЕсли; </p>

<p> Если НаборЗаписей.Количество() > 0 Тогда<br>
 НаборЗаписей.УстановитьАктивность(Не ПометкаУдаления);<br>
 КонецЕсли;<br>
 <br>
 НаборЗаписей.Записывать = Истина;<br>
КонецПроцедуры</p>

<p>#БУдоп3</p>

<p>1. Справочники Номенклатура Реквизиты СрокГодностиВДнях 5.0</p>

<p>2. Перечисления МетодыСписания ПоСредней ФИФО</p>

<p>3. В ПВХ ВидыСубконто добавить предопределенный вид субконто Номенклатура (СправочникСсылка.Номенклатура), Партии (ДокументСсылка.ПриходнаяНакладная), СписаниеПросроченногоТовара (булево), СрокиГодности (Дата)<br>
Тип значения характеристик составной: СправочникСсылка.Номенклатура, Булево, ДокументСсылка.ПриходнаяНакладная, Дата</p>

<p>4. В плане счетов "Управленческий" добавить признак учета "Количественный" (Булево), Признак учета субконто Суммовой (Булево)<br>
Указать макс колво субконто - 3<br>
По счету товары указать признак учета Количественный = Истина, Добавить виды субконто (Номенклатура, Партии - только обороты), СрокГодности<br>
По счету ПрибылиУбытки добавить виды субконто Номенклатура и СписаниеПросроченногоТовара (оба только обороты и суммовой)</p>

<p>5. Создать регистр бухгалтерии "Управленческий", указать план счетов: Управленческий, включить флаг "Корреспонденция"<br>
создать ресурсы "Количество" (Признак учета Количественный), "Сумма" (флаг Балансовый)<br>
регистраторы ПриходнаяНакладная, РасходнаяНакладная, Операция</p>

<p>6. Документ ПриходнаяНакладная <br>
в модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ<br>
 <br>
 // Определение текущего метода списания себестоимости<br>
 МетодСписания = РегистрыСведений.УчетнаяПолитика.ПолучитьПоследнее(Дата).МетодСписания;<br>
 <br>
 Если Не ЗначениеЗаполнено(МетодСписания) Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "Не заполнен метод списания учетной политики";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли; <br>
 <br>
 // Если текущий метод - по среднему, тогда в качестве партии устанавливаем пустую ссылку, иначе - текущий документ<br>
 Партия = ?(МетодСписания = Перечисления.МетодыСписания.ПоСредней, Документы.ПриходнаяНакладная.ПустаяСсылка(), Ссылка);</p>

<p> Движения.Управленческий.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | ДОБАВИТЬКДАТЕ(&Дата, ДЕНЬ, ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура.СрокГодностиВДнях) КАК СрокГодности,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(ПриходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ИЗ<br>
 | Документ.ПриходнаяНакладная.СписокНоменклатуры КАК ПриходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура,<br>
 | ДОБАВИТЬКДАТЕ(&Дата, ДЕНЬ, ПриходнаяНакладнаяСписокНоменклатуры.Номенклатура.СрокГодностиВДнях)";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("Дата", Дата);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.Управленческий.Добавить();<br>
 Движение.СчетДт = ПланыСчетов.Управленческий.Товары;<br>
 Движение.СчетКт = ПланыСчетов.Управленческий.Поставщики;<br>
 Движение.Период = Дата;<br>
 Движение.КоличествоДт = Выборка.Количество;<br>
 Движение.Сумма = Выборка.Сумма;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.СрокиГодности] = Выборка.СрокГодности;<br>
 Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = Партия;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<br>
<p>7. Документ РасходнаяНакладная <br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ УПРАВЛЕНЧЕСКИЙ (СТАРАЯ МЕТОДИКА ПРОВЕДЕНИЯ) <br>
 <br>
 Движения.Управленческий.Записывать = Истина;<br>
 Движения.Управленческий.Записать();<br>
 <br>
 // Установка блокировки данных в регистре Управленческий по списку номенклатур табличной части<br>
 Блокировка = Новый БлокировкаДанных;<br>
 ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");<br>
 ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Товары);<br>
 ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;<br>
 ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;<br>
 ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");<br>
 Блокировка.Заблокировать();<br>
 <br>
 // Запрос получения данных для формирования движений<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,<br>
 | СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть<br>
 |ИЗ<br>
 | Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры<br>
 |ГДЕ<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | РасходнаяНакладнаяСписокНоменклатуры.Номенклатура<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Номенклатура<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура,<br>
 | ВТ_ТабЧасть.Номенклатура.Представление КАК НоменклатураПредставление,<br>
 | ВТ_ТабЧасть.Количество КАК КоличествоВДокументе,<br>
 | ВТ_ТабЧасть.Сумма КАК СуммаВДокументе,<br>
 | УправленческийОстаткиПоПартиямИСрокамГодности.Субконто2 КАК Партия,<br>
 | УправленческийОстаткиПоПартиямИСрокамГодности.Субконто3 КАК СрокГодности,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоПартиямИСрокамГодности.КоличествоОстаток, 0) КАК КоличествоОстатокПоСрокуГодности,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоПартиям.КоличествоОстаток, 0) КАК КоличествоОстатокПоПартии,<br>
 | ЕСТЬNULL(УправленческийОстаткиПоПартиям.СуммаОстаток, 0) КАК СуммаОстаток,<br>
 | ВЫРАЗИТЬ(УправленческийОстаткиПоПартиямИСрокамГодности.Субконто2 КАК Документ.ПриходнаяНакладная).МоментВремени КАК МоментВремениПартии<br>
 |ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | Счет = &СчетТовары,<br>
 | &СубконтоПартииСрокиГодности,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)<br>
 | И Субконто3 > &Дата) КАК УправленческийОстаткиПоПартиямИСрокамГодности<br>
 | ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(<br>
 | &МоментВремени,<br>
 | ,<br>
 | &СубконтоПартии,<br>
 | Субконто1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть.Номенклатура КАК Номенклатура<br>
 | ИЗ<br>
 | ВТ_ТабЧасть КАК ВТ_ТабЧасть)) КАК УправленческийОстаткиПоПартиям<br>
 | ПО УправленческийОстаткиПоПартиямИСрокамГодности.Субконто1 = УправленческийОстаткиПоПартиям.Субконто1<br>
 | И УправленческийОстаткиПоПартиямИСрокамГодности.Субконто2 = УправленческийОстаткиПоПартиям.Субконто2<br>
 | ПО ВТ_ТабЧасть.Номенклатура = УправленческийОстаткиПоПартиямИСрокамГодности.Субконто1<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | МоментВремениПартии,<br>
 | СрокГодности<br>
 |ИТОГИ<br>
 | МАКСИМУМ(КоличествоВДокументе),<br>
 | МАКСИМУМ(СуммаВДокументе),<br>
 | СУММА(КоличествоОстатокПоСрокуГодности),<br>
 | МАКСИМУМ(КоличествоОстатокПоПартии),<br>
 | МАКСИМУМ(СуммаОстаток)<br>
 |ПО<br>
 | Номенклатура,<br>
 | Партия";<br>
 <br>
 СубконтоПартииСрокиГодности = Новый Массив(3);<br>
 СубконтоПартииСрокиГодности[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 СубконтоПартииСрокиГодности[1] = ПланыВидовХарактеристик.ВидыСубконто.Партии;<br>
 СубконтоПартииСрокиГодности[2] = ПланыВидовХарактеристик.ВидыСубконто.СрокиГодности;<br>
 <br>
 СубконтоПартии = Новый Массив(2);<br>
 СубконтоПартии[0] = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;<br>
 СубконтоПартии[1] = ПланыВидовХарактеристик.ВидыСубконто.Партии;<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("МоментВремени", МоментВремени());<br>
 Запрос.УстановитьПараметр("Дата", Дата);<br>
 Запрос.УстановитьПараметр("СчетТовары", ПланыСчетов.Управленческий.Товары);<br>
 Запрос.УстановитьПараметр("СубконтоПартииСрокиГодности", СубконтоПартииСрокиГодности);<br>
 Запрос.УстановитьПараметр("СубконтоПартии", СубконтоПартии);<br>
 <br>
 // Обход результатов запроса<br>
 ВыборкаНоменклатура = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаНоменклатура.Следующий() Цикл<br>
 // Контроль наличия номенклатуры<br>
 Превышение = ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстатокПоСрокуГодности;<br>
 Если Превышение > 0 Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = СтрШаблон("Превышение остатка по номенклатуре %1 в количестве %2", <br>
 ВыборкаНоменклатура.НоменклатураПредставление, Превышение);<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 КонецЕсли;<br>
 <br>
 Если Отказ Тогда <br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 // Переменная для прерывания обхода партий после того как будет списано все количество из документа<br>
 ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе;<br>
 <br>
 ВыборкаПартии = ВыборкаНоменклатура.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаПартии.Следующий() Цикл<br>
 <br>
 // Эти переменные будем использовать при расчете себестоимости списания<br>
 КоличествоПоПартии = ВыборкаПартии.КоличествоОстатокПоПартии;<br>
 СуммаПоПартии = ВыборкаПартии.СуммаОстаток; <br>
 <br>
 // С помощью этих переменных будем контролировать, чтобы при списании всего количества по партии, <br>
 // суммовой остаток по партии также был списан полностью<br>
 КоличественныйОстатокПоПартии = ВыборкаПартии.КоличествоОстатокПоПартии;<br>
 СуммовойОстатокПоПартии = ВыборкаПартии.СуммаОстаток;<br>
 <br>
 ВыборкаДетальные = ВыборкаПартии.Выбрать();<br>
 Пока ВыборкаДетальные.Следующий() И ОсталосьСписать <> 0 Цикл<br>
 <br>
 // Проводка отражения списания товара<br>
 КоличествоСписываем = Мин (ОсталосьСписать, ВыборкаДетальные.КоличествоОстатокПоСрокуГодности); <br>
 <br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата; <br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.ПрибылиУбытки;<br>
 Проводка.СчетКт = Планысчетов.Управленческий.Товары;<br>
 <br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаДетальные.Номенклатура;<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.СписаниеПросроченногоТовара] = Ложь;<br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаДетальные.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Партии] = ВыборкаДетальные.Партия;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.СрокиГодности] = ВыборкаДетальные.СрокГодности;<br>
 <br>
 Проводка.КоличествоКт = КоличествоСписываем; <br>
 Если КоличествоСписываем = КоличественныйОстатокПоПартии Тогда<br>
 СуммаСписываем = СуммовойОстатокПоПартии;<br>
 Иначе<br>
 СуммаСписываем = КоличествоСписываем / КоличествоПоПартии * СуммаПоПартии;<br>
 КонецЕсли; <br>
 <br>
 Проводка.Сумма = СуммаСписываем;<br>
 <br>
 КоличественныйОстатокПоПартии = КоличественныйОстатокПоПартии - КоличествоСписываем;<br>
 СуммовойОстатокПоПартии = СуммовойОстатокПоПартии - Проводка.Сумма; <br>
 <br>
 ОсталосьСписать = ОсталосьСписать - КоличествоСписываем;<br>
 КонецЦикла;<br>
 КонецЦикла;<br>
 <br>
 // Проводка отражения продажи товара<br>
 Проводка = Движения.Управленческий.Добавить();<br>
 <br>
 Проводка.Период = Дата;<br>
 Проводка.СчетДт = ПланыСчетов.Управленческий.Покупатели;<br>
 Проводка.СчетКт = ПланыСчетов.Управленческий.ПрибылиУбытки; <br>
 <br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = ВыборкаНоменклатура.Номенклатура;<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.СписаниеПросроченногоТовара] = Ложь;<br>
 <br>
 Проводка.Сумма = ВыборкаНоменклатура.СуммаВДокументе; <br>
 <br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p>

<p>8. Отчет Продажи<br>
Запрос:<br>
ВЫБРАТЬ<br>
 УправленческийОбороты.Субконто1 КАК Номенклатура,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетПокупатели<br>
 ТОГДА УправленческийОбороты.СуммаОборотКт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК СуммаПродано,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 И УправленческийОбороты.Субконто2 = ЛОЖЬ<br>
 ТОГДА УправленческийОбороты.СуммаОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК Себестоимость,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 И УправленческийОбороты.Субконто2 = ЛОЖЬ<br>
 ТОГДА УправленческийОбороты.КоличествоКорОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК КоличествоПродано,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 И УправленческийОбороты.Субконто2 = ИСТИНА<br>
 ТОГДА УправленческийОбороты.СуммаОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК СуммаСписано,<br>
 ВЫБОР<br>
 КОГДА УправленческийОбороты.КорСчет = &СчетТовары<br>
 И УправленческийОбороты.Субконто2 = ИСТИНА<br>
 ТОГДА УправленческийОбороты.КоличествоКорОборотДт<br>
 ИНАЧЕ 0<br>
 КОНЕЦ КАК КоличествоСписано<br>
ИЗ<br>
 РегистрБухгалтерии.Управленческий.Обороты(, , , Счет = &СчетПрибыли, &МассивСубконто, , КорСчет В (&СчетТовары, &СчетПокупатели), ) КАК УправленческийОбороты</p>

<p>ресурсы<br>
 Себестоимость, СуммаПродано, КоличествоПродано, КоличествоСписано, СуммаСписано</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод<br>
 МассивСубконто ПланВидовХарактеристикСсылка.ВидыСубконто (ПланВидовХарактеристик.ВидыСубконто.Номенклатура, ПланВидовХарактеристик.ВидыСубконто.СписаниеПросроченногоТовара) дост спис знач<br>
 СчетПокупатели ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Покупатели<br>
 СчетПрибыли ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.ПрибылиУбытки<br>
 СчетТовары ПланСчетовСсылка.Управленческий ПланСчетов.Управленческий.Товары</p>

<p>Группировки <br>
1 Номенклатура</p>

<p>макет Номенклатура "Себестоимость продаж" "Продажа кол./сумма" "Списано кол./сумма"</p>

<p>Отчет Выбранные поля - Себест-ть (Себестоимость)<br>
 Продажа кол./сумма (вертикально) (КоличествоПродано), (СуммаПродано)<br>
 Возврат кол./сумма (вертикально) (КоличествоСписано), (СуммаСписано)</p>

<p>//Расположение полей группировок - Отдельно и только в итогах<br>
Расположение общих итогов по вертикали - Нет<br>
Выводить параметры - Не выводить<br>
Параметр Период включить в пользовательские настройки.</p>

<br>
<p>9. Создать Документ Операция, движения по регистру Управленческий, Проведение Запретить, Создать ФормуДокумента, добавить Движения, вытащить дату в шапку</p>

<p>В модуле объекта</p>

<p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)<br>
 НаборЗаписей = Движения.Управленческий;</p>

<p> Если Не ЭтоНовый() И Не НаборЗаписей.Модифицированность() Тогда<br>
 НаборЗаписей.Прочитать();<br>
 КонецЕсли; </p>

<p> Если НаборЗаписей.Количество() > 0 Тогда<br>
 НаборЗаписей.УстановитьАктивность(Не ПометкаУдаления);<br>
 КонецЕсли;<br>
 <br>
 НаборЗаписей.Записывать = Истина;<br>
КонецПроцедуры</p>

<br>
<p>#СПР1</p>

<p>1. Создать справочник Графики</p>

<p>2. В справочнике ФизическиеЛица добавить реквизиты "НачальныйСтаж" число 10,0 и "ДатаПриема" дата</p>

<p>3. ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" снять, не зависит от базы</p>

<p>4. ПВР ДополнительныеНачисления вкладка Расчет флаг "Использует период действия" установить, зависит от базы по периоду действия, базовый план - ОсновныеНачисления<br>
В предопределенных данных для премии установить базовый вид - оклад </p>

<p>5. ПВР Удержания вкладка Расчет флаг "Использует период действия" снять, зависит от базы по периоду регистрации, базовые планы - ОсновныеНачисления, ДополнительныеНачисления</p>

<p>6. Создать регистрСведений ГрафикиРаботы (непериодический, независимый), изм: Дата, График (СправочникСсылка.Графики), ресурс КоличествоДней (число 5,1)</p>

<p>7. Создать регистрСведений СведенияОСотрудниках (В пределах дня, Независимый, Основной отбор по периоду = Истина), изм. Сотрудник, ресурс Оклад (число 10,2).</p>

<p>8. Создать регистрСведений ПроцентыПремии (непериодический, независимый), изм: СтажОт, СтажДо (число 10,0), ресурс Процент (число 10,2)</p>

<p>9. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, рес. Результат, реквизиты График (СправочникСсылка.Графики), Параметр (число 15,2)<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = КоличествоДней, Дата графика = Дата, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>10. Создать регистр расчета ДополнительныеНачисления", изм: Сотрудник, рес: Результат (число 12,2), рекв: Параметр (число 15,2), Стаж (число 5,0)<br>
указать ПВР - ДополнительныеНачисления, флаг Базовый период = истина, периодичность = месяц, Регистратор - НачислениеЗарплаты</p>

<p>11. В обработке ЗаполнениеГрафика добавить реквизит шапки График (СправочникСсылка.Графики), создать форму.</p>

<p>В модуле Объекта обработки </p>

<p>Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.График.Установить(График);<br>
 <br>
 ЧислоСекундВСутках = 86400;<br>
 <br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = Дат;<br>
 Запись.График = График;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.КоличествоДней = 0;<br>
 Иначе <br>
 Запись.КоличествоДней = 1;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
 <br>
КонецПроцедуры</p>

<p>В модуле формы</p>

<p>&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры </p>

<p>12. Документ НачислениеЗарплаты<br>
 В ТЧ ОсновныеНачисления убрать Подразделение, Размер; добавить График (СправочникСсылка.Графики), Результат (число 15,2), Параметр (число 15,2)<br>
 Добавить ТЧ ДополнительныеНачисления, Сотрудник, ВидРасчета (ПланВидовРасчетаСсылка.ДополнительныеНачисления), Результат (число 15,2), Параметр (число 15,2), Стаж (число 5,0)</p>

<p>Создать форму, Добавить кнопку "Рассчитать", Добавить команду "Рассчитать"<br>
В модуле формы </p>

<br>
<p>&НаСервере<br>
Процедура РассчитатьНаСервере()<br>
 ДокументОбъект = РеквизитФормыВЗначение("Объект");<br>
 ДокументОбъект.Рассчитать();<br>
 ЗначениеВРеквизитФормы(ДокументОбъект, "Объект");<br>
 Модифицированность = Истина;<br>
КонецПроцедуры</p>

<p>&НаКлиенте<br>
Процедура Рассчитать(Команда)<br>
 Если Объект.Ссылка.Пустая() Тогда<br>
 Оповещение = Новый ОписаниеОповещения("ОбработатьОтветЗаписиДокумента", ЭтотОбъект);<br>
 ПоказатьВопрос(Оповещение, "Перед расчетом документ будет записан. Продолжить?", РежимДиалогаВопрос.ДаНет);<br>
 Возврат;<br>
 КонецЕсли;<br>
 РассчитатьНаСервере();<br>
КонецПроцедуры</p>

<p>&НаКлиенте<br>
Процедура ОбработатьОтветЗаписиДокумента (Ответ, ДополнительныеПараметры) Экспорт<br>
 Если Ответ = КодВозвратаДиалога.Нет Тогда<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 Записать();<br>
 РассчитатьНаСервере();<br>
КонецПроцедуры</p>

<p>В модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, Режим)</p>

<p> ЗаписатьДанныеДокументаВРегистр();<br>
 <br>
КонецПроцедуры</p>

<p>Процедура Рассчитать() Экспорт<br>
 НачатьТранзакцию();<br>
 <br>
 // Формирование рабочих наборов записей<br>
 ЗаписатьДанныеДокументаВРегистр();<br>
 <br>
 // В процедуре общего модуля выполняется окончательный расчет данных и заполнение табличных частей<br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения, ОсновныеНачисления, ДополнительныеНачисления, ПериодРегистрации);<br>
 <br>
 // Откатываем транзакцию, отменяя тем самым помещенные ранее движения в регистр, эти записи нужны были только для расчета данных в ТЧ<br>
 ОтменитьТранзакцию();<br>
КонецПроцедуры</p>

<p>Процедура ЗаписатьДанныеДокументаВРегистр()<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 <br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 <br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 <br>
 ЗаполнитьЗначенияСвойств(Движение, ТекСтрокаОсновныеНачисления);<br>
 <br>
 Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;<br>
 Движение.ПериодДействияКонец = ТекСтрокаОсновныеНачисления.ДатаОкончания;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 <br>
 КонецЦикла;</p>

<p> КонецБазовогоПериодаПремии = КонецМесяца(Дата);<br>
 <br>
 Для Каждого ТекСтрокаДополнительныеНачисления Из ДополнительныеНачисления Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 <br>
 ЗаполнитьЗначенияСвойств(Движение, ТекСтрокаДополнительныеНачисления);<br>
 <br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.БазовыйПериодНачало = ПериодРегистрации;<br>
 Движение.БазовыйПериодКонец = КонецБазовогоПериодаПремии;<br>
 КонецЦикла;</p>

<p> Движения.Записать();<br>
КонецПроцедуры</p>

<p>13. Создать общий модуль Расчет (Сервер)</p>

<p>Процедура РассчитатьНачисления (Регистратор, Движения, ОсновныеНачисления, ДополнительныеНачисления, ПериодРегистрации) Экспорт<br>
 <br>
 НаборЗаписей = Движения.ОсновныеНачисления;<br>
 РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей, ОсновныеНачисления, ПериодРегистрации);<br>
 НаборЗаписей.Записать(, Истина); // Движения по окладу обязательно необходимо записать до расчета премии, т.к. сумма оклада составляет базу для премии<br>
 <br>
 ДопНаборЗаписей = Движения.ДополнительныеНачисления;<br>
 РассчитатьДопНачисления(Регистратор, ДопНаборЗаписей, ДополнительныеНачисления, ПериодРегистрации);<br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьОсновныеНачисления (Регистратор, НаборЗаписей, ОсновныеНачисления, ПериодРегистрации)<br>
 <br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Начальное значение оклада] / [Количество рабочих дней] * [Количество отработанных дней]</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.КоличествоДнейФактическийПериодДействия, 0) КАК ДнейФакт,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.КоличествоДнейПериодДействия, 0) КАК ДнейПлан,<br>
 | ОсновныеНачисленияДанныеГрафика.Сотрудник КАК Сотрудник<br>
 |ПОМЕСТИТЬ ВТ_ДанныеГрафика<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОклад) КАК ОсновныеНачисленияДанныеГрафика<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ВТ_ДанныеГрафика.ДнейФакт КАК ДнейФакт,<br>
 | ВТ_ДанныеГрафика.ДнейПлан КАК ДнейПлан,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.Оклад, 0) КАК Параметр<br>
 |ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | Сотрудник В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.Сотрудник КАК Сотрудник<br>
 | ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика)) КАК СведенияОСотрудникахСрезПоследних<br>
 | ПО ВТ_ДанныеГрафика.Сотрудник = СведенияОСотрудникахСрезПоследних.Сотрудник";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", ПериодРегистрации);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ДнейПлан = 0, 0, Выборка.Параметр / Выборка.ДнейПлан * Выборка.ДнейФакт);<br>
 <br>
 ОсновныеНачисления[Запись.НомерСтроки-1].Результат = Запись.Результат;<br>
 ОсновныеНачисления[Запись.НомерСтроки-1].Параметр = Выборка.Параметр;<br>
 КонецЕсли;<br>
 Выборка.Сбросить()<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьДопНачисления (Регистратор, НаборЗаписей, ДополнительныеНачисления, ПериодРегистрации) <br>
 <br>
 // РАСЧЕТ ПРЕМИИ<br>
 // Формула расчета: [Сумма базы (по окладу)] * [Процент премии]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ПроцентыПремии.Процент, 0) КАК Параметр,<br>
 | РАЗНОСТЬДАТ(ДополнительныеНачисления.Сотрудник.ДатаПриема, &ПериодРегистрации, ГОД) + ДополнительныеНачисления.Сотрудник.НачальныйСтаж КАК Стаж,<br>
 | ЕСТЬNULL(ДополнительныеНачисленияБазаОсновныеНачисления.РезультатБаза, 0) КАК База<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ДополнительныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаПремия) КАК ДополнительныеНачисленияБазаОсновныеНачисления<br>
 | ПО ДополнительныеНачисления.НомерСтроки = ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПроцентыПремии КАК ПроцентыПремии<br>
 | ПО (РАЗНОСТЬДАТ(ДополнительныеНачисления.Сотрудник.ДатаПриема, &ПериодРегистрации, ГОД) + ДополнительныеНачисления.Сотрудник.НачальныйСтаж >= ПроцентыПремии.СтажОт)<br>
 | И (РАЗНОСТЬДАТ(ДополнительныеНачисления.Сотрудник.ДатаПриема, &ПериодРегистрации, ГОД) + ДополнительныеНачисления.Сотрудник.НачальныйСтаж < ПроцентыПремии.СтажДо)<br>
 |ГДЕ<br>
 | ДополнительныеНачисления.Регистратор = &Регистратор<br>
 | И ДополнительныеНачисления.ВидРасчета = &ВидРасчетаПремия";<br>
 <br>
 Измерения = Новый Массив(1);<br>
 Измерения[0] = "Сотрудник";<br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаПремия", ПланыВидовРасчета.ДополнительныеНачисления.Премия);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", ПериодРегистрации);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 ДополнительныеНачисления[Запись.НомерСтроки-1].Результат = Выборка.База * Выборка.Параметр / 100;<br>
 ДополнительныеНачисления[Запись.НомерСтроки-1].Параметр = Выборка.Параметр;<br>
 ДополнительныеНачисления[Запись.НомерСтроки-1].Стаж = Выборка.Стаж; <br>
 КонецЕсли;<br>
 Выборка.Сбросить()<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<br>
<p>14. Отчет АнализНачисленийПремий<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ДополнительныеНачисления.Сотрудник КАК Сотрудник,<br>
 ДополнительныеНачисления.Стаж КАК ТрудовойСтаж,<br>
 ДополнительныеНачисления.Параметр КАК ПроцентПремии,<br>
 ДополнительныеНачисления.Результат КАК СуммаПремии<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
ГДЕ<br>
 ДополнительныеНачисления.ПериодРегистрации = НАЧАЛОПЕРИОДА(&Месяц, МЕСЯЦ)<br>
 И ДополнительныеНачисления.Активность</p>

<p>Ресурсы СуммаПремии выражение Сумма(СуммаПремии)</p>

<p>Параметр Месяц тип Дата, запрет незаполненных значений, </p>

<p>Группировки <br>
1 Заголовок<br>
2 Сотрудник, ТрудовойСтаж, ПроцентПремии</p>

<p>Для группировки "<Дополнительная информация> (Заголовок)" Вариант использования группировки - Дополнительная информация<br>
ПКМ, Установить имя "Заголовок". В макете "Шаблон" <Месяц: [МесяцОтбора]>, Формат(ПараметрыДанных.Месяц, "ДФ = 'ММММ гггг ""г.""'")</p>

<p>Выводить параметры - Не выводить<br>
Параметр Месяц включить в пользовательские настройки.</p>

<p>#СПР2</p>

<p>1. Создать регистр сведений ГрафикиРаботы (непериодический, независимый), изм: Дата (Дата), Подразделение (СправочникСсылка.Подразделения), рес: КоличествоЧасов число 5,2</p>

<p>2. Создать регистр сведений СведенияОСотрудниках (в пределах дня, независимый), изм: Сотрудник, Подразделение, рес: Оклад 12,2 неотр (был в каркасе)</p>

<p>3. Создать регистр накопления РасчетыССотрудниками (вид Остатки), изм: Сотрудник, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), Подразделение, Сумма 12,2<br>
 регистраторы: НачислениеЗарплаты, ВыплатаЗарплаты</p>

<p>4. ПВР один - ОсновныеНачисления, вкладка Расчет флаг "Использует период действия" установить, зависит от базы по периоду действия, базовый план - ОсновныеНачисления<br>
Добавить вид расчета "ПроизвольнаяСумма"<br>
Добавить вид расчета "Премия", уст.флаг Период действия явл.баз.периодом, базовый вид = оклад, вытесняющий = ПроизвольнаяСумма</p>

<p>5. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, рес. Результат 12,2, реквизиты Подразделение (СправочникСсылка.Подразделения), Параметр (число 15,2)<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = КоличествоЧасов, Дата графика = Дата, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>6. Обработка ЗаполнениеГрафика<br>
Добавить реквизит Подразделение</p>

<p>В модуле объекта</p>

<p>Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей(); <br>
 Набор.Отбор.Подразделение.Установить(Подразделение);<br>
 <br>
 ЧислоСекундВСутках = 86400; <br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = Дат;<br>
 Запись.Подразделение = Подразделение;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.КоличествоЧасов = 0;<br>
 Иначе <br>
 Запись.КоличествоЧасов = 8;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();</p>

<p>КонецПроцедуры</p>

<p>7. Документ НачислениеЗарплаты<br>
 В ТЧ ОсновныеНачисления убрать Размер; добавить Параметр (число 15,2)</p>

<p>В модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСНОВНЫЕ НАЧИСЛЕНИЯ<br>
 <br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 <br>
 // Запрос для формирования рабочего набора записей<br>
 // Согласно условию оклад может быть многократно изменен и необходимо учесть эти изменения, <br>
 // поэтому для вида расчета Оклад формируется объединение двух запросов,<br>
 // первый - это изменения оклада за период действия, второй - значение оклада на начало периода действия<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | НачислениеЗарплатыОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 | НачислениеЗарплатыОсновныеНачисления.Подразделение КАК Подразделение,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаНачала КАК ПериодДействияНачало,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаОкончания КАК ПериодДействияКонец,<br>
 | НАЧАЛОПЕРИОДА(НачислениеЗарплатыОсновныеНачисления.Ссылка.Дата, МЕСЯЦ) КАК ПериодРегистрации,<br>
 | НачислениеЗарплатыОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 | НачислениеЗарплатыОсновныеНачисления.НомерСтроки КАК НомерСтроки<br>
 |ПОМЕСТИТЬ ВТ_ДанныеПоОкладу<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ОсновныеНачисления КАК НачислениеЗарплатыОсновныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыОсновныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыОсновныеНачисления.ВидРасчета = &ВидРасчетаОклад<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеПоОкладу.Сотрудник КАК Сотрудник,<br>
 | ВТ_ДанныеПоОкладу.Подразделение КАК Подразделение,<br>
 | ВТ_ДанныеПоОкладу.ПериодДействияНачало КАК ПериодДействияНачало,<br>
 | ВТ_ДанныеПоОкладу.ПериодДействияКонец КАК ПериодДействияКонец,<br>
 | ВТ_ДанныеПоОкладу.ПериодРегистрации КАК ПериодРегистрации,<br>
 | МАКСИМУМ(СведенияОСотрудниках.Период) КАК МаксимальныйПериод,<br>
 | ВТ_ДанныеПоОкладу.ВидРасчета КАК ВидРасчета,<br>
 | ВТ_ДанныеПоОкладу.НомерСтроки КАК НомерСтроки<br>
 |ПОМЕСТИТЬ ВТ_ДанныеПоОкладуСМаксПериодом<br>
 |ИЗ<br>
 | ВТ_ДанныеПоОкладу КАК ВТ_ДанныеПоОкладу<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках КАК СведенияОСотрудниках<br>
 | ПО ВТ_ДанныеПоОкладу.Сотрудник = СведенияОСотрудниках.Сотрудник<br>
 | И ВТ_ДанныеПоОкладу.Подразделение = СведенияОСотрудниках.Подразделение<br>
 | И ВТ_ДанныеПоОкладу.ПериодДействияНачало >= СведенияОСотрудниках.Период<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ВТ_ДанныеПоОкладу.ПериодДействияКонец,<br>
 | ВТ_ДанныеПоОкладу.ПериодРегистрации,<br>
 | ВТ_ДанныеПоОкладу.Сотрудник,<br>
 | ВТ_ДанныеПоОкладу.Подразделение,<br>
 | ВТ_ДанныеПоОкладу.ПериодДействияНачало,<br>
 | ВТ_ДанныеПоОкладу.ВидРасчета,<br>
 | ВТ_ДанныеПоОкладу.НомерСтроки<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеПоОкладу.Сотрудник КАК Сотрудник,<br>
 | ВТ_ДанныеПоОкладу.Подразделение КАК Подразделение,<br>
 | СведенияОСотрудниках.Оклад КАК Параметр,<br>
 | СведенияОСотрудниках.Период КАК ПериодДействияНачало,<br>
 | ВТ_ДанныеПоОкладу.ПериодДействияКонец КАК ПериодДействияКонец,<br>
 | ВТ_ДанныеПоОкладу.ПериодРегистрации КАК ПериодРегистрации,<br>
 | ВТ_ДанныеПоОкладу.ВидРасчета КАК ВидРасчета,<br>
 | ВТ_ДанныеПоОкладу.НомерСтроки КАК НомерСтроки<br>
 |ИЗ<br>
 | ВТ_ДанныеПоОкладу КАК ВТ_ДанныеПоОкладу<br>
 | ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках КАК СведенияОСотрудниках<br>
 | ПО ВТ_ДанныеПоОкладу.Сотрудник = СведенияОСотрудниках.Сотрудник<br>
 | И ВТ_ДанныеПоОкладу.Подразделение = СведенияОСотрудниках.Подразделение<br>
 | И ВТ_ДанныеПоОкладу.ПериодДействияНачало < СведенияОСотрудниках.Период<br>
 | И ВТ_ДанныеПоОкладу.ПериодДействияКонец >= СведенияОСотрудниках.Период<br>
 |<br>
 |ОБЪЕДИНИТЬ ВСЕ<br>
 |<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеПоОкладуСМаксПериодом.Сотрудник,<br>
 | ВТ_ДанныеПоОкладуСМаксПериодом.Подразделение,<br>
 | СведенияОСотрудниках.Оклад,<br>
 | ВТ_ДанныеПоОкладуСМаксПериодом.ПериодДействияНачало,<br>
 | ВТ_ДанныеПоОкладуСМаксПериодом.ПериодДействияКонец,<br>
 | ВТ_ДанныеПоОкладуСМаксПериодом.ПериодРегистрации,<br>
 | ВТ_ДанныеПоОкладуСМаксПериодом.ВидРасчета,<br>
 | ВТ_ДанныеПоОкладуСМаксПериодом.НомерСтроки<br>
 |ИЗ<br>
 | ВТ_ДанныеПоОкладуСМаксПериодом КАК ВТ_ДанныеПоОкладуСМаксПериодом<br>
 | ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках КАК СведенияОСотрудниках<br>
 | ПО ВТ_ДанныеПоОкладуСМаксПериодом.Сотрудник = СведенияОСотрудниках.Сотрудник<br>
 | И ВТ_ДанныеПоОкладуСМаксПериодом.Подразделение = СведенияОСотрудниках.Подразделение<br>
 | И ВТ_ДанныеПоОкладуСМаксПериодом.МаксимальныйПериод = СведенияОСотрудниках.Период<br>
 |<br>
 |УПОРЯДОЧИТЬ ПО<br>
 | ПериодДействияНачало<br>
 |ИТОГИ ПО<br>
 | НомерСтроки<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | НачислениеЗарплатыОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 | НачислениеЗарплатыОсновныеНачисления.Подразделение КАК Подразделение,<br>
 | НАЧАЛОПЕРИОДА(НачислениеЗарплатыОсновныеНачисления.Ссылка.Дата, МЕСЯЦ) КАК ПериодРегистрации,<br>
 | ВЫБОР<br>
 | КОГДА НачислениеЗарплатыОсновныеНачисления.ВидРасчета = &ВидРасчетаПремия<br>
 | ТОГДА НачислениеЗарплатыОсновныеНачисления.Параметр<br>
 | ИНАЧЕ 0<br>
 | КОНЕЦ КАК Параметр,<br>
 | НачислениеЗарплатыОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаНачала КАК ПериодДействияНачало,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаОкончания КАК ПериодДействияКонец,<br>
 | ВЫБОР<br>
 | КОГДА НачислениеЗарплатыОсновныеНачисления.ВидРасчета = &ВидРасчетаПроизвольнаяСумма<br>
 | ТОГДА НачислениеЗарплатыОсновныеНачисления.Параметр<br>
 | ИНАЧЕ 0<br>
 | КОНЕЦ КАК Результат<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ОсновныеНачисления КАК НачислениеЗарплатыОсновныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыОсновныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыОсновныеНачисления.ВидРасчета <> &ВидРасчетаОклад";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 Запрос.УстановитьПараметр("ВидРасчетаПремия", ПланыВидовРасчета.ОсновныеНачисления.Премия); <br>
 Запрос.УстановитьПараметр("ВидРасчетаПроизвольнаяСумма", ПланыВидовРасчета.ОсновныеНачисления.ПроизвольнаяСумма); <br>
 <br>
 Результаты = Запрос.ВыполнитьПакет(); <br>
 <br>
 ВыборкаИтоги = Результаты[2].Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Движение = Неопределено;<br>
 Пока ВыборкаИтоги.Следующий() Цикл<br>
 ЭтоСледующаяЗапись = Ложь; <br>
 Выборка = ВыборкаИтоги.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Если ЭтоСледующаяЗапись Тогда<br>
 //Переопределяем окончание периода действия для прошлой записи набора<br>
 Движение.ПериодДействияКонец = Выборка.ПериодДействияНачало-1;<br>
 КонецЕсли;<br>
 <br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 ЭтоСледующаяЗапись = Истина;<br>
 КонецЦикла;<br>
 КонецЦикла;<br>
 <br>
 Выборка = Результаты[3].Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочего набора записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистре<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения.ОсновныеНачисления); <br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ РАСЧЕТЫ С СОТРУДНИКАМИ<br>
 Движения.РасчетыССотрудниками.Записывать = Истина;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисления.Сотрудник,<br>
 | ОсновныеНачисления.ВидРасчета,<br>
 | СУММА(ОсновныеНачисления.Результат) КАК Сумма,<br>
 | ОсновныеНачисления.Подразделение<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
 |ГДЕ<br>
 | ОсновныеНачисления.Регистратор = &Регистратор<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ОсновныеНачисления.Сотрудник,<br>
 | ОсновныеНачисления.ВидРасчета,<br>
 | ОсновныеНачисления.Подразделение";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Ссылка);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.РасчетыССотрудниками.Добавить();<br>
 Движение.Период = Дата;<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 КонецЦикла; <br>
 <br>
КонецПроцедуры</p>

<p>8. Создать документ ВыплатаЗарплаты, рекв: Подразделение, ТЧ СписокСотрудников (Сотрудник, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), Сумма 12,2 )<br>
 Создать форму, создать кнопку Заполнить (команда формы)</p>

<p>в модуле формы:</p>

<p>&НаСервере<br>
Процедура ЗаполнитьНаСервере()<br>
 <br>
 // Получение остатков по регистру Расчеты с сотрудниками с отбором по подразделению<br>
 Объект.СписокСотрудников.Очистить();<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РасчетыССотрудникамиОстатки.Сотрудник,<br>
 | РасчетыССотрудникамиОстатки.ВидРасчета,<br>
 | РасчетыССотрудникамиОстатки.СуммаОстаток КАК Сумма<br>
 |ИЗ<br>
 | РегистрНакопления.РасчетыССотрудниками.Остатки(&МоментВремени, Подразделение = &Подразделение) КАК РасчетыССотрудникамиОстатки";<br>
 <br>
 Запрос.УстановитьПараметр("Подразделение", Объект.Подразделение); <br>
 Запрос.УстановитьПараметр("МоментВремени", РеквизитФормыВЗначение("Объект").МоментВремени()); <br>
 <br>
 // Заполнение табличной части полученными данными<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 НоваяСтрока = Объект.СписокСотрудников.Добавить();<br>
 ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка);<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ЗаполнитьНаСервере();<br>
КонецПроцедуры</p>

<p>в модуле объекта:</p>

<br>
<p>Процедура ОбработкаПроведения(Отказ, Режим)<br>
 <br>
 // регистр РасчетыССотрудниками Расход<br>
 Движения.РасчетыССотрудниками.Записывать = Истина;<br>
 <br>
 Для Каждого ТекСтрокаСписокСотрудников Из СписокСотрудников Цикл<br>
 Движение = Движения.РасчетыССотрудниками.Добавить();<br>
 Движение.ВидДвижения = ВидДвиженияНакопления.Расход;<br>
 Движение.Период = Дата;<br>
 Движение.Сотрудник = ТекСтрокаСписокСотрудников.Сотрудник;<br>
 Движение.ВидРасчета = ТекСтрокаСписокСотрудников.ВидРасчета;<br>
 Движение.Подразделение=Подразделение;<br>
 Движение.Сумма = ТекСтрокаСписокСотрудников.Сумма;<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>9. Создать общий модуль Расчет (Сервер)</p>

<p>Процедура РассчитатьНачисления(Регистратор, НаборЗаписей) Экспорт<br>
 <br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Начальное значение оклада] / [Количество рабочих часов] * [Количество отработанных часов]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.КоличествоЧасовФактическийПериодДействия, 0) КАК ЧасовФакт,<br>
 | ОсновныеНачисленияДанныеГрафика.Параметр,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.КоличествоЧасовПериодДействия, 0) КАК ЧасовПлан,<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОклад) КАК ОсновныеНачисленияДанныеГрафика";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки",0);<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ЧасовПлан = 0,0, Выборка.Параметр / Выборка.ЧасовПлан * Выборка.ЧасовФакт);<br>
 КонецЕсли; <br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать(, Истина);<br>
 <br>
 // РАСЧЕТ ПРЕМИИ<br>
 // Формула расчета: [Сумма базы (по окладу)] * [Процент премии]<br>
 <br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.НомерСтроки,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.РезультатБаза КАК База,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.Параметр<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаПремия) КАК ОсновныеНачисленияБазаОсновныеНачисления";<br>
 <br>
 Измерения = Новый Массив(1);<br>
 Измерения[0] = "Сотрудник";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("ВидРасчетаПремия", ПланыВидовРасчета.ОсновныеНачисления.Премия);<br>
 <br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки",0);<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.База * Выборка.Параметр / 100;<br>
 КонецЕсли; <br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать(, Истина); <br>
 <br>
КонецПроцедуры</p>

<p>10. Отчет РасчетноПлатежнаяВедомость<br>
Запрос:<br>
ВЫБРАТЬ<br>
 РасчетыССотрудникамиОстаткиИОбороты.Сотрудник КАК Сотрудник,<br>
 РасчетыССотрудникамиОстаткиИОбороты.ВидРасчета КАК ВидРасчета,<br>
 РасчетыССотрудникамиОстаткиИОбороты.Подразделение КАК Подразделение,<br>
 РасчетыССотрудникамиОстаткиИОбороты.СуммаНачальныйОстаток КАК НачальноеСальдо,<br>
 РасчетыССотрудникамиОстаткиИОбороты.СуммаПриход КАК Начислено,<br>
 РасчетыССотрудникамиОстаткиИОбороты.СуммаРасход КАК Выплачено,<br>
 РасчетыССотрудникамиОстаткиИОбороты.СуммаКонечныйОстаток КАК КонечноеСальдо<br>
ИЗ<br>
 РегистрНакопления.РасчетыССотрудниками.ОстаткиИОбороты КАК РасчетыССотрудникамиОстаткиИОбороты<br>
ГДЕ <br>
 РасчетыССотрудникамиОстаткиИОбороты.Подразделение = &Подразделение</p>

<p>Ресурсы Выплачено Сумма(Выплачено), КонечноеСальдо Сумма(КонечноеСальдо), НачальноеСальдо Сумма(НачальноеСальдо), Начислено Сумма(Начислено)<br>
Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания, Огранич.доступн<br>
 Период СтандартныйПериод, НомерВедомости Число 1, Подразделение СправочникСсылка.Подразделения, МесяцДок Выражение НРег(Формат(&Период.ДатаОкончания, "ДФ = 'ММММ гггг ""года""'"))</p>

<p>Группировки <br>
1 Заголовок<br>
2 ДетальныеЗаписи</p>

<p>Для группировки "<Дополнительная информация> (Заголовок)" Вариант использования группировки - Дополнительная информация<br>
ПКМ, Установить имя "Заголовок". В макете "Шаблон" <Расчетно-платежная ведомость № [НомерДокумента] за [МесяцДокумента] по подразделению "[Подразделение]">,<br>
НомерДокумента ПараметрыДанных.НомерВедомости, МесяцДокумента ПараметрыДанных.МесяцДок, Подразделение Представление(ПараметрыДанных.Подразделение)</p>

<p>Выводить параметры - Не выводить</p>

<p>#СПР3</p>

<p>1. Создать справочник Графики, внести предопределенное значение "Шестидневка"</p>

<p>2. Создать регистрСведений ГрафикиРаботы (непериодический, независимый), изм: Дата, График (СправочникСсылка.Графики), ресурсы Часов 5,2 и Дней 1,0, </p>

<p>3. Создать регистрСведений СведенияОСотрудниках (В пределах дня, Независимый, Основной отбор по периоду = Истина), изм. Сотрудник, Подразделение, ресурс Оклад (число 12,2) неотр.</p>

<p>4. ПВР один - ОсновныеНачисления, вкладка Расчет флаг "Использует период действия" установить, зависит от базы по периоду действия, базовый план - ОсновныеНачисления<br>
Добавить вид расчета "Командировка", базовый вид = оклад</p>

<p>5. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Подразделение; рес. Результат 12,2, ОтработаноЧасов, 10,1; реквизиты График (СправочникСсылка.Графики), Параметр (число 12,2)<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = Часов, Дата графика = Дата, баз.период = истина, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>6. Обработка ЗаполнениеГрафика добавить рекв График в шапку, добавить на форму<br>
в модуле формы:<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры </p>

<p>в модуле объекта</p>

<p>Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.График.Установить(График); <br>
 <br>
 ЧислоСекундВСутках = 86400;<br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.График = График;<br>
 Запись.Дата = Дат;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.Часов = 0; <br>
 Запись.Дней = 0;<br>
 Иначе <br>
 Запись.Часов = 8;<br>
 Запись.Дней = 1; <br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<p>7. Документ НачислениеЗарплаты<br>
 В ТЧ ОсновныеНачисления убрать Размер; добавить График (ссылка)</p>

<p>в модуле объекта</p>

<p>Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСНОВНЫЕ НАЧИСЛЕНИЯ</p>

<p> Движения.ОсновныеНачисления.Записывать = Истина;<br>
 <br>
 // Запрос для формирования рабочего набора записей<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | НачислениеЗарплатыОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 | НачислениеЗарплатыОсновныеНачисления.Подразделение КАК Подразделение,<br>
 | НачислениеЗарплатыОсновныеНачисления.График КАК График,<br>
 | НачислениеЗарплатыОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаНачала КАК ПериодДействияНачало,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаОкончания КАК ПериодДействияКонец<br>
 |ПОМЕСТИТЬ ВТ_ДанныеПоОкладу<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ОсновныеНачисления КАК НачислениеЗарплатыОсновныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыОсновныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыОсновныеНачисления.ВидРасчета = &ВидРасчетаОклад<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник,<br>
 | Подразделение<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | &ПериодРегистрации КАК ПериодРегистрации,<br>
 | ВТ_ДанныеПоОкладу.Сотрудник КАК Сотрудник,<br>
 | ВТ_ДанныеПоОкладу.Подразделение КАК Подразделение,<br>
 | ВТ_ДанныеПоОкладу.График КАК График,<br>
 | ВТ_ДанныеПоОкладу.ВидРасчета КАК ВидРасчета,<br>
 | ВТ_ДанныеПоОкладу.ПериодДействияНачало КАК ПериодДействияНачало,<br>
 | ВТ_ДанныеПоОкладу.ПериодДействияКонец КАК ПериодДействияКонец,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.Оклад, 0) КАК Параметр,<br>
 | NULL КАК БазовыйПериодНачало,<br>
 | NULL КАК БазовыйПериодКонец<br>
 |ИЗ<br>
 | ВТ_ДанныеПоОкладу КАК ВТ_ДанныеПоОкладу<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | (Сотрудник, Подразделение) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеПоОкладу.Сотрудник,<br>
 | ВТ_ДанныеПоОкладу.Подразделение<br>
 | ИЗ<br>
 | ВТ_ДанныеПоОкладу КАК ВТ_ДанныеПоОкладу)) КАК СведенияОСотрудникахСрезПоследних<br>
 | ПО ВТ_ДанныеПоОкладу.Сотрудник = СведенияОСотрудникахСрезПоследних.Сотрудник<br>
 | И ВТ_ДанныеПоОкладу.Подразделение = СведенияОСотрудникахСрезПоследних.Подразделение<br>
 |<br>
 |ОБЪЕДИНИТЬ ВСЕ<br>
 |<br>
 |ВЫБРАТЬ<br>
 | &ПериодРегистрации,<br>
 | НачислениеЗарплатыОсновныеНачисления.Сотрудник,<br>
 | НачислениеЗарплатыОсновныеНачисления.Подразделение,<br>
 | ЗНАЧЕНИЕ(Справочник.Графики.Шестидневка),<br>
 | НачислениеЗарплатыОсновныеНачисления.ВидРасчета,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаНачала,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаОкончания,<br>
 | NULL,<br>
 | ДОБАВИТЬКДАТЕ(&ПериодРегистрации, МЕСЯЦ, -2),<br>
 | ДОБАВИТЬКДАТЕ(&ПериодРегистрации, СЕКУНДА, -1)<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ОсновныеНачисления КАК НачислениеЗарплатыОсновныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыОсновныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыОсновныеНачисления.ВидРасчета = &ВидРасчетаКомандировка";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", НачалоМесяца(Дата)); <br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 Запрос.УстановитьПараметр("ВидРасчетаКомандировка", ПланыВидовРасчета.ОсновныеНачисления.Командировка);<br>
 <br>
 // Заполнение набора записей<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 КонецЦикла;<br>
 <br>
 // Необходима обработка дополнительных сторно записей, так как командировка может вводится задним числом<br>
 СторноЗаписи = Движения.ОсновныеНачисления.ПолучитьДополнение();<br>
 Для Каждого Запись из СторноЗаписи Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Запись);<br>
 Движение.ПериодДействияНачало = Запись.ПериодДействияНачалоСторно;<br>
 Движение.ПериодДействияКонец = Запись.ПериодДействияКонецСторно;<br>
 Движение.ПериодРегистрации = Запись.ПериодРегистрацииСторно;<br>
 Движение.Сторно = Истина;<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочего набора записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистре<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения.ОсновныеНачисления);<br>
 <br>
КонецПроцедуры</p>

<p>8. Создать общий модуль Расчет (Сервер)</p>

<p>Процедура РассчитатьНачисления (Регистратор, НаборЗаписей) Экспорт<br>
 <br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Начальное значение оклада] / [Количество рабочих дней] * [Количество отработанных дней]</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ОсновныеНачисленияДанныеГрафика.Параметр КАК Параметр,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейФактическийПериодДействия, 0) КАК ДнейФакт,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейПериодДействия, 0) КАК ДнейПлан,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовФактическийПериодДействия, 0) КАК ЧасовФакт<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОклад) КАК ОсновныеНачисленияДанныеГрафика";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Сторно = ?(Запись.Сторно, -1, 1);<br>
 Запись.Результат = Сторно * ?(Выборка.ДнейПлан = 0, 0, Выборка.Параметр / Выборка.ДнейПлан * Выборка.ДнейФакт);<br>
 Запись.ОтработаноЧасов = Сторно * Выборка.ЧасовФакт;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать(, Истина); // Необходимо записать до расчета командировки, так как сторно записи могут попасть в базу командировки<br>
 <br>
 <br>
 // РАСЧЕТ КОМАНДИРОВКИ<br>
 // Формула расчета: [Сумма базы (по окладу)] / [Количество отработанных часов в базовом периоде] * [Количество часов в командировке]<br>
 <br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовФактическийПериодДействия, 0) КАК ЧасовФакт,<br>
 | ЕСТЬNULL(ОсновныеНачисленияБазаОсновныеНачисления.РезультатБаза, 0) КАК База,<br>
 | ЕСТЬNULL(ОсновныеНачисленияБазаОсновныеНачисления.ОтработаноЧасовБаза, 0) КАК ЧасовБаза<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаКомандировка) КАК ОсновныеНачисленияДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаКомандировка) КАК ОсновныеНачисленияБазаОсновныеНачисления<br>
 | ПО ОсновныеНачисленияДанныеГрафика.НомерСтроки = ОсновныеНачисленияБазаОсновныеНачисления.НомерСтроки";<br>
 <br>
 Измерения = Новый Массив(2);<br>
 Измерения[0] = "Сотрудник";<br>
 Измерения[1] = "Подразделение";<br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("ВидРасчетаКомандировка", ПланыВидовРасчета.ОсновныеНачисления.Командировка);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ЧасовБаза = 0,0, Выборка.База / Выборка.ЧасовБаза * Выборка.ЧасовФакт);<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать(, Истина);<br>
 <br>
КонецПроцедуры</p>

<p>9. Отчет АнализНачислений<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 ОсновныеНачисления.Подразделение КАК Подразделение,<br>
 ОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 ОсновныеНачисления.ПериодРегистрации КАК ПериодРегистрации,<br>
 ОсновныеНачисления.Результат КАК Результат<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.Активность<br>
 И ОсновныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода</p>

<p>в наборе ПериодРегистрации Роль "Период, 1", Оформление = Формат ДФ='ММММ гггг "г."'<br>
ресурсы Результат Сумма(Результат)<br>
Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания</p>

<p>Группировки<br>
1. Заголовок ПериодРегистрации (Параметр ПериодРегистрации), <Начисления сотрудников с [НачалоПериода] по [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДЛФ = ДД")<br>
2. Таблица, Строки = Подразделение, Сотрудник, ВидРасчета (все Без иерархии); Колонки = ПериодРегистрации (Без дополнения)</p>

<p>Отчет Выб.поля = Результат<br>
Расположение общих итогов по горизонтали = Нет, Выводить параметры = Не выводить</p>

<p>#СПР4</p>

<p>1. Создать справочник Графики</p>

<p>2. Сооздать Перечисление СпособыРасчета, значения ПоТарифу и ПремияРуководителя</p>

<p>3. В ПВР ОсновныеНачисления добавить рекв СпособРасчета (ПеречислениеСсылка.СпособыРасчета)<br>
 вкладка Расчет флаг "Использует период действия" снять, не зависит от базы<br>
Основной вид Оклад сменитть на Тариф</p>

<p>4. В ПВР ДополнительныеНачисления добавить рекв СпособРасчета (ПеречислениеСсылка.СпособыРасчета)<br>
 вкладка Расчет флаг "Использует период действия" установить, зависит от базы по периоду действия, базовый план - ОсновныеНачисления<br>
 для Премии Базовый - Тариф, Ведущий - Тариф</p>

<p>5. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Подразделение, рес. Результат 12,2, реквизиты График (СправочникСсылка.Графики), Параметр (число 12,2)<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = КоличествоЧасов, Дата графика = Дата, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>6. Создать регистр расчета ДополнительныеНачисления", изм: Сотрудник, Подразделение, рес: Результат (число 12,2), рекв: Параметр (число 15,2)<br>
Добавить Перерасчет с измерением Подразделение</p>

<p>7. Создать регистрСведений ТарифныеСтавки (В пределах дня, независимый), изм Смена (СправочникСсылка.Графики), рес Ставка 12,2</p>

<p>8. Создать регистрСведений СведенияОСотрудниках (В пределах месяца, независимый), изм: Сотрудник, Подразделение, ресурс Оклад (число 10,2)</p>

<p>9. В обработке ЗаполнениеГрафика добавить реквизит шапки График (СправочникСсылка.Графики), создать форму.<br>
в модуле объекта<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания) Экспорт <br>
 <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.График.Установить (График);<br>
 <br>
 ТекущаяДата = ДатаНачала;<br>
 Пока ТекущаяДата <= ДатаОкончания Цикл<br>
 <br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = ТекущаяДата;<br>
 Запись.График = График; <br>
 <br>
 Запись.КоличествоЧасов = 24; <br>
 <br>
 ТекущаяДата = ТекущаяДата + 3* 86400;<br>
 КонецЦикла;<br>
 <br>
 <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<p>10. Создать док НачислениеЗарплаты<br>
ТЧ ОсновныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), График, ДатаНачала, ДатаОкончания<br>
ТЧ ДополнительныеНачисления Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ДополнительныеНачисления), Параметр 12,2</p>

<p>в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРАМ ОСНОВНЫЕ НАЧИСЛЕНИЯ И ДОПОЛНИТЕЛЬНЫЕ НАЧИСЛЕНИЯ</p>

<p> Движения.ОсновныеНачисления.Записывать = Истина;<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 <br>
 // Запрос для формирования рабочих наборов записей<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | НачислениеЗарплатыОсновныеНачисления.Сотрудник,<br>
 | НачислениеЗарплатыОсновныеНачисления.Подразделение,<br>
 | НачислениеЗарплатыОсновныеНачисления.ВидРасчета,<br>
 | НачислениеЗарплатыОсновныеНачисления.График,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаНачала,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаОкончания<br>
 |ПОМЕСТИТЬ ВТ_ТабЧастьОН<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ОсновныеНачисления КАК НачислениеЗарплатыОсновныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыОсновныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыОсновныеНачисления.ВидРасчета.СпособРасчета = &СпособРасчетаПоТарифу<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧастьОН.Сотрудник,<br>
 | ВТ_ТабЧастьОН.Подразделение,<br>
 | ВТ_ТабЧастьОН.ВидРасчета,<br>
 | ВТ_ТабЧастьОН.График,<br>
 | ВТ_ТабЧастьОН.ДатаНачала КАК ПериодДействияНачало,<br>
 | ВТ_ТабЧастьОН.ДатаОкончания КАК ПериодДействияКонец,<br>
 | ЕСТЬNULL(ТарифныеСтавкиСрезПоследних.Ставка, 0) КАК Параметр,<br>
 | &ПериодРегистрации<br>
 |ИЗ<br>
 | ВТ_ТабЧастьОН КАК ВТ_ТабЧастьОН<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ТарифныеСтавки.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | Смена В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧастьОН.График<br>
 | ИЗ<br>
 | ВТ_ТабЧастьОН КАК ВТ_ТабЧастьОН)) КАК ТарифныеСтавкиСрезПоследних<br>
 | ПО ВТ_ТабЧастьОН.График = ТарифныеСтавкиСрезПоследних.Смена<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | НачислениеЗарплатыДополнительныеНачисления.Сотрудник,<br>
 | НачислениеЗарплатыДополнительныеНачисления.Подразделение,<br>
 | НачислениеЗарплатыДополнительныеНачисления.ВидРасчета,<br>
 | НачислениеЗарплатыДополнительныеНачисления.Параметр,<br>
 | &ПериодРегистрации,<br>
 | ДОБАВИТЬКДАТЕ(&ПериодРегистрации, МЕСЯЦ, -1) КАК БазовыйПериодНачало,<br>
 | ДОБАВИТЬКДАТЕ(&ПериодРегистрации, СЕКУНДА, -1) КАК БазовыйПериодКонец<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ДополнительныеНачисления КАК НачислениеЗарплатыДополнительныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыДополнительныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыДополнительныеНачисления.ВидРасчета.СпособРасчета = &СпособРасчетаПремияРуководителю";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", НачалоМесяца(Дата));<br>
 Запрос.УстановитьПараметр("СпособРасчетаПоТарифу", Перечисления.СпособыРасчета.ПоТарифу);<br>
 Запрос.УстановитьПараметр("СпособРасчетаПремияРуководителю", Перечисления.СпособыРасчета.ПремияРуководителя);<br>
 <br>
 // Обход результатов запроса, заполнение наборов записей<br>
 МассивРезультатов = Запрос.ВыполнитьПакет();<br>
 <br>
 РезультатОН = МассивРезультатов[1]; <br>
 Если Не РезультатОН.Пустой() Тогда<br>
 Выборка = РезультатОН.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 КонецЦикла;<br>
 КонецЕсли;<br>
 <br>
 РезультатДН = МассивРезультатов[2]; <br>
 <br>
 Если Не РезультатДН.Пустой() Тогда<br>
 Выборка = РезультатДН.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 КонецЦикла;<br>
 КонецЕсли;<br>
 <br>
 // Запись рабочих наборов записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления (Ссылка, Движения);<br>
 <br>
КонецПроцедуры</p>

<p>11. Созадть модуль Расчет (Сервер)</p>

<p>Процедура РассчитатьНачисления(Регистратор, Движения) Экспорт<br>
 <br>
 НаборЗаписей = Движения.ОсновныеНачисления;<br>
 РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей); <br>
 НаборЗаписей.Записать(, Истина);<br>
 <br>
 ДопНаборЗаписей = Движения.ДополнительныеНачисления;<br>
 РассчитатьДопНачисления(Регистратор, ДопНаборЗаписей); <br>
 ДопНаборЗаписей.Записать();<br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей) <br>
 <br>
 // РАСЧЕТ ПО СПОСОБУ РАСЧЕТА ТАРИФ<br>
 // Формула расчета: [Тарифная ставка] * [Количество отработанных часов]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.Параметр,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.КоличествоЧасовФактическийПериодДействия, 0) КАК ЧасовФакт,<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета.СпособРасчета = &РасчетПоТарифу) КАК ОсновныеНачисленияДанныеГрафика";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("РасчетПоТарифу", Перечисления.СпособыРасчета.ПоТарифу);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.Параметр * Выборка.ЧасовФакт;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьДопНачисления(Регистратор, НаборЗаписей) <br>
 <br>
 // РАСЧЕТ ПО СПОСОБУ РАСЧЕТА ПРЕМИЯ РУКОВОДИТЕЛЮ<br>
 // Формула расчета: [Сумма базы по тарифу за исключением оплаты тарифа руководителя] * [Процент премии]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки,<br>
 | СУММА(ДополнительныеНачисленияБазаОсновныеНачисления.РезультатБаза) КАК База,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.Параметр<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | &Разрезы,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета.СпособРасчета = &ПремияРуководителю) КАК ДополнительныеНачисленияБазаОсновныеНачисления<br>
 |ГДЕ<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.Сотрудник <> ДополнительныеНачисленияБазаОсновныеНачисления.СотрудникРазрез<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.Параметр";<br>
 <br>
 Измерения = Новый Массив(1);<br>
 Измерения[0] = "Подразделение";<br>
 <br>
 Разрезы = Новый Массив(1);<br>
 Разрезы[0] = "Сотрудник";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ПремияРуководителю", Перечисления.СпособыРасчета.ПремияРуководителя);<br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("Разрезы", Разрезы);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.База * Запись.Параметр / 100;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>12. Отчет ПерерасчетЗарплаты<br>
Запрос: <br>
ВЫБРАТЬ<br>
 Перерасчет1.ОбъектПерерасчета КАК ОбъектПерерасчета,<br>
 Перерасчет1.ВидРасчета КАК ВидРасчета,<br>
 Перерасчет1.Подразделение КАК Подразделение,<br>
 ДополнительныеНачисления.Сотрудник КАК Сотрудник<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления.Перерасчет1 КАК Перерасчет1<br>
 ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
 ПО Перерасчет1.ОбъектПерерасчета = ДополнительныеНачисления.Регистратор<br>
 И Перерасчет1.ВидРасчета = ДополнительныеНачисления.ВидРасчета<br>
 И Перерасчет1.Подразделение = ДополнительныеНачисления.Подразделение</p>

<p>Группировка - Детальные записи<br>
Отчет выб поля: ОбъектПерерасчета, ВидРасчета, Сотрудник, Подразделение</p>

<p>13. Отчет ПремииРуководителям<br>
Запрос: <br>
ВЫБРАТЬ<br>
 ДополнительныеНачисления.Сотрудник КАК Сотрудник,<br>
 ДополнительныеНачисления.Подразделение КАК Подразделение,<br>
 ДополнительныеНачисления.Результат КАК СуммаПремии,<br>
 ДополнительныеНачисления.Параметр КАК ПроцентПремии<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
ГДЕ<br>
 ДополнительныеНачисления.ПериодРегистрации = НАЧАЛОПЕРИОДА(&МесяцОтчета, МЕСЯЦ)<br>
 И ДополнительныеНачисления.Активность</p>

<p>ресурс СуммаПремии Сумма(СуммаПремии)<br>
параметр МесяцОтчета Дата</p>

<p>Группировка - Детальные записи</p>

<p>Отчет выб поля: Подразделение, Сотрудник, ПроцентПремии, СуммаПремии<br>
Выводить параметры = Не выводить</p>

<p>#СПР5</p>

<p>1. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" установить, не зависит от базы<br>
 Предопр виды расч: ШтрафЗаОпоздание, Оклад (вытесн ШтрафЗаОпоздание)</p>

<p>2. В ПВР ДополнительныеНачисления вкладка Расчет флаг "Использует период действия" снять, не зависит от базы<br>
 Предопр виды расч: Надбавка</p>

<p>3. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Подразделение, рес. Результат 12,2, реквизиты ОтработаноЧасов (число 10,2)<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = КоличествоЧасов, Дата графика = Дата, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>4. Создать регистр расчета "ДополнительныеНачисления", изм. Сотрудник, Подразделение, рес. Результат 12,2, реквизиты ПроцентНадбавки (число 10,2)<br>
указать ПВР - ДополнительныеНачисления, флаг ПериодДействия = Ложь, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>5. Создать регистрСведений ЗначенияОклада (Непериодический, независимый), изм Подразделение, ЧасовОт 10,0, ЧасовДо 10,0; рес Оклад 12,2</p>

<p>6. Создать регистрСведений ГрафикиРаботы (Непериодический, независимый), изм Дата (ДатаВремя),Подразделение,Сотрудник; рес КоличествоЧасов 5,2, КоличествоПятнадцатиминуток 5,0</p>

<p>7. Создать регистрСведений СведенияОСотрудниках (В пределах дня, независимый), изм: Сотрудник, Подразделение, ресурс Оклад (число 10,2)</p>

<p>8. В обработке ЗаполнениеГрафика добавить реквизит шапки Подразделение, Сотрудник, создать форму.<br>
в модуле объекта<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.Подразделение.Установить(Подразделение);<br>
 Набор.Отбор.Сотрудник.Установить(Сотрудник);<br>
 <br>
 ЧислоСекундВСутках = 86400;<br>
 <br>
 Дат = ДатаНачала;<br>
 <br>
 // Вносим график с разбивкой по 15 минут, количество часов на таком интервале устанавливаем 0.25, количество пятнадцатиминуток 1<br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Если Не Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 ТекущаяДата = Дат + 8 * 3600 + 15 * 60; // Начальная дата - 08:15 текущего дня тут можно изменить типа рабочий день с 10 до 18 например<br>
 КонечнаяДата = Дат + 16 * 3600; // Конечная дата - 16.00 текущего дня<br>
 Пока ТекущаяДата <= КонечнаяДата Цикл <br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = ТекущаяДата;<br>
 Запись.Подразделение = Подразделение;<br>
 Запись.Сотрудник = Сотрудник; <br>
 Запись.КоличествоЧасов = 0.25;<br>
 Запись.КоличествоПятнадцатиминуток = 1; <br>
 ТекущаяДата = ТекущаяДата + 15 * 60;<br>
 КонецЦикла;<br>
 <br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<p>9. В док РасходнаяНакладная добавить рекв Подразделение в шапку<br>
10. В ПВХ ВидыСубконто добавить предопр. вид субконто Подразделения<br>
11. В плане счетов управленческий по счету ПрибылиУбытки добавить вид субконто Подразделения (только обороты = истина, суммовой = истина), увеличить макс субконто на 1<br>
12. в модуле в обраб провед БУ расх накл добавить<br>
 Проводка.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Подразделения] = Подразделение; //когда ПрибылиУбытки дебет<br>
 Проводка.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Подразделения] = Подразделение; //когда ПрибылиУбытки кредит</p>

<p>13. Создать док НачислениеЗарплаты<br>
ТЧ ОсновныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), ДатаНачала, ДатаОкончания (Дата и время)<br>
ТЧ ДополнительныеНачисления Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ДополнительныеНачисления), ПроцентНадбавки 15,2</p>

<p>в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 <br>
 // Формирование рабочего набора записей по регистру Основные начисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина; <br>
 Для Каждого Строка Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Строка);<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.ПериодДействияНачало = Строка.ДатаНачала;<br>
 Если Строка.ВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Оклад Тогда<br>
 // в задаче с разбитием дня в графике обязательно приведение даты к концу дня, иначе один день не будет учтен<br>
 Движение.ПериодДействияКонец = КонецДня(Строка.ДатаОкончания); <br>
 Иначе<br>
 Движение.ПериодДействияКонец = Строка.ДатаОкончания;<br>
 КонецЕсли;<br>
 КонецЦикла;<br>
 <br>
 // Формирование рабочего набора записей по регистру Дополнительные начисления<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 Для Каждого ТекСтрокаДополнительныеНачисления Из ДополнительныеНачисления Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, ТекСтрокаДополнительныеНачисления);<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 КонецЦикла; <br>
 <br>
 // Запись рабочих наборов записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления (Ссылка, Движения);<br>
 <br>
КонецПроцедуры</p>

<br>
<p>14. Создать модуль Расчет (Сервер)</p>

<p>Процедура РассчитатьНачисления(Регистратор, Движения) Экспорт<br>
 <br>
 НаборЗаписей = Движения.ОсновныеНачисления;<br>
 РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей); <br>
 НаборЗаписей.Записать(, Истина);<br>
 <br>
 ДопНаборЗаписей = Движения.ДополнительныеНачисления;<br>
 РассчитатьДопНачисления(Регистратор, ДопНаборЗаписей); <br>
 ДопНаборЗаписей.Записать();<br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей) <br>
 <br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Начальное значение оклада] / [Количество рабочих часов] * [Количество отработанных часов]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.КоличествоЧасовФактическийПериодДействия, 0) КАК ЧасовФакт,<br>
 | ЕСТЬNULL(ЗначенияОклада.Оклад, 0) КАК Оклад,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.КоличествоЧасовПериодДействия, 0) КАК ЧасовПлан<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОклад) КАК ОсновныеНачисленияДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияОклада КАК ЗначенияОклада<br>
 | ПО ОсновныеНачисленияДанныеГрафика.Подразделение = ЗначенияОклада.Подразделение<br>
 | И ОсновныеНачисленияДанныеГрафика.КоличествоЧасовФактическийПериодДействия >= ЗначенияОклада.ЧасовОт<br>
 | И ОсновныеНачисленияДанныеГрафика.КоличествоЧасовФактическийПериодДействия < ЗначенияОклада.ЧасовДо";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ЧасовПлан = 0, 0, Выборка.Оклад / Выборка.ЧасовПлан * Выборка.ЧасовФакт);<br>
 Запись.ОтработаноЧасов = Выборка.ЧасовФакт;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
 <br>
 // РАСЧЕТ ШТРАФА ЗА ОПОЗДАНИЕ<br>
 // Формула расчета: [Количество пропущенных пятнадцитиминуток] * 100<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.КоличествоПятнадцатиминутокФактическийПериодДействия, 0) КАК КоличествоПятнадцитиминуток<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаШТрафЗаОпоздание) КАК ОсновныеНачисленияДанныеГрафика";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаШтрафЗаОпоздание", ПланыВидовРасчета.ОсновныеНачисления.ШтрафЗаОпоздание);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.КоличествоПятнадцитиминуток * 100;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьДопНачисления(Регистратор, НаборЗаписей)<br>
 <br>
 // РАСЧЕТ НАДБАВКИ<br>
 // Формула расчета: [Сумма продаж по подразделению] * [Процент надбавки] <br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеНачисления.Подразделение КАК Подразделение,<br>
 | ДополнительныеНачисления.ПроцентНадбавки КАК ПроцентНадбавки,<br>
 | ДополнительныеНачисления.НомерСтроки КАК НомерСтроки<br>
 |ПОМЕСТИТЬ ВТ_ДополнительныеНачисления<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
 |ГДЕ<br>
 | ДополнительныеНачисления.Регистратор = &Регистратор<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Подразделение<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ЕСТЬNULL(УправленческийОборотыДтКт.СуммаОборот, 0) КАК СуммаПродаж,<br>
 | ВТ_ДополнительныеНачисления.ПроцентНадбавки,<br>
 | ВТ_ДополнительныеНачисления.НомерСтроки<br>
 |ИЗ<br>
 | ВТ_ДополнительныеНачисления КАК ВТ_ДополнительныеНачисления<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.ОборотыДтКт(<br>
 | &НачалоПериода,<br>
 | &КонецПериода,<br>
 | ,<br>
 | СчетДт = &СчетПокупатели,<br>
 | ,<br>
 | СчетКт = &СчетПрибыли,<br>
 | &Субконто,<br>
 | СубконтоКт1 В<br>
 | (ВЫБРАТЬ<br>
 | Т.Подразделение<br>
 | ИЗ<br>
 | ВТ_ДополнительныеНачисления КАК Т)) КАК УправленческийОборотыДтКт<br>
 | ПО ВТ_ДополнительныеНачисления.Подразделение = УправленческийОборотыДтКт.СубконтоКт1";<br>
 <br>
 Субконто = Новый Массив(1);<br>
 Субконто[0] = ПланыВидовХарактеристик.ВидыСубконто.Подразделения;<br>
 НачалоПериода = НачалоМесяца(ДобавитьМесяц(Регистратор.Дата, -1)); <br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);<br>
 Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(НачалоПериода));<br>
 Запрос.УстановитьПараметр("СчетПокупатели", ПланыСчетов.Управленческий.Покупатели);<br>
 Запрос.УстановитьПараметр("СчетПрибыли", ПланыСчетов.Управленческий.ПрибылиУбытки);<br>
 Запрос.УстановитьПараметр("Субконто", Субконто);</p>

<p> СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.СуммаПродаж * Выборка.ПроцентНадбавки / 100;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<br>
<p>15. Отчет АнализНачислений<br>
Запрос:</p>

<p>ВЫБРАТЬ<br>
 ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 ОсновныеНачисления.Подразделение КАК Подразделение,<br>
 ОсновныеНачисления.Результат КАК РезультатОклад,<br>
 ОсновныеНачисления.ОтработаноЧасов КАК ОтработаноЧасов,<br>
 0 КАК ПроцентНадбавки,<br>
 0 КАК РезультатНадбавка<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.ПериодРегистрации = НАЧАЛОПЕРИОДА(&МесяцОтчета, МЕСЯЦ)<br>
 И ОсновныеНачисления.ВидРасчета = &ВидРасчетаОклад<br>
 И ОсновныеНачисления.Активность</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 ДополнительныеНачисления.Сотрудник,<br>
 ДополнительныеНачисления.Подразделение,<br>
 0,<br>
 0,<br>
 ДополнительныеНачисления.ПроцентНадбавки,<br>
 ДополнительныеНачисления.Результат<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
ГДЕ<br>
 ДополнительныеНачисления.ПериодРегистрации = НАЧАЛОПЕРИОДА(&МесяцОтчета, МЕСЯЦ)<br>
 И ДополнительныеНачисления.Активность</p>

<p>Выч.поля: ИтогоСумма выражение "РезультатОклад+РезультатНадбавка" заголовок "Итого: (Сумма)"<br>
ресурсы ОтработаноЧасов, РезультатНадбавка, РезультатОклад, ИтогоСумма, ПроцентНадбавки (расч по Сотрудник)<br>
параметры: ВидРасчетаОклад ПланВидовРасчетаСсылка.ОсновныеНачисления знач ПланВидовРасчета.ОсновныеНачисления.Оклад (огр.дост)<br>
 МесяцОтчета Дата</p>

<p>Группировки<br>
1. Заголовок <Месяц: [МесяцОтчета]> Формат (ПараметрыДанных.МесяцОтчета, "ДФ = 'ММММ гггг ""г.""'")<br>
2. Подразделение, Сотрудник</p>

<p>Группировка - Детальные записи<br>
Отчет выб поля: Подразделение, Сотрудник,<br>
 Начисление по окладу (в отд.колонке) Отработано (час) (ОтработаноЧасов) Сумма (РезультатОклад)<br>
 Начислено от продаж (в отд.колонке) % (ПроцентНадбавки) Сумма (РезультатНадбавка)<br>
 Итого сумма (в отд.колонке) (ИтогоСумма)</p>

<br>
<p>Выводить параметры = Не выводить, Авто позиция ресурсов = Не использовать</p>

<p>#СПР6</p>

<p>1. Создать спр Автомобили</p>

<p>2. В ПВР ДополнительныеНачисления вкладка Расчет флаг "Использует период действия" снять, зависит по периоду действия<br>
базовые = ДополнительныеНачисления <br>
 Предопр виды расч: Надбавка, ФиксированнаяСумма (флагов нет)</p>

<p>3. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" установить, зависит по периоду действия<br>
базовые = ОсновныеНачисления и ДополнительныеНачисления <br>
 Предопр виды расч: Отпуск (базовые Отпуск, Надбавка, ФиксированнаяСумма; ведущие Отпуск, Надбавка, ФиксированнаяСумма)</p>

<p>4. Создать регистрСведений ГрафикиРаботы (Непериодический, независимый), изм Дата (Дата), Автомобиль; рес РабочихДней 5,2, ДнейПятидневки 1,0</p>

<p>5. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Автомобиль; рес. Результат 12,2<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = РабочихДней, Дата графика = Дата, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты<br>
Создать перерасчет ПерерасчетОсновныеНачисления (Сотрудник, Автомобиль)</p>

<p>6. Создать регистр расчета "ДополнительныеНачисления", изм. Сотрудник, Автомобиль; рес. Результат 12,2<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Ложь, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты<br>
Создать перерасчет ПерерасчетДополнительныеНачисления (Сотрудник, Автомобиль)</p>

<p>7. Создать Регистр накопления ОплатыПассажиров (обороты)<br>
 регистратор док ОплатыПассажиров<br>
изм: Сотрудник, Автомобиль; рес. Сумма 12,2</p>

<p>8. Обработка ЗаполнениеГрафика, добавить рекв Автомобиль в шапку<br>
в модуле формы: <br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры</p>

<p>в модуле объекта</p>

<p>Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.Автомобиль.Установить(Автомобиль);<br>
 <br>
 ЧислоСекундВСутках = 86400;<br>
 <br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = Дат;<br>
 Запись.Автомобиль = Автомобиль;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.РабочихДней = 0;<br>
 Иначе <br>
 Запись.РабочихДней = 1;<br>
 КонецЕсли; <br>
 <br>
 Если ДеньНедели(Дат) < 6 Тогда <br>
 Запись.ДнейПятидневки = 1;<br>
 Иначе<br>
 Запись.ДнейПятидневки = 0;<br>
 КонецЕсли;<br>
 <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<p>9. Создать док ОплатыПассажиров, рекв шапки Сотрудник, Автомобиль, СуммаОплаты<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОПЛАТЫ ПАССАЖИРОВ<br>
 <br>
 Движения.ОплатыПассажиров.Записывать = Истина;<br>
 <br>
 Движение = Движения.ОплатыПассажиров.Добавить();<br>
 Движение.Период = Дата;<br>
 Движение.Сотрудник = Сотрудник;<br>
 Движение.Автомобиль = Автомобиль;<br>
 Движение.Сумма = СуммаОплаты;<br>
КонецПроцедуры</p>

<p>10. док НачислениеЗарплаты<br>
В ТЧ ОсновныеНачисления: Сотрудник, Автомобиль, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), ДатаНачала, ДатаОкончания (Дата)<br>
В ТЧ ДополнительныеНачисления: Сотрудник, Автомобиль, ВидРасчета (ПланВидовРасчетаСсылка.ДополнительныеНачисления)</p>

<p>в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 <br>
 // Запрос для формирования рабочих наборов записей<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | НачислениеЗарплатыДополнительныеНачисления.Сотрудник КАК Сотрудник,<br>
 | НачислениеЗарплатыДополнительныеНачисления.Автомобиль КАК Автомобиль,<br>
 | НачислениеЗарплатыДополнительныеНачисления.ВидРасчета КАК ВидРасчета<br>
 |ПОМЕСТИТЬ ВТ_ДанныеПоНадбавке<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ДополнительныеНачисления КАК НачислениеЗарплатыДополнительныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыДополнительныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыДополнительныеНачисления.ВидРасчета = &ВидРасчетаНадбавка<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник,<br>
 | Автомобиль<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеПоНадбавке.Сотрудник КАК Сотрудник,<br>
 | ВТ_ДанныеПоНадбавке.Автомобиль КАК Автомобиль,<br>
 | ВТ_ДанныеПоНадбавке.ВидРасчета КАК ВидРасчета,<br>
 | ЕСТЬNULL(ОплатыПассажировОбороты.СуммаОборот * ПоказателиДляНачисленийСрезПоследних.ПроцентНадбавки / 100, 0) КАК Результат,<br>
 | &ПериодРегистрации КАК ПериодРегистрации<br>
 |ИЗ<br>
 | ВТ_ДанныеПоНадбавке КАК ВТ_ДанныеПоНадбавке<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПоказателиДляНачислений.СрезПоследних(&ПериодРегистрации, ) КАК ПоказателиДляНачисленийСрезПоследних<br>
 | ПО (ИСТИНА)<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОплатыПассажиров.Обороты(<br>
 | &НачалоПериодаБазы,<br>
 | &КонецПериодаБазы,<br>
 | ,<br>
 | (Сотрудник, Автомобиль) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеПоНадбавке.Сотрудник,<br>
 | ВТ_ДанныеПоНадбавке.Автомобиль<br>
 | ИЗ<br>
 | ВТ_ДанныеПоНадбавке КАК ВТ_ДанныеПоНадбавке)) КАК ОплатыПассажировОбороты<br>
 | ПО ВТ_ДанныеПоНадбавке.Сотрудник = ОплатыПассажировОбороты.Сотрудник<br>
 | И ВТ_ДанныеПоНадбавке.Автомобиль = ОплатыПассажировОбороты.Автомобиль<br>
 |<br>
 |ОБЪЕДИНИТЬ ВСЕ<br>
 |<br>
 |ВЫБРАТЬ<br>
 | НачислениеЗарплатыДополнительныеНачисления.Сотрудник,<br>
 | НачислениеЗарплатыДополнительныеНачисления.Автомобиль,<br>
 | НачислениеЗарплатыДополнительныеНачисления.ВидРасчета,<br>
 | ЕСТЬNULL(ПоказателиДляНачисленийСрезПоследних.ФиксированнаяСумма, 0),<br>
 | &ПериодРегистрации<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ДополнительныеНачисления КАК НачислениеЗарплатыДополнительныеНачисления<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПоказателиДляНачислений.СрезПоследних(&ПериодРегистрации, ) КАК ПоказателиДляНачисленийСрезПоследних<br>
 | ПО (ИСТИНА)<br>
 |ГДЕ<br>
 | НачислениеЗарплатыДополнительныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыДополнительныеНачисления.ВидРасчета = &ВидРасчетаФиксированнаяСумма<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | НачислениеЗарплатыОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 | НачислениеЗарплатыОсновныеНачисления.Автомобиль КАК Автомобиль,<br>
 | НачислениеЗарплатыОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаНачала КАК ПериодДействияНачало,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаОкончания КАК ПериодДействияКонец,<br>
 | &ПериодРегистрации КАК ПериодРегистрации,<br>
 | ДОБАВИТЬКДАТЕ(&ПериодРегистрации, МЕСЯЦ, -3) КАК БазовыйПериодНачало,<br>
 | ДОБАВИТЬКДАТЕ(&ПериодРегистрации, СЕКУНДА, -1) КАК БазовыйПериодКонец<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ОсновныеНачисления КАК НачислениеЗарплатыОсновныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыОсновныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыОсновныеНачисления.ВидРасчета = &ВидРасчетаОтпуск";<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Дата);</p>

<p> Запрос.УстановитьПараметр("ПериодРегистрации", НачалоМесяца(Дата));<br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("ВидРасчетаФиксированнаяСумма", ПланыВидовРасчета.ДополнительныеНачисления.ФиксированнаяСумма);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОтпуск", ПланыВидовРасчета.ОсновныеНачисления.Отпуск);<br>
 Запрос.УстановитьПараметр("ВидРасчетаНадбавка", ПланыВидовРасчета.ДополнительныеНачисления.Надбавка); <br>
 Запрос.УстановитьПараметр("НачалоПериодаБазы", ДобавитьМесяц(ПериодРегистрации, -1));<br>
 Запрос.УстановитьПараметр("КонецПериодаБазы", ПериодРегистрации-1);<br>
 <br>
 // Обход результатов запроса, заполнение наборов записей<br>
 МассивРезультатов = Запрос.ВыполнитьПакет();<br>
 <br>
 РезультатДН = МассивРезультатов[1]; <br>
 <br>
 Если Не РезультатДН.Пустой() Тогда<br>
 Выборка = РезультатДН.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 КонецЦикла;<br>
 КонецЕсли;</p>

<p> РезультатОН = МассивРезультатов[2]; <br>
 Если Не РезультатОН.Пустой() Тогда<br>
 Выборка = РезультатОН.Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Выборка);<br>
 КонецЦикла;<br>
 КонецЕсли;<br>
 <br>
 // Запись рабочих наборов записей, при этом по видам расчета "Надбавка" и "Фиксированная сумма" уже выполнен расчет Результата<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистре<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения.ОсновныеНачисления); <br>
 <br>
КонецПроцедуры</p>

<p>11. Создать модуль Расчет (Сервер)<br>
Процедура РассчитатьНачисления (Регистратор, НаборЗаписей) Экспорт<br>
 <br>
 // РАСЧЕТ ОТПУСКА<br>
 // Формула расчета: [Сумма базы (по всем начислениям)] / [Количество рабочих дней в базовом периоде] * [Количество дней в отпуске] <br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейПятидневкиФактическийПериодДействия, 0) КАК ДнейФакт,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.РабочихДнейБазовыйПериод, 0) КАК ДнейБаза,<br>
 | ЕСТЬNULL(ОсновныеНачисленияБазаОсновныеНачисления.РезультатБаза, 0) + ЕСТЬNULL(ОсновныеНачисленияБазаДополнительныеНачисления.РезультатБаза, 0) КАК База<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОтпуск) КАК ОсновныеНачисленияДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОтпуск) КАК ОсновныеНачисленияБазаОсновныеНачисления<br>
 | ПО ОсновныеНачисленияДанныеГрафика.НомерСтроки = ОсновныеНачисленияБазаОсновныеНачисления.НомерСтроки<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисления.БазаДополнительныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОтпуск) КАК ОсновныеНачисленияБазаДополнительныеНачисления<br>
 | ПО ОсновныеНачисленияДанныеГрафика.НомерСтроки = ОсновныеНачисленияБазаДополнительныеНачисления.НомерСтроки";<br>
 <br>
 Измерения = Новый Массив(2);<br>
 Измерения[0] = "Сотрудник";<br>
 Измерения[1] = "Автомобиль";<br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОтпуск", ПланыВидовРасчета.ОсновныеНачисления.Отпуск); <br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ДнейБаза = 0, 0, Выборка.База / Выборка.ДнейБаза * Выборка.ДнейФакт);<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать(, Истина); </p>

<p>КонецПроцедуры</p>

<p>12. Отчет Перерасчеты<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ПерерасчетДополнительныеНачисления.ОбъектПерерасчета КАК ОбъектПерерасчета,<br>
 ПерерасчетДополнительныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 ПерерасчетДополнительныеНачисления.Сотрудник КАК Сотрудник,<br>
 ПерерасчетДополнительныеНачисления.Автомобиль КАК Автомобиль<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления.ПерерасчетДополнительныеНачисления КАК ПерерасчетДополнительныеНачисления</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 ПерерасчетОсновныеНачисления.ОбъектПерерасчета,<br>
 ПерерасчетОсновныеНачисления.ВидРасчета,<br>
 ПерерасчетОсновныеНачисления.Сотрудник,<br>
 ПерерасчетОсновныеНачисления.Автомобиль<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления.ПерерасчетОсновныеНачисления КАК ПерерасчетОсновныеНачисления</p>

<p>Группировка <Детальные записи><br>
Отчет Выб.поля ОбъектПерерасчета, ВидРасчета, Сотрудник, Автомобиль<br>
В наборе данных заголовок Регистратор поменять на Объект перерасчета</p>

<p>13. Отчет АнализНачислений<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОсновныеНачисления.ПериодРегистрации КАК ПериодРегистрации,<br>
 ОсновныеНачисления.Автомобиль КАК Автомобиль,<br>
 ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 ОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 ОсновныеНачисления.Результат КАК Результат<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода<br>
 И ОсновныеНачисления.Активность</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 ДополнительныеНачисления.ПериодРегистрации,<br>
 ДополнительныеНачисления.Автомобиль,<br>
 ДополнительныеНачисления.Сотрудник,<br>
 ДополнительныеНачисления.ВидРасчета,<br>
 ДополнительныеНачисления.Результат<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
ГДЕ<br>
 ДополнительныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода<br>
 И ДополнительныеНачисления.Активность<br>
Ресурсы Результат Сумма(Результат)<br>
Параметры: Период СтандартныйПериод, НачалоПериода Дата НачалоПериода(&Период.ДатаНачала, "Месяц") огр дост, КонецПериода Дата КонецПериода(&Период.ДатаОкончания, "Месяц") огр дост</p>

<p>Группировки<br>
1. Заголовок <Период [НачалоПериода] - [КонецПериода]> Формат (ПараметрыДанных.НачалоПериода, "ДФ = 'ММММ гггг'"), Формат (ПараметрыДанных.КонецПериода, "ДФ = 'ММММ гггг'")<br>
2. Таблица Строки: Автомобиль, Сотрудник, ВидРасчета<br>
 Колонки: ПериодРегистрации</p>

<p>отч выб поля: (Результат) убр заголовок, Автомобиль, Сотрудник, Вид начисления (ВидРасчета), ПериодРегистрации<br>
Выводить параметры = Не выводить</p>

<p>#СПР7</p>

<p>1. Создать спр Графики</p>

<p>2. Создать рег сведений СведенияОСотрудниках (В пределах дня), изм: Сотрудник, Подразделение; рес: Оклад 10.2</p>

<p>3. Создать рег сведений ГрафикиРаботы, изм: Дата, График (СправочникСсылка.Графики); рес КоличествоЧасов 5.2</p>

<p>4. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" установить, не зависит <br>
базовые = ОсновныеНачисления и ДополнительныеНачисления <br>
 Предопр виды расч: Оклад (флагов нет)</p>

<p>5. В ПВР ДополнительныеНачисления вкладка Расчет флаг "Использует период действия" снять, зависит по периоду действия<br>
базовые = ОсновныеНачисления, ДополнительныеНачисления <br>
 Предопр виды расч: Командировка (базовые = Оклад, Командировка, ведущих нет)</p>

<p>6. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Подразделение; рес. Результат 12,2, РабочихЧасов 5.2; рекв График<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина, Базовый период = Ложь<br>
График = ГрафикиРаботы, Значение графика = КоличествоЧасов, Дата графика = Дата, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>7. Создать регистр расчета "ДополнительныеНачисления", изм. Сотрудник, Подразделение; рес. Результат 12,2<br>
указать ПВР - ДополнительныеНачисления, флаг ПериодДействия = Ложь, Базовый период = истина, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>8. Обработка ЗаполнениеГрафика, добавить рекв График в шапку<br>
в модуле формы: <br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры</p>

<p>в модуле объекта</p>

<p>Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.График.Установить (График);<br>
 <br>
 Набор.Прочитать();<br>
 <br>
 ЧислоСекундВСутках = 86400;<br>
 <br>
 Дат = ДатаНачала; <br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.График = График;<br>
 Запись.Дата = Дат;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.КоличествоЧасов = 0;<br>
 Иначе <br>
 Запись.КоличествоЧасов = 8;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 Набор.Записать();<br>
 <br>
КонецПроцедуры</p>

<br>
<p>9. Создать док Табель, рекв шапки Подразделение, ТЧ СписокСотрудников рекв Сотрудник, День1 Синоним 1 Строка 3,..., День31 Синоним 31 Строка 3<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ДАННЫЕ ТАБЕЛЯ<br>
 Движения.ДанныеТабеля.Записывать = Истина;<br>
 НачалоМесяцаТабеля = НачалоМесяца(Дата);<br>
 <br>
 // Обходим каждый день каждой строки табличной части, если поле заполнено, то добавляем запись в регистр,<br>
 // заполняя, если в поле есть буква "К", то ресурс "Часов в командировке", иначе ресурс "Часов отработано"<br>
 Для Каждого СтрокаТЧ Из СписокСотрудников Цикл <br>
 Для ДеньМесяца = 1 По 31 Цикл<br>
 ДанныеДня = СтрокаТЧ["День" + ДеньМесяца];<br>
 <br>
 Если ЗначениеЗаполнено(ДанныеДня) Тогда<br>
 <br>
 НоваяЗапись = Движения.ДанныеТабеля.Добавить();<br>
 НоваяЗапись.Период = НачалоМесяцаТабеля + (ДеньМесяца - 1) * 86400;<br>
 НоваяЗапись.Сотрудник = СтрокаТЧ.Сотрудник;<br>
 НоваяЗапись.Подразделение = Подразделение;<br>
 <br>
 Если СтрНайти(ДанныеДня, "К") > 0 Тогда<br>
 НоваяЗапись.ЧасовВКомандировке = Число (Лев(ДанныеДня, СтрДлина(ДанныеДня) - 1));<br>
 Иначе<br>
 НоваяЗапись.ЧасовОтработано = Число (ДанныеДня);<br>
 КонецЕсли;<br>
 КонецЕсли;<br>
 КонецЦикла;<br>
 КонецЦикла; <br>
КонецПроцедуры</p>

<p>10. док НачислениеЗарплаты<br>
В ТЧ ОсновныеНачисления: Сотрудник, Подразделение, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), График, ДатаНачала, ДатаОкончания (Дата)<br>
В ТЧ ДополнительныеНачисления: Сотрудник, Подразделение, ВидРасчета (ПланВидовРасчетаСсылка.ДополнительныеНачисления)</p>

<p>в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)</p>

<p> ПериодРегистрации = НачалоМесяца(Дата);<br>
 <br>
 // регистр ОсновныеНачисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;<br>
 Движение.ПериодДействияКонец = ТекСтрокаОсновныеНачисления.ДатаОкончания;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;<br>
 Движение.График = ТекСтрокаОсновныеНачисления.График;<br>
 КонецЦикла;</p>

<p> // регистр ДополнительныеНачисления<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 Для Каждого ТекСтрокаДополнительныеНачисления Из ДополнительныеНачисления Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаДополнительныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.БазовыйПериодНачало = ДобавитьМесяц(ПериодРегистрации, -2);<br>
 Движение.БазовыйПериодКонец = ПериодРегистрации - 1;<br>
 Движение.Сотрудник = ТекСтрокаДополнительныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаДополнительныеНачисления.Подразделение;<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочих наборов записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления (Ссылка, Движения);</p>

<p>КонецПроцедуры</p>

<p>11. Создать модуль Расчет (Сервер)<br>
Процедура РассчитатьНачисления(Регистратор, Движения) Экспорт<br>
 НаборЗаписей = Движения.ОсновныеНачисления;<br>
 РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей); <br>
 НаборЗаписей.Записать(, Истина);<br>
 <br>
 ДопНаборЗаписей = Движения.ДополнительныеНачисления;<br>
 РассчитатьДопНачисления(Регистратор, ДопНаборЗаписей); <br>
 ДопНаборЗаписей.Записать();<br>
КонецПроцедуры</p>

<p>Процедура РассчитатьОсновныеНачисления (Регистратор, НаборЗаписей) <br>
 <br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Начальное значение оклада] / [Количество рабочих часов] * [Количество отработанных часов]</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки,<br>
 | ОсновныеНачисленияДанныеГрафика.Сотрудник КАК Сотрудник,<br>
 | ОсновныеНачисленияДанныеГрафика.Подразделение КАК Подразделение,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.КоличествоЧасовПериодДействия, 0) КАК ЧасовПлан,<br>
 | ОсновныеНачисленияДанныеГрафика.ПериодДействияНачало,<br>
 | ОсновныеНачисленияДанныеГрафика.ПериодДействияКонец<br>
 |ПОМЕСТИТЬ ВТ_ДанныеГрафика<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОклад) КАК ОсновныеНачисленияДанныеГрафика<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник,<br>
 | Подразделение<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.НомерСтроки,<br>
 | СУММА(ЕСТЬNULL(ДанныеТабеляОбороты.ЧасовОтработаноОборот, 0)) КАК ЧасовФакт,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.Оклад, 0) КАК Оклад,<br>
 | ВТ_ДанныеГрафика.ЧасовПлан<br>
 |ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ДанныеТабеля.Обороты(<br>
 | &ПериодРегистрации,<br>
 | &КонецМесяца,<br>
 | День,<br>
 | (Сотрудник, Подразделение) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.Сотрудник,<br>
 | ВТ_ДанныеГрафика.Подразделение<br>
 | ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика)) КАК ДанныеТабеляОбороты<br>
 | ПО ВТ_ДанныеГрафика.Сотрудник = ДанныеТабеляОбороты.Сотрудник<br>
 | И ВТ_ДанныеГрафика.Подразделение = ДанныеТабеляОбороты.Подразделение<br>
 | И ВТ_ДанныеГрафика.ПериодДействияНачало <= ДанныеТабеляОбороты.Период<br>
 | И ВТ_ДанныеГрафика.ПериодДействияКонец >= ДанныеТабеляОбороты.Период<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | (Сотрудник, Подразделение) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.Сотрудник,<br>
 | ВТ_ДанныеГрафика.Подразделение<br>
 | ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика)) КАК СведенияОСотрудникахСрезПоследних<br>
 | ПО ВТ_ДанныеГрафика.Сотрудник = СведенияОСотрудникахСрезПоследних.Сотрудник<br>
 | И ВТ_ДанныеГрафика.Подразделение = СведенияОСотрудникахСрезПоследних.Подразделение<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ВТ_ДанныеГрафика.НомерСтроки,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.Оклад, 0),<br>
 | ВТ_ДанныеГрафика.ЧасовПлан";<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Регистратор.Дата);<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", ПериодРегистрации);<br>
 Запрос.УстановитьПараметр("КонецМесяца", КонецМесяца(ПериодРегистрации));<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ЧасовПлан = 0, 0, Выборка.Оклад / Выборка.ЧасовПлан * Выборка.ЧасовФакт);<br>
 Запись.РабочихЧасов = Выборка.ЧасовПлан;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьДопНачисления (Регистратор, НаборЗаписей) <br>
 <br>
 // РАСЧЕТ КОМАНДИРОВКИ<br>
 // Формула расчета: [Сумма базы (по всем видам расчетов)] / [Количество рабочих часов в базовом периоде] * [Количество часов в командировке]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ЕСТЬNULL(ДополнительныеНачисленияБазаОсновныеНачисления.Сотрудник, ДополнительныеНачисленияБазаДополнительныеНачисления.Сотрудник) КАК Сотрудник,<br>
 | ЕСТЬNULL(ДополнительныеНачисленияБазаОсновныеНачисления.Подразделение, ДополнительныеНачисленияБазаДополнительныеНачисления.Подразделение) КАК Подразделение,<br>
 | ЕСТЬNULL(ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки, ДополнительныеНачисленияБазаДополнительныеНачисления.НомерСтроки) КАК НомерСтроки,<br>
 | ЕСТЬNULL(ДополнительныеНачисленияБазаДополнительныеНачисления.РезультатБаза, 0) + ЕСТЬNULL(ДополнительныеНачисленияБазаОсновныеНачисления.РезультатБаза, 0) КАК База,<br>
 | ЕСТЬNULL(ДополнительныеНачисленияБазаОсновныеНачисления.РабочихЧасовБаза, 0) КАК РабочихЧасов<br>
 |ПОМЕСТИТЬ ВТ_ДанныеБазы<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаКомандировка) КАК ДополнительныеНачисленияБазаОсновныеНачисления<br>
 | ПОЛНОЕ СОЕДИНЕНИЕ РегистрРасчета.ДополнительныеНачисления.БазаДополнительныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаКомандировка) КАК ДополнительныеНачисленияБазаДополнительныеНачисления<br>
 | ПО ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки = ДополнительныеНачисленияБазаДополнительныеНачисления.НомерСтроки<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник,<br>
 | Подразделение<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеБазы.НомерСтроки,<br>
 | ВТ_ДанныеБазы.База,<br>
 | ЕСТЬNULL(ДанныеТабеляОбороты.ЧасовВКомандировкеОборот, 0) КАК ЧасовФакт,<br>
 | ВТ_ДанныеБазы.РабочихЧасов<br>
 |ИЗ<br>
 | ВТ_ДанныеБазы КАК ВТ_ДанныеБазы<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ДанныеТабеля.Обороты(<br>
 | &ПериодРегистрации,<br>
 | &КонецМесяца,<br>
 | ,<br>
 | (Сотрудник, Подразделение) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеБазы.Сотрудник,<br>
 | ВТ_ДанныеБазы.Подразделение<br>
 | ИЗ<br>
 | ВТ_ДанныеБазы КАК ВТ_ДанныеБазы)) КАК ДанныеТабеляОбороты<br>
 | ПО ВТ_ДанныеБазы.Сотрудник = ДанныеТабеляОбороты.Сотрудник<br>
 | И ВТ_ДанныеБазы.Подразделение = ДанныеТабеляОбороты.Подразделение";<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Регистратор.Дата);<br>
 <br>
 Измерения = Новый Массив(2);<br>
 Измерения[0] = "Сотрудник";<br>
 Измерения[1] = "Подразделение";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаКомандировка", ПланыВидовРасчета.ДополнительныеНачисления.Командировка);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", ПериодРегистрации);<br>
 Запрос.УстановитьПараметр("КонецМесяца", КонецМесяца(ПериодРегистрации));<br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.РабочихЧасов = 0, 0, Выборка.База / Выборка.РабочихЧасов * Выборка.ЧасовФакт);<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>12. Отчет АнализНачислений<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОсновныеНачисления.Сотрудник,<br>
 ОсновныеНачисления.Подразделение,<br>
 ОсновныеНачисления.ВидРасчета,<br>
 ОсновныеНачисления.ПериодРегистрации,<br>
 ОсновныеНачисления.Результат<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.Активность<br>
 И ОсновныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 ДополнительныеНачисления.Сотрудник,<br>
 ДополнительныеНачисления.Подразделение,<br>
 ДополнительныеНачисления.ВидРасчета,<br>
 ДополнительныеНачисления.ПериодРегистрации,<br>
 ДополнительныеНачисления.Результат<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
ГДЕ<br>
 ДополнительныеНачисления.Активность<br>
 И ДополнительныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода</p>

<p>Ресурсы Результат Сумма(Результат)<br>
Параметры: Период СтандартныйПериод, НачалоПериода Дата НачалоПериода(&Период.ДатаНачала, "Месяц") огр дост, КонецПериода Дата КонецПериода(&Период.ДатаОкончания, "Месяц") огр дост</p>

<p>Группировки<br>
1. Заголовок <Период> Выражение ПериодРегистрации<br>
2. Таблица Строки: Подразделение, Сотрудник, ВидРасчета<br>
 Колонки: ПериодРегистрации</p>

<p>отч выб поля: Результат<br>
Выводить параметры = Не выводить</p>

<p>#СПР8</p>

<p>1. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" установить, зависит по периоду действия<br>
 Предопр виды расч: Оклад, Сверхурочные (базовые - оклад, сверхурочные)</p>

<p>2. Создать регистрСведений ГрафикиРаботы (Непериодический, независимый), изм Дата (Дата),Подразделение; рес РабочихЧасов 5,2, СверхурочныхЧасов 5,2</p>

<p>3. Создать регистрСведений КурсыВалют (В пределах дня, осн отбор по периоду = истина), изм Валюта, рес Курс 5.2</p>

<p>4. Создать регистрСведений ТарифныеСтавки (Непериодический, независимый), изм: Подразделение, ОтработаноОт 5.0, ОтработаноДо 5.0</p>

<p>5. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Подразделение, рес. РезультатВДолларах 12.2, РезультатВЕвро 12.2, РабочихЧасов 5,2<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = РабочихЧасов, Дата графика = Дата, Периодичность = месяц, баз.период = истина.<br>
Регистратор - НачислениеЗарплаты</p>

<p>6. В обработке ЗаполнениеГрафика добавить реквизит шапки Подразделение, создать форму.<br>
добавить рекв формы ОтражатьСверхурочные булево<br>
в модуле формы<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни, ОтражатьСверхурочные);<br>
КонецПроцедуры </p>

<p>в модуле объекта<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни, ОтражатьСверхурочные) Экспорт <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.Подразделение.Установить (Подразделение);<br>
 <br>
 Набор.Прочитать();<br>
 <br>
 ЧислоСекундВСутках = 86400;<br>
 <br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = Дат;<br>
 Запись.Подразделение = Подразделение;<br>
 ДеньНедели = ДеньНедели(Дат);<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели)) Тогда<br>
 Запись.РабочихЧасов = 0;<br>
 Иначе <br>
 Запись.РабочихЧасов = 8;<br>
 КонецЕсли; <br>
 <br>
 // Будем считать, что во вторник и четверг по три сверхурочных часа<br>
 Если ОтражатьСверхурочные И (ДеньНедели = 2 Или ДеньНедели = 4) Тогда<br>
 Запись.СверхурочныхЧасов = 3;<br>
 КонецЕсли;<br>
 <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<p>7. Создать док НачислениеЗарплаты<br>
ТЧ ОсновныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), ДатаНачала, ДатаОкончания (Дата)</p>

<p>в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 <br>
 // регистр ОсновныеНачисления <br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 <br>
 ВидРасчетаСверхурочные = ПланыВидовРасчета.ОсновныеНачисления.Сверхурочные;<br>
 НачалоБазовогоПериода = ДобавитьМесяц(ПериодРегистрации, -1);<br>
 КонецБазовогоПериода = КонецМесяца(НачалоБазовогоПериода);<br>
 <br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;<br>
 Движение.ПериодДействияКонец = ТекСтрокаОсновныеНачисления.ДатаОкончания;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;<br>
 <br>
 Если ТекСтрокаОсновныеНачисления.ВидРасчета = ВидРасчетаСверхурочные Тогда<br>
 Движение.БазовыйПериодНачало = НачалоБазовогоПериода;<br>
 Движение.БазовыйПериодКонец = КонецБазовогоПериода;<br>
 КонецЕсли;<br>
 <br>
 КонецЦикла;</p>

<p> // Запись рабочих наборов записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения.ОсновныеНачисления, Отказ);<br>
КонецПроцедуры</p>

<br>
<p>8. Создать модуль Расчет (Сервер)</p>

<p>Процедура РассчитатьНачисления(Регистратор, НаборЗаписей, Отказ) Экспорт<br>
 <br>
 // Определение курсов доллара и евро<br>
 ЗапросКурсы = Новый Запрос;<br>
 ЗапросКурсы.Текст =<br>
 "ВЫБРАТЬ<br>
 | КурсыВалютСрезПоследних.Курс КАК Курс<br>
 |ИЗ<br>
 | РегистрСведений.КурсыВалют.СрезПоследних(&ДатаСреза, Валюта.Код = 840) КАК КурсыВалютСрезПоследних<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | КурсыВалютСрезПоследних.Курс КАК Курс<br>
 |ИЗ<br>
 | РегистрСведений.КурсыВалют.СрезПоследних(&ДатаСреза, Валюта.Код = 978) КАК КурсыВалютСрезПоследних";<br>
 <br>
 ЗапросКурсы.УстановитьПараметр("ДатаСреза", Регистратор.Дата);<br>
 МассивРезультатов = ЗапросКурсы.ВыполнитьПакет();<br>
 РезультатДоллар = МассивРезультатов[0];<br>
 РезультатЕвро = МассивРезультатов[1];<br>
 <br>
 Если РезультатДоллар.Пустой() Или РезультатЕвро.Пустой() Тогда<br>
 Сообщение = Новый СообщениеПользователю;<br>
 Сообщение.Текст = "В регистре курсов валют должны быть заполнены курсы доллара и евро";<br>
 Сообщение.Сообщить();<br>
 <br>
 Отказ = Истина;<br>
 Возврат;<br>
 КонецЕсли;<br>
 <br>
 Данные = РезультатДоллар.Выбрать();<br>
 Данные.Следующий();<br>
 КурсДоллара = Данные.Курс;<br>
 <br>
 Данные = РезультатЕвро.Выбрать();<br>
 Данные.Следующий();<br>
 КурсЕвро = Данные.Курс;<br>
 <br>
 // Формирование движений<br>
 <br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Количество отработанных часов] * [Тарифная ставка]</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.РабочихЧасовФактическийПериодДействия, 0) КАК ЧасовФакт,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.РабочихЧасовПериодДействия, 0) КАК ЧасовПлан,<br>
 | ЕСТЬNULL(ТарифныеСтавки.Ставка, 0) КАК Ставка<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОклад) КАК ОсновныеНачисленияДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ТарифныеСтавки КАК ТарифныеСтавки<br>
 | ПО ОсновныеНачисленияДанныеГрафика.Подразделение = ТарифныеСтавки.Подразделение<br>
 | И ОсновныеНачисленияДанныеГрафика.РабочихЧасовФактическийПериодДействия >= ТарифныеСтавки.ОтработаноОт<br>
 | И ОсновныеНачисленияДанныеГрафика.РабочихЧасовФактическийПериодДействия < ТарифныеСтавки.ОтработаноДо";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 <br>
 Результат = Запрос.Выполнить();<br>
 <br>
 Если Не Результат.Пустой() Тогда<br>
 <br>
 Выборка = Результат.Выбрать();<br>
 СтруктураПоиска = Новый Структура();<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 РезультатВРублях = Выборка.ЧасовФакт * Выборка.Ставка;<br>
 Запись.РезультатВДолларах = РезультатВРублях / КурсДоллара;<br>
 Запись.РезультатВЕвро = РезультатВРублях / КурсЕвро;<br>
 <br>
 Запись.РабочихЧасов = Выборка.ЧасовПлан;<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 <br>
 КонецЦикла;<br>
 КонецЕсли;</p>

<p> // РАСЧЕТ СВЕРХУРОЧНЫХ<br>
 // Формула расчета: [Сумма базы (по всем начислениям)] / [Количество рабочих часов в базовом периоде] * [Количество сверхурочных часов] * 1.5 </p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.СверхурочныхЧасовФактическийПериодДействия, 0) КАК СверхурочныхЧасов,<br>
 | ЕСТЬNULL(ОсновныеНачисленияБазаОсновныеНачисления.РезультатВДолларахБаза, 0) КАК БазаВДолларах,<br>
 | ЕСТЬNULL(ОсновныеНачисленияБазаОсновныеНачисления.РезультатВЕвроБаза, 0) КАК БазаВЕвро,<br>
 | ЕСТЬNULL(ОсновныеНачисленияБазаОсновныеНачисления.РабочихЧасовБаза, 0) КАК РабочихЧасов<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаСверхурочные) КАК ОсновныеНачисленияДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаСверхурочные) КАК ОсновныеНачисленияБазаОсновныеНачисления<br>
 | ПО ОсновныеНачисленияДанныеГрафика.НомерСтроки = ОсновныеНачисленияБазаОсновныеНачисления.НомерСтроки";<br>
 <br>
 Измерения = Новый Массив(2);<br>
 Измерения[0] = "Сотрудник";<br>
 Измерения[1] = "Подразделение";<br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаСверхурочные", ПланыВидовРасчета.ОсновныеНачисления.Сверхурочные);<br>
 <br>
 Результат = Запрос.Выполнить();<br>
 <br>
 Если Не Результат.Пустой() Тогда<br>
 <br>
 Выборка = Результат.Выбрать();<br>
 СтруктураПоиска = Новый Структура();<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Если Выборка.РабочихЧасов = 0 Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 Запись.РезультатВДолларах = Выборка.БазаВДолларах / Выборка.РабочихЧасов * Выборка.СверхурочныхЧасов * 1.5;<br>
 Запись.РезультатВЕвро = Выборка.БазаВЕвро / Выборка.РабочихЧасов * Выборка.СверхурочныхЧасов * 1.5;<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 <br>
 КонецЦикла;<br>
 КонецЕсли;<br>
 <br>
 НаборЗаписей.Записать(, Истина);<br>
КонецПроцедуры</p>

<p>9. Отчет АнализНачислений<br>
Запрос:</p>

<p>ВЫБРАТЬ<br>
 ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 ОсновныеНачисления.Подразделение КАК Подразделение,<br>
 ОсновныеНачисления.РезультатВДолларах КАК СуммаUSD,<br>
 ОсновныеНачисления.РезультатВЕвро КАК СуммаEUR,<br>
 ОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 ОсновныеНачисления.ПериодРегистрации КАК ПериодРегистрации<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода<br>
 И ОсновныеНачисления.Активность</p>

<p>В наборе формат для ПериодаРегистрации = ДФ='ММММ гггг'</p>

<p>ресурсы СуммаEUR, СуммаUSD (все сумма)<br>
Параметры: Период СтандартныйПериод, НачалоПериода Дата НачалоПериода(&Период.ДатаНачала) огр дост, КонецПериода Дата КонецПериода(&Период.ДатаОкончания) огр дост</p>

<p>Группировки<br>
1. Таблица<br>
 Строки: Подразделение, Сотрудник, ВидРасчета<br>
 Колонки: ПериодРегистрации<br>
выб поля СуммаUSD, СуммаEUR</p>

<p>Выводить параметры = Не выводить</p>

<p>#СПР9</p>

<p>1. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" установить, зависит по периоду действия<br>
 Предопр виды расч: Оклад (Вытесняющие - больничный), Больничный (базовые - оклад)</p>

<p>2. Создать регистрСведений ГрафикиРаботы (Непериодический, независимый), изм График, Дата (Дата); рес Часов 5,2, Дней 5,0</p>

<p>4. Создать регистрСведений СведенияОСотрудниках (в пределдах дня, независимый), изм: Подразделение, ОтработаноОт 5.0, ОтработаноДо 5.0</p>

<p>5. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Подразделение; рес: Результат 12.2, РабочихДней 5.0; рекв: График, ДнейБолезни 5.0, Параметр 10.2<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = Часов, Дата графика = Дата, Периодичность = месяц, баз.период = истина.<br>
Регистратор - НачислениеЗарплаты</p>

<p>6. В обработке ЗаполнениеГрафика добавить рекв шапки График<br>
в модуле формы<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры </p>

<p>в модуле объекта<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 <br>
 Набор.Отбор.График.Установить (График);<br>
 Набор.Прочитать();<br>
 <br>
 ЧислоСекундВСутках = 86400;<br>
 <br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = Дат;<br>
 Запись.График = График;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.Часов = 0;<br>
 Запись.Дней = 0;<br>
 Иначе <br>
 Запись.Часов = 8;<br>
 Запись.Дней = 1;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<br>
<p>7. Создать док НачислениеЗарплаты<br>
ТЧ ОсновныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), График, ДатаНачала, ДатаОкончания (Дата)<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 <br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ОСНОВНЫЕ НАЧИСЛЕНИЯ<br>
 <br>
 // Запрос для формирования рабочего набора записей<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | НачислениеЗарплатыОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 | НачислениеЗарплатыОсновныеНачисления.Подразделение КАК Подразделение,<br>
 | НачислениеЗарплатыОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 | НачислениеЗарплатыОсновныеНачисления.График КАК График,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаНачала КАК ДатаНачала,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаОкончания КАК ДатаОкончания<br>
 |ПОМЕСТИТЬ ВТ_ТабЧасть_Оклад<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ОсновныеНачисления КАК НачислениеЗарплатыОсновныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыОсновныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыОсновныеНачисления.ВидРасчета = &ВидРасчетаОклад<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник,<br>
 | Подразделение<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ТабЧасть_Оклад.Сотрудник КАК Сотрудник,<br>
 | ВТ_ТабЧасть_Оклад.Подразделение КАК Подразделение,<br>
 | ВТ_ТабЧасть_Оклад.ВидРасчета КАК ВидРасчета,<br>
 | ВТ_ТабЧасть_Оклад.График КАК График,<br>
 | ВТ_ТабЧасть_Оклад.ДатаНачала КАК ПериодДействияНачало,<br>
 | ВТ_ТабЧасть_Оклад.ДатаОкончания КАК ПериодДействияКонец,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.ЧасоваяСтавка, 0) КАК Параметр,<br>
 | &ПериодРегистрации КАК ПериодРегистрации<br>
 |ИЗ<br>
 | ВТ_ТабЧасть_Оклад КАК ВТ_ТабЧасть_Оклад<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | (Сотрудник, Подразделение) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ТабЧасть_Оклад.Сотрудник КАК Сотрудник,<br>
 | ВТ_ТабЧасть_Оклад.Подразделение КАК Подразделение<br>
 | ИЗ<br>
 | ВТ_ТабЧасть_Оклад КАК ВТ_ТабЧасть_Оклад)) КАК СведенияОСотрудникахСрезПоследних<br>
 | ПО ВТ_ТабЧасть_Оклад.Сотрудник = СведенияОСотрудникахСрезПоследних.Сотрудник<br>
 | И ВТ_ТабЧасть_Оклад.Подразделение = СведенияОСотрудникахСрезПоследних.Подразделение<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | НачислениеЗарплатыОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 | НачислениеЗарплатыОсновныеНачисления.Подразделение КАК Подразделение,<br>
 | НачислениеЗарплатыОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаНачала,<br>
 | НачислениеЗарплатыОсновныеНачисления.ДатаОкончания,<br>
 | &ПериодРегистрации КАК ПериодРегистрации,<br>
 | РАЗНОСТЬДАТ(НачислениеЗарплатыОсновныеНачисления.ДатаНачала, НачислениеЗарплатыОсновныеНачисления.ДатаОкончания, МЕСЯЦ) КАК КоличествоМесяцев<br>
 |ИЗ<br>
 | Документ.НачислениеЗарплаты.ОсновныеНачисления КАК НачислениеЗарплатыОсновныеНачисления<br>
 |ГДЕ<br>
 | НачислениеЗарплатыОсновныеНачисления.Ссылка = &Ссылка<br>
 | И НачислениеЗарплатыОсновныеНачисления.ВидРасчета = &ВидРасчетаБольничный";<br>
 <br>
 Запрос.УстановитьПараметр("Ссылка", Ссылка);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 Запрос.УстановитьПараметр("ВидРасчетаБольничный", ПланыВидовРасчета.ОсновныеНачисления.Больничный);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", НачалоМесяца(Дата));<br>
 <br>
 МассивРезультатов = Запрос.ВыполнитьПакет();<br>
 <br>
 // Обход результата запроса по Окладу, заполнение движений в регистре<br>
 ВыборкаОклад = МассивРезультатов[1].Выбрать();<br>
 Пока ВыборкаОклад.Следующий() Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, ВыборкаОклад);<br>
 КонецЦикла;<br>
 <br>
 // Обход результата запроса по Больничному, заполнение движений в регистре<br>
 ВыборкаБольничный = МассивРезультатов[2].Выбрать();<br>
 // Разбиваем заданный период больничного по месяцам, при этом для каждого записи в качестве начала периода действия <br>
 // устанавливаем начало месяца, в качестве конца - конец месяца, переопределяем только начало периода действия <br>
 // для первой строки и конец периода действия для последней строки<br>
 Пока ВыборкаБольничный.Следующий() Цикл<br>
 Для ИндексМесяца = 0 По ВыборкаБольничный.КоличествоМесяцев Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, ВыборкаБольничный);<br>
 <br>
 НачалоТекущегоМесяца = НачалоМесяца (ДобавитьМесяц(ВыборкаБольничный.ДатаНачала, ИндексМесяца));<br>
 <br>
 Если ИндексМесяца = 0 Тогда<br>
 ПериодДействияНачало = ВыборкаБольничный.ДатаНачала // Переопределение значения ПериодДействияНачало для первой строки<br>
 Иначе<br>
 ПериодДействияНачало = НачалоТекущегоМесяца;<br>
 КонецЕсли;<br>
 <br>
 Движение.ПериодДействияНачало = ПериодДействияНачало;<br>
 Движение.ПериодДействияКонец = КонецМесяца(НачалоТекущегоМесяца);<br>
 <br>
 Движение.БазовыйПериодНачало = ДобавитьМесяц(НачалоТекущегоМесяца, -1);<br>
 Движение.БазовыйПериодКонец = КонецМесяца(Движение.БазовыйПериодНачало);<br>
 КонецЦикла;<br>
 <br>
 Движение.ПериодДействияКонец = ВыборкаБольничный.ДатаОкончания; // Переопределение значения ПериодДействияКонец для последней строки<br>
 <br>
 КонецЦикла;</p>

<p> // Данные могут вводиться задним числом, значит необходимо сформировать сторно записи<br>
 СторноЗаписи = Движения.ОсновныеНачисления.ПолучитьДополнение();<br>
 Для Каждого Сторно Из СторноЗаписи Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Сторно);<br>
 Движение.ПериодРегистрации = Сторно.ПериодРегистрацииСторно;<br>
 Движение.ПериодДействияНачало = Сторно.ПериодДействияНачалоСторно;<br>
 Движение.ПериодДействияКонец = Сторно.ПериодДействияКонецСторно;<br>
 Движение.Сторно = Истина;<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочего набора записей<br>
 Движения.ОсновныеНачисления.Записать();<br>
 <br>
 // Окончательный расчет данных в регистре<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения.ОсновныеНачисления);<br>
КонецПроцедуры</p>

<p>8. Создать модуль Расчет (Сервер)<br>
Процедура РассчитатьНачисления(Регистратор, НаборЗаписей) Экспорт<br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Количество отработанных часов] * [Тарифная ставка]</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовФактическийПериодДействия, 0) КАК ЧасовФакт,<br>
 | ОсновныеНачисленияДанныеГрафика.Параметр КАК Ставка,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейПериодДействия, 0) КАК ДнейПлан<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОклад) КАК ОсновныеНачисленияДанныеГрафика";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 <br>
 Если Запись.Сторно Тогда<br>
 Запись.Результат = - Выборка.ЧасовФакт * Выборка.Ставка;<br>
 Запись.РабочихДней = 0; // Сторно запись не должна изменить количество плановых (рабочих) дней<br>
 Иначе<br>
 Запись.Результат = Выборка.ЧасовФакт * Выборка.Ставка;<br>
 Запись.РабочихДней = Выборка.ДнейПлан;<br>
 КонецЕсли; <br>
 <br>
 Выборка.Сбросить(); <br>
 КонецЕсли;<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать(, Истина); <br>
 <br>
 <br>
 // РАСЧЕТ БОЛЬНИЧНОГО <br>
 // Формула расчета: [Сумма базы (по окладу)][Количество рабочих дней в базовом периоде] * [Количество дней больничного]<br>
 <br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | РАЗНОСТЬДАТ(ОсновныеНачисленияБазаОсновныеНачисления.ПериодДействияНачало, ОсновныеНачисленияБазаОсновныеНачисления.ПериодДействияКонец, ДЕНЬ) + 1 КАК ДнейБолезни,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.РезультатБаза КАК База,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.РабочихДнейБаза КАК РабочихДнейБаза,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.НомерСтроки КАК НомерСтроки<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаБольничный) КАК ОсновныеНачисленияБазаОсновныеНачисления";<br>
 <br>
 Измерения = Новый Массив (2);<br>
 Измерения[0] = "Сотрудник";<br>
 Измерения[1] = "Подразделение";<br>
 <br>
 Запрос.УстановитьПараметр("ВидРасчетаБольничный", ПланыВидовРасчета.ОсновныеНачисления.Больничный);<br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 <br>
 Запись.Результат = ?(Выборка.РабочихДнейБаза = 0, 0, Выборка.База / Выборка.РабочихДнейБаза * Выборка.ДнейБолезни); <br>
 Запись.ДнейБолезни = Выборка.ДнейБолезни;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЕсли;<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать(, Истина);<br>
КонецПроцедуры</p>

<p>9. Отчет АнализНачисленийБольничных<br>
Запрос:</p>

<p>ВЫБРАТЬ<br>
 ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 ОсновныеНачисления.Подразделение КАК Подразделение,<br>
 ОсновныеНачисления.ДнейБолезни КАК ДнейБолезни,<br>
 ОсновныеНачисления.Результат КАК СуммаНачисленногоБольничного<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.ВидРасчета = &ВидРасчетаБольничный<br>
 И ОсновныеНачисления.Активность<br>
 И ОсновныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода</p>

<p>ресурсы ДнейБолезни, СуммаНачисленногоБольничного (все сумма)<br>
Параметры: Период СтандартныйПериод, НачалоПериода Дата НачалоПериода(&Период.ДатаНачала) огр дост, КонецПериода Дата КонецПериода(&Период.ДатаОкончания) огр дост<br>
 ВидРасчетаБольничный ПланВидовРасчетаСсылка.ОсновныеНачисления знач ПланВидовРасчета.ОсновныеНачисления.Больничный<br>
Группировки<br>
1. Заголовок (если надо, канеш)<br>
2. Подразделение, Сотрудник</p>

<p>выб поля Подразделение, Сотрудник, ДнейБолезни, СуммаНачисленногоБольничного </p>

<p>Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить</p>

<p>#СПР10</p>

<p>1. Создать спр Графики</p>

<p>2. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" установить, не зависит <br>
 Предопр виды расч: Тариф (Вытесняющие - Невыход), Невыход (базовые - оклад)</p>

<p>3 В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" снять, зависит по периоду действия, базовый план - ОсновныеНачисления<br>
 Предопр виды расч: Компенсация(базовые - Тариф)</p>

<p>4. Создать регистрСведений ГрафикиРаботы (Непериодический, независимый), изм Дата (Дата), График; рес Часов 5,2, Дней 5,0</p>

<p>5. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Подразделение; рес: Результат 12.2, ДнейФакт 5.0, ДнейПлан 5.0; рекв: График, Параметр 12.3<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = Часов, Дата графика = Дата, Периодичность = месяц, баз.период = Ложь<br>
Регистратор - НачислениеЗарплаты</p>

<p>5. Создать регистр расчета "ДополнительныеНачисления", изм. Сотрудник, Подразделение; рес: Результат 12.2; рекв: ДнейКомпенсации 12.3<br>
указать ПВР - ДополнительныеНачисления, флаг ПериодДействия = Ложь<br>
Регистратор - НачислениеЗарплаты</p>

<br>
<p>6. В обработке ЗаполнениеГрафика добавить рекв шапки График<br>
в модуле формы<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры </p>

<p>в модуле объекта<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей(); <br>
 Набор.Отбор.График.Установить (График);<br>
 <br>
 ЧислоСекундВСутках = 86400; <br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.График = График;<br>
 Запись.Дата = Дат;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.Часов = 0;<br>
 Запись.Дней = 0;<br>
 Иначе <br>
 Запись.Часов = 8;<br>
 Запись.Дней = 1;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<p>7. Создать док НачислениеЗарплаты<br>
ТЧ ОсновныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), График, ДатаНачала, ДатаОкончания (Дата), ТарифнаяСтавка 10.2<br>
ТЧ ДополнительныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ДополнительныеНачисления)<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 <br>
 // регистр ОсновныеНачисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;<br>
 Движение.ПериодДействияКонец = КонецДня(ТекСтрокаОсновныеНачисления.ДатаОкончания);<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;<br>
 Движение.График = ТекСтрокаОсновныеНачисления.График;<br>
 Движение.Параметр = ТекСтрокаОсновныеНачисления.ТарифнаяСтавка;<br>
 КонецЦикла;<br>
 <br>
 // Невыход может вводиться задним числом, поэтому необходимо организовать формирование записей сторно<br>
 СторноЗаписи = Движения.ОсновныеНачисления.ПолучитьДополнение();<br>
 Для Каждого Сторно Из СторноЗаписи Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Сторно); <br>
 Движение.ПериодРегистрации = Сторно.ПериодРегистрацииСторно;<br>
 Движение.ПериодДействияНачало = Сторно.ПериодДействияНачалоСторно;<br>
 Движение.ПериодДействияКонец = Сторно.ПериодДействияКонецСторно;<br>
 Движение.Сторно = Истина;<br>
 КонецЦикла;<br>
 <br>
 // регистр ДополнительныеНачисления<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 <br>
 БазовыйПериодКонец = КонецМесяца(ПериодРегистрации); <br>
 Для Каждого ТекСтрокаДополнительныеНачисления Из ДополнительныеНачисления Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаДополнительныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.БазовыйПериодНачало = ПериодРегистрации;<br>
 Движение.БазовыйПериодКонец = БазовыйПериодКонец;<br>
 Движение.Сотрудник = ТекСтрокаДополнительныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаДополнительныеНачисления.Подразделение;<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочих наборов записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения);<br>
КонецПроцедуры</p>

<p>8. Создать модуль Расчет (Сервер)<br>
Процедура РассчитатьНачисления(Регистратор, Движения) Экспорт<br>
 <br>
 НаборЗаписей = Движения.ОсновныеНачисления;<br>
 РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей); <br>
 НаборЗаписей.Записать(, Истина);<br>
 <br>
 ДопНаборЗаписей = Движения.ДополнительныеНачисления;<br>
 РассчитатьДопНачисления(Регистратор, ДопНаборЗаписей); <br>
 ДопНаборЗаписей.Записать();<br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей)<br>
 // РАСЧЕТ ТАРИФА<br>
 // Формула расчета: [Количество отработанных часов] * [Тарифная ставка]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовФактическийПериодДействия, 0) КАК ЧасовФакт,<br>
 | ОсновныеНачисленияДанныеГрафика.Параметр КАК ТарифнаяСтавка,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейПериодДействия, 0) КАК ДнейПлан,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейФактическийПериодДействия, 0) КАК ДнейФакт<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаТариф) КАК ОсновныеНачисленияДанныеГрафика";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаТариф", ПланыВидовРасчета.ОсновныеНачисления.Тариф);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Если Запись.Сторно Тогда<br>
 Запись.Результат = - Выборка.ЧасовФакт * Выборка.ТарифнаяСтавка;<br>
 Запись.ДнейФакт = - Выборка.ДнейФакт; <br>
 Запись.ДнейПлан = 0;<br>
 Иначе<br>
 Запись.Результат = Выборка.ЧасовФакт * Выборка.ТарифнаяСтавка;<br>
 Запись.ДнейФакт = Выборка.ДнейФакт; <br>
 Запись.ДнейПлан = Выборка.ДнейПлан;<br>
 КонецЕсли;<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьДопНачисления(Регистратор, НаборЗаписей)<br>
 // РАСЧЕТ КОМПЕНСАЦИИ НА ОБЕД<br>
 // Формула расчета: [Сумма базы (по тарифу)] / [Количество рабочих дней] * [Количество отработанных дней]</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.ДнейФактБаза КАК ДнейФакт,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.РезультатБаза КАК База,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.ДнейПланБаза КАК ДнейПлан<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления.БазаОсновныеНачисления(&Измерения, &Измерения, , Регистратор = &Регистратор) КАК ДополнительныеНачисленияБазаОсновныеНачисления";<br>
 <br>
 Измерения = Новый Массив(2);<br>
 Измерения[0] = "Сотрудник";<br>
 Измерения[1] = "Подразделение";<br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения); <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор); <br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ДнейПлан = 0, 0, Выборка.База / Выборка.ДнейПлан * Выборка.ДнейФакт * 0.05);<br>
 Запись.ДнейКомпенсации = Выборка.ДнейФакт; <br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
КонецПроцедуры</p>

<p>9. Отчет АнализНачисленийБольничных<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ДополнительныеНачисления.Сотрудник КАК Сотрудник,<br>
 ДополнительныеНачисления.Подразделение КАК Подразделение,<br>
 ДополнительныеНачисления.ДнейКомпенсации КАК ДнейКомпенсации,<br>
 ДополнительныеНачисления.Результат КАК СуммаКомпенсации<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
ГДЕ<br>
 ДополнительныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода<br>
 И ДополнительныеНачисления.Активность</p>

<p>ресурсы ДнейКомпенсации, СуммаКомпенсации (все сумма)<br>
Параметры: Период СтандартныйПериод, НачалоПериода Дата НачалоПериода(&Период.ДатаНачала) огр дост, КонецПериода Дата КонецПериода(&Период.ДатаОкончания) огр дост</p>

<p>Группировки<br>
1. Заголовок (если надо, канеш)<br>
2. Подразделение -> Сотрудник</p>

<p>выб поля "Кол-во дней, за которые начислена комп-я (ДнейКомпенсации)", "СуммаКомпенсации"</p>

<p>Расположение полей группировок = Отдельно и только в итогах<br>
Расположение общих итогов по вертикали = нет<br>
Выводить параметры = Не выводить<br>
Для Плодразделения: Расположение итогов = нет</p>

<p>#СПР11</p>

<p>1. Создать спр Графики</p>

<p>2. Создать рег сведений СведенияОСотрудниках (В пределах дня), изм: Сотрудник, Подразделение; рес: ТарифнаяСтавка 10.2, ПроцентПремии 5.2</p>

<p>3. Создать рег накопл ДанныеТабеля, изм: Сотрудник, Подразделение; рес ОтработаноЧасов 5.2<br>
регистратор: Табель</p>

<p>4. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" снять, зависит по периоду регистрации<br>
базовые = ОсновныеНачисления <br>
 Предопр виды расч: Тариф (флагов нет), Премия (базовые = тариф), Невыход (флагов нет)</p>

<p>5. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Подразделение; рес. Результат 12,2; рекв Параметр 12.2<br>
Базовый период = Ложь, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<br>
<p>9. Создать док Табель, рекв шапки Подразделение, ТЧ СписокСотрудников рекв Сотрудник, День1 Синоним 1 Строка 3,..., День31 Синоним 31 Строка 3<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ДАННЫЕ ТАБЕЛЯ<br>
 <br>
 Движения.ДанныеТабеля.Записывать = Истина;<br>
 <br>
 НачалоМесяцаТабеля = НачалоМесяца(Дата);<br>
 <br>
 //Обходим все дни каждой строки табличной части. Если значение заполнено и это не буква "К", <br>
 //то преобразовываем к числу и записываем данные по отработанным часам в регистр данных табеля.<br>
 Для Каждого СтрокаТЧ Из СписокСотрудников Цикл <br>
 Для ДеньМесяца = 1 По 31 Цикл<br>
 <br>
 ДанныеДня = СтрокаТЧ["День" + ДеньМесяца];<br>
 <br>
 Если ДанныеДня <> "К" И ЗначениеЗаполнено(ДанныеДня) Тогда<br>
 <br>
 НоваяЗапись = Движения.ДанныеТабеля.Добавить();<br>
 НоваяЗапись.Период = НачалоМесяцаТабеля + (ДеньМесяца - 1) * 86400;<br>
 НоваяЗапись.Сотрудник = СтрокаТЧ.Сотрудник;<br>
 НоваяЗапись.Подразделение = Подразделение;<br>
 <br>
 НоваяЗапись.ОтработаноЧасов = Число (ДанныеДня);<br>
 КонецЕсли;<br>
 КонецЦикла;<br>
 КонецЦикла; <br>
КонецПроцедуры</p>

<p>10. док НачислениеЗарплаты<br>
В ТЧ ОсновныеНачисления: Сотрудник, Подразделение, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), Размер 10.2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // регистр ОсновныеНачисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 КонецБазовогоПериода = КонецМесяца(Дата);<br>
 <br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Если ТекСтрокаОсновныеНачисления.ВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Премия Тогда<br>
 Движение.БазовыйПериодНачало = ПериодРегистрации;<br>
 Движение.БазовыйПериодКонец = КонецБазовогоПериода;<br>
 Движение.Параметр = ТекСтрокаОсновныеНачисления.Размер; // процент премии <br>
 КонецЕсли;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;<br>
 <br>
 КонецЦикла;<br>
 <br>
 // Запись рабочего набора записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистре<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения.ОсновныеНачисления);<br>
КонецПроцедуры</p>

<p>11. Создать модуль Расчет (Сервер)<br>
Процедура РассчитатьНачисления (Регистратор, НаборЗаписей) Экспорт<br>
 // РАСЧЕТ ТАРИФА<br>
 // Формула расчета: [Количество отработанных часов] * [Тарифная ставка]<br>
 <br>
 // Запрос данных для формирования движений, отработанные часы получаем из регистра данных табеля, <br>
 // а тарифную ставку - из регистра сведений СведенияОСотрудниках<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 | ОсновныеНачисления.Подразделение КАК Подразделение<br>
 |ПОМЕСТИТЬ ВТ_НачисленияПоТарифу<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
 |ГДЕ<br>
 | ОсновныеНачисления.Регистратор = &Регистратор<br>
 | И ОсновныеНачисления.ВидРасчета = &ВидРасчетаТариф<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник,<br>
 | Подразделение<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_НачисленияПоТарифу.НомерСтроки КАК НомерСтроки,<br>
 | ВТ_НачисленияПоТарифу.Сотрудник КАК Сотрудник,<br>
 | ВТ_НачисленияПоТарифу.Подразделение КАК Подразделение,<br>
 | ЕСТЬNULL(ДанныеТабеляОбороты.ОтработаноЧасовОборот, 0) КАК ЧасовФакт,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.ТарифнаяСтавка, 0) КАК ТарифнаяСтавка<br>
 |ИЗ<br>
 | ВТ_НачисленияПоТарифу КАК ВТ_НачисленияПоТарифу<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ДанныеТабеля.Обороты(<br>
 | &ПериодРегистрации,<br>
 | &КонецМесяца,<br>
 | ,<br>
 | (Сотрудник, Подразделение) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_НачисленияПоТарифу.Сотрудник,<br>
 | ВТ_НачисленияПоТарифу.Подразделение<br>
 | ИЗ<br>
 | ВТ_НачисленияПоТарифу КАК ВТ_НачисленияПоТарифу)) КАК ДанныеТабеляОбороты<br>
 | ПО ВТ_НачисленияПоТарифу.Сотрудник = ДанныеТабеляОбороты.Сотрудник<br>
 | И ВТ_НачисленияПоТарифу.Подразделение = ДанныеТабеляОбороты.Подразделение<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | (Сотрудник, Подразделение) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_НачисленияПоТарифу.Сотрудник,<br>
 | ВТ_НачисленияПоТарифу.Подразделение<br>
 | ИЗ<br>
 | ВТ_НачисленияПоТарифу КАК ВТ_НачисленияПоТарифу)) КАК СведенияОСотрудникахСрезПоследних<br>
 | ПО ВТ_НачисленияПоТарифу.Сотрудник = СведенияОСотрудникахСрезПоследних.Сотрудник<br>
 | И ВТ_НачисленияПоТарифу.Подразделение = СведенияОСотрудникахСрезПоследних.Подразделение";<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Регистратор.Дата);<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаТариф", ПланыВидовРасчета.ОсновныеНачисления.Тариф);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", ПериодРегистрации);<br>
 Запрос.УстановитьПараметр("КонецМесяца", КонецМесяца(ПериодРегистрации));<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.ЧасовФакт * Выборка.ТарифнаяСтавка;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать(); // Необходимо обязательно записать Тариф т.к. он составляет базу для премии<br>
 <br>
 <br>
 // РАСЧЕТ ПРЕМИИ<br>
 // Формула расчета: [Сумма базы (от тарифа)] * [Процент премии]<br>
 <br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.РезультатБаза КАК База,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.Параметр КАК Процент<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаПремия) КАК ОсновныеНачисленияБазаОсновныеНачисления";<br>
 <br>
 Измерения = Новый Массив(2);<br>
 Измерения[0] = "Сотрудник";<br>
 Измерения[1] = "Подразделение";<br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("ВидРасчетаПремия", ПланыВидовРасчета.ОсновныеНачисления.Премия);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.База * Выборка.Процент / 100;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
 <br>
 НаборЗаписей.Записать();<br>
КонецПроцедуры</p>

<p>12. Отчет НачисленияСотрудникам<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 ОсновныеНачисления.Подразделение КАК Подразделение,<br>
 ОсновныеНачисления.Результат КАК Результат,<br>
 ОсновныеНачисления.ПериодРегистрации КАК ПериодРегистрации,<br>
 ОсновныеНачисления.ВидРасчета КАК ВидРасчета<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода<br>
 И ОсновныеНачисления.Активность</p>

<p>Ресурсы Результат Сумма(Результат)<br>
Параметры: Период СтандартныйПериод, НачалоПериода Дата НачалоПериода(&Период.ДатаНачала, "Месяц") огр дост, КонецПериода Дата КонецПериода(&Период.ДатаОкончания, "Месяц") огр дост</p>

<p>Группировки<br>
1. Заголовок <ПериодРегистрации> Выражение ПериодРегистрации<br>
2. Таблица Строки: Подразделение, Сотрудник, ВидРасчета<br>
 Колонки: ПериодРегистрации</p>

<p>отч выб поля: Результат<br>
Выводить параметры = Не выводить<br>
Расположение общих итогов по горизонтали = нет</p>

<p>#СПР12</p>

<p>1. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" Установить, не зависит<br>
 Предопр виды расч: Тариф (вытесняющее - невыход), Невыход (флагов нет)</p>

<p>2. В ПВР ДополнительныеНачисления вкладка Расчет флаг "Использует период действия" снять, зависит по периоду действия<br>
 Предопр виды расч: Компенсация (базовые - тариф)</p>

<p>3. Создать рег свед ГрафикиРаботы (Непериодический, Независимый), изм: Дата, рес: Часов 5.2, Дней 1.0</p>

<p>4. Создать рег сведений СведенияОСотрудниках (В пределах дня), изм: Сотрудник; рес: Ставка 10.2</p>

<p>5. Создать рег сведений ПроцентыКомпенсации (В пределах месяца), рес: Процент 6.2</p>

<p>6. Создать рег накопл НаезженныеЧасы (Остатки), изм: Сотрудник; рес Количество 7.2<br>
регистратор: НачислениеЗарплаты</p>

<p>7. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник; рес. Результат 12,2; рекв ОтработаноЧасов 5.2<br>
ПВР - ОсновныеНачисления, График - ГрафикиРаботы, Значение графика - Часов, Дата графика - Дата<br>
Базовый период = Ложь, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>8. Создать регистр расчета "ДополнительныеНачисления", изм. Сотрудник; рес. Результат 12,2; рекв Размер 12.2<br>
ПВР - ДополнительныеНачисления, Базовый период = Истина, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>9. Обработка ЗаполнениеГрафика <br>
форма<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры </p>

<p>модуль<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 <br>
 ЧислоСекундВСутках = 86400; <br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = Дат;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.Часов = 0;<br>
 Запись.Дней = 0;<br>
 Иначе <br>
 Запись.Часов = 8;<br>
 Запись.Дней = 1;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<p>10. док НачислениеЗарплаты<br>
В ТЧ ОсновныеНачисления: Сотрудник, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), ДатаНачала, ДатаОкончания<br>
В ТЧ ДополнительныеНачисления: Сотрудник, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), Размер 12.2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 <br>
 // регистр ОсновныеНачисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;<br>
 Движение.ПериодДействияКонец = ТекСтрокаОсновныеНачисления.ДатаОкончания;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 КонецЦикла;</p>

<p> // регистр ДополнительныеНачисления<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 <br>
 КонецБазовогоПериода = КонецМесяца(ПериодРегистрации);<br>
 Для Каждого ТекСтрокаДополнительныеНачисления Из ДополнительныеНачисления Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаДополнительныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.БазовыйПериодНачало = ПериодРегистрации;<br>
 Движение.БазовыйПериодКонец = КонецБазовогоПериода;<br>
 Движение.Сотрудник = ТекСтрокаДополнительныеНачисления.Сотрудник;<br>
 Движение.Размер = ТекСтрокаДополнительныеНачисления.Размер;<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочих наборов записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения);<br>
КонецПроцедуры</p>

<p>11. Создать модуль Расчет (Сервер)</p>

<p>Процедура РассчитатьНачисления(Регистратор, Движения) Экспорт<br>
 НаборЗаписейНаезженныеЧасы = Движения.НаезженныеЧасы;<br>
 <br>
 НаборЗаписейОсновныеНачисления = Движения.ОсновныеНачисления;<br>
 РассчитатьОсновныеНачисления(Регистратор, НаборЗаписейОсновныеНачисления, НаборЗаписейНаезженныеЧасы); <br>
 НаборЗаписейОсновныеНачисления.Записать(, Истина);<br>
 <br>
 ДопНаборЗаписей = Движения.ДополнительныеНачисления;<br>
 РассчитатьДопНачисления(Регистратор, ДопНаборЗаписей, НаборЗаписейНаезженныеЧасы); <br>
 ДопНаборЗаписей.Записать();<br>
КонецПроцедуры</p>

<p>Процедура РассчитатьОсновныеНачисления(Регистратор, НаборЗаписейОсновныеНачисления, НаборЗаписейНаезженныеЧасы)<br>
 // РАСЧЕТ ТАРИФА<br>
 // Формула расчета: [Количество отработанных часов] * [Тарифная ставка]<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Регистратор.Дата);<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ОсновныеНачисленияДанныеГрафика.Сотрудник КАК Сотрудник,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовФактическийПериодДействия, 0) КАК ЧасовФакт<br>
 |ПОМЕСТИТЬ ВТ_ДанныеГрафикаПоТарифу<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаТариф) КАК ОсновныеНачисленияДанныеГрафика<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафикаПоТарифу.НомерСтроки КАК НомерСтроки,<br>
 | ВТ_ДанныеГрафикаПоТарифу.ЧасовФакт КАК ЧасовФакт,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.Ставка, 0) КАК Ставка<br>
 |ИЗ<br>
 | ВТ_ДанныеГрафикаПоТарифу КАК ВТ_ДанныеГрафикаПоТарифу<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | Сотрудник В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафикаПоТарифу.Сотрудник КАК Сотрудник<br>
 | ИЗ<br>
 | ВТ_ДанныеГрафикаПоТарифу КАК ВТ_ДанныеГрафикаПоТарифу)) КАК СведенияОСотрудникахСрезПоследних<br>
 | ПО ВТ_ДанныеГрафикаПоТарифу.Сотрудник = СведенияОСотрудникахСрезПоследних.Сотрудник";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", ПериодРегистрации);<br>
 Запрос.УстановитьПараметр("ВидРасчетаТариф", ПланыВидовРасчета.ОсновныеНачисления.Тариф);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписейОсновныеНачисления Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.ЧасовФакт * Выборка.Ставка;<br>
 Запись.ОтработаноЧасов = Выборка.ЧасовФакт; <br>
 <br>
 // Запись отработанных часов в регистр, накапливающий информацию о наезженных сотруниками часах<br>
 Движение = НаборЗаписейНаезженныеЧасы.ДобавитьПриход();<br>
 Движение.Период = ПериодРегистрации;<br>
 Движение.Сотрудник = Запись.Сотрудник;<br>
 Движение.Количество = Выборка.ЧасовФакт;<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
 <br>
 НаборЗаписейНаезженныеЧасы.Записать();<br>
 <br>
 // РАСЧЕТ НЕВЫХОДА<br>
 // Формула расчета: 5000 * [Количество дней невыхода] <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = "ВЫБРАТЬ<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейФактическийПериодДействия, 0) КАК ДнейФакт,<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаНевыход) КАК ОсновныеНачисленияДанныеГрафика";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаНевыход", ПланыВидовРасчета.ОсновныеНачисления.Невыход);</p>

<p> Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписейОсновныеНачисления Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = 5000 * Выборка.ДнейФакт;<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьДопНачисления(Регистратор, НаборЗаписейДопНачисления, НаборЗаписейНаезженныеЧасы)<br>
 <br>
 // РАСЧЕТ КОМПЕНСАЦИИ<br>
 // Формула расчета: [Сумма базы (по тарифу)] * [Процент компенсации]. Выплата только при превышении 1000 наезденных часов.<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Регистратор.Дата);<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.РезультатБаза КАК База,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.Размер КАК Процент<br>
 |ПОМЕСТИТЬ ВТ_БазаКомпенсации<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления.БазаОсновныеНачисления(&Измерения, &Измерения, , Регистратор = &Регистратор) КАК ДополнительныеНачисленияБазаОсновныеНачисления<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_БазаКомпенсации.НомерСтроки КАК НомерСтроки,<br>
 | ВТ_БазаКомпенсации.База КАК База,<br>
 | ВТ_БазаКомпенсации.Процент КАК Процент<br>
 |ИЗ<br>
 | ВТ_БазаКомпенсации КАК ВТ_БазаКомпенсации<br>
 | ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.НаезженныеЧасы.Остатки(<br>
 | &ПериодРегистрации,<br>
 | Сотрудник В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_БазаКомпенсации.Сотрудник КАК Сотрудник<br>
 | ИЗ<br>
 | ВТ_БазаКомпенсации КАК ВТ_БазаКомпенсации)) КАК НаезженныеЧасыОстатки<br>
 | ПО ВТ_БазаКомпенсации.Сотрудник = НаезженныеЧасыОстатки.Сотрудник<br>
 |ГДЕ<br>
 | НаезженныеЧасыОстатки.КоличествоОстаток > 1000";<br>
 <br>
 Измерения = Новый Массив (1);<br>
 Измерения [0] = "Сотрудник";<br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", Новый Граница(ПериодРегистрации)); // Границу используем, чтобы получить остатки, включая дату периода регистрации<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 <br>
 Результат = Запрос.Выполнить();<br>
 Выборка = Результат.Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписейДопНачисления Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 <br>
 // Сотрудник наездил 1000 часов, рассчитываем компенсацию, списываем 1000 часов в регистре накопления<br>
 Запись.Результат = Выборка.База * Выборка.Процент / 100; <br>
 <br>
 Движение = НаборЗаписейНаезженныеЧасы.ДобавитьРасход();<br>
 Движение.Период = ПериодРегистрации;<br>
 Движение.Сотрудник = Запись.Сотрудник;<br>
 Движение.Количество = 1000;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
 <br>
 // Если были выплаты компенсации, значит в наборе записей зафиксированы списания 1000 часов, необходимо записать их в регистр<br>
 Если Не Результат.Пустой() Тогда<br>
 НаборЗаписейНаезженныеЧасы.Записать();<br>
 КонецЕсли;<br>
КонецПроцедуры</p>

<br>
<p>12. Отчет АнализКомпенсаций<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 ОсновныеНачисления.ОтработаноЧасов КАК ОтработаноЧасов,<br>
 ВЫБОР<br>
 КОГДА ОсновныеНачисления.ВидРасчета = &ВидРасчетаНевыход<br>
 ТОГДА ОсновныеНачисления.Результат <> 0<br>
 ИНАЧЕ ЛОЖЬ<br>
 КОНЕЦ КАК БылШтраф,<br>
 NULL КАК СуммаКомпенсации<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.ПериодРегистрации = НАЧАЛОПЕРИОДА(&Месяц, МЕСЯЦ)<br>
 И ОсновныеНачисления.Активность</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 ДополнительныеНачисления.Сотрудник,<br>
 0,<br>
 ЛОЖЬ,<br>
 ДополнительныеНачисления.Результат<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
ГДЕ<br>
 ДополнительныеНачисления.ПериодРегистрации = НАЧАЛОПЕРИОДА(&Месяц, МЕСЯЦ)<br>
 И ДополнительныеНачисления.Активность</p>

<p>Параметры: ВидРасчетаНевыход ПланВидовРасчетаСсылка.ОсновныеНачисления ПланВидовРасчета.ОсновныеНачисления.Невыход, огр дост<br>
 Месяц Дата</p>

<p>Группировки<br>
1. Сотрудник</p>

<p>Выводить параметры = Не выводить</p>

<p>#СПР13</p>

<p>1 созд справ Бригады, если нету</p>

<p>2. В ПВХ ВидыСубконто <br>
добавить тип знач хар СправочникСсылка.Бригады<br>
добавить предопр знач: Бригада (СправочникСсылка.Бригады)</p>

<p>3. В Плане счетов Управленческий по счету ПрибылиУбытки указать субконто2 Бригада</p>

<p>4. В Док РасходнаяНакладная в обраб проведения добавить "Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Бригады] = Бригада;" Где общ сумма продажи пишется в реистр Управленческий</p>

<p>5. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" Установить, не зависит<br>
 Предопр виды расч: Тариф (флагов нет)</p>

<p>6. В ПВР ДополнительныеНачисления вкладка Расчет флаг "Использует период действия" снять, зависит по периоду регистрации<br>
Базовые планы: ДополнительныеНачисления <br>
 Предопр виды расч: Надбавка, Премия (базовые - Надбавка)</p>

<p>7. Создать рег свед ГрафикиРаботы (Непериодический, Независимый), изм: Дата, рес: Часов 5.2</p>

<p>8. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник; рес. Результат 12,2; рекв Бригада Размер 12.2<br>
ПВР - ОсновныеНачисления, График - ГрафикиРаботы, Значение графика - Часов, Дата графика - Дата<br>
Базовый период = Ложь, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>9. Создать регистр расчета "ДополнительныеНачисления", изм. Сотрудник, Бригада (флаг базовое = истина на вкладке Данные) ; рес. Результат 12,2; рекв Размер 12.2, СуммаПродаж 12.2<br>
ПВР - ДополнительныеНачисления, Базовый период = Истина, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>10. Обработка ЗаполнениеГрафика <br>
форма<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры </p>

<p>модуль<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 <br>
 ЧислоСекундВСутках = 86400; <br>
 Дат = ДатаНачала; <br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = Дат;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.Часов = 0;<br>
 Иначе <br>
 Запись.Часов = 8;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<br>
<p>11. док НачислениеЗарплаты<br>
В ТЧ ОсновныеНачисления: Сотрудник, Бригада, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), ДатаНачала, ДатаОкончания, Размер 12.2<br>
В ТЧ ДополнительныеНачисления: Сотрудник, Бригада, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), Размер 12.2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 // регистр ОсновныеНачисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;<br>
 Движение.ПериодДействияКонец = ТекСтрокаОсновныеНачисления.ДатаОкончания;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 Движение.Бригада = ТекСтрокаОсновныеНачисления.Бригада;<br>
 Движение.Размер = ТекСтрокаОсновныеНачисления.Размер;<br>
 КонецЦикла;</p>

<p> <br>
 // регистр ДополнительныеНачисления<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 <br>
 НачалоБазовогоПериодаПремии = ПериодРегистрации;<br>
 КонецБазовогоПериодаПремии = КонецМесяца(ПериодРегистрации);<br>
 <br>
 Для Каждого ТекСтрокаДополнительныеНачисления Из ДополнительныеНачисления Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаДополнительныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 <br>
 Если ТекСтрокаДополнительныеНачисления.ВидРасчета = ПланыВидовРасчета.ДополнительныеНачисления.Премия Тогда<br>
 Движение.БазовыйПериодНачало = НачалоБазовогоПериодаПремии;<br>
 Движение.БазовыйПериодКонец = КонецБазовогоПериодаПремии;<br>
 КонецЕсли;<br>
 <br>
 Движение.Сотрудник = ТекСтрокаДополнительныеНачисления.Сотрудник;<br>
 Движение.Бригада = ТекСтрокаДополнительныеНачисления.Бригада;<br>
 Движение.Размер = ТекСтрокаДополнительныеНачисления.Размер;<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочих наборов записей<br>
 Движения.Записать(); <br>
 <br>
 // Окончательные расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения);<br>
КонецПроцедуры</p>

<p>12. Создать модуль Расчет (Сервер)</p>

<br>
<p>Процедура РассчитатьНачисления(Регистратор, Движения) Экспорт<br>
 НаборЗаписей = Движения.ОсновныеНачисления;<br>
 РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей); <br>
 НаборЗаписей.Записать(, Истина);<br>
 <br>
 ДопНаборЗаписей = Движения.ДополнительныеНачисления;<br>
 РассчитатьДопНачисления(Регистратор, ДопНаборЗаписей); <br>
 ДопНаборЗаписей.Записать();<br>
КонецПроцедуры</p>

<p>Процедура РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей)<br>
 // РАСЧЕТ ТАРИФА<br>
 // Формула расчета: [Количество отработанных часов] * [Тарифная ставка]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ОсновныеНачисленияДанныеГрафика.Размер КАК Ставка,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовФактическийПериодДействия, 0) КАК ЧасовФакт<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(Регистратор = &Регистратор) КАК ОсновныеНачисленияДанныеГрафика";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.ЧасовФакт * Выборка.Ставка;<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьДопНачисления(Регистратор, НаборЗаписей)<br>
 // РАСЧЕТ НАДБАВКИ<br>
 // Формула расчета: [Сумма продаж по бригаде] * [Процент надбавки]<br>
 <br>
 Запрос = Новый Запрос; <br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ДополнительныеНачисления.Размер КАК Размер,<br>
 | ДополнительныеНачисления.Бригада КАК Бригада<br>
 |ПОМЕСТИТЬ ВТ_ДополнительныеНачисления_Надбавка<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
 |ГДЕ<br>
 | ДополнительныеНачисления.Регистратор = &Регистратор<br>
 | И ДополнительныеНачисления.ВидРасчета = &ВидРасчетаНадбавка<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Бригада<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДополнительныеНачисления_Надбавка.НомерСтроки КАК НомерСтроки,<br>
 | ВТ_ДополнительныеНачисления_Надбавка.Размер КАК Процент,<br>
 | ЕСТЬNULL(УправленческийОборотыДтКт.СуммаОборот, 0) КАК СуммаПродаж<br>
 |ИЗ<br>
 | ВТ_ДополнительныеНачисления_Надбавка КАК ВТ_ДополнительныеНачисления_Надбавка<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.ОборотыДтКт(<br>
 | &НачалоБазовогоПериода,<br>
 | &КонецБазовогоПериода,<br>
 | ,<br>
 | СчетДт = &СчетПокупатели,<br>
 | ,<br>
 | СчетКт = &СчетПрибыли,<br>
 | &СубконтоБригады,<br>
 | СубконтоКт1 В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДополнительныеНачисления_Надбавка.Бригада КАК Бригада<br>
 | ИЗ<br>
 | ВТ_ДополнительныеНачисления_Надбавка КАК ВТ_ДополнительныеНачисления_Надбавка)) КАК УправленческийОборотыДтКт<br>
 | ПО ВТ_ДополнительныеНачисления_Надбавка.Бригада = УправленческийОборотыДтКт.СубконтоКт1";<br>
 <br>
 ПредыдущийКвартал = ДобавитьМесяц(Регистратор.Дата, -3); // для расчета параметров периода регистра бухгалтерии</p>

<p> Запрос.УстановитьПараметр("Регистратор", Регистратор); <br>
 Запрос.УстановитьПараметр("ВидРасчетаНадбавка", ПланыВидовРасчета.ДополнительныеНачисления.Надбавка);<br>
 Запрос.УстановитьПараметр("НачалоБазовогоПериода", НачалоКвартала(ПредыдущийКвартал));<br>
 Запрос.УстановитьПараметр("КонецБазовогоПериода", КонецКвартала(ПредыдущийКвартал));<br>
 Запрос.УстановитьПараметр("СчетПокупатели", ПланыСчетов.Управленческий.Покупатели);<br>
 Запрос.УстановитьПараметр("СчетПрибыли", ПланыСчетов.Управленческий.ПрибылиУбытки);<br>
 Запрос.УстановитьПараметр("СубконтоБригады", ПланыВидовХарактеристик.ВидыСубконто.Бригады);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0); <br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.СуммаПродаж * Выборка.Процент / 100;<br>
 Запись.СуммаПродаж = Выборка.СуммаПродаж;<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
 <br>
 НаборЗаписей.Записать();<br>
 <br>
 // РАСЧЕТ ПРЕМИИ<br>
 // Формула расчета: [Максимальная сумма надбавки в бригаде] * [Процент премии]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеНачисленияБазаДополнительныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | МАКСИМУМ(ДополнительныеНачисленияБазаДополнительныеНачисления.РезультатБаза) КАК МаксСуммаНадбавки,<br>
 | КОЛИЧЕСТВО(ДополнительныеНачисленияБазаДополнительныеНачисления.СотрудникРазрез) КАК СотрудникРазрез,<br>
 | ДополнительныеНачисленияБазаДополнительныеНачисления.Размер КАК Процент<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления.БазаДополнительныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | &Разрезы,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаПремия) КАК ДополнительныеНачисленияБазаДополнительныеНачисления<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ДополнительныеНачисленияБазаДополнительныеНачисления.НомерСтроки,<br>
 | ДополнительныеНачисленияБазаДополнительныеНачисления.Размер";<br>
 <br>
 Измерения = Новый Массив (1);<br>
 Измерения [0] = "Бригада";<br>
 <br>
 Разрезы = Новый Массив (1);<br>
 Разрезы [0] = "Сотрудник";<br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("Разрезы", Разрезы);<br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаПремия", ПланыВидовРасчета.ДополнительныеНачисления.Премия);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.МаксСуммаНадбавки * Выборка.Процент / 100;<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
КонецПроцедуры</p>

<br>
<p>13. Отчет АнализКомпенсаций<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ДополнительныеНачисления.Бригада КАК Бригада,<br>
 ДополнительныеНачисления.Сотрудник КАК Сотрудник,<br>
 ДополнительныеНачисления.СуммаПродаж КАК СуммаПродаж,<br>
 ДополнительныеНачисления.Размер КАК ПроцентНадбавки,<br>
 ДополнительныеНачисления.Результат КАК СуммаПремии<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
ГДЕ<br>
 ДополнительныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода<br>
 И ДополнительныеНачисления.Активность<br>
 И ДополнительныеНачисления.ВидРасчета = &ВидРасчетаНадбавка</p>

<p>рес: СуммаПремии, СуммаПродаж (расч по Сотрудник)</p>

<p>Параметры: ВидРасчетаНадбавка ПланВидовРасчетаСсылка.ДополнительныеНачисления ПланВидовРасчета.ДополнительныеНачисления.Надбавка, огр дост<br>
 НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод</p>

<p>Группировки<br>
1. Сотрудник, Бригада, ПроцентНадбавки </p>

<p>выб поля Бригада, Сотрудник, СуммаПродаж, ПроцентНадбавки, СуммаПремии<br>
Авто позиция ресурсов = Не использовать</p>

<p>#СПР14</p>

<p>1. Создать спр Графики</p>

<p>2. Создать рег сведений СведенияОСотрудниках (В пределах дня), изм: Сотрудник, Подразделение; рес: Оклад 10.2</p>

<p>2. Создать рег сведений ГрафикиРаботы (Непериодический, Независимый), изм: Дата, График; рес: Дней 5.2</p>

<p>3. Создать рег накопл ДанныеТабеля (Обороты), изм: Сотрудник, Подразделение; рес ОтработаноДней 1.0<br>
регистратор: Табель</p>

<p>4. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" установить, не зависит <br>
базовых нет <br>
 Предопр виды расч: Оклад (флагов нет)</p>

<p>4. В ПВР ДополнительныеНачисления вкладка Расчет флаг "Использует период действия" снять, зависит по периоду действия<br>
базовые = ОсновныеНачисления <br>
 Предопр виды расч: Премия (базовые = Оклад)</p>

<p>5. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник, Подразделение (флаг базовое в данных); рес. Результат 12,2; рекв График<br>
ПВР = ОсновныеНачисления, Период действия = истина, Базовый период = Ложь, График = ГрафикиРаботы, Значение графика = дней, Дата графика = Дата, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>5. Создать регистр расчета "ДополнительныеНачисления", изм. Сотрудник, Подразделение; рес. Результат 12,2; рекв Размер 12.2<br>
 ПВР ДополнительныеНачисления, период действия = ложь, Базовый период = Истина, Периодичность = месяц.<br>
Регистратор - НачислениеЗарплаты</p>

<p>6. Обработка ЗаполнениеГрафика в шапку добавить рекв График<br>
модуль формы:<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры</p>

<p>модуль объекта<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.График.Установить (График);<br>
 <br>
 ЧислоСекундВСутках = 86400;</p>

<p> Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.График = График;<br>
 Запись.Дата = Дат;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.Дней = 0;<br>
 Иначе <br>
 Запись.Дней = 1;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
КонецПроцедуры</p>

<br>
<p>9. Создать док Табель, рекв шапки НачалоПериода, КонецПериода (Даты), ТЧ СписокСотрудников рекв Сотрудник, Подразделение, Д1 Синоним Д1 Булево,..., Д7 Синоним Д7 Булево<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)<br>
 // ДВИЖЕНИЯ ПО РЕГИСТРУ ДАННЫЕ ТАБЕЛЯ<br>
 <br>
 Движения.ДанныеТабеля.Записывать = Истина;<br>
 <br>
 НачалоНеделиТабеля = НачалоПериода;<br>
 <br>
 // Обходим все дни каждой строки табличной части. Если флажок в поля дня установлен, <br>
 // то записываем данные по отработанным дням в регистр данных табеля.<br>
 Для Каждого СтрокаТЧ Из СписокСотрудников Цикл <br>
 Для ДеньНедели = 1 По 7 Цикл <br>
 Если СтрокаТЧ["Д" + ДеньНедели] Тогда <br>
 НоваяЗапись = Движения.ДанныеТабеля.Добавить();<br>
 НоваяЗапись.Период = НачалоНеделиТабеля + (ДеньНедели - 1) * 86400;<br>
 НоваяЗапись.Сотрудник = СтрокаТЧ.Сотрудник;<br>
 НоваяЗапись.Подразделение = СтрокаТЧ.Подразделение; <br>
 НоваяЗапись.ОтработаноДней = 1;<br>
 КонецЕсли;<br>
 КонецЦикла;<br>
 КонецЦикла; <br>
КонецПроцедуры</p>

<br>
<p>10. док НачислениеЗарплаты<br>
В ТЧ ОсновныеНачисления: Сотрудник, Подразделение, График, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), ДатаНачала, ДатаОкончания<br>
В ТЧ ДополнительныеНачисления: Сотрудник, Подразделение, ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), Размер 12.2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 <br>
 // регистр ОсновныеНачисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;<br>
 Движение.ПериодДействияКонец = ТекСтрокаОсновныеНачисления.ДатаОкончания;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;<br>
 Движение.График = ТекСтрокаОсновныеНачисления.График;<br>
 КонецЦикла;</p>

<p> // регистр ДополнительныеНачисления<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 <br>
 КонецБазовогоПериода = КонецМесяца(ПериодРегистрации);<br>
 Для Каждого ТекСтрокаДополнительныеНачисления Из ДополнительныеНачисления Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаДополнительныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.БазовыйПериодНачало = ПериодРегистрации;<br>
 Движение.БазовыйПериодКонец = КонецБазовогоПериода;<br>
 Движение.Сотрудник = ТекСтрокаДополнительныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаДополнительныеНачисления.Подразделение;<br>
 Движение.Размер = ТекСтрокаДополнительныеНачисления.Размер;<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочих номеров записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательные расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения);<br>
КонецПроцедуры</p>

<p>11. Создать модуль Расчет (Сервер)<br>
Процедура РассчитатьНачисления(Регистратор, Движения) Экспорт<br>
 НаборЗаписей = Движения.ОсновныеНачисления;<br>
 РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей); <br>
 НаборЗаписей.Записать(, Истина);<br>
 <br>
 ДопНаборЗаписей = Движения.ДополнительныеНачисления;<br>
 РассчитатьДопНачисления(Регистратор, ДопНаборЗаписей); <br>
 ДопНаборЗаписей.Записать();<br>
КонецПроцедуры</p>

<p>Процедура РассчитатьОсновныеНачисления(Регистратор, НаборЗаписей)<br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Оклад] / [Количество рабочих дней] * [Количество отработанных дней]<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Регистратор.Дата);<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ОсновныеНачисленияДанныеГрафика.Сотрудник КАК Сотрудник,<br>
 | ОсновныеНачисленияДанныеГрафика.Подразделение КАК Подразделение,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейПериодДействия, 0) КАК ДнейПлан,<br>
 | ОсновныеНачисленияДанныеГрафика.ПериодДействияНачало КАК ПериодДействияНачало,<br>
 | ОсновныеНачисленияДанныеГрафика.ПериодДействияКонец КАК ПериодДействияКонец<br>
 |ПОМЕСТИТЬ ВТ_ДанныеГрафика<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(Регистратор = &Регистратор) КАК ОсновныеНачисленияДанныеГрафика<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник,<br>
 | Подразделение<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ВТ_ДанныеГрафика.ДнейПлан КАК ДнейПлан,<br>
 | СУММА(ЕСТЬNULL(ДанныеТабеляОбороты.ОтработаноДнейОборот, 0)) КАК ДнейФакт,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.Оклад, 0) КАК Оклад<br>
 |ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ДанныеТабеля.Обороты(<br>
 | &ПериодРегистрации,<br>
 | &КонецМесяца,<br>
 | День,<br>
 | (Сотрудник, Подразделение) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.Сотрудник КАК Сотрудник,<br>
 | ВТ_ДанныеГрафика.Подразделение КАК Подразделение<br>
 | ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика)) КАК ДанныеТабеляОбороты<br>
 | ПО ВТ_ДанныеГрафика.Сотрудник = ДанныеТабеляОбороты.Сотрудник<br>
 | И ВТ_ДанныеГрафика.Подразделение = ДанныеТабеляОбороты.Подразделение<br>
 | И ВТ_ДанныеГрафика.ПериодДействияНачало <= ДанныеТабеляОбороты.Период<br>
 | И ВТ_ДанныеГрафика.ПериодДействияКонец >= ДанныеТабеляОбороты.Период<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | (Сотрудник, Подразделение) В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.Сотрудник КАК Сотрудник,<br>
 | ВТ_ДанныеГрафика.Подразделение КАК Подразделение<br>
 | ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика)) КАК СведенияОСотрудникахСрезПоследних<br>
 | ПО ВТ_ДанныеГрафика.Сотрудник = СведенияОСотрудникахСрезПоследних.Сотрудник<br>
 | И ВТ_ДанныеГрафика.Подразделение = СведенияОСотрудникахСрезПоследних.Подразделение<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ВТ_ДанныеГрафика.НомерСтроки,<br>
 | ВТ_ДанныеГрафика.ДнейПлан,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.Оклад, 0)";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", ПериодРегистрации);<br>
 Запрос.УстановитьПараметр("КонецМесяца", КонецМесяца(ПериодРегистрации));<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ДнейПлан = 0, 0, Выборка.Оклад / Выборка.ДнейПлан * Выборка.ДнейФакт);<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьДопНачисления(Регистратор, НаборЗаписей)<br>
 // РАСЧЕТ ПРЕМИИ<br>
 // Формула расчета: [Сумма базы (по окладу)] * [Процент премии]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.РезультатБаза КАК База,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.Размер КАК Размер<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления.БазаОсновныеНачисления(&Измерения, &Измерения, , Регистратор = &Регистратор) КАК ДополнительныеНачисленияБазаОсновныеНачисления";<br>
 <br>
 Измерения = Новый Массив(1);<br>
 Измерения[0] = "Подразделение";<br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.База * Выборка.Размер / 100;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла;<br>
КонецПроцедуры</p>

<p>12. Отчет НачисленияСотрудникам<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОсновныеНачисления.ПериодРегистрации КАК ПериодРегистрации,<br>
 ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 ОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 ОсновныеНачисления.Результат КАК Результат,<br>
 ОсновныеНачисления.Подразделение КАК Подразделение<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода<br>
 И ОсновныеНачисления.Активность</p>

<p>ОБЪЕДИНИТЬ ВСЕ</p>

<p>ВЫБРАТЬ<br>
 ДополнительныеНачисления.ПериодРегистрации,<br>
 ДополнительныеНачисления.Сотрудник,<br>
 ДополнительныеНачисления.ВидРасчета,<br>
 ДополнительныеНачисления.Результат,<br>
 ДополнительныеНачисления.Подразделение<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления КАК ДополнительныеНачисления<br>
ГДЕ<br>
 ДополнительныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода<br>
 И ДополнительныеНачисления.Активность</p>

<p>Ресурсы Результат Сумма(Результат)<br>
Параметры: Период СтандартныйПериод, НачалоПериода Дата НачалоПериода(&Период.ДатаНачала, "Месяц") огр дост, КонецПериода Дата КонецПериода(&Период.ДатаОкончания, "Месяц") огр дост</p>

<p>Группировки<br>
1. Заголовок <ПериодРегистрации> Выражение ПериодРегистрации<br>
2. Таблица Строки: Подразделение, Сотрудник, ВидРасчета<br>
 Колонки: ПериодРегистрации</p>

<p>отч выб поля: Результат<br>
Выводить параметры = Не выводить<br>
Расположение общих итогов по горизонтали = нет</p>

<p>#СПР15</p>

<p>1. Создать спр Графики</p>

<p>2. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" установить, зависит по периоду действия <br>
Базовые ОсновныеНачисления ДополнительныеНачисления <br>
 Предопр виды расч: Оклад (Вытесняющие - Больничный), Больничный (базовые - оклад, Больничный, Поощрение)</p>

<p>3 В ПВР ДополнительныеНачисления вкладка Расчет флаг "Использует период действия" снять, не зависит, <br>
 Предопр виды расч: Поощрение(флагов нет)</p>

<p>4. Создать регистрСведений ГрафикиРаботы (Непериодический, независимый), изм Дата (Дата), График; рес Часов 5,2, Дней 5,0</p>

<p>5. Создать регистрСведений СведенияОСотрудниках (В пределах дня, независимый), изм Сотрудник; рес Оклад 10.2</p>

<p>6. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник баз; рес: Результат 12.2, РабочихДней 2.0; рекв: График, Подразделение, Параметр 10.2<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = Истина<br>
График = ГрафикиРаботы, Значение графика = Часов, Дата графика = Дата, Периодичность = месяц, баз.период = Истина<br>
Регистратор - НачислениеЗарплаты</p>

<p>7. Создать регистр расчета "ДополнительныеНачисления", изм. Сотрудник баз, Подразделение; рес: Результат 12.2; рекв: Подразделение<br>
указать ПВР - ДополнительныеНачисления, флаг ПериодДействия = Ложь<br>
Регистратор - НачислениеЗарплаты</p><br>
<br>
<br>
<br>
<p>6. В обработке ЗаполнениеГрафика добавить рекв шапки График<br>
в модуле формы<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания);<br>
КонецПроцедуры </p>

<p>в модуле объекта<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания) Экспорт <br>
 <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 <br>
 Набор.Прочитать();<br>
 <br>
 ЧислоСекундВСутках = 86400;<br>
 <br>
 Дат = ДатаНачала;<br>
 <br>
 ТекущийИндексСмены = 0;<br>
 <br>
 МассивСмен = Новый Массив;<br>
 МассивСмен.Добавить(Справочники.Графики.Смена1);<br>
 МассивСмен.Добавить(Справочники.Графики.Смена2);<br>
 МассивСмен.Добавить(Справочники.Графики.Смена3);<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 <br>
 Запись = Набор.Добавить();<br>
 <br>
 Запись.Дата = Дат;<br>
 Запись.График = МассивСмен[ТекущийИндексСмены]; <br>
 <br>
 Запись.Часов = 24;<br>
 Запись.Дней = 1;<br>
 <br>
 Если ДеньНедели(Дат) <= 5 Тогда <br>
 Запись = Набор.Добавить();<br>
 <br>
 Запись.Дата = Дат;<br>
 Запись.График = Справочники.Графики.Пятидневка; <br>
 <br>
 Запись.Дней = 1;<br>
 КонецЕсли;<br>
 <br>
 ТекущийИндексСмены = ТекущийИндексСмены + 1;<br>
 <br>
 Если ТекущийИндексСмены = 3 Тогда<br>
 ТекущийИндексСмены = 0;<br>
 КонецЕсли;<br>
 <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 <br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
 <br>
КонецПроцедуры</p>

<p>7. Создать док НачислениеЗарплаты<br>
ТЧ ОсновныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), График, ДатаНачала, ДатаОкончания (Дата)<br>
ТЧ ДополнительныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ДополнительныеНачисления), Размер 12.2<br>
в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)</p>

<p> // регистр ОсновныеНачисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 <br>
 НачалоБазовогоПериода = ДобавитьМесяц(ПериодРегистрации, -1);<br>
 КонецБазовогоПериода = ПериодРегистрации - 1;<br>
 <br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;<br>
 Движение.ПериодДействияКонец = КонецДня(ТекСтрокаОсновныеНачисления.ДатаОкончания);<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.График = ТекСтрокаОсновныеНачисления.График;<br>
 Если ТекСтрокаОсновныеНачисления.ВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Больничный Тогда<br>
 Движение.БазовыйПериодНачало = НачалоБазовогоПериода;<br>
 Движение.БазовыйПериодКонец = КонецБазовогоПериода;<br>
 Движение.График = Справочники.Графики.Пятидневка;<br>
 КонецЕсли;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;<br>
 КонецЦикла;<br>
 <br>
 // регистр ДополнительныеНачисления<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;</p>

<p> Для Каждого ТекСтрокаДополнительныеНачисления Из ДополнительныеНачисления Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаДополнительныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.Сотрудник = ТекСтрокаДополнительныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаДополнительныеНачисления.Подразделение;<br>
 Движение.Результат = ТекСтрокаДополнительныеНачисления.Размер; // для поощрения сразу рассчитываем Результат<br>
 КонецЦикла;<br>
 <br>
 // Данные могут вводиться задним числом, значит необходимо сформировать сторно записи<br>
 СторноЗаписи = Движения.ОсновныеНачисления.ПолучитьДополнение();<br>
 Для Каждого Сторно Из СторноЗаписи Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 ЗаполнитьЗначенияСвойств(Движение, Сторно);<br>
 Движение.ПериодРегистрации = Сторно.ПериодРегистрацииСторно;<br>
 Движение.ПериодДействияНачало = Сторно.ПериодДействияНачалоСторно;<br>
 Движение.ПериодДействияКонец = Сторно.ПериодДействияКонецСторно;<br>
 Движение.Сторно = Истина;<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочего набора записей <br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистре<br>
 Расчет.РассчитатьНачисления(Ссылка, Движения.ОсновныеНачисления);<br>
КонецПроцедуры</p>

<br>
<p>8. Создать модуль Расчет (Сервер)</p>

<p>Процедура РассчитатьНачисления(Регистратор, НаборЗаписей) Экспорт<br>
 <br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Оклад] / [Количество рабочих часов] * [Количество отработанных часов]</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ОсновныеНачисленияДанныеГрафика.Сотрудник КАК Сотрудник,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовПериодДействия, 0) КАК ЧасовПлан,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовФактическийПериодДействия, 0) КАК ЧасовФакт,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейПериодДействия, 0) КАК ДнейПлан<br>
 |ПОМЕСТИТЬ ВТ_ДанныеГрафика<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОклад) КАК ОсновныеНачисленияДанныеГрафика<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.Оклад, 0) КАК Оклад,<br>
 | ВТ_ДанныеГрафика.ЧасовПлан КАК ЧасовПлан,<br>
 | ВТ_ДанныеГрафика.ЧасовФакт КАК ЧасовФакт,<br>
 | ВТ_ДанныеГрафика.ДнейПлан КАК ДнейПлан<br>
 |ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | Сотрудник В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_ДанныеГрафика.Сотрудник КАК Сотрудник<br>
 | ИЗ<br>
 | ВТ_ДанныеГрафика КАК ВТ_ДанныеГрафика)) КАК СведенияОСотрудникахСрезПоследних<br>
 | ПО ВТ_ДанныеГрафика.Сотрудник = СведенияОСотрудникахСрезПоследних.Сотрудник";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОклад", ПланыВидовРасчета.ОсновныеНачисления.Оклад);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", НачалоМесяца(Регистратор.Дата));<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 <br>
 Если Запись.Сторно Тогда<br>
 Запись.Результат = ?(Выборка.ЧасовПлан = 0, 0, - Запись.Параметр / Выборка.ЧасовПлан * Выборка.ЧасовФакт);<br>
 Запись.РабочихДней = 0; // Сторно запись не должна изменить количество плановых (рабочих) дней<br>
 Иначе<br>
 Запись.Результат = ?(Выборка.ЧасовПлан = 0, 0, Выборка.Оклад / Выборка.ЧасовПлан * Выборка.ЧасовФакт);<br>
 Запись.Параметр = Выборка.Оклад;<br>
 Запись.РабочихДней = Выборка.ДнейПлан;<br>
 КонецЕсли; <br>
 <br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
 <br>
 <br>
 НаборЗаписей.Записать(, Истина);<br>
 <br>
 <br>
 // РАСЧЕТ БОЛЬНИЧНОГО<br>
 // Формула расчета: [Сумма базы (по всем видам расчета)] / [Количество рабочих дней] * [Количество дней по графику пятидневки]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейФактическийПериодДействия, 0) КАК ДнейФакт,<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияБазаОсновныеНачисления.РабочихДнейБаза, 0) КАК РабочихДней,<br>
 | ЕСТЬNULL(ОсновныеНачисленияБазаОсновныеНачисления.РезультатБаза, 0) + ЕСТЬNULL(ОсновныеНачисленияБазаДополнительныеНачисления.РезультатБаза, 0) КАК База<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаБольничный) КАК ОсновныеНачисленияДанныеГрафика<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаБольничный) КАК ОсновныеНачисленияБазаОсновныеНачисления<br>
 | ПО ОсновныеНачисленияДанныеГрафика.НомерСтроки = ОсновныеНачисленияБазаОсновныеНачисления.НомерСтроки<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисления.БазаДополнительныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаБольничный) КАК ОсновныеНачисленияБазаДополнительныеНачисления<br>
 | ПО ОсновныеНачисленияДанныеГрафика.НомерСтроки = ОсновныеНачисленияБазаДополнительныеНачисления.НомерСтроки";<br>
 <br>
 Измерения = Новый Массив(1);<br>
 Измерения[0] = "Сотрудник";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("ВидРасчетаБольничный", ПланыВидовРасчета.ОсновныеНачисления.Больничный);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.РабочихДней = 0, 0, Выборка.База / Выборка.РабочихДней * Выборка.ДнейФакт);<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
 <br>
 НаборЗаписей.Записать(, Истина);</p>

<p>КонецПроцедуры</p>

<br>
<p>9. Отчет ДиаграммаГанта<br>
в модуле формы<br>
создать рекв Диаграмма (ДиаграммаГанта), рекв СтандартПериод<br>
кнопку Сформировать<br>
добавить на форму диаграмму без полей, период и кнопку</p>

<p>&НаКлиенте<br>
Процедура Сформировать(Команда)<br>
 СформироватьНаСервере();<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура СформироватьНаСервере()<br>
 <br>
 Диаграмма.Очистить();<br>
 Диаграмма.Обновление = Ложь;<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияФактическийПериодДействия.ВидРасчета КАК ВидРасчета,<br>
 | ОсновныеНачисленияФактическийПериодДействия.ПериодДействияНачало КАК Начало,<br>
 | ОсновныеНачисленияФактическийПериодДействия.ПериодДействияКонец КАК Конец,<br>
 | ОсновныеНачисленияФактическийПериодДействия.Сотрудник КАК Сотрудник<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ФактическийПериодДействия(ПериодДействия МЕЖДУ &НачалоПериода И &КонецПериода) КАК ОсновныеНачисленияФактическийПериодДействия";<br>
 <br>
 Запрос.УстановитьПараметр("НачалоПериода", Период.ДатаНачала);<br>
 Запрос.УстановитьПараметр("КонецПериода", Период.ДатаОкончания);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Пока Выборка.Следующий() Цикл<br>
 <br>
 Точка = Диаграмма.УстановитьТочку(Выборка.Сотрудник);<br>
 Серия = Диаграмма.УстановитьСерию(Выборка.ВидРасчета);<br>
 Значение = Диаграмма.ПолучитьЗначение(Точка, Серия);<br>
 <br>
 Интервал = Значение.Добавить();<br>
 Интервал.Начало = Выборка.Начало;<br>
 Интервал.Конец = Выборка.Конец;<br>
 <br>
 КонецЦикла;<br>
 <br>
 Диаграмма.Обновление = Истина;<br>
 <br>
КонецПроцедуры</p>

<p>#СПР16</p>

<p>1. Справочники ФизическиеЛица Реквизиты Должность</p>

<p>2. Справочники Должности и Графики</p>

<p>3. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" установить, не зависит<br>
Базовых нет<br>
 Предопр виды расч: оклад</p>

<p>4. В ПВР ДополнительныеНачисления вкладка Расчет флаг "Использует период действия" снять, зависит по периоду действия<br>
Базовые ОсновныеНачисления <br>
 Предопр виды расч: Компенсация(базовые - оклад, ведущие оклад)</p>

<p>5. Создать регистрСведений ГрафикиРаботы (Непериодический, независимый), изм График, Дата (Дата); рес часов 5.2, дней 1.0</p>

<p>6. Создать регистрСведений ДанныеДляРасчетов В пределах дня, независимый), изм нет; рес РазмерКомпенсации 12.2</p>

<p>7. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник баз, Подразделение баз; рес: Результат 12.2, ОтработаноДней 5.0; рекв: Параметр 12.2, График<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = истина, Периодичность = месяц, баз.период = ложь, график ГрафикиРаботы, значение Часов, дата = дата<br>
Регистратор - НачислениеЗарплаты</p>

<p>8. Создать регистр расчета "ДополнительныеНачисления", изм. Сотрудник, Подразделение; рес: Результат 12.2<br>
указать ПВР - ДополнительныеНачисления, флаг ПериодДействия = ложь, Периодичность = месяц, баз.период = Истина<br>
Регистратор - НачислениеЗарплаты<br>
Перерасчет по Сотрудник, Подразделение</p>

<br>
<p>9. В обработке ЗаполнениеГрафика добавить рекв шапки График<br>
в модуле формы<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни);<br>
КонецПроцедуры </p>

<p>в модуле объекта<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.График.Установить(График);<br>
 <br>
 ЧислоСекундВСутках = 86400; <br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = Дат;<br>
 Запись.График = График;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.Часов = 0;<br>
 Запись.Дней = 0;<br>
 Иначе <br>
 Запись.Часов = 8;<br>
 Запись.Дней = 1;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
 <br>
КонецПроцедуры</p>

<br>
<p>7. Создать док НачислениеЗарплаты<br>
ТЧ ОсновныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), График, ДатаНачала, ДатаОкончания, Размер 10.2<br>
ТЧ ДополнительныеНачисления , рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ДополнительныеНачисления)</p>

<p>в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, Режим)<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Дата);<br>
 <br>
 // регистр ОсновныеНачисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 <br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;<br>
 Движение.ПериодДействияКонец = ТекСтрокаОсновныеНачисления.ДатаОкончания;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;<br>
 Движение.График = ТекСтрокаОсновныеНачисления.График;<br>
 Движение.Параметр = ТекСтрокаОсновныеНачисления.Размер;<br>
 КонецЦикла;</p>

<p> // регистр ДополнительныеНачисления<br>
 Движения.ДополнительныеНачисления.Записывать = Истина;<br>
 <br>
 КонецБазовогоПериода = КонецМесяца(ПериодРегистрации);<br>
 Для Каждого ТекСтрокаДополнительныеНачисления Из ДополнительныеНачисления Цикл<br>
 Движение = Движения.ДополнительныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаДополнительныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.БазовыйПериодНачало = ПериодРегистрации;<br>
 Движение.БазовыйПериодКонец = КонецБазовогоПериода;<br>
 Движение.Сотрудник = ТекСтрокаДополнительныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаДополнительныеНачисления.Подразделение;<br>
 КонецЦикла;<br>
 <br>
 // Запись рабочих наборов записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления(Ссылка);</p>

<p>КонецПроцедуры</p><br>
<br>
<p>8. Создать модуль Расчет (Сервер)</p><br>
<br>
<p>Процедура РассчитатьНачисления (Регистратор) Экспорт<br>
 <br>
 РассчитатьОсновныеНачисления(Регистратор); <br>
 РассчитатьДопНачисления(Регистратор); </p>

<p>КонецПроцедуры</p>

<p>Процедура РассчитатьОсновныеНачисления(Регистратор) <br>
 <br>
 НаборЗаписей = РегистрыРасчета.ОсновныеНачисления.СоздатьНаборЗаписей();<br>
 НаборЗаписей.Отбор.Регистратор.Установить(Регистратор);<br>
 НаборЗаписей.Прочитать(); <br>
 <br>
 // РАСЧЕТ ОКЛАДА<br>
 // Формула расчета: [Оклад] / [Количество рабочих часов] * [Количество отработанных часов]</p>

<p> Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовФактическийПериодДействия, 0) КАК ЧасовФакт,<br>
 | ОсновныеНачисленияДанныеГрафика.Параметр КАК Параметр,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЧасовПериодДействия, 0) КАК ЧасовПлан,<br>
 | ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ДнейФактическийПериодДействия, 0) КАК ДнейФакт<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(Регистратор = &Регистратор) КАК ОсновныеНачисленияДанныеГрафика";<br>
 <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ЧасовПлан = 0,0, Выборка.Параметр / Выборка.ЧасовПлан * Выборка.ЧасовФакт);<br>
 Запись.ОтработаноДней = Выборка.ДнейФакт;<br>
 КонецЕсли;<br>
 <br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
 <br>
 НаборЗаписей.Записать(, Истина); <br>
 <br>
КонецПроцедуры</p>

<p>Процедура РассчитатьДопНачисления(Регистратор, ДанныеДопОтбора = Неопределено) Экспорт<br>
 <br>
 ДопНаборЗаписей = РегистрыРасчета.ДополнительныеНачисления.СоздатьНаборЗаписей();<br>
 ДопНаборЗаписей.Отбор.Регистратор.Установить (Регистратор);<br>
 ДопНаборЗаписей.Прочитать();<br>
 <br>
 // РАСЧЕТ КОМПЕНСАЦИИ<br>
 // Формула расчета: [Отработано дней в базе] * [Размер компенсации]<br>
 <br>
 // Текст запроса для расчета данных по компенсации<br>
 // В запросе текст &ДопОтбор будет переопределен при вызове из перерасчетов для установки отбора по сотруднику и подразделению<br>
 Запрос = Новый Запрос;<br>
 ТекстЗапроса = <br>
 "ВЫБРАТЬ<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ЕСТЬNULL(ДанныеДляРасчетов.РазмерКомпенсации, 0) КАК РазмерКомпенсации,<br>
 | ДополнительныеНачисленияБазаОсновныеНачисления.ОтработаноДнейБаза КАК ОтработаноДней<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И &ДопОтбор) КАК ДополнительныеНачисленияБазаОсновныеНачисления<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеДляРасчетов КАК ДанныеДляРасчетов<br>
 | ПО (ИСТИНА)";<br>
 <br>
 Измерения = Новый Массив(2);<br>
 Измерения[0] = "Сотрудник";<br>
 Измерения[1] = "Подразделение"; <br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения); <br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор); <br>
 <br>
 Если ДанныеДопОтбора <> Неопределено Тогда // это перерасчет<br>
 <br>
 // Установили отбор в виртуальной таблице регистра расчета по данным таблицы значений, переденной из отчета по перерасчетам<br>
 ТекстЗапроса = СтрЗаменить(ТекстЗапроса, <br>
 "&ДопОтбор", "(Сотрудник, Подразделение) В (&ДанныеДопОтбора)");<br>
 <br>
 Запрос.УстановитьПараметр("ДанныеДопОтбора", ДанныеДопОтбора);<br>
 <br>
 Иначе // это обычное проведение документа <br>
 ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "И &ДопОтбор", ""); // Если не перерасчет, то удаляем текст для доп.отбора <br>
 КонецЕсли;<br>
 <br>
 Запрос.Текст = ТекстЗапроса;<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 <br>
 Для Каждого Запись Из ДопНаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 <br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.ОтработаноДней * Выборка.РазмерКомпенсации;<br>
 КонецЕсли;<br>
 Выборка.Сбросить();<br>
 КонецЦикла; <br>
 <br>
 ДопНаборЗаписей.Записать();<br>
 <br>
КонецПроцедуры</p>

<br>
<p>9. Отчет Начисления<br>
Запрос:<br>
ВЫБРАТЬ<br>
 Перерасчет.ОбъектПерерасчета КАК ОбъектПерерасчета,<br>
 Перерасчет.ВидРасчета КАК ВидРасчета,<br>
 Перерасчет.Сотрудник КАК Сотрудник,<br>
 Перерасчет.Подразделение КАК Подразделение<br>
ИЗ<br>
 РегистрРасчета.ДополнительныеНачисления.Перерасчет КАК Перерасчет</p>

<p>группировка 1. <Детальные записи></p>

<p>выб поля: ОбъектПерерасчета, ВидРасчета, Сотрудник, Подразделение</p>

<p>в форме отчета (нужно создать)<br>
ДанныеРасшифровки Строка<br>
Результат ТабличныйДокумент<br>
Кнопка Перерассчитать</p>

<p>в модуле формы</p>

<p>&НаСервереБезКонтекста<br>
Процедура ПерерассчитатьНаСервере()</p>

<p> // Получаем данные из таблицы перерасчетов, затем по каждому документу (ОбъектПерерасчета) вызываем процедуру <br>
 // расчета начислений с отбором по сотрудникам и подразделениям, требующим пересчета.<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | Перерасчет.ОбъектПерерасчета КАК ОбъектПерерасчета,<br>
 | Перерасчет.Сотрудник КАК Сотрудник,<br>
 | Перерасчет.Подразделение КАК Подразделение<br>
 |ИЗ<br>
 | РегистрРасчета.ДополнительныеНачисления.Перерасчет КАК Перерасчет<br>
 |ИТОГИ ПО<br>
 | ОбъектПерерасчета";<br>
 <br>
 ДопОтбор = Новый ТаблицаЗначений;<br>
 ДопОтбор.Колонки.Добавить("Сотрудник", Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));<br>
 ДопОтбор.Колонки.Добавить("Подразделение", Новый ОписаниеТипов("СправочникСсылка.Подразделения"));<br>
 <br>
 ВыборкаПоРегистратору = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);<br>
 Пока ВыборкаПоРегистратору.Следующий() Цикл<br>
 ВыборкаПоСотрудникам = ВыборкаПоРегистратору.Выбрать();<br>
 ДопОтбор.Очистить();<br>
 Пока ВыборкаПоСотрудникам.Следующий() Цикл<br>
 НоваяСтрока = ДопОтбор.Добавить();<br>
 ЗаполнитьЗначенияСвойств(НоваяСтрока, ВыборкаПоСотрудникам);<br>
 КонецЦикла;<br>
 <br>
 Расчет.РассчитатьДопНачисления(ВыборкаПоРегистратору.ОбъектПерерасчета, ДопОтбор);<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<p>&НаКлиенте<br>
Процедура Перерассчитать(Команда)<br>
 ПерерассчитатьНаСервере(); <br>
 СкомпоноватьРезультат(); // Переформировываем отчет после перерасчета<br>
КонецПроцедуры</p>

<p>#СПРдоп1</p>

<p>1. Создать регистрСведений ГрафикиРаботы (Непериодический, независимый), изм Дата (Дата), Сотрудник; рес Значение 5,2</p>

<p>2. Создать регистрСведений ТарифныеСтавки В пределах дня, независимый, осн отбор по периоду), изм Сотрудник; рес Ставка 10,2</p>

<p>3. В ПВР ОсновныеНачисления вкладка Расчет флаг "Использует период действия" снять, зависит по периоду регистрации<br>
Базовые ОсновныеНачисления <br>
 Предопр виды расч: Тариф, Отпуск (базовые - оклад), Поощрение</p>

<br>
<p>4. Создать регистр расчета "ОсновныеНачисления", изм. Сотрудник баз; рес: Результат 12.2, ДнейОтработано 2.0; рекв: Подразделение<br>
указать ПВР - ОсновныеНачисления, флаг ПериодДействия = ложь, Периодичность = месяц, баз.период = Истина<br>
Регистратор - НачислениеЗарплаты</p>

<p>5. Регистры накопления РабочееВремя Обороты Измерения Сотрудник, рес ЧасовОтработано 4.2<br>
Регистратор - УчетРабочегоВремени</p>

<br>
<p>6. В обработке ЗаполнениеГрафика добавить рекв шапки Сотрудник<br>
в модуле формы<br>
&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ВыполнитьОбработку();<br>
 Сообщить("Обработка завершена!");<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ВыполнитьОбработку()<br>
 ОбработкаОбъект = РеквизитФормыВЗначение("Объект");<br>
 ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания);<br>
КонецПроцедуры </p>

<p>в модуле объекта<br>
Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни) Экспорт <br>
 <br>
 Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();<br>
 Набор.Отбор.Сотрудник.Установить (Сотрудник);<br>
 <br>
 Набор.Прочитать();<br>
 <br>
 ЧислоСекундВСутках = 86400;<br>
 <br>
 Дат = ДатаНачала;<br>
 <br>
 Пока Дат <= ДатаОкончания Цикл<br>
 Запись = Набор.Добавить();<br>
 Запись.Дата = Дат;<br>
 Запись.Сотрудник = Сотрудник;<br>
 Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда<br>
 Запись.Значение = 0;<br>
 Иначе <br>
 Запись.Значение = 8;<br>
 КонецЕсли; <br>
 Дат = Дат + ЧислоСекундВСутках;<br>
 КонецЦикла; <br>
 <br>
 Набор.Записать();<br>
 <br>
КонецПроцедуры</p>

<br>
<p>7. Создать док НачислениеЗарплаты<br>
ТЧ ОсновныеНачисления, рекв Сотрудник,Подразделение,ВидРасчета (ПланВидовРасчетаСсылка.ОсновныеНачисления), Размер 10.2</p>

<p>в модуле объекта<br>
Процедура ОбработкаПроведения(Отказ, РежимПроведения)</p>

<p> ПериодРегистрации = НачалоМесяца(Дата);<br>
 БазовыйПериодНачало = ДобавитьМесяц(ПериодРегистрации, -12);<br>
 БазовыйПериодКонец = ПериодРегистрации - 1;<br>
 ВидРасчетаОтпуск = ПланыВидовРасчета.ОсновныеНачисления.Отпуск;<br>
 ВидРасчетаПоощрение = ПланыВидовРасчета.ОсновныеНачисления.Поощрение;</p>

<p> // регистр ОсновныеНачисления<br>
 Движения.ОсновныеНачисления.Записывать = Истина;<br>
 Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл<br>
 Движение = Движения.ОсновныеНачисления.Добавить();<br>
 Движение.Сторно = Ложь;<br>
 Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;<br>
 Движение.ПериодРегистрации = ПериодРегистрации;<br>
 Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;<br>
 Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;<br>
 <br>
 Если ТекСтрокаОсновныеНачисления.ВидРасчета = ВидРасчетаОтпуск Тогда<br>
 Движение.БазовыйПериодНачало = БазовыйПериодНачало;<br>
 Движение.БазовыйПериодКонец = БазовыйПериодКонец;<br>
 КонецЕсли;<br>
 <br>
 Если ТекСтрокаОсновныеНачисления.ВидРасчета = ВидРасчетаПоощрение Тогда<br>
 Движение.Результат = ТекСтрокаОсновныеНачисления.Размер; <br>
 КонецЕсли;<br>
 <br>
 КонецЦикла;</p>

<p> // Запись рабочих наборов записей<br>
 Движения.Записать();<br>
 <br>
 // Окончательный расчет данных в регистрах<br>
 Расчет.РассчитатьНачисления (Ссылка, Движения.ОсновныеНачисления);</p>

<p>КонецПроцедуры</p>

<p>7. Создать док УчетРабочегоВремени шапка Сотрудник, ДатаНачала, ДатаОкончания; в ТЧ РабочееВремя рекв Дата, КоличествоЧасов 4.2<br>
в модуле формы:<br>
&НаКлиенте<br>
Процедура ДатаНачалаПриИзменении(Элемент)<br>
 ОбработатьИзменениеДаты(Объект.ДатаНачала);<br>
КонецПроцедуры</p>

<p>&НаКлиенте<br>
Процедура ДатаОкончанияПриИзменении(Элемент)<br>
 ОбработатьИзменениеДаты(Объект.ДатаОкончания);<br>
КонецПроцедуры</p>

<p>&НаКлиенте<br>
Процедура ОбработатьИзменениеДаты(ВведеннаяДата)<br>
 Объект.ДатаНачала = НачалоНедели(ВведеннаяДата);<br>
 Объект.ДатаОкончания = КонецНедели(ВведеннаяДата);<br>
КонецПроцедуры</p>

<p>&НаКлиенте<br>
Процедура Заполнить(Команда)<br>
 ЗаполнитьНаСервере();<br>
КонецПроцедуры</p>

<p>&НаСервере<br>
Процедура ЗаполнитьНаСервере()<br>
 <br>
 // Заполняем табличную часть данными из графика сотрудника за период, указанный в документе<br>
 <br>
 Объект.РабочееВремя.Очистить();<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст =<br>
 "ВЫБРАТЬ<br>
 | ГрафикиРаботы.Дата КАК Дата,<br>
 | ГрафикиРаботы.Значение КАК КоличествоЧасов<br>
 |ИЗ<br>
 | РегистрСведений.ГрафикиРаботы КАК ГрафикиРаботы<br>
 |ГДЕ<br>
 | ГрафикиРаботы.Сотрудник = &Сотрудник<br>
 | И ГрафикиРаботы.Дата МЕЖДУ &НачалоПериода И &КонецПериода";<br>
 <br>
 Запрос.УстановитьПараметр("Сотрудник", Объект.Сотрудник);<br>
 Запрос.УстановитьПараметр("НачалоПериода", Объект.ДатаНачала);<br>
 Запрос.УстановитьПараметр("КонецПериода", Объект.ДатаОкончания);<br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Пока Выборка.Следующий() Цикл<br>
 НоваяСтрока = Объект.РабочееВремя.Добавить();<br>
 ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка); // Заполняем дату и количество часов<br>
 КонецЦикла;<br>
 <br>
КонецПроцедуры</p>

<br>
<p>в модуле объекта:<br>
Процедура ОбработкаПроведения(Отказ, Режим)</p>

<p> // ДВИЖЕНИЯ ПО РЕГИСТРУ РАБОЧЕЕ ВРЕМЯ<br>
 <br>
 Движения.РабочееВремя.Записывать = Истина;<br>
 <br>
 Для Каждого ТекСтрокаРабочееВремя Из РабочееВремя Цикл<br>
 <br>
 Если ТекСтрокаРабочееВремя.КоличествоЧасов = 0 Тогда<br>
 Продолжить;<br>
 КонецЕсли;<br>
 <br>
 Движение = Движения.РабочееВремя.Добавить();<br>
 Движение.Сотрудник = Сотрудник;<br>
 Движение.Период = ТекСтрокаРабочееВремя.Дата; <br>
 Движение.ЧасовОтработано = ТекСтрокаРабочееВремя.КоличествоЧасов;<br>
 КонецЦикла;</p>

<p>КонецПроцедуры</p><br>
<br>
<br>
<p>8. Создать модуль Расчет (Сервер)</p>

<br>
<p>Процедура РассчитатьНачисления(Регистратор, НаборЗаписей) Экспорт<br>
 <br>
 ПериодРегистрации = НачалоМесяца(Регистратор.Дата);<br>
 <br>
 // РАСЧЕТ ТАРИФА<br>
 // Формула расчета: [Количество отработанных часов] * [Тарифная ставка]<br>
 <br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ОсновныеНачисления.Сотрудник КАК Сотрудник<br>
 |ПОМЕСТИТЬ ВТ_НачисленияПоТарифу<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
 |ГДЕ<br>
 | ОсновныеНачисления.ВидРасчета = &ВидРасчетаТариф<br>
 | И ОсновныеНачисления.Регистратор = &Регистратор<br>
 |<br>
 |ИНДЕКСИРОВАТЬ ПО<br>
 | Сотрудник<br>
 |;<br>
 |<br>
 |////////////////////////////////////////////////////////////////////////////////<br>
 |ВЫБРАТЬ<br>
 | ВТ_НачисленияПоТарифу.НомерСтроки КАК НомерСтроки,<br>
 | ВТ_НачисленияПоТарифу.Сотрудник КАК Сотрудник,<br>
 | СУММА(ЕСТЬNULL(РабочееВремяОбороты.ЧасовОтработаноОборот, 0)) КАК ЧасовОтработано,<br>
 | МАКСИМУМ(ЕСТЬNULL(ТарифныеСтавкиСрезПоследних.Ставка, 0)) КАК Ставка,<br>
 | СУММА(ВЫБОР<br>
 | КОГДА РабочееВремяОбороты.ЧасовОтработаноОборот ЕСТЬ NULL<br>
 | ТОГДА 0<br>
 | ИНАЧЕ 1<br>
 | КОНЕЦ) КАК ДнейОтработано<br>
 |ИЗ<br>
 | ВТ_НачисленияПоТарифу КАК ВТ_НачисленияПоТарифу<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РабочееВремя.Обороты(<br>
 | &ПериодРегистрации,<br>
 | КОНЕЦПЕРИОДА(&ПериодРегистрации, МЕСЯЦ),<br>
 | День,<br>
 | Сотрудник В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_НачисленияПоТарифу.Сотрудник КАК Сотрудник<br>
 | ИЗ<br>
 | ВТ_НачисленияПоТарифу КАК ВТ_НачисленияПоТарифу)) КАК РабочееВремяОбороты<br>
 | ПО ВТ_НачисленияПоТарифу.Сотрудник = РабочееВремяОбороты.Сотрудник<br>
 | ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ТарифныеСтавки.СрезПоследних(<br>
 | &ПериодРегистрации,<br>
 | Сотрудник В<br>
 | (ВЫБРАТЬ<br>
 | ВТ_НачисленияПоТарифу.Сотрудник КАК Сотрудник<br>
 | ИЗ<br>
 | ВТ_НачисленияПоТарифу КАК ВТ_НачисленияПоТарифу)) КАК ТарифныеСтавкиСрезПоследних<br>
 | ПО ВТ_НачисленияПоТарифу.Сотрудник = ТарифныеСтавкиСрезПоследних.Сотрудник<br>
 |<br>
 |СГРУППИРОВАТЬ ПО<br>
 | ВТ_НачисленияПоТарифу.НомерСтроки,<br>
 | ВТ_НачисленияПоТарифу.Сотрудник";</p>

<p> Запрос.УстановитьПараметр("Регистратор", Регистратор);<br>
 Запрос.УстановитьПараметр("ВидРасчетаТариф", ПланыВидовРасчета.ОсновныеНачисления.Тариф);<br>
 Запрос.УстановитьПараметр("ПериодРегистрации", ПериодРегистрации);<br>
 <br>
 СтруктураПоиска = Новый Структура;<br>
 СтруктураПоиска.Вставить("НомерСтроки", 0);<br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = Выборка.ЧасовОтработано * Выборка.Ставка;<br>
 Запись.ДнейОтработано = Выборка.ДнейОтработано;<br>
 КонецЕсли;<br>
 Выборка.Сбросить(); <br>
 КонецЦикла;<br>
 <br>
 // РАСЧЕТ ОТПУСКА<br>
 // Формула расчета: [Сумма базы (по тарифу)] / [Количество отработанных дней в базовом периоде] * [Количество календарных дней в отпуске]<br>
 Запрос = Новый Запрос;<br>
 Запрос.Текст = <br>
 "ВЫБРАТЬ<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.НомерСтроки КАК НомерСтроки,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.РезультатБаза КАК База,<br>
 | ОсновныеНачисленияБазаОсновныеНачисления.ДнейОтработаноБаза КАК ДнейОтработаноВБазе<br>
 |ИЗ<br>
 | РегистрРасчета.ОсновныеНачисления.БазаОсновныеНачисления(<br>
 | &Измерения,<br>
 | &Измерения,<br>
 | ,<br>
 | Регистратор = &Регистратор<br>
 | И ВидРасчета = &ВидРасчетаОтпуск) КАК ОсновныеНачисленияБазаОсновныеНачисления";<br>
 <br>
 ДнейОтпуска = День(КонецМесяца(ПериодРегистрации)); // количество календарных дней за весь месяц периода регистрации<br>
 <br>
 Измерения = Новый Массив(1);<br>
 Измерения[0] = "Сотрудник";<br>
 <br>
 Запрос.УстановитьПараметр("Измерения", Измерения);<br>
 Запрос.УстановитьПараметр("ВидРасчетаОтпуск", ПланыВидовРасчета.ОсновныеНачисления.Отпуск);<br>
 Запрос.УстановитьПараметр("Регистратор", Регистратор); <br>
 <br>
 Выборка = Запрос.Выполнить().Выбрать();<br>
 Для Каждого Запись Из НаборЗаписей Цикл<br>
 СтруктураПоиска.НомерСтроки = Запись.НомерСтроки;<br>
 Если Выборка.НайтиСледующий(СтруктураПоиска) Тогда<br>
 Запись.Результат = ?(Выборка.ДнейОтработаноВБазе = 0, 0,Выборка.База / Выборка.ДнейОтработаноВБазе * ДнейОтпуска);<br>
 КонецЕсли;<br>
 Выборка.Сбросить(); <br>
 КонецЦикла;</p>

<p> НаборЗаписей.Записать();<br>
 <br>
КонецПроцедуры</p><br>
<br>
<p>9. Отчет Начисления<br>
Запрос:<br>
ВЫБРАТЬ<br>
 ОсновныеНачисления.ПериодРегистрации КАК ПериодРегистрации,<br>
 ОсновныеНачисления.Сотрудник КАК Сотрудник,<br>
 ОсновныеНачисления.Подразделение КАК Подразделение,<br>
 ОсновныеНачисления.ВидРасчета КАК ВидРасчета,<br>
 ОсновныеНачисления.Результат КАК Результат<br>
ИЗ<br>
 РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления<br>
ГДЕ<br>
 ОсновныеНачисления.Активность<br>
 И ОсновныеНачисления.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода</p>

<p>в наборе для поля Накладная выражение представления "Выбор Когда Накладная = Значение(Документ.РасходнаяНакладная.ПустаяСсылка) Тогда "Аванс" Иначе "Расх.Накл. № " + Строка(Накладная.Номер) Конец"</p>

<p>ресурсы Результат</p>

<p>Параметры: НачалоПериода Дата выражение &Период.ДатаНачала, КонецПериода Дата выражение &Период.ДатаОкончания<br>
 Период СтандартныйПериод</p>

<p>1. Заголовок <ПериодРегистрации> <br>
2 Таблица <br>
 Строки Подразделение, Сотрудник, ВидРасчета<br>
 Колонки ПериодРегистрации</p>

<p>выб поля: Результат</p>

<p>Выводить параметры = Не выводить<br>
Расположение общих итогов по вертикали = Нет</p><br>
<br>
